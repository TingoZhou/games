(function(a){a.action=function(){return{role:function(){var b=function(m,n,l,k,c){if(c.length>0){m=[];for(l=0;l<c.length;l++){k=[];n=c[l].frames;for(var i=0;i<n.length;i++){k.push({args:[n[i][0],n[i][1],n[i][2]],step:n[i][3]})}m.push(new a.action.sprite(k,c[l].loop,0,0))}}return m};return function(m,q,l,k,c,i,r,p){this.imageNames=c||[];this.rects=i||[];this.frames=r||[];this.actions=p||[];this.sprites=b(m,this.imageNames,this.rects,this.frames,this.actions)||[];this.x=q||0;this.y=l||0;this.current=k||0;this.zoom=1;this.setSprite=function(d){this.current=d>=this.sprites.length?this.sprites.length-1:d>0?d:0;this.sprites[this.current].setFrame(0);return this};this.getSprite=function(){return this.sprites[this.current]};this.getFrame=function(){return this.frames[this.getSprite().getFrame().args[0]]};this.action=function(){this.x+=this.getSprite().getFrame().args[1];this.y+=this.getSprite().getFrame().args[2]};this.render=function(g,f){if(!g){this.x+=this.getSprite().getFrame().args[1];this.y+=this.getSprite().getFrame().args[2]}for(var n=this.frames[this.getSprite().getFrame().args[0]].frameArray,j=n.length,h=f?f:a.canvas,e,d=0;d<j;d++){e=f?a.getImage(this.imageNames[n[d][0]]):this.imageNames[n[d][0]];h.drawImage(e,this.rects[n[d][0]][n[d][1]][0],this.rects[n[d][0]][n[d][1]][1],this.rects[n[d][0]][n[d][1]][2],this.rects[n[d][0]][n[d][1]][3],parseInt(this.x+n[d][2]*this.zoom),parseInt(this.y+n[d][3]*this.zoom),this.rects[n[d][0]][n[d][1]][2]*this.zoom,this.rects[n[d][0]][n[d][1]][3]*this.zoom)}};this.setZoom=function(d){if(d>0){this.zoom=d}};this.getBodyRect=function(){var d=this.getFrame().bodyRect;return this.zoom==1?d:[d[0]*this.zoom,d[1]*this.zoom,d[2]*this.zoom,d[3]*this.zoom]};this.getAttackRect=function(){var d=this.getFrame().actRect;return this.zoom==1?d:[d[0]*this.zoom,d[1]*this.zoom,d[2]*this.zoom,d[3]*this.zoom]}}}(),sprite:function(){return function(b,g,h,c){this.frames=b||[];this.loop=g;this.current=h||0;this.step=c||0;this.setFrame=function(d){this.current=d>=this.frames.length?this.frames.length-1:d>0?d:0;
if(this.getFrame().step){this.runStep=this.getFrame().step}return this};this.getFrame=function(){return this.frames[this.current]};this.nextFrame=function(){if(this.frames.length>0){if(this.runStep<=0){if(this.loop){this.current++;this.current%=this.frames.length}else{this.current<this.frames.length-1&&this.current++}this.runStep=this.getFrame().step?this.getFrame().step:this.step}else{this.runStep--}}return this};this.preFrame=function(){if(this.frames.length>0){if(this.runStep<=0){if(this.loop){this.current--;if(this.current<0){this.current=this.frames.length-1}}else{this.current>0&&this.current--}this.runStep=this.getFrame().step?this.getFrame().step:this.step}else{this.runStep--}}return this};this.endFrame=function(){return this.current==this.frames.length-1&&this.runStep==0};this.setFrame(h);this.runStep=this.getFrame().step?this.getFrame().step:this.step}}(),fragment:function(){var b;return function(c){this.sprites=c||[];this.queue=function(){if(this.sprites.length>0){if(this.sprites[0].frames.length>0){if(this.sprites[0].runStep<=0){this.sprites[0].runStep=this.sprites[0].step;b=this.sprites[0].frames.shift();this.sprites[0].frames.length==0&&this.sprites.shift()}else{b=this.sprites[0].getFrame();this.sprites[0].runStep--}}}else{b=null}return b}}}()}}()})(jsGame);