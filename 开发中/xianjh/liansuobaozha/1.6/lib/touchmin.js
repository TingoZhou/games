(function(a){a.touch=function(){var b={start:true,imgs:[],width:0,height:0,offset:{left:0,top:0},startPos:{x:0,y:0},releasePos:{x:0,y:0},touches:[],path:[],tracing:false,startTime:0,stopTime:0,traceable:false},e=function(y){y.preventDefault();if(!b.start){return false}var u=b.offset.left<<0,q=b.offset.top<<0,w=b.touches;if(y.touches){for(var x=y.touches,v=x.length,p=0;p<v;p++){w[p]={e:x[p],s:-1}}b.startPos={x:x[0].clientX-u<<0,y:x[0].clientY-q<<0}}else{w[0]={e:y,s:-1};b.startPos={x:y.clientX-u<<0,y:y.clientY-q<<0}}x=b.imgs;var m=x.length;v=w.length;for(var t,s=0;s<v;s++){for(p=m-1;p>=0;p--){if(x[p]&&w[s]){t=x[p];var l=(w[s].e.clientX-u<<0)-t.x<<0,k=(w[s].e.clientY-q<<0)-t.y<<0;if(Math.abs(l)<t.w/2&&Math.abs(k)<t.h/2){t.dx=l;t.dy=k;t=true}else{t=false}if(t){w[s].s=p;x[p].selected=true;break}}}}if(b.traceable&&v==1){b.path=[];b.tracing=true;b.startTime=(new Date).getTime();b.path[0]={x:w[0].e.clientX-u<<0,y:w[0].e.clientY-q<<0}}if(b.touchStart){y.touches?b.touchStart(y.touches):b.touchStart([y])}return false},d=function(G){G.preventDefault();if(!b.start){return false}var C=b.offset.left<<0,z=b.offset.top<<0,E=b.touches,F=E.length,D=b.imgs,y=b.width<<0,v=b.height<<0,B,A,u,m,x,t,w=0;t=null;for(var s=0;s<F;s++){if(E[s]){if(G.touches){t=G.touches.length;for(B=0;B<t;B++){if(E[s].e.identifier==G.touches[B].identifier){E[s].e=G.touches[B];break}else{E[s].e=G.touches[s]}}}else{E[0].e=G}t=E[s].e;w=E[s].s;if(w>-1&&D[w]&&D[w].dragable){B=D[w].x;A=D[w].y;u=D[w].w/2;m=D[w].h/2;x=t.clientX-C-D[w].dx;x=x>y-u?y-u:x;x=x<u?u:x;D[w].x=x<<0;x=t.clientY-z-D[w].dy;x=x>v-m?v-m:x;x=x<m?m:x;D[w].y=x<<0;if(Math.abs(D[w].x-B)>3||Math.abs(D[w].y-A)>3){E[s].moveFlag=true}}if(b.traceable&&b.tracing&&F==1){b.stopTime=(new Date).getTime();x=b.stopTime-b.startTime<<0;if(x<1000){B=t.clientX-C<<0;A=t.clientY-z<<0;t=b.path.length;Math.abs(B-b.path[t-1].x)<3&&Math.abs(A-b.path[t-1].y)<3||(b.path[t]={x:B,y:A})}}}}if(b.touchMove){G.touches?b.touchMove(G.touches):b.touchMove([G])}return false},c=function(w){w.preventDefault();if(!b.start){return false}var s=b.offset.left<<0,p=b.offset.top<<0,u=b.imgs,v=b.touches,t=v.length;
if(w.touches){for(var m=w.touches,l=m.length,r=false,q=0;q<t;q++){r=false;for(var k=0;k<l;k++){if(v[q].e.identifier==m[k].identifier){r=true;break}}if(!r){b.releasePos={x:v[q].e.clientX-s<<0,y:v[q].e.clientY-p<<0};if(v[q].s>-1){u[v[q].s].selected=false;if(v[q].moveFlag){b.draged&&u[v[q].s].dragable&&b.draged(u[v[q].s])}else{b.click&&u[v[q].s].clickable&&b.click(u[v[q].s])}}v.splice(q,1);q--;t--}}}else{if(v[0].s>-1){if(u[v[0].s]){u[v[0].s].selected=false;if(v[0].moveFlag){b.draged&&u[v[0].s].dragable&&b.draged(u[v[0].s])}else{b.click&&u[v[0].s].clickable&&b.click(u[v[0].s])}v[0].s=-1}}v[0].moveFlag=false;b.releasePos={x:w.clientX-s<<0,y:w.clientY-p<<0}}if(b.traceable){b.tracing=false}if(b.touchEnd){w.touches?b.touchEnd(w.touches):b.touchEnd([w])}return false};return{imgs:b.imgs,init:function(f){b.width=a.canvas.screen.getWidth();b.height=a.canvas.screen.getHeight();b.offset.left=a.getDom("jsGameScreen").offsetLeft;b.offset.top=a.getDom("jsGameScreen").offsetTop;b.traceable=f;this.bind()},create:function(g,j,h){var k=b.imgs,l=k.length;k[l]=g;k[l].dx=0;k[l].dy=0;k[l].clickable=j;k[l].dragable=h},click:function(f){b.click=f},draged:function(f){b.draged=f},touchStart:function(f){b.touchStart=f},touchMove:function(f){b.touchMove=f},touchEnd:function(f){b.touchEnd=f},resize:function(f){b.resize=f},bind:function(){var f=a.getDom("jsGameScreen");a.canvas.screen.getTouch()?a.events.touchStart(function(g){e(g)}).touchMove(function(g){d(g)}).touchEnd(function(g){c(g)}):a.events.mouseDown(function(){e(event)}).mouseMove(function(){d(event)}).mouseUp(function(){c(event)});document.getElementsByTagName("body")[0].onresize=function(){b.resize&&b.resize();b.offset.left=a.getDom("jsGameScreen").offsetLeft;b.offset.top=a.getDom("jsGameScreen").offsetTop};f.onmouseout=function(){for(var h=b.imgs,g=b.touches,j=g.length,k=0;k<j;k++){if(g[k].s>-1){h[g[k].s].selected=false;g[k].s=-1}}}},unbind:function(){var f=a.getDom("jsGameScreen");f.onmousedown=null;f.onmousemove=null;f.onmouseup=null;f.ontouchstart=null;f.ontouchmove=null;f.ontouchend=null
},getImgs:function(){return b.imgs},deleteImg:function(g){for(var j=b.imgs,h=j.length,l=b.touches,m=l.length,k=0;k<h;k++){if(j[k]&&j[k].id==g){for(g=0;g<m;g++){if(l[g].s>k){l[g].s--}else{if(l[g].s==k){l[g].s=-1}}}j.splice(k,1);return true}}return false},getStartPos:function(){return b.startPos},getReleasePos:function(){return b.releasePos},getPath:function(){return b.path},getGesture:function(){var s;s=b.path;var o=s.length;if(o){var l,q=0;l="null";for(var r="swipeleft",p="swiperight",k="scrollup",h="scrolldown",m=1;m<o;m++){l=s[m].x-s[m-1].x<<0;q=s[m].y-s[m-1].y<<0;if(l>0){r="";if(Math.abs(q)>20){p=""}}if(l<0){p="";if(Math.abs(q)>20){r=""}}if(q>0){k="";if(Math.abs(l)>20){h=""}}if(q<0){h="";if(Math.abs(l)>20){k=""}}}if(Math.abs(s[0].x-s[o-1].x)>100){k=h=""}if(Math.abs(s[0].y-s[o-1].y)>100){r=p=""}if(Math.abs(s[0].x-s[o-1].x)<20){r=p=""}if(Math.abs(s[0].y-s[o-1].y)<20){k=h=""}s=r||p||k||h||"null"}else{s="null"}return s},start:function(){b.start=true},stop:function(){b.start=false}}}()})(jsGame);