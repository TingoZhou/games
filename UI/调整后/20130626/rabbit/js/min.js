function arrayIndexOf(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function arrayContains(e,t){return arrayIndexOf(e,t)>-1}function arrayRemove(e,t){var n=arrayIndexOf(e,t);n>-1&&e.splice(n,1)}function loadImages(e,t){function n(e,t){return function(){t[e]=1}}function r(e){for(var t=0;t<e.length;t++)if(!e[t])return 0;return 1}function i(){if(r(o)){for(u=0;u<e.length;u++)a[e[u]]=s[u];t(a)}else setTimeout(i,100)}var s=[],o=new Array(e.length),u=0,a={};for(;u<e.length;u++)s[u]=document.createElement("img"),s[u].onload=n(u,o),s[u].src=e[u];i()}function Sprite(e){this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.setImage=function(e){this.img=e,this.cx=0,this.cy=0,this.cWidth=e.width,this.cHeight=e.height},e&&this.setImage(e),this.getWidth=function(){return this.cWidth*this.scaleX},this.getHeight=function(){return this.cHeight*this.scaleY},this.getCenterX=function(){return this.x+this.getWidth()/2},this.getCenterY=function(){return this.y+this.getHeight()/2},this.setCenterX=function(e){this.x=e-this.getWidth()/2},this.setCenterY=function(e){this.y=e-this.getHeight()/2},this.draw=function(e){e.globalAlpha=this.alpha,e.drawImage(this.img,this.cx,this.cy,this.cWidth,this.cHeight,this.x,this.y,this.getWidth(),this.getHeight()),e.globalAlpha=1},this.getRectangle=function(){return new Rectangle(this.x,this.y,this.getWidth(),this.getHeight())}}function TextSprite(e){this.x=0,this.y=0,this.text=typeof e=="string"?e:"",this.textAlign="left",this.textBaseline="top",this.font="10px sans-serif",this.color="#ffffff",this.draw=function(e){e.fillStyle=this.color,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.font=this.font,e.fillText(this.text,this.x,this.y)}}function Rectangle(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.contains=function(e,t){return this.x<=e&&e<this.x+this.width&&this.y<=t&&t<this.y+this.height},this.intersects=function(e){if(e.x<this.x){if(e.x+e.width>this.x)return e.y<this.y?e.y+e.height>this.y:e.y<this.y+this.height}else if(e.x<this.x+this.width)return e.y<this.y?e.y+e.height>this.y:e.y<this.y+this.height;return 0}}function TimedTriggerPoller(e){this.totalMillis=0,this.delayMillis=e,this.generateDelayMillis=function(){return this.delayMillis},this.initTimer=function(){this.totalMillis=0,this.delayMillis=this.generateDelayMillis()},this.update=function(e){this.totalMillis+=e,this.totalMillis>=this.delayMillis&&(this.initTimer(),this.timedListener&&this.timedListener.trigger())}}function GameState(){this.load=function(){},this.update=function(){},this.unload=function(){}}function Game(e){function t(t){t.pageX!=undefined?(h=t.pageX-e.offsetLeft,p=t.pageY-e.offsetTop):(h=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-e.offsetLeft,p=t.clientY+document.body.scrollTop+document.documentElement.scrollTop-e.offsetTop)}function n(e){y(e)}function r(e){y(e),v=1}function i(e){y(e),v=0}function s(){var t=e.width;e.width=1,e.width=t;for(var n=0;n<l.length;n++)l[n].draw(c)}function o(){var e=(new Date).getTime(),t=e-a;a=e,u.update(t),setTimeout(o,u.delay)}var u=this,a=(new Date).getTime(),f,l=[],c=e.getContext("2d"),h=0,p=0,d=0,v=0,m=0,g=0;this.delay=33,this.bgColor="#000000",this.getMouseX=function(){return h},this.getMouseY=function(){return p},this.isMouseDown=function(){return v},this.isMouseNewlyDown=function(){return m},this.isMouseNewlyUp=function(){return g};var y;IS_TOUCH?y=function(e){e.touches&&e.touches.item(0)?t(e.touches.item(0)):t(e)}:y=t,IS_TOUCH?(e.ontouchstart=function(){event.preventDefault(),r(event)},e.ontouchmove=n,e.ontouchend=i):(e.onmousedown=r,e.onmousemove=n,e.onmouseup=i),this.update=function(e){m=!d&&v,g=d&&!v,d=v,f&&f.update(e),s()},this.start=function(){o()},this.getCanvas=function(){return e},this.setState=function(e){f&&f.unload(),e&&e.load(),f=e},this.addSprite=function(e){l.push(e)},this.removeSprite=function(e){arrayRemove(l,e)},this.removeAllSprites=function(){l=[]},this.getSpriteArray=function(){return l}}function MultiUpdateExecutor(){var e=[];this.add=function(t){e.push(t)},this.remove=function(t){arrayRemove(e,t)},this.clear=function(){e=[]},this.getUpdateableArray=function(){return e},this.update=function(t){var n=e.slice(),r=0;for(;r<n.length;r++)arrayContains(e,n[r])&&n[r].update(t)}}function ParticleEngine(e){var t=[];this.add=function(n){e.addSprite(n),t.push(n)},this.remove=function(n){e.removeSprite(n),arrayRemove(t,n)},this.clear=function(){for(var n=0;n<t.length;n++)e.removeSprite(t[n]);t=[]},this.update=function(n){var r=0;for(;r<t.length;r++)t[r].update(n);r=0;while(r<t.length)t[r].willDispose(n)?(e.removeSprite(t[r]),t.splice(r,1)):r++}}function SpriteUpdater(e,t,n,r,i,s){this.dx=t?t:0,this.dy=n?n:0,this.dsx=r?r:0,this.dsy=i?i:0,this.dalpha=s?s:0,this.update=function(t){e.x+=this.dx,e.y+=this.dy,e.scaleX+=this.dsx,e.scaleY+=this.dsy,e.alpha+=this.dalpha}}window.onload=function(){function play(e){if(!MUTE)try{AUDIO.src=e,AUDIO.play()}catch(t){}}function addTopScore(e){TOP_10.push(e),TOP_10.sort(function(e,t){return t-e}),TOP_10.length>10&&(TOP_10=TOP_10.slice(0,10)),localStorage.stopTheRabbitsHighScore="["+TOP_10.join(",")+"]"}function MuteButton(){this.superClass=Sprite,this.superClass(IMG["img/ui/btn_soundOn.png"]),this.x=5,this.y=34,this.toggle=function(){MUTE=!MUTE,MUTE?this.setImage(IMG["img/ui/btn_soundOff.png"]):this.setImage(IMG["img/ui/btn_soundOn.png"])}}function FredTextSprite(e){this.superClass=TextSprite,this.superClass(e),this.font="bold 15px "+FONT,this.textAlign="left"}function setScore(e){score=e,SCORE_TEXT.text=""+e}function TypeText(e){this.superClass=FredTextSprite,this.superClass("");var t=e,n=0,r=new TimedTriggerPoller(50);r.timedListener=this,this.setText=function(e){t=e,n=0},this.trigger=function(){n===t.length-1&&this.oncomplete&&this.oncomplete(),n=Math.min(t.length,n+1),this.text=t.substr(0,n)},this.update=function(e){r.update(e)}}function PopupText(e,t,n){this.superClass=FredTextSprite,this.superClass(e),this.a=1,this.color="rgba(255,215,0,"+this.a+")",this.x=t,this.y=n,this.textAlign="center",this.update=function(){this.a=Math.max(0,this.a-.03),this.color="rgba(255,215,0,"+this.a+")",this.y-=.5},this.willDispose=function(){return this.a<=0}}function LoadingState(e){var t=new FredTextSprite("  加载中"),n=[],r=new TimedTriggerPoller(500),i,s;t.x=WIDTH/2-40,t.y=40,n.push(new FredTextSprite("在这游戏中")),n.push(new FredTextSprite("没有兔子会被伤害或杀死")),n.push(new FredTextSprite("一切都只是特效和演技"));for(s=0;s<n.length;s++)n[s].x=WIDTH/2,n[s].y=20*s+70,n[s].textAlign="center";r.timedListener=this,this.load=function(){e.addSprite(BORDER),e.addSprite(t),r.initTimer(),i=0,t.text="  加载中";for(s=0;s<n.length;s++)e.addSprite(n[s])},this.update=function(e){r.update(e)},this.unload=function(){e.removeAllSprites()},this.trigger=function(){i=(i+1)%4;var e="  加载中",n=0;for(;n<i;n++)e+=".";t.text=e}}function SplashScreenState(e){var t=new Sprite(IMG["img/spilgames_splash_screen_for_HTML5.jpg"]),n=0,r=new Sprite(IMG["img/ui/title.png"]),i=.05;this.load=function(){t.scaleX=1,t.alpha=0,e.addSprite(BORDER),e.addSprite(t)},this.update=function(n){t.alpha+=i,t.alpha>=1&&(i=-i,e.addSprite(r),e.removeSprite(t),e.addSprite(t)),i<0&&t.alpha<=0&&e.setState(MENU_STATE)},this.unload=function(){e.removeAllSprites()}}function MenuState(e){var t=new Sprite(IMG["img/ui/title.png"]),n=new Sprite(IMG["img/ui/btn_play.png"]),r=new Sprite(IMG["img/ui/btn_highscore.png"]),i=new Sprite(IMG["img/ui/btn_credits.png"]);n.setCenterX(WIDTH/2),n.y=HEIGHT-n.getHeight()-10,r.x=10,r.y=HEIGHT-r.getHeight()-10,i.x=WIDTH-i.getWidth()-10,i.y=HEIGHT-i.getHeight()+20,this.load=function(){e.addSprite(t),e.addSprite(n),e.addSprite(r),e.addSprite(i),e.addSprite(BORDER)},this.update=function(){e.isMouseNewlyDown()&&(n.getRectangle().contains(e.getMouseX(),e.getMouseY())?(score=0,currentLevel=0,e.setState(LEVEL[0])):r.getRectangle().contains(e.getMouseX(),e.getMouseY())?e.setState(HIGH_SCORE_STATE):i.getRectangle().contains(e.getMouseX(),e.getMouseY())&&e.setState(SCREEN_CREDITS_STATE))},this.unload=function(){e.removeAllSprites()}}function HighScoreState(e){function t(){var t,n,r,i=90,s=0;for(;s<TOP_10.length;s++)t=new FredTextSprite(""+(s+1)),t.x=40,t.y=i+15*s,t.textAlign="center",t.color="black",e.addSprite(t),r=new FredTextSprite(""+TOP_10[s]),r.x=WIDTH-50,r.y=i+15*s,r.textAlign="right",r.color="black",e.addSprite(r);e.addSprite(TOUCH_TEXT)}var n=new Sprite(IMG["img/ui/menu_highScore.png"]);this.load=function(){e.addSprite(n),t()},this.update=function(t){e.isMouseNewlyDown()&&e.setState(MENU_STATE)},this.unload=function(){e.removeAllSprites()}}function ScreenCreditsState(e){var t=new Sprite(IMG["img/ui/credits.png"]),n=new Sprite(IMG["img/ui/btn_exit.png"]);n.x=WIDTH-n.getWidth()-2,n.y=2,this.load=function(){e.addSprite(t),e.addSprite(BORDER),e.addSprite(n)},this.update=function(t){e.isMouseNewlyDown()&&e.setState(MENU_STATE)},this.unload=function(){e.removeAllSprites()}}function CreditsState(e){var t=0,n=new Sprite(HARE_EAT_IMG[0]),r=new Sprite(IMG["img/ui/btn_exit.png"]),i=[],s;i.push(new FredTextSprite("UC Games")),i.push(new FredTextSprite("")),i.push(new FredTextSprite("Designers")),i.push(new FredTextSprite("Teril Bilog")),i.push(new FredTextSprite("Solomon See")),i.push(new FredTextSprite("Steven Pua")),i.push(new FredTextSprite("")),i.push(new FredTextSprite("")),i.push(new FredTextSprite("No rabbits were hurt or killed")),i.push(new FredTextSprite("in this game.")),i.push(new FredTextSprite("Everything is just special effects")),i.push(new FredTextSprite("and good acting.")),i.push(new FredTextSprite("")),i.push(new FredTextSprite("Thank you for playing!!!")),i.push(new FredTextSprite("")),i.push(new FredTextSprite(IS_TOUCH?"touch to continue...":"click to continue..."));for(s=0;s<i.length;s++)i[s].x=WIDTH/2,i[s].y=20*s+20,i[s].textAlign="center";n.alpha=.5,n.update=function(){t=(t+1)%HARE_EAT_IMG.length,n.setImage(HARE_EAT_IMG[t])},r.x=WIDTH-r.getWidth()-2,r.y=2,n.x=(WIDTH-n.getWidth())/2,n.y=(HEIGHT-n.getHeight())/2,this.load=function(){e.addSprite(n),e.addSprite(GRAY_SCREEN),e.addSprite(BORDER),e.addSprite(r);for(s=0;s<i.length;s++)e.addSprite(i[s])},this.update=function(t){n.update(),e.isMouseNewlyDown()&&e.setState(HIGH_SCORE_STATE)},this.unload=function(){e.removeAllSprites()}}function drawCircle(e,t,n,r,i){e.fillStyle=i,e.beginPath(),e.arc(t,n,r,0,TWO_PI,!1),e.closePath(),e.fill()}function Droop(e,t,n){var r=Math.random()*2,i=0,s=n/2,o=e+s;this.update=function(e){i+=r},this.draw=function(r){r.fillStyle="red",r.fillRect(e,t,n,i),drawCircle(r,o,t+i,s,"red")}}function Blood(e,t,n){function r(){bc.clearRect(0,0,WIDTH,HEIGHT),drawCircle(bc,e,t,n,"red");for(var r=0;r<i.length;r++)i[r].draw(bc),i[r].y++}var i=[],s=1,o=e-n+4,u;do u=Math.random()*3+3,i.push(new Droop(o,t+n*Math.sin(Math.acos((o-e)/n))-5,u)),o+=u+Math.random()*8;while(o<e+n-8);this.update=function(e){for(var t=0;t<i.length;t++)i[t].update(e);s-=.02},this.willDispose=function(){return s<=0},this.draw=function(r){r.save(),r.globalAlpha=s,drawCircle(r,e,t,n,"red");for(var o=0;o<i.length;o++)i[o].draw(r);r.restore()}}function Blood2(e,t){this.superClass=Sprite,this.superClass(IMG["img/ui/blood2.png"]),this.setCenterX(e),this.setCenterY(t),this.update=function(e){this.alpha-=.02,this.y+=1},this.willDispose=function(){return this.alpha<=0}}function MinimapUnit(e,t,n){var r=n.getRectangle(),i=r.y,s=r.height,o=e.getWidth()/2;e.y=i+(s-e.getHeight())/2,this.draw=function(r){e.x=n.getScrollX(t.logicalX),e.draw(r)}}function Minimap(e){var t=WIDTH/e.end,n=t*WIDTH,r=new Rectangle(0,HEIGHT-30,WIDTH,30),i=IMG["img/ui/bar.png"];this.getRectangle=function(){return r},this.getScrollX=function(e){return t*e},this.getScreenX=function(e){return e/t},this.draw=function(s){s.drawImage(i,r.x,r.y),s.fillStyle="rgba(119,153,51,.3)",s.fillRect(t*e.screenX,r.y,n,r.height),s.strokeStyle="#779933",s.strokeRect(t*e.screenX,r.y,n,r.height)}}function Background(e){var t=IMG[BG_URL],n=HEIGHT-t.height-30;this.width=2e3,this.draw=function(r){var i=e.screenX%t.width,s=t.width-i,o=WIDTH-s;r.drawImage(t,i,0,s,t.height,0,n,s,t.height),o>0&&r.drawImage(t,0,0,o,t.height,s,n,o,t.height)}}function Unit(e){this.superClass=Sprite,this.superClass(e),this.logicalX=0,this.setLane=function(e){this.lane=e,this.y=LANE_BOTTOM_Y[e]-this.getHeight()}}function Hare(e,t,n,r,i){var s=0,o=0,u,a,f,l,c=e.game,h,p,d=this,v={STAND:function(e){},WALK:function(t){d.setImage(h[o=(o+1)%h.length]),d.logicalX+=d.speed,d.logicalX>=e.end&&!e.isGameOver&&e.gameOver()},JUMP:function(e){d.setImage(HARE_JUMP_IMG[o=(o+1)%HARE_JUMP_IMG.length]),m.update(e)},PICK:function(e){d.setImage(HARE_PICK_IMG[s]),s++,s>=HARE_PICK_IMG.length&&(s=0,d.action="EAT")},EAT:function(e){d.setImage(HARE_EAT_IMG[o=(o+1)%HARE_EAT_IMG.length]),g.totalMillis>=4e3&&(d.alpha=1-(g.totalMillis-4e3)/(g.delayMillis-4e3)),g.update(e)},DIZZY:function(e){d.setImage(HARE_DIZZY_IMG[o=(o+1)%HARE_DIZZY_IMG.length]),y.update(e)},DEAD:function(e){o<p.length&&d.setImage(p[o++])}},m=new TimedTriggerPoller(400),g=new TimedTriggerPoller(5e3),y=new TimedTriggerPoller(2500),b=new TimedTriggerPoller(1e4);i?(h=BLACK_HARE_WALK_IMG,p=BLACK_HARE_DEAD_IMG,this.isBlack=1,this.update=function(e){v[this.action](e)}):(h=HARE_WALK_IMG,p=HARE_DEAD_IMG,this.isBlack=0,this.update=function(e){v[this.action](e),c.isMouseNewlyDown()&&this.getCollisionRectangle().contains(c.getMouseX(),c.getMouseY())&&this.stun()}),this.superClass=Unit,this.superClass(h[0]),u=this.getWidth()/2,a=this.getHeight()*3/10,f=u,l=this.getHeight()-a,this.logicalX=n?n:0,this.speed=t?t:2,this.action="WALK",this.setLane(r?r:0),y.timedListener={trigger:function(){d.action="WALK",o=0}},m.timedListener={trigger:function(){d.action="PICK",o=0}},g.timedListener={trigger:function(){e.killed++,e.addScore(1),e.removeHare(d),e.updateRabbitsLeft()}},this.stand=function(){this.setImage(h[0]),this.action="STAND"},this.stun=function(){this.action=="WALK"&&(this.action="DIZZY",o=0)},this.eat=function(){this.action!="DEAD"&&(this.action="JUMP",o=0)},this.getMinimapUnit=function(e){return new MinimapUnit(new Sprite(IMG["img/ui/marker_enemy.png"]),this,e)},this.getCollisionRectangle=function(){return new Rectangle(this.x+u,this.y+a,f,l)},this.kill=function(){var t=this.getCollisionRectangle();e.removeHare(this)},this.kill2=function(){this.action!="DEAD"&&(o=0,this.scaleX=this.scaleY=.7,this.setImage(p[0]),this.action="DEAD",e.killed++,e.updateRabbitsLeft(),e.addScore(this.isBlack?2:1),play("sounds/ahhh.wav"))}}function SkillMenuItem(e,t,n,r,i){function s(){return o.cooldownTimer.totalMillis/o.cooldownTimer.delayMillis}this.superClass=Sprite,this.superClass(e),this.defaultImg=e;var o=this,u=0,a=n.game,f=-1,l,c=t.height,h=new Sprite(t);this.cooldownTimer=new TimedTriggerPoller(r),this.isCooldown=0,this.countText=new FredTextSprite(""),this.countText.textAlign="right",this.countText.textBaseline="bottom",this.countText.font="11px "+FONT,this.count=0,this.cooldownTimer.timedListener={trigger:function(){o.isCooldown=0,o.setImage(e)}},this.initRect=function(){l=this.getRectangle(),this.countText.x=l.x+l.width-2,this.countText.y=l.y+l.height-2},this.update=function(e){if(!this.count)this.setImage(i[0]);else if(this.isCooldown)this.setImage(i[Math.floor(s()*i.length)]),this.cooldownTimer.update(e);else{var t=a.getMouseX(),r=a.getMouseY();u?a.isMouseNewlyUp()?(a.removeSprite(h),n.skillHold=u=0,this.x=l.x,this.y=l.y,f>-1&&(this.ondrop(h.getCenterX()+n.screenX,f),this.isCooldown=1,this.count--,this.countText.text=""+this.count)):(h.setCenterX(t),r<LANE_Y[0]?(h.setCenterY(r),f=-1):r<LANE_Y[1]?(h.y=LANE_BOTTOM_Y[0]-c,f=0):r<LANE_Y[2]?(h.y=LANE_BOTTOM_Y[1]-c,f=1):(h.y=LANE_BOTTOM_Y[2]-c,f=2)):a.isMouseNewlyDown()&&l.contains(t,r)&&(u=1,n.skillHold=1,a.addSprite(h),h.setCenterX(t),h.setCenterY(r))}}}function Carrot(e,t,n){this.superClass=Unit,this.superClass(IMG["img/ui/trap_carrot.png"]),this.setLane(n),this.logicalX=t-this.getWidth()/2;var r=this.logicalX+this.getWidth()/2;this.update=function(t){var n=0,i,s;for(;n<e.hares.length;n++){i=e.hares[n],s=i.getRectangle();if(!i.isBlack&&i.lane==this.lane&&i.action=="WALK"&&i.logicalX<=r&&i.logicalX+s.width>r){i.eat(),e.removeUnit(this);break}}}}function Smoke(e,t,n){var r=Math.random()*30+20,i=1,s=.01*Math.random()+.01,o=Math.random()*80,u=Math.random()*TWO_PI,a=Math.sin(u),f=Math.cos(u),l=e+o*f,c=t+o*a,h=Math.random()*3*f,p=Math.random()*3*a;this.draw=function(e){e.globalAlpha=i,drawCircle(e,l-n.screenX,c,r,"#555555"),e.globalAlpha=1},this.update=function(e){r=Math.max(0,r-.5),i-=s,l+=h,c+=p},this.willDispose=function(e){return i<=0}}function Bomb(e,t,n){this.superClass=Unit,this.superClass(IMG["img/ui/trap_bomb.png"]);var r=new FredTextSprite("3"),i=new TimedTriggerPoller(1e3),s=this,o=3,u=t-200,a=t+200,f=u+100,l=a-100,c=LANE_BOTTOM_Y[n]-this.getHeight()/2;r.textAlign="center",r.textBaseline="middle",r.font="12px "+FONT,r.y=LANE_Y[n]+58,this.superDraw=this.draw,this.draw=function(n){this.superDraw(n),r.x=t-e.screenX+1,r.draw(n)},i.timedListener={trigger:function(){o--,r.text=""+o;if(o<1){e.removeUnit(s);var n=0,i,u,a,f=t-e.screenX,l,h,p=e.hares.slice(),d=[],v=0;for(;n<10;n++)e.addParticle(new Smoke(t,s.y+s.getHeight()/2,e));for(n=0;n<p.length;n++){i=p[n],h=i.getCollisionRectangle(),l=h.x+h.width/2,u=Math.abs(s.lane-i.lane),a=Math.abs(f-l);if(u<1&&a<150||u<2&&a<75)i.kill(),d.push(i),v+=i.isBlack?2:1,i.action!="DEAD"&&e.killed++}e.updateRabbitsLeft(),v*=d.length,d.length&&e.addParticle(new Blood2(t,c)),e.addScore(v),play("sounds/firework-explosion-1.wav")}}},this.setLane(n),this.logicalX=t-this.getWidth()/2,this.update=function(e){this.scaleY=this.scaleX=this.scaleX+.01,this.setCenterY(c),this.logicalX=t-this.getWidth()/2,i.update(e)}}function BrutalKill(e,t,n){this.superClass=Unit,this.superClass(IMG["img/ui/trap_brutalKill.png"]),this.setLane(n),this.logicalX=t-this.getWidth()/2;var r=this.y-5,i=5,s=1;this.update=function(n){i+=s,this.y=r+i,Math.abs(i)>5&&(s=-s);var o=0,u,a,f=t-e.screenX;for(;o<e.hares.length;o++){u=e.hares[o],a=u.getCollisionRectangle();if(u.lane===this.lane&&u.action!="DEAD"&&a.x<=f&&a.x+a.width>f){u.kill2(),e.removeUnit(this);break}}}}function FredGameState(e){this.game=e;var t=this,n=new Background(this),r,i,s=[],o=new Sprite(IMG["img/ui/btn_pause.png"]),u=new Sprite(IMG["img/ui/btn_exit.png"]),a=new FredTextSprite(""),f=new Sprite(IMG["img/ui/btn_play.png"]),l=new MultiUpdateExecutor,c=new ParticleEngine(e),h={update:function(){if(t.totalRabbits<=t.killed){t.removeUpdateable(this),e.addSprite(YOU_WIN_SPRITE),t.isWin=1;var n=t.carrotSkill.count+t.bombSkill.count+t.brutalKillSkill.count;a.text="未使用工具加分: +"+n,t.addScore(n),e.addSprite(a),play("sounds/sigh-1.wav")}}},p,d=new TimedTriggerPoller(1e3);rabbitsLeft=new FredTextSprite(""),o.x=2,o.y=2,u.x=WIDTH-u.getWidth()-2,u.y=2,a.x=WIDTH/2,a.y=YOU_WIN_SPRITE.y+YOU_WIN_SPRITE.getHeight()-40,a.textAlign="center",a.color="black",a.font="bold 12px "+FONT,f.x=(WIDTH-f.getWidth())/2,f.y=(HEIGHT-f.getHeight())/2,d.timedListener={trigger:function(){p--,TEXT.text=""+p;if(!p){TEXT.text="哇!!!",t.initLevel(),t.addUpdateable(h),t.killed=0,t.totalRabbits=0;for(var n=0;n<t.hares.length;n++)t.hares[n].action!="DEAD"&&t.totalRabbits++;var r=new Sprite(IMG["img/ui/bar_bunniesLeft.png"]);r.y=HEIGHT-r.getHeight()-30,e.addSprite(r),e.addSprite(rabbitsLeft),t.updateRabbitsLeft()}else p<0&&(t.removeUpdateable(this),e.removeSprite(TEXT),e.removeSprite(TEXT_BOX))}},rabbitsLeft.x=95,rabbitsLeft.y=HEIGHT-55,this.end=2e3,this.carrotSkill=new SkillMenuItem(IMG["img/ui/carrot/btn_carrot.png"],IMG["img/ui/trap_carrot.png"],this,3e3,BUTTON_CARROT_COOLDOWN_IMG),this.bombSkill=new SkillMenuItem(IMG["img/ui/bomb/btn_bomb.png"],IMG["img/ui/trap_bomb.png"],this,5e3,BUTTON_BOMB_COOLDOWN_IMG),this.brutalKillSkill=new SkillMenuItem(IMG["img/ui/brutalKill/btn_brutalKill.png"],IMG["img/ui/trap_brutalKill.png"],this,5e3,BUTTON_BRUTAL_KILL_COOLDOWN_IMG),this.carrotSkill.ondrop=function(e,n){t.addUnit(new Carrot(t,e,n))},this.bombSkill.ondrop=function(e,n){t.addUnit(new Bomb(t,e,n))},this.brutalKillSkill.ondrop=function(e,n){t.addUnit(new BrutalKill(t,e,n))},this.carrotSkill.y=5,this.bombSkill.y=5,this.brutalKillSkill.y=5,this.carrotSkill.x=50,this.carrotSkill.initRect(),this.bombSkill.x=120,this.bombSkill.initRect(),this.brutalKillSkill.x=190,this.brutalKillSkill.initRect(),this.hares=[],this.addSkill=function(t,n){this.addUpdateableSprite(t),e.addSprite(t.countText),t.count=n,t.countText.text=""+n,t.cooldownTimer.initTimer(),t.isCooldown=0,t.setImage(t.defaultImg)},this.addParticle=function(e){c.add(e)},this.addUnit=function(e){s.push(e),this.addUpdateableSprite(e)},this.removeUnit=function(e){this.removeUpdateableSprite(e),arrayRemove(s,e)},this.addHare=function(t){this.addUnit(t),t.minimapUnit=t.getMinimapUnit(r),e.addSprite(t.minimapUnit),this.hares.push(t)},this.updateRabbitsLeft=function(){rabbitsLeft.text=""+(this.totalRabbits-this.killed)},this.removeHare=function(t){this.removeUnit(t),e.removeSprite(t.minimapUnit),arrayRemove(this.hares,t)},this.addHares=function(e){e.sort(function(e,t){return e.lane-t.lane});for(var t=0;t<e.length;t++)this.addHare(e[t])},this.addScore=function(e,t,n){this.isGameOver||(setScore(score+e),t&&n&&this.addParticle(new PopupText("+"+e,t,n)))},this.load=function(){e.addSprite(BORDER),e.addSprite(n),e.addSprite(o),e.addSprite(MUTE_BUTTON);var t=new Sprite(IMG["img/ui/bar_score.png"]);t.x=WIDTH-t.getWidth(),t.y=HEIGHT-t.getHeight()-30,e.addSprite(t),r=new Minimap(this),e.addSprite(r),this.hares=[],s=[],this.beforeGameStart(),this.skillHold=0,i=e.getMouseX(),l.add(c),this.isGameOver=0,this.isWin=0,this.screenX=0,this.isPause=0,SCORE_TEXT.text=""+score,e.addSprite(SCORE_TEXT)},this.start=function(){TEXT.text="兔子们马上要来了",p=4,e.addSprite(TEXT_BOX),e.addSprite(TEXT),this.addUpdateable(d)},this.beforeGameStart=this.start,this.addUpdateable=function(e){l.add(e)},this.removeUpdateable=function(e){l.remove(e)},this.addUpdateableSprite=function(t){l.add(t),e.addSprite(t)},this.removeUpdateableSprite=function(t){l.remove(t),e.removeSprite(t)},this.setScreenX=function(e){this.screenX=Math.min(this.end-WIDTH,Math.max(0,e))},this.update=function(t){e.isMouseNewlyDown()&&(o.getRectangle().contains(e.getMouseX(),e.getMouseY())?(this.isPause=!this.isPause,this.isPause?(e.addSprite(GRAY_SCREEN),e.addSprite(u),e.addSprite(f)):(e.removeSprite(GRAY_SCREEN),e.removeSprite(u),e.removeSprite(f))):MUTE_BUTTON.getRectangle().contains(e.getMouseX(),e.getMouseY())&&MUTE_BUTTON.toggle()),this.isPause?e.isMouseNewlyDown()&&(u.getRectangle().contains(e.getMouseX(),e.getMouseY())?e.setState(MENU_STATE):f.getRectangle().contains(e.getMouseX(),e.getMouseY())&&(this.isPause=0,e.removeSprite(GRAY_SCREEN),e.removeSprite(u),e.removeSprite(f))):l.update(e.delay),e.isMouseDown()&&r.getRectangle().contains(e.getMouseX(),e.getMouseY())?this.setScreenX(r.getScreenX(e.getMouseX())-WIDTH/2):this.skillHold||(e.isMouseNewlyDown()?i=e.getMouseX():e.isMouseDown()&&(this.screenX+=-e.getMouseX()+i,this.setScreenX(this.screenX),i=e.getMouseX()));var n=0;for(;n<s.length;n++)s[n].x=s[n].logicalX-this.screenX;this.isWin&&e.isMouseNewlyDown()?(currentLevel++,currentLevel<MAX_LEVEL?e.setState(LEVEL[currentLevel]):((TOP_10.length<10||TOP_10[9]<score)&&addTopScore(score),e.setState(CREDITS_STATE))):this.isGameOver&&e.isMouseNewlyDown()&&e.setState(HIGH_SCORE_STATE)},this.unload=function(){l.clear(),c.clear(),e.removeAllSprites(),this.hares=[],s=[]},this.gameOver=function(){(TOP_10.length<10||TOP_10[9]<score)&&addTopScore(score),this.isGameOver=1,e.addSprite(GAME_OVER_SPRITE)}}function generateRabbits(e,t,n,r,i,s,o,u){function a(){h-=s+Math.random()*o,l=[],v=Math.floor(Math.random()*p+n)}u=u?u:0;var f=[],l=[],c=0,h=-100,p=3-n+1,d,v;a();for(;c<t;c++){while(l.length==v)a();d=Math.floor(Math.random()*3);while(arrayContains(l,d))d=(d+1)%3;f.push(new Hare(e,r+Math.random()*i,h,d,Math.random()<u?1:0)),l.push(d)}return f}function Level0(e){this.superClass=FredGameState,this.superClass(e),this.end=600;var t=this,n=new TimedTriggerPoller(2e3),r={update:function(){t.hares.length<1&&(t.removeUpdateable(this),t.removeUpdateableSprite(TUTORIAL_TEXT),e.removeSprite(TEXT_BOX),t.start())}},i={update:function(){if(t.hares.length<1){t.removeUpdateable(this),TUTORIAL_TEXT.setText("点击兔子减慢它的速度。"),t.addUpdateable(r);for(var e=0,n;e<3;e++)t.addHare(new Hare(t,2,-100,e))}}};this.beforeGameStart=function(){this.addSkill(this.carrotSkill,20),e.addSprite(TEXT_BOX),TUTORIAL_TEXT.setText("不要让兔子走到另一边。"),TUTORIAL_TEXT.oncomplete=function(){t.addUpdateable(n)},n.timedListener={trigger:function(){t.addHare(new Hare(t,2,-100,1)),TUTORIAL_TEXT.oncomplete=null,t.removeUpdateable(n),TUTORIAL_TEXT.setText("拖动萝卜到兔子那里。"),t.addUpdateable(i)}},this.addUpdateableSprite(TUTORIAL_TEXT)},this.initLevel=function(){var e=[],n=-100,r,i=0;e.push(new Hare(t,2,-100,1)),e.push(new Hare(t,2,-250,1)),e.push(new Hare(t,2,-250,2)),e.push(new Hare(t,2,-400,0)),e.push(new Hare(t,2,-400,2)),e.push(new Hare(t,2,-500,0)),e.push(new Hare(t,2,-500,1)),e.push(new Hare(t,2,-600,0)),e.push(new Hare(t,2,-600,1)),e.push(new Hare(t,2,-600,2)),this.addHares(e)}}function Level1(e){this.superClass=FredGameState,this.superClass(e),this.end=700;var t=this;this.beforeGameStart=function(){this.addSkill(this.carrotSkill,12),this.start()},this.initLevel=function(){var e=[],t=-100,n,r=0;e=generateRabbits(this,10,1,3,0,150,50),this.addHares(e)}}function Level2(e){this.superClass=FredGameState,this.superClass(e),this.end=800;var t=this,n=new TimedTriggerPoller(2e3),r={update:function(){t.hares.length<1&&(t.removeUpdateable(this),t.removeUpdateableSprite(TUTORIAL_TEXT),e.removeSprite(TEXT_BOX),t.start())}};this.beforeGameStart=function(){this.addSkill(this.carrotSkill,7),this.addSkill(this.bombSkill,7),e.addSprite(TEXT_BOX),TUTORIAL_TEXT.setText("你解锁了炸弹。"),TUTORIAL_TEXT.oncomplete=function(){t.addUpdateable(n)},n.timedListener={trigger:function(){t.addHare(new Hare(t,2,-150,0)),t.addHare(new Hare(t,2,-150,2)),t.addHare(new Hare(t,2,-100,1)),t.addHare(new Hare(t,2,-150,1)),t.addHare(new Hare(t,2,-200,1)),TUTORIAL_TEXT.oncomplete=null,t.removeUpdateable(n),TUTORIAL_TEXT.setText("Bombs explodes in 3 seconds."),t.addUpdateable(r)}},this.addUpdateableSprite(TUTORIAL_TEXT)},this.initLevel=function(){var e=[],t=-100,n,r=0;e=generateRabbits(this,15,2,3,0,100,0),this.addHares(e)}}function Level3(e){this.superClass=FredGameState,this.superClass(e),this.end=1e3;var t=this;this.beforeGameStart=function(){this.addSkill(this.carrotSkill,3),this.addSkill(this.bombSkill,4),this.start()},this.initLevel=function(){var e=[],t=-100,n,r=0;e=generateRabbits(this,15,2,3,1,100,50),this.addHares(e)}}function Level4(e){this.superClass=FredGameState,this.superClass(e),this.end=1200;var t=this,n=new TimedTriggerPoller(2e3),r={update:function(){if(!t.hares.length||t.hares[0].action==="DEAD")t.removeUpdateableSprite(TUTORIAL_TEXT),e.removeSprite(TEXT_BOX),t.removeUpdateable(this),t.start()}};this.beforeGameStart=function(){this.addSkill(this.carrotSkill,10),this.addSkill(this.bombSkill,3),this.addSkill(this.brutalKillSkill,6),e.addSprite(TEXT_BOX),TUTORIAL_TEXT.setText("黑兔子不吃萝卜。"),TUTORIAL_TEXT.oncomplete=function(){t.addUpdateable(n)},n.timedListener={trigger:function(){t.addHare(new Hare(t,3,-100,1,1)),TUTORIAL_TEXT.oncomplete=null,t.removeUpdateable(n),TUTORIAL_TEXT.setText("使用秘密武器。"),t.addUpdateable(r)}},this.addUpdateableSprite(TUTORIAL_TEXT)},this.initLevel=function(){var e=[],t=-100,n,r=0;e=generateRabbits(this,20,1,3,1,100,50,.3),this.addHares(e)}}function Level5(e){this.superClass=FredGameState,this.superClass(e),this.end=1200;var t=this;this.beforeGameStart=function(){this.addSkill(this.carrotSkill,10),this.addSkill(this.bombSkill,3),this.addSkill(this.brutalKillSkill,8),this.start()},this.initLevel=function(){var e=[],t=-100,n,r=0;e=generateRabbits(this,25,2,3,1,100,50,.5),this.addHares(e)}}function Level6(e){this.superClass=FredGameState,this.superClass(e),this.end=1500;var t=this,n=new TimedTriggerPoller(2e3);this.beforeGameStart=function(){this.addSkill(this.carrotSkill,10),this.addSkill(this.bombSkill,5),this.addSkill(this.brutalKillSkill,10),e.addSprite(TEXT_BOX),TUTORIAL_TEXT.setText("Final Level"),TUTORIAL_TEXT.oncomplete=function(){t.addUpdateable(n)},n.timedListener={trigger:function(){e.removeSprite(TEXT_BOX),t.removeUpdateableSprite(TUTORIAL_TEXT),t.removeUpdateable(n),TUTORIAL_TEXT.oncomplete=null,t.start()}},this.addUpdateableSprite(TUTORIAL_TEXT)},this.initLevel=function(){var e=[],t=-100,n,r=0;e=generateRabbits(this,30,2,3,1,100,50,.5),this.addHares(e)}}var i,WIDTH=320,HEIGHT=455,GAME_RECTANGLE=new Rectangle(0,0,WIDTH,HEIGHT),currentHour=(new Date).getHours(),BG_URL="img/ui/bgPluty.png",LANE_BOTTOM_Y=[],LANE_Y=[],LANE_HEIGHT=75,OFFSET_Y,y,GAME_LEVEL_INTERVAL=15e3,IMG,MENU_STATE,GAME_STATE,HIGH_SCORE_STATE,CREDITS_STATE,SCREEN_CREDITS_STATE,FONT="Tahoma",LEVEL=[],currentLevel=0,MAX_LEVEL=7,score,SCORE_TEXT,YOU_WIN_SPRITE,GAME_OVER_SPRITE,MUTE=0,AUDIO=document.getElementById("sounds"),MUTE_BUTTON,TOP_10=localStorage.stopTheRabbitsHighScore?eval("("+localStorage.stopTheRabbitsHighScore+")"):[],TEXT_BOX={y:0,height:50,draw:function(e){e.fillStyle="rgba(0,0,0,.5)",e.fillRect(0,this.y,WIDTH,this.height)}},TEXT,TUTORIAL_TEXT,LEVEL_TEXT,BORDER={draw:function(e){e.strokeStyle="#888888",e.strokeRect(0,0,WIDTH,HEIGHT)}},GRAY_SCREEN={draw:function(e){e.fillStyle="rgba(0,0,0,.5)",e.fillRect(0,0,WIDTH,HEIGHT)}},CATEGORY;(IS_IPHONE||IS_IPOD)&&!window.navigator.standalone&&(HEIGHT=415),y=HEIGHT-210;for(i=0;i<3;i++)LANE_BOTTOM_Y.push(y),LANE_Y.push(y-LANE_HEIGHT),y+=LANE_HEIGHT;OFFSET_Y=LANE_Y[0],IS_ANDROID?CATEGORY="android":IS_IPAD?CATEGORY="ipad":IS_IPRODUCT?CATEGORY="iphone":CATEGORY="non-mobile";if(IS_TOUCH){var head=document.getElementsByTagName("head")[0],node;node=document.createElement("meta"),node.setAttribute("name","viewport"),IS_IPAD?node.setAttribute("content","user-scalable=no, width=320, initial-scale=2.0, maximum-scale=2.0"):node.setAttribute("content","user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"),head.appendChild(node),node=document.createElement("meta"),node.setAttribute("name","apple-mobile-web-app-capable"),node.setAttribute("content","yes"),head.appendChild(node),node=document.createElement("meta"),node.setAttribute("name","apple-mobile-web-app-status-bar-style"),node.setAttribute("content","black"),head.appendChild(node),node=document.createElement("link"),node.setAttribute("rel","apple-touch-icon"),node.setAttribute("href","img/bunnyPink_walk/bunnyPink_walk0000.png"),head.appendChild(node),node=document.createElement("link"),node.setAttribute("rel","apple-touch-startup-image"),node.setAttribute("href","img/ui/title.png"),head.appendChild(node),window.scrollTo(0,1)}var TOUCH_TEXT=new FredTextSprite(IS_TOUCH?"点击返回菜单...":"点击返回菜单..."),TOUCH_TEXT1=new FredTextSprite(IS_TOUCH?"点击继续...":"点击继续...");TOUCH_TEXT.textAlign="center",TOUCH_TEXT.font="bold 12px "+FONT,TOUCH_TEXT.x=WIDTH/2,TOUCH_TEXT.y=260,TOUCH_TEXT.color="black",TOUCH_TEXT1.textAlign="center",TOUCH_TEXT1.font="bold 12px "+FONT,TOUCH_TEXT1.x=WIDTH/2,TOUCH_TEXT1.y=320,TOUCH_TEXT1.color="black",TEXT=new FredTextSprite(""),TEXT.x=WIDTH/2,TEXT.y=80,TEXT.font="bold 12px "+FONT,TEXT.textAlign="center",TEXT_BOX.y=70,TEXT_BOX.height=40,SCORE_TEXT=new FredTextSprite(""),SCORE_TEXT.x=WIDTH-10,SCORE_TEXT.y=HEIGHT-53,SCORE_TEXT.textAlign="right",LEVEL_TEXT=new FredTextSprite(""),LEVEL_TEXT.x=WIDTH-10,LEVEL_TEXT.y=HEIGHT-53,LEVEL_TEXT.textAlign="right",TUTORIAL_TEXT=new TypeText(""),TUTORIAL_TEXT.x=WIDTH/2,TUTORIAL_TEXT.y=80,TUTORIAL_TEXT.font="bold 12px "+FONT,TUTORIAL_TEXT.textAlign="center";var TWO_PI=Math.PI+Math.PI,HARE_WALK_URL="img/bunnyPink_walk/bunnyPink_walk000",HARE_WALK_IMG=[],HARE_JUMP_URL="img/bunnyPink_eat/bunnyPink_jump/bunny_jump000",HARE_JUMP_IMG=[],HARE_PICK_URL="img/bunnyPink_eat/bunnyPink _carrotGrab/bunny_pick000",HARE_PICK_IMG=[],HARE_EAT_URL="img/bunnyPink_eat/bunnyPink_carrotLove/carrotlove000",HARE_EAT_IMG=[],HARE_DIZZY_URL="img/bunnyPink_dizzy/bunnyPink_dizzy000",HARE_DIZZY_IMG=[],HARE_DEAD_URL="img/bunny_kill/bunnyPink_kill00",HARE_DEAD_IMG=[],BLACK_HARE_WALK_URL="img/bunnyBlack_walk/bunnyBlack_walk000",BLACK_HARE_WALK_IMG=[],BLACK_HARE_DEAD_URL="img/blackBunny_kill/bunnyBlack_kill00",BLACK_HARE_DEAD_IMG=[],BUTTON_CARROT_COOLDOWN_URL="img/ui/carrot/btn_carrot_cooldown0",BUTTON_CARROT_COOLDOWN_IMG=[],BUTTON_BOMB_COOLDOWN_URL="img/ui/bomb/btn_bomb_cooldown0",BUTTON_BOMB_COOLDOWN_IMG=[],BUTTON_BRUTAL_KILL_COOLDOWN_URL="img/ui/brutalKill/btn_brutalKill_cooldown0",BUTTON_BRUTAL_KILL_COOLDOWN_IMG=[],canvas=document.getElementById("canvas"),imgURLs=["img/ui/title.png","img/ui/btn_play.png","img/ui/btn_highscore.png","img/ui/btn_credits.png","img/ui/credits.png","img/ui/btn_soundOff.png","img/ui/btn_soundOn.png",BG_URL,"img/ui/marker_enemy.png","img/ui/blood2.png","img/ui/pane_gameover.png","img/ui/pane_youwin.png","img/ui/menu_highScore.png","img/ui/btn_pause.png","img/ui/btn_exit.png","img/ui/bar.png","img/ui/bar_score.png","img/ui/bar_bunniesLeft.png","img/spilgames_splash_screen_for_HTML5.jpg","img/ui/carrot/btn_carrot.png","img/ui/brutalKill/btn_brutalKill.png","img/ui/bomb/btn_bomb.png","img/ui/trap_carrot.png","img/ui/trap_brutalKill.png","img/ui/trap_bomb.png"],game=new Game(canvas);for(i=0;i<12;i++)imgURLs.push((i<10?HARE_DEAD_URL+"0"+i:HARE_DEAD_URL+i)+".png"),imgURLs.push((i<10?BLACK_HARE_DEAD_URL+"0"+i:BLACK_HARE_DEAD_URL+i)+".png");for(i=0;i<8;i++)imgURLs.push(HARE_WALK_URL+i+".png"),imgURLs.push(BLACK_HARE_WALK_URL+i+".png"),imgURLs.push(HARE_DIZZY_URL+i+".png"),imgURLs.push(BUTTON_CARROT_COOLDOWN_URL+i+".png"),imgURLs.push(BUTTON_BOMB_COOLDOWN_URL+i+".png"),imgURLs.push(BUTTON_BRUTAL_KILL_COOLDOWN_URL+i+".png");for(i=0;i<6;i++)imgURLs.push(HARE_JUMP_URL+i+".png"),imgURLs.push(HARE_PICK_URL+i+".png");for(i=0;i<10;i++)imgURLs.push(HARE_EAT_URL+i+".png");canvas.width=WIDTH,canvas.height=HEIGHT,game.delay=100,game.setState(new LoadingState(game)),game.start(),loadImages(imgURLs,function(e){IMG=e;for(i=0;i<8;i++)HARE_WALK_IMG.push(IMG[HARE_WALK_URL+i+".png"]),BLACK_HARE_WALK_IMG.push(IMG[BLACK_HARE_WALK_URL+i+".png"]),HARE_DIZZY_IMG.push(IMG[HARE_DIZZY_URL+i+".png"]),BUTTON_CARROT_COOLDOWN_IMG.push(IMG[BUTTON_CARROT_COOLDOWN_URL+i+".png"]),BUTTON_BOMB_COOLDOWN_IMG.push(IMG[BUTTON_BOMB_COOLDOWN_URL+i+".png"]),BUTTON_BRUTAL_KILL_COOLDOWN_IMG.push(IMG[BUTTON_BRUTAL_KILL_COOLDOWN_URL+i+".png"]);for(i=0;i<6;i++)HARE_JUMP_IMG.push(IMG[HARE_JUMP_URL+i+".png"]),HARE_PICK_IMG.push(IMG[HARE_PICK_URL+i+".png"]);for(i=0;i<10;i++)HARE_EAT_IMG.push(IMG[HARE_EAT_URL+i+".png"]);for(i=0;i<12;i++)HARE_DEAD_IMG.push(IMG[(i<10?HARE_DEAD_URL+"0"+i:HARE_DEAD_URL+i)+".png"]),BLACK_HARE_DEAD_IMG.push(IMG[(i<10?BLACK_HARE_DEAD_URL+"0"+i:BLACK_HARE_DEAD_URL+i)+".png"]);GAME_OVER_SPRITE=new Sprite(IMG["img/ui/pane_gameover.png"]),GAME_OVER_SPRITE.x=(WIDTH-GAME_OVER_SPRITE.getWidth())/2,GAME_OVER_SPRITE.y=(HEIGHT-GAME_OVER_SPRITE.getHeight())/2,YOU_WIN_SPRITE=new Sprite(IMG["img/ui/pane_youwin.png"]),YOU_WIN_SPRITE.x=(WIDTH-YOU_WIN_SPRITE.getWidth())/2,YOU_WIN_SPRITE.y=(HEIGHT-YOU_WIN_SPRITE.getHeight())/2,MUTE_BUTTON=new MuteButton,LEVEL[0]=new Level0(game),LEVEL[1]=new Level1(game),LEVEL[2]=new Level2(game),LEVEL[3]=new Level3(game),LEVEL[4]=new Level4(game),LEVEL[5]=new Level5(game),LEVEL[6]=new Level6(game),MENU_STATE=new MenuState(game),GAME_STATE=new FredGameState(game),HIGH_SCORE_STATE=new HighScoreState(game),SCREEN_CREDITS_STATE=new ScreenCreditsState(game),CREDITS_STATE=new CreditsState(game),game.setState(new SplashScreenState(game))})};var agent=navigator.userAgent.toLowerCase(),IS_IPAD=agent.indexOf("ipad")>-1,IS_IPHONE=agent.indexOf("iphone")>-1,IS_IPOD=agent.indexOf("ipod")>-1,IS_ANDROID=agent.indexOf("android")>-1,IS_IPRODUCT=IS_IPAD||IS_IPHONE||IS_IPOD,IS_TOUCH=IS_IPAD||IS_IPHONE||IS_IPOD||IS_ANDROID;