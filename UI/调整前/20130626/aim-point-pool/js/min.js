var viewporter;(function(){var e;viewporter={forceDetection:!1,preventPageScroll:!1,ACTIVE:function(){return/ipad/i.test(navigator.userAgent)?!1:/webos/i.test(navigator.userAgent)?!0:"ontouchstart"in window?!0:!1}(),READY:!1,isLandscape:function(){return window.orientation===90||window.orientation===-90},ready:function(e){window.addEventListener("viewportready",e,!1)},change:function(e){window.addEventListener("viewportchange",e,!1)},refresh:function(){e&&e.prepareVisualViewport()}};if(!viewporter.ACTIVE)return;var t=function(){var e=this;this.IS_ANDROID=/Android/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);var t=function(){e.prepareVisualViewport();var t=window.orientation;window.addEventListener("orientationchange",function(){window.orientation!==t&&(e.prepareVisualViewport(),t=window.orientation)},!1),document.body.addEventListener("touchmove",function(e){viewporter.preventPageScroll&&e.preventDefault()},!1),document.body.addEventListener("touchstart",function(){viewporter.preventPageScroll&&e.prepareVisualViewport()},!1)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){t()},!1):t()};t.prototype={getProfile:function(){if(viewporter.forceDetection)return null;for(var e in viewporter.profiles)if((new RegExp(e)).test(navigator.userAgent))return viewporter.profiles[e];return null},postProcess:function(){viewporter.READY=!0,this.triggerWindowEvent(this._firstUpdateExecuted?"viewportchange":"viewportready"),this._firstUpdateExecuted=!0},prepareVisualViewport:function(){var e=this;if(navigator.standalone)return this.postProcess();document.documentElement.style.minHeight="5000px";var t=window.innerHeight,n=this.getProfile(),r=viewporter.isLandscape()?"landscape":"portrait";window.scrollTo(0,e.IS_ANDROID?1:0);var i=40,s=window.setInterval(function(){function o(){return n?window.innerHeight===n[r]:!1}function u(){return window.innerHeight>t}window.scrollTo(0,e.IS_ANDROID?1:0),i--;if((e.IS_ANDROID?o():u())||i<0)document.documentElement.style.minHeight=window.innerHeight+"px",document.getElementById("viewporter").style.position="relative",document.getElementById("viewporter").style.height=window.innerHeight+"px",clearInterval(s),e.postProcess()},10)},triggerWindowEvent:function(e){var t=document.createEvent("Event");t.initEvent(e,!1,!1),window.dispatchEvent(t)}},e=new t})(),viewporter.profiles={MZ601:{portrait:696,landscape:1176},"GT-I9000|GT-I9100|Nexus S":{portrait:508,landscape:295},"GT-P1000":{portrait:657,landscape:400},"Desire_A8181|DesireHD_A9191":{portrait:533,landscape:320}};function PxLoader(e){e=e||{},e.statusInterval==null&&(e.statusInterval=5e3),e.loggingDelay==null&&(e.loggingDelay=2e4),e.noProgressTimeout==null&&(e.noProgressTimeout=Infinity);var t=[],n=[],r,i=+(new Date),s={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},o=function(e){return e==null?[]:Array.isArray(e)?e:[e]};this.add=function(e){e.tags=new PxLoaderTags(e.tags),e.priority==null&&(e.priority=Infinity),t.push({resource:e,state:s.QUEUED})},this.addProgressListener=function(e,t){n.push({callback:e,tags:new PxLoaderTags(t)})},this.addCompletionListener=function(e,t){n.push({tags:new PxLoaderTags(t),callback:function(t){t.completedCount===t.totalCount&&e()}})};var u=function(e){e=o(e);var t=function(t){var n=t.resource,r=Infinity;for(var i=0;i<n.tags.length;i++)for(var s=0;s<Math.min(e.length,r);s++){if(n.tags[i]==e[s]&&s<r){r=s;if(r===0)break}if(r===0)break}return r};return function(e,n){var r=t(e),i=t(n);return r<i?-1:r>i?1:e.priority<n.priority?-1:e.priority>n.priority?1:0}};this.start=function(e){r=+(new Date);var n=u(e);t.sort(n);for(var i=0,o=t.length;i<o;i++){var f=t[i];f.status=s.WAITING,f.resource.start(this)}setTimeout(a,100)};var a=function(){var n=!1,r=+(new Date)-i,o=r>=e.noProgressTimeout,u=r>=e.loggingDelay;for(var f=0,l=t.length;f<l;f++){var h=t[f];if(h.status!==s.WAITING)continue;h.resource.checkStatus(),h.status===s.WAITING&&(o?h.resource.onTimeout():n=!0)}u&&n&&c(),n&&setTimeout(a,e.statusInterval)};this.isBusy=function(){for(var e=0,n=t.length;e<n;e++)if(t[e].status===s.QUEUED||t[e].status===s.WAITING)return!0;return!1};var f=function(e,r){var o=null;for(var u=0,a=t.length;u<a;u++)if(t[u].resource===e){o=t[u];break}if(o==null||o.status!==s.WAITING)return;o.status=r,i=+(new Date);var f=e.tags.length;for(var u=0,c=n.length;u<c;u++){var h=n[u],p;h.tags.length===0?p=!0:p=e.tags.contains(h.tags),p&&l(o,h)}};this.onLoad=function(e){f(e,s.LOADED)},this.onError=function(e){f(e,s.ERROR)},this.onTimeout=function(e){f(e,s.TIMEOUT)};var l=function(e,n){var r=0,i=0;for(var o=0,u=t.length;o<u;o++){var a=t[o],f=!1;n.tags.length===0?f=!0:f=a.resource.tags.contains(n.tags),f&&(i++,(a.status===s.LOADED||a.status===s.ERROR||a.status===s.TIMEOUT)&&r++)}n.callback({resource:e.resource,loaded:e.status===s.LOADED,error:e.status===s.ERROR,timeout:e.status===s.TIMEOUT,completedCount:r,totalCount:i})},c=this.log=function(e){if(!window.console)return;var n=Math.round((+(new Date)-r)/1e3);window.console.log("PxLoader elapsed: "+n+" sec");for(var i=0,o=t.length;i<o;i++){var u=t[i];if(!e&&u.status!==s.WAITING)continue;var a="PxLoader: #"+i+" "+u.resource.getName();switch(u.status){case s.QUEUED:a+=" (Not Started)";break;case s.WAITING:a+=" (Waiting)";break;case s.LOADED:a+=" (Loaded)";break;case s.ERROR:a+=" (Error)";break;case s.TIMEOUT:a+=" (Timeout)"}u.resource.tags.length>0&&(a+=" Tags: ["+u.resource.tags.join(",")+"]"),window.console.log(a)}}}function PxLoaderTags(e){this.array=[],this.object={},this.value=null,this.length=0;if(e!==null&&e!==undefined){if(Array.isArray(e))this.array=e;else if(typeof e=="object")for(var t in e)this.array.push(t);else this.array.push(e),this.value=e;this.length=this.array.length;for(var n=0;n<this.length;n++)this.object[this.array[n]]=!0}this.contains=function(e){if(this.length===0||e.length===0)return!1;if(this.length===1)return e.length===1?this.value===e.value:e.object.hasOwnProperty(this.value);if(e.length<this.length)return e.contains(this);for(var t in this.object)if(e.object[t])return!0;return!1}}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)=="[object Array]"});function PxLoaderImage(e,t,n){var r=this,i=null;this.img=new Image,this.tags=t,this.priority=n;var s=function(){r.img.readyState=="complete"&&(a(),i.onLoad(r))},o=function(){a(),i.onLoad(r)},u=function(){a(),i.onError(r)},a=function(){r.unbind("load",o),r.unbind("readystatechange",s),r.unbind("error",u)};this.start=function(t){i=t,r.bind("load",o),r.bind("readystatechange",s),r.bind("error",u),r.img.src=e},this.checkStatus=function(){r.img.complete&&(a(),i.onLoad(r))},this.onTimeout=function(){a(),r.img.complete?i.onLoad(r):i.onTimeout(r)},this.getName=function(){return e},this.bind=function(e,t){r.img.addEventListener?r.img.addEventListener(e,t,!1):r.img.attachEvent&&r.img.attachEvent("on"+e,t)},this.unbind=function(e,t){r.img.removeEventListener?r.img.removeEventListener(e,t,!1):r.img.detachEvent&&r.img.detachEvent("on"+e,t)}}PxLoader.prototype.addImage=function(e,t,n){var r=new PxLoaderImage(e,t,n);return this.add(r),r.img};function extend(e,t){var n=e.prototype,r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t);for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i])}function getElementPosition(e){var t=e,n="",r=0,i=0;if(t==null)return null;while(typeof t=="object"&&typeof t.tagName!="undefined"){i+=t.offsetTop,r+=t.offsetLeft,n=t.tagName.toUpperCase(),n=="BODY"&&(t=0),typeof t=="object"&&typeof t.offsetParent=="object"&&(t=t.offsetParent);if(t==null)return null}return{x:r,y:i}}function getQueryString(){var e={},t=location.search.substring(1),n=/([^&=]+)=([^&]*)/g,r;while(r=n.exec(t))e[decodeURIComponent(r[1])]=decodeURIComponent(r[2]);return e}function getDistributionPartner(){var e=getQueryString().dst;return typeof e=="string"?e:null}function loadScript(e,t){var n=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=t,r.onload=t,n.appendChild(r)}function FriendsterSocialLeaderBoard(){return this.config={SERVER_URL:"http://prod.tresensa.com:8585",ErrorHandler:null},this.loginDetails=[{social_network:"friendster",id:""}],this.userConfiguration={SERVER_URL:this.config.SERVER_URL,APP_URL:this.config.APP_URL,APP_KEY:this.config.APP_KEY,APP_ID:this.config.APP_ID,GameCode:this.config.GameCode,ErrorHandler:this.config.ErrorHandler,SocialNetwork:String(this.config.SocialNetwork).toLowerCase()},this}var TGE=TGE||{};TGE.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))},TGE.debugLog=function(){},Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),TGE.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"an unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.platform=this.searchString(this.dataPlatform)||"an unknown OS or Device",this.OSversion=this.detectOSversion(this.platform),this.isMobileDevice=this.platform!=="Windows"&&this.platform!=="Mac"&&this.platform!=="Linux",this.oniOS=this.platform==="iPhone"||this.platform==="iPad",this.onAndroid=this.platform==="Android",this.usingPhoneGap=window.PhoneGap||window.cordova||window.Cordova},detectOSversion:function(e){var t="-1",n="",r=navigator.userAgent.toString();switch(e){case"Windows Phone":n=/Windows Phone OS\s+[\d\.]+/,t=String(r.match(n)).substring(17,20);break;case"iPhone":case"iPad":n=/OS\s+[\d\_]+/,t=String(r.match(n)).substring(3,6);break;case"Windows":n=/Windows NT\s+[\d\.]+/;var i=String(r.match(n)).substring(11,14);i=="6.1"?t="7":i=="5.1"?t="XP":i=="5.2"?t="XP":i=="6.0"?t="Vista":i=="5.01"?t="2000 SP1":i=="5.0"&&(t="2000");break;case"Mac":n=/Mac OS X\s+[\d\_]+/,t=String(r.match(n)).substring(9,13);break;case"Android":n=/ndroid\s+[\d\.]+/,t=String(r.match(n)).substring(7,10)}return t},searchString:function(e){for(var t=0;t<e.length;t++)if(e[t]!=null){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!==-1)return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t===-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Silk",identity:"Silk",versionSearch:"Silk"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.vendor,subString:"BlackBerry",identity:"BlackBerry"}],dataPlatform:[{string:navigator.userAgent,subString:"Windows Phone",identity:"Windows Phone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"Silk",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.userAgent,subString:"Mobile",identity:"Mobile"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},TGE.BrowserDetect.init();if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var _vp=document.querySelector("meta[name=viewport]");_vp&&_vp.setAttribute("content","maximum-scale=1, minimum-scale=1, initial-scale=1, user-scalable=no")}TGE.Matrix=function(e,t,n,r,i,s){e=typeof e!="undefined"?e:1,t=typeof t!="undefined"?t:0,n=typeof n!="undefined"?n:0,r=typeof r!="undefined"?r:1,i=typeof i!="undefined"?i:0,s=typeof s!="undefined"?s:0,this._internal=[e,n,i,t,r,s,0,0,1]},TGE.Matrix.RotationMatrix=function(e){var t=new TGE.Matrix;return t._internal[0]=Math.cos(e),t._internal[1]=-Math.sin(e),t._internal[3]=Math.sin(e),t._internal[4]=Math.cos(e),t},TGE.Matrix.ScaleMatrix=function(e,t){return(new TGE.Matrix).scale(e,t)},TGE.Matrix.TranslationMatrix=function(e,t){return(new TGE.Matrix).translate(e,t)},TGE.Matrix.prototype={_internal:null,identity:function(){var e=this._internal;return e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0,e[0]=e[4]=e[8]=1,this},copyFrom:function(e){var t=this._internal,n=e._internal;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},concat:function(e){var t=this._internal,n=e._internal,r=t[0]*n[0]+t[1]*n[3]+t[2]*n[6],i=t[0]*n[1]+t[1]*n[4]+t[2]*n[7],s=t[0]*n[2]+t[1]*n[5]+t[2]*n[8],o=t[3]*n[0]+t[4]*n[3]+t[5]*n[6],u=t[3]*n[1]+t[4]*n[4]+t[5]*n[7],a=t[3]*n[2]+t[4]*n[5]+t[5]*n[8],f=t[6]*n[0]+t[7]*n[3]+t[8]*n[6],l=t[6]*n[1]+t[7]*n[4]+t[8]*n[7],c=t[6]*n[2]+t[7]*n[5]+t[8]*n[8];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=u,t[5]=a,t[6]=f,t[7]=l,t[8]=c,this},rotate:function(e){return this.concat(TGE.Matrix.RotationMatrix(e*TGE.DEG2RAD))},scale:function(e,t){var n=this._internal;return n[0]*=e,n[1]*=t,n[3]*=e,n[4]*=t,this},translate:function(e,t){return this._internal[2]+=e,this._internal[5]+=t,this},transformPoint:function(e){var t=e.x,n=e.y;return e.x=t*this._internal[0]+n*this._internal[1]+this._internal[2],e.y=t*this._internal[3]+n*this._internal[4]+this._internal[5],e}},TGE.Point=function(e,t){return e=typeof e!="undefined"?e:0,t=typeof t!="undefined"?t:0,this.x=e,this.y=t,this},TGE.Point.prototype={setTo:function(e,t){this.x=e,this.y=t},copyFrom:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return new this.constructor(this.x+e.x,this.y+e.y)},subtract:function(e){return new this.constructor(this.x-e.x,this.y-e.y)},offset:function(e,t){return this.x+=e,this.y+=t,this},rotate:function(e){var t=e*TGE.DEG2RAD;return new this.constructor(this.x*Math.cos(t)-this.y*Math.sin(t),this.y*Math.cos(t)+this.x*Math.sin(t))},rotateThis:function(e){var t=e*TGE.DEG2RAD,n=this.x*Math.cos(t)-this.y*Math.sin(t),r=this.y*Math.cos(t)+this.x*Math.sin(t);return this.setTo(n,r),this}},TGE.Vector2D=function(e,t){TGE.Vector2D.superclass.constructor.call(this,e,t)},TGE.Vector2D.prototype={magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dotProduct:function(e){return this.x*e.x+this.y*e.y},crossProduct:function(e){return this.x*e.y-this.y*e.x},angleBetween:function(e){var t=this.magnitude()*e.magnitude();return t===0?0:Math.acos(this.dotProduct(e)/t)*TGE.RAD2DEG}},extend(TGE.Vector2D,TGE.Point),TGE.Rectangle=function(e,t,n,r){e=typeof e!="undefined"?e:0,t=typeof t!="undefined"?t:0,n=typeof n!="undefined"?n:0,r=typeof r!="undefined"?r:0,this.x=e,this.y=t,this.width=n,this.height=r},TGE.Rectangle.prototype={intersects:function(e,t,n){t=typeof t=="undefined"?1:t,n=typeof n=="undefined"?1:n;var r=this.width*(1-t)/2,i=this.height*(1-t)/2,s=this.x+r,o=this.y+i,u=this.x+this.width-r,a=this.y+this.height-i;r=e.width*(1-n)/2,i=e.height*(1-n)/2;var f=e.x+r,l=e.y+i,c=e.x+e.width-r,h=e.y+e.height-i;return f>=s&&c<=u&&l>=o&&h<=a?!0:u<f||s>c||a<l||o>h?!1:!0},union:function(e){var t=this.x+this.width,n=this.y+this.height,r=e.x+e.width,i=e.y+e.height;this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y);var s=Math.max(t,r),o=Math.max(n,i);this.width=s-this.x,this.height=o-this.y}},TGE.PI=3.1415926535,TGE.TWO_PI=6.2831853072,TGE.RAD2DEG=57.2957795,TGE.DEG2RAD=.0174532925,TGE.POSITIVE_X_VECTOR=new TGE.Vector2D(1,0),TGE.NEGATIVE_X_VECTOR=new TGE.Vector2D(-1,0),TGE.POSITIVE_Y_VECTOR=new TGE.Vector2D(0,1),TGE.NEGATIVE_Y_VECTOR=new TGE.Vector2D(0,-1),TGE.DisplayObject=function(){return this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.alpha=1,this.backgroundColor=null,this.visible=!0,this.width=0,this.height=0,this.registrationX=.5,this.registrationY=.5,this.parent=null,this.stage=null,this.mouseEnabled=!1,this.instanceName="",this._mLocalTransform=new TGE.Matrix,this._mLocalTransformNoReg=new TGE.Matrix,this._mWorldTransform=new TGE.Matrix,this._mWorldTransformNoReg=new TGE.Matrix,this._mRegistrationTransform=new TGE.Matrix,this._mTopLeft=new TGE.Point,this._mBottomRight=new TGE.Point,this._mAABB=new TGE.Rectangle,this._boundingInfoDirty=!0,this},TGE.DisplayObject.prototype={_mPreviousX:0,_mPreviousY:0,_mPreviousScaleX:1,_mPreviousScaleY:1,_mPreviousRotation:0,_mPreviousRegistrationX:0,_mPreviousRegistrationY:0,_mPreviousVisibility:!1,_mLocalTransform:null,_mLocalTransformNoReg:null,_mLocalTransformDirty:!0,_mWorldTransform:null,_mWorldTransformNoReg:null,_mWorldTransformDirty:!0,_mRegistrationTransform:null,_mTopLeft:0,_mBottomRight:0,_mAABB:null,_boundingInfoDirty:!0,_mWorldAlpha:1,_mIgnoreProperties:!1,_mMouseOver:!1,_visibilityChanged:!1,setLocalTransform:function(e,t,n,r,i,s){var o=this._mLocalTransform._internal;o[0]=e,o[1]=n,o[2]=i,o[3]=t,o[4]=r,o[5]=s,this._mIgnoreProperties=!0,this._mLocalTransformDirty=!0},useDisplayProperties:function(){this._mIgnoreProperties=!1,this._mLocalTransformDirty=!0},getBounds:function(){return this._checkVisibilityChange(),this._boundingInfoDirty&&this._updateAABB(),this._mAABB},hitTestPoint:function(e,t){var n=this.x-this.registrationX*this.width,r=this.x+(1-this.registrationX)*this.width,i=this.y-this.registrationY*this.height,s=this.y+(1-this.registrationY)*this.height;return e>this.x-this.registrationX*this.width&&e<this.x+(1-this.registrationX)*this.width&&t>this.y-this.registrationY*this.height&&t<this.y+(1-this.registrationY)*this.height},clearChildren:function(){},markForRemoval:function(){},numChildren:function(e){return 0},isMouseOver:function(){return this._mMouseOver},_draw:function(e){this._checkVisibilityChange();if(!this.visible)return;this._updateTransformations(),this.stage!==null&&this.mouseEnabled&&this.stage._mMouseTargets.push(this),e.save();var t=this._mWorldTransform._internal,n=this.stage===null?1:this.stage._mScale,r=t[0]*n,i=t[3]*n,s=t[1]*n,o=t[4]*n,u=t[2]*n,a=t[5]*n;this._mIgnoreProperties||this.rotation!==0?e.setTransform(r,i,s,o,u,a):e.setTransform(r,i,s,o,u|0,a|0),e.globalAlpha=this._mWorldAlpha,this.backgroundColor!==null&&(e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.width,this.height)),this._drawClass(e),e.restore()},_drawClass:function(e){},_updateTransformations:function(){this._mWorldTransformDirty=!1;var e=this.x!==this._mPreviousX||this.y!==this._mPreviousY||this.scaleX!==this._mPreviousScaleX||this.scaleY!==this._mPreviousScaleY||this.rotation!==this._mPreviousRotation||this._visibilityChanged;e&&!this._mIgnoreProperties&&(this._visibilityChanged=!1,this._mPreviousX=this.x,this._mPreviousY=this.y,this._mPreviousScaleX=this.scaleX,this._mPreviousScaleY=this.scaleY,this._mPreviousRotation=this.rotation,this._mLocalTransformDirty=!0);if(this.registrationX!==this._mPreviousRegistrationX||this.registrationY!==this._mPreviousRegistrationY){this._mPreviousRegistrationX=this.registrationX,this._mPreviousRegistrationY=this.registrationY;var t=-this.width*this.registrationX,n=-this.height*this.registrationY;this._mRegistrationTransform.identity(),this._mRegistrationTransform.translate(t,n)}if(this._mLocalTransformDirty){if(!this._mIgnoreProperties){this._mLocalTransform.identity();var r=this._mLocalTransform._internal;r[2]=this.x,r[5]=this.y,this.rotation!==0&&this._mLocalTransform.rotate(this.rotation);if(this.scaleX!==1||this.scaleY!==1)r[0]*=this.scaleX,r[1]*=this.scaleY,r[3]*=this.scaleX,r[4]*=this.scaleY}this._mLocalTransformNoReg.copyFrom(this._mLocalTransform),this._mLocalTransform.concat(this._mRegistrationTransform)}if(this.parent!==null){if(this._mLocalTransformDirty||this.parent._mWorldTransformDirty)this._mWorldTransform.copyFrom(this.parent._mWorldTransformNoReg),this._mWorldTransform.concat(this._mLocalTransform),this._mWorldTransformNoReg.copyFrom(this.parent._mWorldTransformNoReg),this._mWorldTransformNoReg.concat(this._mLocalTransformNoReg),this._mWorldTransformDirty=!0}else this._mWorldTransform.copyFrom(this._mLocalTransform),this._mWorldTransformDirty=this._mLocalTransformDirty;this._mWorldTransformDirty&&this._setBoundingInfoDirty(),this._mWorldAlpha=this.parent!==null?this.parent._mWorldAlpha*this.alpha:this.alpha,this._mLocalTransformDirty=!1},_updateAABB:function(){this._mTopLeft.x=0,this._mTopLeft.y=0,this._mBottomRight.x=this.width,this._mBottomRight.y=this.height,this._mWorldTransform.transformPoint(this._mTopLeft),this._mWorldTransform.transformPoint(this._mBottomRight);var e=Math.min(this._mTopLeft.x,this._mBottomRight.x),t=Math.max(this._mTopLeft.x,this._mBottomRight.x),n=Math.min(this._mTopLeft.y,this._mBottomRight.y),r=Math.max(this._mTopLeft.y,this._mBottomRight.y);this._mAABB.x=e,this._mAABB.y=n,this._mAABB.width=t-e,this._mAABB.height=r-n,this._boundingInfoDirty=!1},_setBoundingInfoDirty:function(){this._boundingInfoDirty=!0,this.parent!==null&&this.parent._setBoundingInfoDirty()},_checkVisibilityChange:function(){this.visible!==this._mPreviousVisibility&&(this._visibilityChanged=!0,this._mPreviousVisibility=this.visible,this._setBoundingInfoDirty())}},TGE.DisplayObjectContainer=function(){return TGE.DisplayObjectContainer.superclass.constructor.call(this),this._mChildren=[],this},TGE.DisplayObjectContainer.prototype={_mChildren:null,addChild:function(e){return e.parent!==null&&e.parent.removeChild(e),e.parent=this,e.stage=this.stage,this._mChildren.push(e),e},getChildAt:function(e){return this._mChildren[e]},getChildByName:function(e,t){t=typeof t=="undefined"?!1:t;var n=this._mChildren.length;for(var r=0;r<n;r++){if(this._mChildren[r].instanceName===e)return this._mChildren[r];if(t){var i=this._mChildren[r].getChildByName(e,!0);if(i!==null)return i}}return null},getChildIndex:function(e){var t=this._mChildren.length;for(var n=0;n<t;n++)if(this._mChildren[n]===e)return n;return-1},removeChild:function(e){var t=this.getChildIndex(e);return t!==-1&&(this._mChildren[t].parent=null,this._mChildren.splice(t,1)),e},clearChildren:function(){for(var e=this._mChildren.length-1;e>=0;e--)this._mChildren[e].markForRemoval(),this._mChildren[e].clearChildren(),this._mChildren[e].parent=null,this._mChildren.splice(e,1);this._mChildren=[]},numChildren:function(e){e=typeof e=="undefined"?!1:e;var t=this._mChildren.length;if(e){var n=0;for(var r=0;r<t;r++)n+=1+this._mChildren[r].numChildren(!0);return n}return t},_drawClass:function(e){TGE.DisplayObjectContainer.superclass._drawClass.call(this,e);var t=this._mChildren.length;for(var n=0;n<t;n++){var r=this._mChildren[n];r._checkVisibilityChange(),r.visible&&(e.save(),r._draw(e),e.restore())}},_updateAABB:function(){TGE.DisplayObjectContainer.superclass._updateAABB.call(this);var e=this._mChildren.length;for(var t=0;t<e;t++)this._mChildren[t].visible&&this._mAABB.union(this._mChildren[t].getBounds())}},extend(TGE.DisplayObjectContainer,TGE.DisplayObject),TGE.Stage=function(e,t,n){TGE.Stage.superclass.constructor.call(this),this.stage=this;var r=!1;e&&(e instanceof HTMLDivElement?r=!1:e instanceof HTMLCanvasElement?r=!0:e=document.body);var i;return r?i=e:(i=document.createElement("canvas"),e.appendChild(i)),this.width=e.clientWidth,this.height=e.clientHeight,this.registrationX=0,this.registrationY=0,i.width=this.width,i.height=this.height,this.width=this._mOriginalWidth=typeof t!="undefined"?t:e.clientWidth,this.height=this._mOriginalHeight=typeof n!="undefined"?n:e.clientHeight,this._mScale=1,this._mCanvas=i,this._mCanvasContext=i.getContext("2d"),this},TGE.Stage.prototype={_mCanvasContext:null,_mMouseTargets:[],draw:function(){this._mMouseTargets=[],this._mCanvasContext.globalAlpha=1,this._mCanvasContext.globalCompositeOperation="source-over",this._draw.call(this,this._mCanvasContext)},setScale:function(e){this._mScale=e,this._mCanvas.width=this._mOriginalWidth*e,this._mCanvas.height=this._mOriginalHeight*e,this.width=this._mOriginalWidth,this.height=this._mOriginalHeight},_notifyObjectsOfMouseEvent:function(e,t,n){for(var r=this._mMouseTargets.length-1;r>=0;r--){var i=this._mMouseTargets[r];if(i.hitTestPoint(t,n)){switch(e){case"up":i.MouseUp();break;case"down":i.MouseDown();break;case"click":i.Click()}return}}},_updateObjectMouseOverStates:function(e,t){for(var n=this._mMouseTargets.length-1;n>=0;n--){var r=this._mMouseTargets[n],i=r.hitTestPoint(e,t);i?r._mMouseOver=!0:r._mMouseOver&&(r._mMouseOver=!1)}}},extend(TGE.Stage,TGE.DisplayObjectContainer),TGE.Sprite=function(){return TGE.Sprite.superclass.constructor.call(this),this},TGE.Sprite.prototype={_mImage:null,_mCellWidth:0,_mCellHeight:0,_mSpriteIndex:0,_mCoordinateCache:null,setImage:function(e,t,n){t=typeof t=="undefined"?1:t,n=typeof n=="undefined"?1:n,typeof e=="string"&&(e=TGE.AssetManager.GetImage(e));if(!e||e instanceof Image||!e.spriteSheet)if(e instanceof Image){this._mImage=e,this._mCellWidth=Math.floor(e.width/n),this._mCellHeight=Math.floor(e.height/t),this._mCoordinateCache=[];var r,i;for(var s=0;s<t*n;s++)r=(s%n|0)*this._mCellWidth,i=(s/n|0)*this._mCellHeight,this._mCoordinateCache.push([r,i]);this.width=this._mCellWidth,this.height=this._mCellHeight}else this._mImage=null;else{this._mImage=e.spriteSheet,this._mCellWidth=Math.floor(e.width/n),this._mCellHeight=Math.floor(e.height/t),this._mCoordinateCache=[];var r,i;for(var s=0;s<t*n;s++)r=e.x+(s%n|0)*this._mCellWidth,i=e.y+(s/n|0)*this._mCellHeight,this._mCoordinateCache.push([r,i]);this.width=this._mCellWidth,this.height=this._mCellHeight}this._mSpriteIndex=0},setSpriteIndex:function(e){this._mSpriteIndex=e,this._mSpriteIndex>=this._mCoordinateCache.length&&(TGE.log("***** ERROR: Attempt to call TGE.Sprite.setSpriteIndex with an out of range index ("+e.toString()+")"),this._mSpriteIndex=0)},_drawClass:function(e){this._mImage!==null&&(this.width!==this._mCellWidth||this.height!==this._mCellHeight)&&(TGE.log("***** ERROR: You cannot change the width or height properties of a TGE.Sprite object - use scaleX or scaleY instead"),this.width=this._mCellWidth,this.height=this._mCellHeight),this._mImage!==null&&e.drawImage(this._mImage,this._mCoordinateCache[this._mSpriteIndex][0]>>0,this._mCoordinateCache[this._mSpriteIndex][1]>>0,this.width,this.height,0,0,this.width,this.height),TGE.Sprite.superclass._drawClass.call(this,e)}},extend(TGE.Sprite,TGE.DisplayObjectContainer),TGE.AudioLoader=function(e,t,n,r,i){var s=this;this.id=e,this.loader=null,this.forceHandler=null,this.audio=document.createElement("audio"),this.audio.setAttribute("preload","auto"),document.body.appendChild(this.audio);if(TGE.BrowserDetect.browser==="Safari"||TGE.BrowserDetect.platform==="Windows Phone")if(typeof t!="undefined"&&n.lastIndexOf("mp3")==n.length-"mp3".length){var o=t;t=n,n=o}var u=document.createElement("source");u.setAttribute("src",t),this.audio.appendChild(u);var a=document.createElement("source");a.setAttribute("src",n),this.audio.appendChild(a),this.url=t,this.tags=r,this.priority=i,this.complete=!1,this.pollCount=0,this.start=function(e){this.loader=e;if(this.isLimited()){var t=function(){this.audio.pause(),this.audio.removeEventListener("play",this.forceHandler,!1),this.complete=!0,this.loader.onLoad(s),this.audio.play()};this.forceHandler=t.bind(this),this.audio.addEventListener("play",this.forceHandler,!1),this.audio.play()}else{var n=function(){this.audio.removeEventListener("loadedmetadata",this.forceHandler,!1),this.complete=!0,this.loader.onLoad(s)};this.forceHandler=n.bind(this),this.audio.addEventListener("loadedmetadata",this.forceHandler,!1),this.audio.load()}},this.checkStatus=function(){if(this.audio.networkState===HTMLMediaElement.NETWORK_NO_SOURCE){this.loader.onError(s);return}if(this.pollCount>=3){this.loader.onTimeout(s);return}(this.complete===!0||TGE.BrowserDetect.platform==="Windows Phone")&&this.loader.onLoad(s);if(this.isLimited()){this.loader.onTimeout(s);return}this.pollCount++},this.onTimeout=function(){this.loader.onTimeout(s)},this.getName=function(){return t}},TGE.AudioLoader.prototype.isLimited=function(){return TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"},PxLoader.prototype.addAudio=function(e,t,n,r,i){var s=new TGE.AudioLoader(e,t,n,r,i);return this.add(s),s.audio},TGE.AudioManager=function(e){this.mAssetManager=e,this.mVolume=1,this.mMuted=!1,this.mplayerManagerList=new Array},TGE.AudioManager.prototype={Play:function(e){var t=null;if(e.id in this.mplayerManagerList)t=this.mplayerManagerList[e.id];else{t=new TGE.PlayerManager(this);if(t.init(e)===!1)return;this.mplayerManagerList[e.id]=t}if(this.isMobile()==1&&this.mMuted===!0)return;t.playAudio(e)},Pause:function(e){if(e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.pauseAudio()}},Mute:function(){if(this.mMuted===!0)return;this.mMuted=!0;for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];this.isMobile()===!0?t.nLoop==0?t.stopAudio():t.pauseAudio():t.muteAudio()}},Unmute:function(){if(this.mMuted===!1)return;this.mMuted=!1;for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];this.isMobile()===!0?t.nLoop!=0&&(t.mState===t.STATE.Stopped?t.playAudio({}):t.resumeAudio()):t.unmuteAudio()}},ToggleMute:function(){this.mMuted===!0?this.Unmute():this.Mute()},StopAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.stopAudio()}},PauseAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.pauseAudio()}},ResumeAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];if(this.isMobile()==1&&this.mMuted===!0)continue;t.resumeAudio()}},isLoadAudio:function(){return this.mAssetManager.mLoadAudio},isMobile:function(){return TGE.BrowserDetect.platform!=="Windows"&&TGE.BrowserDetect.platform!=="Mac"}},TGE.PlayerManager=function(e){this.mAudioManager=e,this.nStartTime=0,this.nEndTime=-1,this.nLoop=0,this.callback=null,this.audioElement=null,this.bPlaySegment=!1,this.STATE={NotLoaded:0,Playing:1,Stopped:2,Paused:3,AutoPaused:4},this.mState=this.STATE.NotLoaded,this.audioId=null,this.audioPlaybackInProgressHandler=null,this.audioPlaybackCompleteHandler=null},TGE.PlayerManager.prototype={init:function(e){this.mState=this.STATE.NotLoaded,this.audioId=e.id;var t=this;this.callback=e.callBackFunction!==undefined?e.callBackFunction:null,this.audioElement=this.mAudioManager.mAssetManager.getImage(e.id);if(undefined===this.audioElement)return TGE.log("Unknown audio id: "+e.id),!1;this.nStartTime=0,this.nEndTime=-1,"audio_sprite"===this.audioElement.assetType&&(this.bPlaySegment=!0,this.nStartTime=this.audioElement.startTime,this.nEndTime=this.audioElement.endTime,this.audioElement=this.mAudioManager.mAssetManager.getImage(this.audioElement.id));if(!this.audioElement.canPlayType)return TGE.log("No canPlayType attribute found in audio tag: "+e.id),!1;this.nLoop=0,e.loop!==undefined&&(this.nLoop=Number(e.loop)),this.nLoop===undefined&&(this.nLoop=0);var n=function(){this.bPlaySegment&&(this.audioElement.currentTime<this.nStartTime&&(this.audioElement.currentTime=this.nStartTime),this.audioElement.currentTime>=this.nEndTime&&(this.nLoop===0?this.stopAudio():this.restartAudio()))},r=function(){this.nLoop===0?this.stopAudio():this.restartAudio()};return this.audioElement.addEventListener("timeupdate",n.bind(this),!1),this.audioElement.addEventListener("ended",r.bind(this),!1),window.addEventListener("pagehide",function(){t.mState===t.STATE.Playing&&(t.pauseAudio(),t.mState=t.STATE.AutoPaused)}),window.addEventListener("pageshow",function(){t.mState===t.STATE.AutoPaused&&t.resumeAudio()}),this.mState=this.STATE.Stopped,!0},playAudio:function(e){if(this.mAudioManager.isLoadAudio()===!1)return;this.mAudioManager.mMuted===!0?this.audioElement.volume=0:this.audioElement.volume=this.mAudioManager.mVolume;try{this.audioElement.currentTime=this.nStartTime}catch(t){TGE.log("Error setting start time, continuing: "+t)}this.bPlaySegment===!1&&(this.nEndTime=this.audioElement.duration),this.mState=this.STATE.Playing,this.audioElement.play()},stopAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.mState=this.STATE.Stopped,this.audioElement.pause(),this.audioElement.currentTime=0,this.callback!==null&&this.callback()},restartAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.mState=this.STATE.Playing,this.audioElement.currentTime=this.nStartTime,this.audioElement.play()},pauseAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;if(this.mState!==this.STATE.Playing)return;this.mState=this.STATE.Paused,this.audioElement.pause()},resumeAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;if(this.mState!==this.STATE.Paused)return;this.mState=this.STATE.Playing,this.audioElement.play()},muteAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.audioElement.volume=0},unmuteAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.audioElement.volume=this.mAudioManager.mVolume}},TGE.Game=function(){if(TGE.Game._sInstance!==null)return TGE.log("***** ERROR: you can only create one instance of a TGE.Game object"),this;TGE.Game._sInstance=this,this.analytics=null,this.mCanvasDiv=null,this.mReorientationDiv=null,this.mCanvasPosition=null,this.mGameManager=new TGE.ObjectsManager,this.mLayers={},this.mCameraLocation=null,this.mLoadingStartTime=(new Date).getTime(),this.mLoadingScreen=null,this.stage=null,this.assetManager=new TGE.AssetManager,this.audioManager=new TGE.AudioManager(this.assetManager),this.mPlaying=!1,this.mPaused=!1,this.mCurrentLevel=null,this.mPauseButton=null,this.mUserPauseEnabled=!1,this.mGameTime=0,this.mFilterStrength=10,this.mFrameTime=0,this.mLastLoop=new Date,this.mLastDisplay=new Date,this.mThisLoop,this.mFPSText=null,this.mMaxTickTime=.1,this.mMinTickTime=Number.MIN_VALUE,this.mUIManager=new TGE.ObjectsManager,this.mScreenManager=new TGE.ScreenManager(this),this.mMouseX=0,this.mMouseY=0,this.mMouseDown=!1,this.mKeysDown={},this.mDefaultLinkTarget="_blank",this.canvasWidth=0,this.canvasHeight=0,this._mNativeScaling=null,this._mViewportScale=1,this._oniOS=TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad",this._onAndroid=TGE.BrowserDetect.platform==="Android"},TGE.Game._sInstance=null,TGE.Game.GetInstance=function(){return TGE.Game._sInstance},TGE.Game.prototype={_mViewportScale:0,_mResizeTimeout:null,_oniOS:!1,_onAndroid:!1,onMobile:function(){return TGE.BrowserDetect.isMobileDevice},oniOS:function(){return this._oniOS},onAndroid:function(){return this._onAndroid},onPhoneGap:function(){return TGE.BrowserDetect.usingPhoneGap},IsPlatformAcceptable:function(){var e=!!window.CanvasRenderingContext2D;if(!e)return this.AnalyticErrorEvent("no canvas"),!1;var t=!1;if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var n=TGE.BrowserDetect.OSversion.charCodeAt(0)-48;return n>=5}if(TGE.BrowserDetect.Platform==="Android")return!0;if(TGE.BrowserDetect.platform==="Windows"||TGE.BrowserDetect.platform==="Mac"){var r=TGE.BrowserDetect.browser.toLowerCase(),i=parseFloat(TGE.BrowserDetect.version);if(r=="firefox")return i>=8;if(r=="explorer")return i>=9;if(r=="chrome")return i>=14;if(r=="safari")return i>=5.1}return!0},_determineCanvasPosition:function(){TGE.debugLog("_determineCanvasPosition"),this.mCanvasPosition=getElementPosition(this.mCanvasDiv)},Launch:function(e,t){var n,r,i=-1,s=-1,o=-1,u=-1,a=!1;this.analytics===null&&this.mAnalytics!=null&&(this.analytics=this.mAnalytics),typeof e=="string"?(n=e,r=t):(n=typeof e.gameDiv=="undefined"?null:e.gameDiv,r=typeof e.reorientDiv=="undefined"?null:e.reorientDiv,i=typeof e.width=="undefined"?-1:e.width,s=typeof e.height=="undefined"?-1:e.height,o=typeof e.initialWidth=="undefined"?-1:parseInt(e.initialWidth),u=typeof e.initialHeight=="undefined"?-1:parseInt(e.initialHeight),a=typeof e.resizeForNative=="undefined"?!1:e.resizeForNative),this.mCanvasDiv=document.getElementById(n);if(this.mCanvasDiv==null)return TGE.log("***** ERROR: Could not find canvas div '"+n+"'"),!1;var f=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",f+" z-index: 1; overflow: hidden; -webkit-user-select: none; -ms-touch-action:none; -webkit-tap-highlight-color: transparent; -moz-tap-highlight-color: transparent; -webkit-transform: translateZ(0);");if(a){var l=document.getElementById("viewporter");l!==null&&(l.align="left");var c=1;TGE.BrowserDetect.platform==="iPad"?(c=.75,i=this.mCanvasDiv.clientWidth,s=Math.round(c*i)):TGE.BrowserDetect.platform==="iPhone"&&(c=320/480,i=this.mCanvasDiv.clientWidth,s=Math.round(c*i),l!==null&&(window.innerWidth>480||window.innerHeight>480)&&(l.align="center")),c!==1&&(this._mNativeScaling={x:i/this.mCanvasDiv.clientWidth,y:s/this.mCanvasDiv.clientHeight})}return i>0&&s>0&&(this.mCanvasDiv.style.width=i+"px",this.mCanvasDiv.style.height=s+"px"),this.canvasWidth=this.mCanvasDiv.clientWidth,this.canvasHeight=this.mCanvasDiv.clientHeight,TGE.debugLog("game launch calling _resizeViewport"),this._resizeViewport(),this.mReorientationDiv=document.getElementById(r),this._determineCanvasPosition(),window.addEventListener("resize",this._onResize.bind(this),!1),this.onMobile()&&(window.addEventListener("blur",this._onDeactivate.bind(this),!1),window.addEventListener("pagehide",this._onDeactivate.bind(this),!1),this.onPhoneGap()&&document.addEventListener("pause",this._onDeactivate.bind(this),!1)),"ontouchstart"in document.documentElement&&TGE.BrowserDetect.isMobileDevice?(this.mCanvasDiv.addEventListener("touchstart",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("touchmove",this._mouseMove.bind(this),!1),this.mCanvasDiv.addEventListener("touchend",this._mouseUp.bind(this),!1)):(this.mCanvasDiv.addEventListener("click",this._preventBehavior.bind(this),!1),this.mCanvasDiv.addEventListener("mousedown",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("mouseup",this._mouseUp.bind(this),!1),this.mCanvasDiv.addEventListener("mousemove",this._mouseMove.bind(this),!1)),document.addEventListener("keydown",this._keyDown.bind(this),!1),document.addEventListener("keyup",this._keyUp.bind(this),!1),o>0&&u>0?this.InitializeRenderer(o,u):this.InitializeRenderer(),window.addEventListener("orientationchange",this._onOrientationChanged),typeof viewporter!="undefined"&&typeof viewporter.preventPageScroll=="function"&&(viewporter.preventPageScroll=!0),this.BeginLoad(),!0},_onOrientationChanged:function(){TGE.debugLog("_onOrientationChanged called"),typeof viewporter!="undefined"&&typeof viewporter.refresh=="function"&&viewporter.refresh()},_onResize:function(){TGE.debugLog("_onResize::_mResizeTimeout: "+this._mResizeTimeout),this._mResizeTimeout!==null&&(clearTimeout(this._mResizeTimeout),this._mResizeTimeout=null),this.onAndroid()?this._mResizeTimeout=setTimeout(this._resizeViewport.bind(this),500):this._resizeViewport()},_scaleCanvasDiv:function(e){if(this.stage===null)return;var t=Math.round(this.stage.width*e*1e3)/1e3,n=Math.round(this.stage.height*e*1e3)/1e3;this.mCanvasDiv.style.width=t+"px",this.mCanvasDiv.style.height=n+"px",this._scaleStage(e)},_getBrowserWidth:function(){return window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth!=0?document.documentElement.clientWidth:document.body?document.body.clientWidth:0},_getBrowserHeight:function(){return window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight!=0?document.documentElement.clientHeight:document.body?document.body.clientHeight:0},_scaleStage:function(e){this._mViewportScale=e,this.stage!==null&&this.stage.setScale(this._mViewportScale),this._determineCanvasPosition()},_centerCanvasDiv:function(e,t,n,r){this.mCanvasDiv.style.position="absolute";if(e){this.mCanvasDiv.style.align="left",this.mCanvasDiv.style.left=this._getBrowserWidth()/2-n/2+"px";var i=document.getElementById("viewporter");i&&(i.style.align="left")}t&&(this.mCanvasDiv.style.top=this._getBrowserHeight()/2-r/2+"px")},_resizeViewport:function(){TGE.debugLog("_resizeViewport");if(typeof window.canvasScale!="undefined"){TGE.debugLog("_resizeViewport for JSEmbed using stage scaling"),this.scaleStage(window.canvasScale);return}var e=this.mCanvasDiv,t=e.getAttribute("style")||"",n=this.canvasWidth,r=this.canvasHeight,i=window.innerWidth,s=window.innerHeight;TGE.debugLog("_resizeViewport::game size: "+n+"x"+r+", \nscreen size: "+i+"x"+s);var o=n<=r,u=i<=s,a=u===o,f={x:1,y:1};f.x=i/n,f.y=s/r,f.x=Math.round(f.x*100)/100,f.y=Math.round(f.y*100)/100;var l=1,c;f.x<f.y?(l=f.x,c=!0):(l=f.y,c=!1),Math.abs(1-l)<=.01&&(l=1);var h=n*l,p=r*l;if(TGE.BrowserDetect.usingPhoneGap){TGE.debugLog("_resizeViewport for native using stage scaling"),this._scaleCanvasDiv(l),this._centerCanvasDiv(!0,!0,h,p);return}TGE.BrowserDetect.isMobileDevice?(TGE.BrowserDetect.platform==="Android"&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<4||TGE.BrowserDetect.oniOS&&TGE.BrowserDetect.OSversion.charAt(0)<6||TGE.BrowserDetect.platform==="Kindle Fire"?(TGE.debugLog("_resizeViewport for mobile web using stage scaling"),this._scaleCanvasDiv(l)):(TGE.debugLog("_resizeViewport for mobile web using css transform scaling"),this._mViewportScale=l,f=l+", "+l,e.setAttribute("style",t+" -ms-transform-origin: left top; -webkit-transform-origin: left top; -moz-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top; -ms-transform: scale("+f+"); -webkit-transform: scale3d("+f+", 1); -moz-transform: scale("+f+"); -o-transform: scale("+f+"); transform: scale("+f+");")),this._centerCanvasDiv(!0,!0,h,p)):this._centerCanvasDiv(!0,!1,n,r),this.mReorientationDiv!==null&&TGE.BrowserDetect.isMobileDevice&&(a?(this.mReorientationDiv.style.display="none",this.mCanvasDiv.style.display="block"):(this.mCanvasDiv.style.display="none",this.mReorientationDiv.style.display="block",this.PauseGame(!0))),this._determineCanvasPosition(),typeof viewporter!="undefined"&&typeof viewporter.refresh=="function"&&viewporter.refresh()},_onDeactivate:function(){this.mPlaying&&(this.PauseGame(!0),this.audioManager.Mute())},InitializeRenderer:function(e,t){this.stage=new TGE.Stage(this.mCanvasDiv,e,t)},BeginLoad:function(){this.assetManager.loadAssetList("loading",null,this.LoadRequiredAssets.bind(this))},LoadRequiredAssets:function(){this.mScreenManager.Initialize(this),this._resizeViewport();var e=null;typeof LoadingScreen!="undefined"&&(this.mLoadingScreen=this.ShowScreen(LoadingScreen),e=this.loadRequiredAssetsCallback.bind(this)),this.Update(),this.assetManager.loadAssetList("required",e,this.finishedLoadingRequiredAssets.bind(this))},loadRequiredAssetsCallback:function(e){this.mLoadingScreen!=null&&typeof this.mLoadingScreen.UpdateProgress=="function"&&this.mLoadingScreen.UpdateProgress(e)},finishedLoadingRequiredAssets:function(){var e=Math.round(((new Date).getTime()-this.mLoadingStartTime)/1e3);this.AnalyticGameEvent("load",e),TGE.debugLog("finishedLoadingRequiredAssets calling _resizeViewport"),this._resizeViewport(),this.GotoMainMenu()},LoadLevelAssets:function(e,t,n){this.assetManager.loadAssetList("level_"+e.toString(),t,n)},StartLevel:function(e){var t=e==this.mCurrentLevel;this.mCurrentLevel=e,this.subclassSetupLevel(this.mCurrentLevel),this.AnalyticLevelEvent(t?"replay":"start"),(!this.mPlaying||this.mPaused)&&this.StartPlaying()},FinishLevel:function(){this.AnalyticLevelEvent("complete"),this.subclassFinishLevel()},Replay:function(){this.StartLevel(this.mCurrentLevel)},StartPlaying:function(){this.mGameTime=0,this.mPaused=!1,this.mPlaying=!0,TGE.Achievements.EnableParterUI(!1),this.subclassStartPlaying()},ClearScene:function(){this.mGameManager.Purge(),this.mUIManager.Purge(),this.mCameraLocation=new TGE.Point,this.stage.clearChildren(),this.mFPSText=null,this.SetupLayers(),this.mScreenManager.Initialize(this),this.CreateLayer("FPS");var e=this.assetManager.getImage("pause_button",!1);if(e!=null&&e.width>0){var t=Math.max(e.width,e.height);this.mPauseButton=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.Width()-t/2,t/2,"pause_button","ScreenManager"),this.EnableUserPause()}},SetupLayers:function(){this.mLayers={},this.CreateLayer("TGE_default"),this.subclassSetupLayers()},ShowScreen:function(e){return this.mScreenManager.ShowScreen(e)},GotoMainMenu:function(){this.mPaused=!1,this.mPlaying=!1,this.ClearScene(),typeof MainMenu!="undefined"?this.ShowScreen(MainMenu):this.StartPlaying()},PauseGame:function(e){var t=typeof PauseScreen!="undefined";if(!this.mPlaying||e===this.mPaused||!t)return;this.mPaused=e,this.AnalyticGameEvent(this.mPaused?"pause":"resume",this.mCurrentLevel),this._determineCanvasPosition(),t&&(this.mPaused?(this.ShowScreen(PauseScreen,!1),this.DisableUserPause()):(this.mScreenManager.CloseScreen(PauseScreen),this.EnableUserPause())),TGE.Achievements.EnableParterUI(this.mPaused)},DisableUserPause:function(){this.mUserPauseEnabled=!1,this.mPauseButton!=null&&this.mPauseButton.Hide()},EnableUserPause:function(){this.mUserPauseEnabled=!0,this.mPauseButton!=null&&this.mPauseButton.Show()},Update:function(){var e=(this.mThisLoop=new Date)-this.mLastLoop;this.mFrameTime+=(e-this.mFrameTime)/this.mFilterStrength,this.mLastLoop=this.mThisLoop,this.updateFPSDisplay(),e/=1e3,e=Math.max(this.mMinTickTime,e),e=Math.min(this.mMaxTickTime,e),this.mPaused||(this.mGameTime+=e),this.mScreenManager.Update(e),this.stage._updateObjectMouseOverStates(this.mMouseX,this.mMouseY),this.mPaused||this.updateObjects(e),this.mPlaying&&!this.mPaused&&this.subclassUpdateGame(e),this._updateObjectsToScreen(),requestAnimFrame(this.Update.bind(this)),this.stage.draw()},SetConstantTickTime:function(e){this.mMinTickTime=this.mMaxTickTime=e},SetBackgroundColor:function(e){this.stage.backgroundColor=e},CreateLayer:function(e){var t=new TGE.DisplayObjectContainer;this.mLayers[e]=t,t.registrationX=0,t.registrationY=0,this.stage.addChild(t)},CreateWorldEntity:function(e){var t=new e;return e.prototype.constructor.apply(t,[this]),this.mGameManager.AddObject(t),t},CreateUIEntity:function(e){var t=new e;return e.prototype.constructor.apply(t,[this]),this.mUIManager.AddObject(t),t},getLayer:function(e){var t="TGE_default"in this.mLayers?this.mLayers.TGE_default:this.stage;return e!=null&&e in this.mLayers&&(t=this.mLayers[e]),t},ShowFramerateDisplay:function(e,t,n,r){this.mFPSText!=null&&this.mFPSText.markForRemoval(),this.mFPSText=this.CreateUIEntity(TGE.Text).Setup(e,t,"",n.toString()+"px Arial","center","middle",r,"FPS")},updateFPSDisplay:function(){var e=this.mThisLoop-this.mLastDisplay;if(e<1e3)return;this.mLastDisplay=this.mThisLoop,this.mFrameTime>0&&this.mFPSText!=null&&(this.mFPSText.Show(),this.mFPSText.text=Math.round(1e3/this.mFrameTime).toFixed(0)+"fps")},updateObjects:function(e){this.mGameManager.Update(e),this.mUIManager.Update(e)},_updateObjectsToScreen:function(){this.mGameManager._updateObjectsToScreen()},EndGame:function(){if(!this.mPlaying)return;this.mPlaying=!1,TGE.Achievements.EnableParterUI(!0);var e=Math.round(this.mGameTime);this.AnalyticGameEvent("end",e),this.DisableUserPause(),this.subclassEndGame(),typeof GameOver!="undefined"&&this.ShowScreen(GameOver)},CurrentLevel:function(){return this.mCurrentLevel},_processMousePosition:function(e){this.mCanvasPosition===null&&this._determineCanvasPosition(),this.mMouseX=e.pageX,this.mMouseY=e.pageY,e.touches&&(this.mMouseX=e.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.mMouseY=e.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop),this.mMouseX-=this.mCanvasPosition.x,this.mMouseY-=this.mCanvasPosition.y,this.mMouseX/=this._mViewportScale,this.mMouseY/=this._mViewportScale},_preventBehavior:function(e){e.stopPropagation(),e.preventDefault()},_mouseDown:function(e){window.focus(),this._processMousePosition(e),this.mMouseDown=!0;if(this.mUserPauseEnabled&&this.mPauseButton!=null&&this.mGameTime>.5){var t=Math.max(this.mPauseButton.Width(),this.mPauseButton.Height());if(this.mMouseX>this.Width()-t&&this.mMouseY<t){this.PauseGame(!0);return}}this.stage._notifyObjectsOfMouseEvent("down",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseDown(),e.stopPropagation(),e.preventDefault()},_mouseUp:function(e){this.mMouseDown=!1,this.stage._notifyObjectsOfMouseEvent("up",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseUp(),e.stopPropagation(),e.preventDefault()},_mouseMove:function(e){this._processMousePosition(e),this.mPaused||this.subclassMouseMove(),e.stopPropagation(),e.preventDefault()},MouseX:function(){return this.mMouseX},MouseY:function(){return this.mMouseY},IsMouseDown:function(){return this.mMouseDown},isMouseDown:function(){return this.mMouseDown},_keyDown:function(e){this.mKeysDown[e.keyCode]=!0,this.subclassKeyDown(e.keyCode)},_keyUp:function(e){this.mKeysDown[e.keyCode]=!1,this.subclassKeyUp(e.keyCode)},isKeyDown:function(e){return this.mKeysDown[e]===!0},Width:function(){return this.stage.width},Height:function(){return this.stage.height},GameTime:function(){return this.mGameTime},NumGameObjects:function(){return this.mGameManager.NumObjects()},NumUIObjects:function(){return this.mUIManager.NumObjects()},CameraLocation:function(){return this.mCameraLocation},ScreenX:function(e){return this.stage.width/2+(e-this.mCameraLocation.x)},ScreenY:function(e){return this.stage.height/2-(e-this.mCameraLocation.y)},GetImage:function(e){return this.assetManager.getImage(e)},OpenURL:function(e){this.AnalyticClickThruEvent(e),window.open(e,this.mDefaultLinkTarget)},PlayGame:function(){this.AnalyticGameEvent("begin"),this.subclassPlayGame()},CurrentScore:function(){return 0},subclassSetupLayers:function(){},subclassPlayGame:function(){this.StartLevel(-1)},subclassSetupLevel:function(e){},subclassStartPlaying:function(){},subclassStartLevel:function(){},subclassFinishLevel:function(){},subclassUpdateGame:function(e){},subclassEndGame:function(e){},subclassMouseMove:function(){},subclassMouseDown:function(){},subclassMouseUp:function(){},subclassKeyDown:function(e){},subclassKeyUp:function(e){},AnalyticGameEvent:function(e,t){this.analytics!==null&&this.analytics.logGameEvent(e,this.mCurrentLevel,t)},AnalyticShareEvent:function(e){this.analytics!==null&&this.analytics.logShareEvent(e,this.mCurrentLevel)},AnalyticLevelEvent:function(e){this.analytics!==null&&this.analytics.logLevelEvent(e,this.mCurrentLevel,Math.floor(this.mGameTime))},AnalyticAchievementEvent:function(e,t){this.analytics!==null&&this.analytics.logAchievementEvent(e,this.mCurrentLevel,t)},AnalyticErrorEvent:function(e){this.analytics!==null&&this.analytics.logErrorEvent(e)},AnalyticClickThruEvent:function(e){this.analytics!==null&&this.analytics.logClickThruEvent(e,this.mCurrentLevel)},AnalyticCustomEvent:function(e,t){this.analytics!==null&&this.analytics.logCustomEvent(e,this.mCurrentLevel,t)}},TGE.KEY_ARROW_LEFT=37,TGE.KEY_ARROW_RIGHT=39,TGE.KEY_ARROW_UP=38,TGE.KEY_ARROW_DOWN=40,TGE.KEY_SPACEBAR=32,TGE.ObjectsManager=function(){this.mObjectsArray=[]},TGE.ObjectsManager.prototype={AddObject:function(e){this.mObjectsArray.push(e)},Update:function(e){for(var t=this.mObjectsArray.length-1;t>=0;t--)this.mObjectsArray[t].Update(e),this.mObjectsArray[t].MarkedForRemoval()&&(this.mObjectsArray[t].Cleanup(),this.mObjectsArray.splice(t,1))},_updateObjectsToScreen:function(){for(var e=0;e<this.mObjectsArray.length;e++)this.mObjectsArray[e]._updateScreenPosition()},Purge:function(){for(var e=this.mObjectsArray.length-1;e>=0;e--)this.mObjectsArray[e].Cleanup(),this.mObjectsArray.splice(e,1)},NumObjects:function(){return this.mObjectsArray.length}},TGE.AssetLoader=function(){return this.mAssetList=null,this.mUpdateCallback=null,this.mCompleteCallback=null,this},TGE.AssetLoader.prototype={loadAssetList:function(e,t,n,r,s){n=typeof n=="string"?n:"",n.length>0&&n.charAt(n.length-1)!=="/"&&(n=n.concat("/")),this.mAssetList=t,this.mUpdateCallback=r,this.mCompleteCallback=s;var o=new PxLoader({statusInterval:3e3}),u=0;if(t!==null&&t.list.length>0&&t.loaded===!1){for(i=0;i<t.list.length;i++){var a=null;if(t.list[i].assetType==="audio")e.loadAudio&&(a=o.addAudio(t.list[i].id,n+t.list[i].url,n+t.list[i].backup_url,null,null),u++);else if(t.list[i].assetType==="audio_sprite")a={assetType:"audio_sprite",id:t.list[i].sprite,startTime:t.list[i].startTime,endTime:t.list[i].endTime};else if(t.list[i].sheet){var f=t.list[i].sheet,l=e._mSpriteSheets[f];l||(l=o.addImage(n+t.list[i].sheet),l!==null&&e.addImage(t.list[i].id,l),e._mSpriteSheets[t.list[i].sheet]=l);var c=TGE.AssetManager.SpriteSheets[this._trimmedFilename(f)];if(c){var h=c[this._trimmedFilename(t.list[i].url)];h&&(a={spriteSheet:l,x:h[0],y:h[1],width:h[2],height:h[3]})}}else a=o.addImage(n+t.list[i].url);a!==null&&e.addImage(t.list[i].id,a)}o.addProgressListener(TGE.AssetLoader.prototype._loaderCallback.bind(this)),o.addCompletionListener(TGE.AssetLoader.prototype._completeCallback.bind(this)),o.start()}else this.mUpdateCallback!==null&&this.mUpdateCallback(1),this.mCompleteCallback!==null&&this.mCompleteCallback.call()},_trimmedFilename:function(e){var t=e.lastIndexOf("/")+1;return e.substr(t,e.lastIndexOf(".")-t)},_loaderCallback:function(e){e.error&&TGE.log("***** ERROR: could not load image '"+e.resource.getName()+"'");if(this.mUpdateCallback!==null){var t=e.completedCount/e.totalCount;this.mUpdateCallback(t)}},_completeCallback:function(){this.mAssetList!==null&&(this.mAssetList.loaded=!0,this.mAssetList=null),this.mCompleteCallback!==null&&this.mCompleteCallback()}},TGE.AssetManager=function(e){return TGE.AssetManager.sAssetManagerInstance!==null?TGE.AssetManager.sAssetManagerInstance:(TGE.AssetManager.sAssetManagerInstance=this,e===undefined&&(e=!0),this.rootLocation="",this.useSpriteSheets=!1,this.loadAudio=e,this._mSpriteSheets={},this)},TGE.AssetManager.SpriteSheets={},TGE.AssetManager.sAssetManagerInstance=null,TGE.AssetManager.GetImage=function(e){return TGE.AssetManager.sAssetManagerInstance===null?null:TGE.AssetManager.sAssetManagerInstance.getImage(e)},TGE.AssetManager.prototype={_mImageAssetLists:[],_mImageCache:[],assignImageAssetList:function(e,t){this._mImageAssetLists[e]={loaded:!1,list:t}},loadAssetList:function(e,t,n){var r=new TGE.AssetLoader,i=this._mImageAssetLists[e];i?r.loadAssetList(this,i,this.rootLocation,t,n):(TGE.log("TGE.AssetManager could not locate asset list '"+e+"'"),n&&n.call())},addImage:function(e,t){this._mImageCache[e]=t},getImage:function(e,t){t=typeof t=="undefined"?!0:t;var n=this._mImageCache[e];return t&&e!=null&&!n&&TGE.log("***** ERROR: TGE.AssetManager.getImage could not find the asset '"+e+"'"),n}},TGE.SpriteAnimation=function(e,t,n,r,i,s,o){this.mFPS=s,this.mNumberOfFrames=i,this.mLooping=o,this.mAge=0,this.mPaused=!1,this.mFinishedCallback=null,this.mFrameOffset=0,this.mCurrentFrame=0,this.mSprite=new TGE.Sprite,this.mSprite.setImage(t,n,r),this.mSprite.visible=!1,e.addChild(this.mSprite),this.mSprite.registrationX=e.registrationX,this.mSprite.registrationY=e.registrationY},TGE.SpriteAnimation.prototype={Play:function(e){this.mAge=0,this.mFinishedCallback=e,this.mSprite.setSpriteIndex(0),this.mSprite.visible=!0},Pause:function(){this.mPaused=!0},Stop:function(){this.mSprite.visible=!1},Resume:function(){this.mPaused=!1},SetAnimationIndexOffset:function(e){this.mFrameOffset=e},Update:function(e){this.mPaused||(this.mAge+=e);var t=1/this.mFPS,n=Math.floor(this.mAge/t);this.mCurrentFrame=0,this.mLooping||n<this.mNumberOfFrames?this.mCurrentFrame=n%this.mNumberOfFrames:(this.mCurrentFrame=this.mNumberOfFrames-1,this.mFinishedCallback!=null&&(this.mFinishedCallback.call(),this.mFinishedCallback=null)),this.mCurrentFrame+=this.mFrameOffset,this.mSprite.setSpriteIndex(this.mCurrentFrame)}},TGE.KeyframedAnimation=function(e,t,n,r,i){return this.mAnimationPlayer=e,this.mAnimationID=t,this.mPartInstances=n,this.mLooping=r,this.mFinishedCallback=i,this.mSmoothTransitions=!1,this.mAge=0,this.mPaused=!1,this.mAnimationPlayer.AnimationExists(t)||(this.Cancel(),console.log("***** ERROR: keyframed animation not found: '"+t+"'")),this},TGE.KeyframedAnimation.prototype={Pause:function(){this.mPaused=!0},Resume:function(){this.mPaused=!1},Update:function(e){if(this.mPaused)return;this.mAge+=e,this.mAnimationPlayer.PosePartInstances(this.mPartInstances,this.mAnimationID,this.mAge,this.mLooping,this.mSmoothTransitions)},Cancel:function(){this.mFinishedCallback=null,this.Pause()}},TGE.KeyframedAnimationPlayer=function(e,t,n,r){var i,s=null;typeof t=="undefined"?(i=e.data,n=e.imagesFolder,t=e.assetsList,r=e.imageSet,s=typeof e.spriteSheet=="string"?e.spriteSheet:null):i=e,this.mData=null,this.mPartImages=null,this.mImageTag=typeof r=="undefined"?null:r;if(i.parts===undefined||i.part_instances===undefined||i.animations===undefined||i.max_children===undefined||i.framerate===undefined)return this;this.mData=i,this.mInverseGlobalScale=1/i.image_scale;if(t){typeof n=="undefined"&&(n="");for(var o in this.mData.parts)if(this.mData.parts.hasOwnProperty(o)){var u=this.mImageTag===null?o:this.mImageTag+"_"+o;s!==null?t.push({id:u,url:n+"/"+o+".png",sheet:s}):t.push({id:u,url:n+"/"+o+".png"})}}return this},TGE.KeyframedAnimationPlayer.prototype={Valid:function(){return this.mData!==null},GetAnimations:function(){return this.Valid()?this.mData.animations:null},NumRequiredPartInstances:function(){return this.Valid()?this.mData.max_children:0},AnimationExists:function(e){return this.Valid()?this.mData.animations[e]!==undefined:!1},InitializeImages:function(e){if(this.mPartImages!==null)return;this.mPartImages={};for(var t in this.mData.parts)if(this.mData.parts.hasOwnProperty(t)){var n=this.mImageTag===null?t:this.mImageTag+"_"+t;this.mPartImages[t]=e.GetImage(n)}},PosePartInstances:function(e,t,n,r,i){if(!this.Valid())return;var s=this.mData.animations[t],o=s.frames.length,u=o/this.mData.framerate,a=Math.floor(n/u),f=!r&&a>=1?o-1:(n-a*u)/u*o,l=Math.floor(f),c=s.frames[l],h=(l+1)%o,p=s.frames[h],d=e.length,v=c.instances.length;for(var m=0;m<d;m++){var g=e[m];if(m>=v)g.visible=!1;else{var y=c.instances[m],b=this.mData.part_instances[y.i],w=this.mData.parts[b];g.setImage(this.mPartImages[b]),g.registrationX=w.regx,g.registrationY=w.regy;var E=y.a,S=y.b,x=y.c,T=y.d,N=y.x,C=y.y;if(i){var k=p.instances[p.instances_map[y.i]];if(k!==undefined){var L=f-l;E=y.a+(k.a-y.a)*L,S=y.b+(k.b-y.b)*L,x=y.c+(k.c-y.c)*L,T=y.d+(k.d-y.d)*L,N=y.x+(k.x-y.x)*L,C=y.y+(k.y-y.y)*L}}E*=this.mInverseGlobalScale,S*=this.mInverseGlobalScale,x*=this.mInverseGlobalScale,T*=this.mInverseGlobalScale,g.setLocalTransform(E,S,x,T,N,C),g.visible=!0}}}},TGE.ScreenEntity=function(e){TGE.ScreenEntity.superclass.constructor.call(this),this.mGame=e,this.mAge=0,this.mMarkedForRemoval=!1,this.mAnimations=[],this.mCurrentAnimation=null,this.mKeyframedAnimationPlayer=null,this.mAnimationPartInstances=[],this.mCurrentKeyframedAnimation=null,this.mCurrentKeyframedAnimationID=null},TGE.ScreenEntity.prototype={_mCameraCulling:null,Setup:function(e,t,n,r){return this.mLayer=r,this.x=e,this.y=t,this.setImage(this.mGame.GetImage(n)),this.mGame.getLayer(this.mLayer).addChild(this),this},SetImage:function(e,t,n){var r=this.mGame.GetImage(e);if(r==null)return;t=typeof t!="undefined"?t:1,n=typeof n!="undefined"?n:1,this.setImage(r,t,n)},LoadAnimation:function(e,t,n,r,i,s,o){var u=new TGE.SpriteAnimation(this,this.mGame.GetImage(t),n,r,i,s,o);this.mAnimations[e]=u},PlayAnimation:function(e,t){if(this.mCurrentAnimation==this.mAnimations[e])return;this.PlayAnimationFromStart(e,t)},PlayAnimationFromStart:function(e,t){var n=this.mAnimations[e];n!=null&&(this.mCurrentAnimation!==null&&this.mCurrentAnimation.Stop(),this.setImage(null),this.mCurrentAnimation=n,this.mCurrentAnimation.Play(t),this.width=this.mCurrentAnimation.mSprite.width,this.height=this.mCurrentAnimation.mSprite.height)},removeCurrentAnimation:function(){this.mCurrentAnimation!==null&&this.mCurrentAnimation.Stop(),this.setImage(null),this.mCurrentAnimation=null,this.width=this.height=0,this._boundingInfoDirty=!0},InitializeKeyframedAnimations:function(e){this.mKeyframedAnimationPlayer=e,this.mKeyframedAnimationPlayer.InitializeImages(this.mGame),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Cancel();if(this.mAnimationPartInstances.length>0){var t=this.mAnimationPartInstances.length;for(var n=0;n<t;n++)this.mAnimationPartInstances[n].markForRemoval()}this.mAnimationPartInstances=[];var r=this.mKeyframedAnimationPlayer.NumRequiredPartInstances();for(var n=0;n<r;n++){var i=this.addChild(new TGE.Sprite);i.visible=!1,this.mAnimationPartInstances.push(i)}},PlayKeyframedAnimation:function(e,t,n){if(this.mCurrentKeyframedAnimationID===e)return;this.PlayKeyframedAnimationFromStart(e,t,n)},PlayKeyframedAnimationFromStart:function(e,t,n){typeof t=="undefined"&&(t=!0),typeof n=="undefined"&&(n=null),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Cancel(),this.mCurrentKeyframedAnimation=new TGE.KeyframedAnimation(this.mKeyframedAnimationPlayer,e,this.mAnimationPartInstances,t,n),this.mCurrentKeyframedAnimationID=e},Age:function(){return this.mAge},Update:function(e){this.mAge+=e,this.subclassUpdate(e),this.ShouldBeRemoved()&&this.markForRemoval(),this.mCurrentAnimation!=null&&this.mCurrentAnimation.Update(e),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Update(e)},Cleanup:function(){this.subclassCleanup(),this.clearChildren(),this.parent!==null&&this.parent.removeChild(this)},markForRemoval:function(){this.mMarkedForRemoval=!0;var e=this._mChildren.length;for(var t=0;t<e;t++)this._mChildren[t].markForRemoval()},MarkedForRemoval:function(){return this.mMarkedForRemoval},ShouldBeRemoved:function(){if(this._mCameraCulling!==null){var e=this.getBounds();if(this._mCameraCulling[0]&&e.y+e.height<0)return!0;if(this._mCameraCulling[1]&&e.x>this.mGame.Width())return!0;if(this._mCameraCulling[2]&&e.y>this.mGame.Height())return!0;if(this._mCameraCulling[3]&&e.x+e.width<0)return!0}return this.subclassShouldBeRemoved()},subclassUpdate:function(e){},subclassShouldBeRemoved:function(){return!1},subclassCleanup:function(){},_updateScreenPosition:function(){},SetRotation:function(e){this.rotation=e},SetScale:function(e,t){t=typeof t=="undefined"?e:t,this.scaleX=e,this.scaleY=t},SetAlpha:function(e){this.alpha=e},Width:function(){return this.width},Height:function(){return this.height},Show:function(){this.visible=!0},Hide:function(){this.visible=!1},Visible:function(){return this.visible}},extend(TGE.ScreenEntity,TGE.Sprite),TGE.Button=function(e){TGE.ScreenEntity.call(this,e),this.mouseEnabled=!0,this.mState="idle",this.mMouseDown=!1,this.mPressFunction},TGE.Button.prototype={Setup:function(e,t,n,r,i,s){return this.mNumStates=i,TGE.ScreenEntity.prototype.Setup.call(this,e,t,null,s),this.SetImage(n,1,i),this.mPressFunction=r,this.setButtonState("idle"),this},MouseDown:function(){this.mMouseDown=!0},MouseOver:function(){},MouseUp:function(){this.mPressFunction!=null&&this.mMouseDown&&this.mPressFunction.call(this,this),this.mMouseDown=!1},subclassUpdate:function(e){this.mMouseDown=this.mMouseDown&&this.mGame.IsMouseDown(),this._mMouseOver?this.setButtonState(this.mMouseDown?"down":"hover"):this.setButtonState("idle")},setButtonState:function(e){if(e==this.mState)return;this.mState=e;var t=0;switch(this.mState){case"disable":t=3;break;case"down":t=2;break;case"hover":t=1;break;case"idle":default:t=0}t<this.mNumStates&&this.setSpriteIndex(t)}},extend(TGE.Button,TGE.ScreenEntity),TGE.Text=function(e){return TGE.Text.superclass.constructor.call(this,e),this.text="",this.font="12px Arial",this.hAlign="center",this.vAlign="middle",this.textColor="#000",this},TGE.Text.prototype={_mPreviousText:null,_mPreviousFont:null,Setup:function(e,t,n,r,i,s,o,u){return TGE.ScreenEntity.prototype.Setup.call(this,e,t,null,u),this.text=n,this.font=r,this.hAlign=i,this.vAlign=s,this.textColor=o,this},_calculateDimensions:function(e){e.save(),e.font=this.font;var t=e.measureText(this.text);this.width=t.width;try{var n=this.font.indexOf("px"),r=this.font.substring(0,n);this.height=parseInt(r,10),this.height+=this.height/4>>0}catch(i){this.height=30}e.restore()},_drawClass:function(e){if(this.text===null)return;if(this._mPreviousText!==this.text||this._mPreviousFont!==this.font)this._mPreviousText=this.text,this._mPreviousFont=this.font,this._calculateDimensions(e);e.font=this.font!==null?this.font:"Arial",e.textAlign=this.hAlign!==null?this.hAlign:"center",e.textBaseline=this.vAlign!==null?this.vAlign:"middle",e.fillStyle=this.textColor!==null?this.textColor:"#000",e.fillText(this.text,0,0)}},extend(TGE.Text,TGE.ScreenEntity),TGE.GameWorldEntity=function(e){TGE.ScreenEntity.call(this,e),this.worldPosition=new TGE.Point},TGE.GameWorldEntity.prototype={_mLockXPosition:!1,Setup:function(e,t,n,r){return this.mLayer=r,this.SetWorldPosition(e,t),this.setImage(this.mGame.GetImage(n)),this.mGame.getLayer(this.mLayer).addChild(this),this},SetWorldPosition:function(e,t){this.worldPosition.x=e,this.worldPosition.y=t},CullToCamera:function(e,t,n,r){this._mCameraCulling=[e,t,n,r]},WorldPosition:function(){return this.mWorldPosition},LockXPosition:function(){this._mLockXPosition=!0},_updateScreenPosition:function(){var e=this._mLockXPosition?this.worldPosition.x:this.mGame.ScreenX(this.worldPosition.x),t=this.mGame.ScreenY(this.worldPosition.y);this.x=e,this.y=t}},extend(TGE.GameWorldEntity,TGE.ScreenEntity,null),TGE.Screen=function(e){this.mScreenManager=e,this.mBackground=null,this.mUIElements=new Array,this.mDestroyed=!1},TGE.Screen.prototype={Setup:function(){},Close:function(){this.mScreenManager.CloseScreen(this.constructor)},Game:function(){return this.mScreenManager.Game()},CreateUIEntity:function(e){var t=this.mScreenManager.CreateUIEntity(e);return this.mUIElements.push(t),t},DisplayNumber:function(e,t,n,r,s,o,u,a){var f=this.CreateUIEntity(TGE.ScreenEntity).Setup(t,n,null,a),l=e.toString(),c=24,h=2,p=l.length*s;if(u){var d=Math.floor((l.length-1)/3);p+=d*c,p-=d*h}var v=o=="center"?p/2+s/2:p;v-=s;var m=0,g=0;for(i=l.length-1;i>=0;i--){if(u&&g==3){v+=h;var y=new TGE.Sprite;y.setImage("big_digits_comma"),y.x=v,y.y=m,f.addChild(y),v-=c,g=0}var b=new TGE.Sprite;b.setImage(r,1,10),b.setSpriteIndex(l.charCodeAt(i)-48),b.x=v,b.y=m,f.addChild(b),v-=s,g++}return f},FillBackground:function(e){this.mBackground=this.mScreenManager.Game().CreateUIEntity(TGE.ScreenEntity),this.mBackground.Setup(0,0,null,this.mScreenManager.mLayerName),this.mBackground.registrationX=0,this.mBackground.registrationY=0,this.mBackground.width=this.mScreenManager.Game().Width(),this.mBackground.height=this.mScreenManager.Game().Height(),this.mBackground.backgroundColor=e},Finalize:function(){},ShowAll:function(){for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].Show()},HideAll:function(){for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].Hide()},Update:function(e){},Destroy:function(){this.mBackground!=null&&this.mBackground.markForRemoval();for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].markForRemoval();this.mDestroyed=!0}},TGE.ScreenManager=function(e){this.mGame=e,this.mLayerName="ScreenManager",this.mScreens=new Array,this.mFadeIn=null,this.mFadeInAlpha=1,this.mFadeInSpeed=1,this.mFadeInColor=null},TGE.ScreenManager.prototype={Initialize:function(e){for(var t in this.mScreens)this.mScreens[t]!=null&&(this.mScreens[t].Destroy(),this.mScreens[t]=null);e.CreateLayer(this.mLayerName),e.CreateLayer("FadeOverlay")},setupFadeIn:function(e,t){this.mFadeInSpeed=t,this.mFadeInColor=e},CreateUIEntity:function(e){return this.mGame.CreateUIEntity(e)},ShowScreen:function(e,t){var n=new e;e.prototype.constructor.apply(n,[this]);var r=e.className?e.className():e.name;return this.mScreens[r]=n,n.Setup(),n.Finalize(),t=typeof t=="undefined"?!0:t,t!=0&&this.ResetFade(),n},CloseScreen:function(e){var t=e.className?e.className():e.name,n=this.mScreens[t];if(n==null)return;n.Destroy(),this.mScreens[e]=null},ResetFade:function(){this.mFadeInColor!==null&&(this.mFadeIn===null&&(this.mFadeIn=new TGE.DisplayObject,this.mFadeIn.width=this.mGame.Width(),this.mFadeIn.height=this.mGame.Height(),this.mFadeIn.registrationX=0,this.mFadeIn.registrationY=0,this.mFadeIn.backgroundColor=this.mFadeInColor,this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn)),this.mGame.getLayer("FadeOverlay").getChildIndex(this.mFadeIn)===-1&&this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn),this.mFadeInAlpha=1,this.mFadeIn.alpha=1,this.mFadeIn.visible=!0)},Update:function(e){this.mFadeIn!==null&&this.mFadeInColor!==null&&(this.mFadeInAlpha-=e/this.mFadeInSpeed,this.mFadeInAlpha<=0&&(this.mFadeInAlpha=0,this.mFadeIn.visible=!1),this.mFadeIn.alpha=this.mFadeInAlpha);for(var t in this.mScreens)this.mScreens[t]!=null&&this.mScreens[t].Update(e)},Game:function(){return this.mGame},XFromPercentage:function(e){return this.mGame.Width()*e},YFromPercentage:function(e){return this.mGame.Height()*e},FixedDistanceFromTop:function(e){return e},FixedDistanceFromBottom:function(e){return this.mGame.Height()-e},FixedDistanceFromLeft:function(e){return e},FixedDistanceFromRight:function(e){return this.mGame.Width()-e}},TGE.Analytics=function(e){return this.gameName=e,this},TGE.Analytics.prototype={logGameEvent:function(e,t,n){var r=this.gameName;(e=="pause"||e=="resume")&&t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: game, "+e+", "+r;if(e=="load"||e=="end")i+=", "+n.toString();TGE.log(i)},logShareEvent:function(e,t){var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="ANALYTIC EVENT: share, "+e+", "+n;TGE.log(r)},logLevelEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: level, "+e+", "+r;(e=="complete"||e=="fail")&&n!=null&&(i+=", "+n.toString()),TGE.log(i)},logAchievementEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: achievement, "+e+", "+r;n!=null&&(i+=", "+n.toString()),TGE.log(i)},logErrorEvent:function(e){var t="ANALYTIC EVENT: error, "+e+", "+this.gameName;TGE.log(t)},logClickThruEvent:function(e,t){var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="ANALYTIC EVENT: clickthru, "+e+", "+n;TGE.log(r)},logCustomEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: custom, "+e+", "+r;n!=null&&(i+=", "+n.toString()),TGE.log(i)}},TGE.GoogleAnalytics=function(e,t){return TGE.GoogleAnalytics.superclass.constructor.call(this,e),TGE.BrowserDetect.usingPhoneGap&&(window.plugins&&window.plugins.gaPlugin?(this._gaPlugin=window.plugins.gaPlugin,this._gaPlugin.init(null,this._logError,t,10)):TGE.log("***** ERROR: PhoneGap GoogleAnalytics plugin was not found")),this},TGE.GoogleAnalytics.prototype={_gaPlugin:null,logGameEvent:function(e,t,n){try{var r=this.gameName;(e=="pause"||e=="resume")&&t!=null&&t>0&&(r+=" - level "+t.toString());var i="game",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logShareEvent:function(e,t){try{var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="share",i=e,s=n,o=null;this._trackEvent(r,i,s,o)}catch(u){this._logError(u.toString())}},logLevelEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="level",s=e,o=r,u;if(e=="complete"||e=="fail"&&n!=null)u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logAchievementEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="achievement",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logErrorEvent:function(e){try{var t="error",n=e,r=this.gameName,i=null;this._trackEvent(t,n,r,i)}catch(s){this._logError(s.toString())}},logClickThruEvent:function(e,t){try{var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="clickthru",i=e,s=n,o=null;this._trackEvent(r,i,s,o)}catch(u){this._logError(u.toString())}},logCustomEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="custom",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},_trackEvent:function(e,t,n,r){this._gaPlugin!==null?(typeof r!="number"&&(r=-1),this._gaPlugin.trackEvent(this._logResult,this._logError,e,t,n,r)):_gaq&&_gaq.push(["_trackEvent",e,t,n,r])},_logError:function(e){TGE.log("***** ERROR: TGE.GoogleAnalytics - "+e)},_logResult:function(e){}},extend(TGE.GoogleAnalytics,TGE.Analytics),TGE.ParallaxPane=function(e){TGE.ParallaxPane.superclass.constructor.call(this,e),this.mTrackingSpeed=1,this.mPane1=null,this.mPane2=null,this.mHorizontalOffset=0,this.mWorldY=0},TGE.ParallaxPane.prototype={Setup:function(e,t,n,r){return TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,r),this.mWorldY=e,this.registrationX=0,this.registrationY=0,this.mTrackingSpeed=t,this.mPane1=new TGE.Sprite,this.mPane1.setImage(this.mGame.GetImage(n)),this.addChild(this.mPane1),this.mPane1.x=0,this.mPane1.y=0,this.mPane1.registrationX=0,this.mPane1.registrationY=0,this.mPane2=new TGE.Sprite,this.mPane2.setImage(this.mGame.GetImage(n)),this.addChild(this.mPane2),this.mPane2.x=this.mGame.Width(),this.mPane2.y=0,this.mPane2.registrationX=0,this.mPane2.registrationY=0,this},SetHorizontalOffset:function(e){this.mHorizontalOffset=e},_updateScreenPosition:function(){var e=this.mGame.CameraLocation().x,t=(-e+this.mHorizontalOffset)*this.mTrackingSpeed/this.scaleX,n=this.mGame.Width()/this.scaleX;this.mPane1.x=t%n,this.mPane1.y=this.mGame.ScreenY(this.mWorldY),this.mPane2.x=this.mPane1.x+n,this.mPane2.y=this.mGame.ScreenY(this.mWorldY)}},extend(TGE.ParallaxPane,TGE.ScreenEntity),TGE.VerticalParallaxPane=function(e){TGE.VerticalParallaxPane.superclass.constructor.call(this,e),this.mTrackingSpeed=1,this.mPane1=null,this.mPane2=null,this.mVerticalOffset=0},TGE.VerticalParallaxPane.prototype={Setup:function(e,t,n){return TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,n),this.registrationX=0,this.registrationY=0,this.mTrackingSpeed=e,this.mPane1=new TGE.Sprite,this.mPane1.setImage(this.mGame.GetImage(t)),this.addChild(this.mPane1),this.mPane1.x=0,this.mPane1.y=0,this.mPane1.registrationX=0,this.mPane1.registrationY=0,this.mPane2=new TGE.Sprite,this.mPane2.setImage(this.mGame.GetImage(t)),this.addChild(this.mPane2),this.mPane2.x=0,this.mPane2.y=this.mGame.Height(),this.mPane2.registrationX=0,this.mPane2.registrationY=0,this},_updateScreenPosition:function(){var e=this.mGame.CameraLocation().y,t=(e+this.mVerticalOffset)*this.mTrackingSpeed/this.scaleY,n=this.mGame.Height()/this.scaleY;this.mPane1.x=0,this.mPane1.y=t%n,this.mPane2.x=0,this.mPane2.y=this.mPane1.y-n}},extend(TGE.VerticalParallaxPane,TGE.ScreenEntity),TGE.Advertisement=function(e){this.element=e.element==="undefined"?null:e.element,this.closeCallback=e.closeCallback==="undefined"?null:e.closeCallback},TGE.Advertisement.prototype={close:function(){this.element!==null&&this.element.parentNode!==null&&this.element.parentNode.removeChild(this.element),this.closeCallback!==null&&this.closeCallback.call()}},TGE.Advertisement.DisplayAd=function(e){var t=e.parentDiv,n=e.adWidth,r=e.adHeight,i=typeof e.x=="undefined"?(t.clientWidth-n)/2:e.x,s=typeof e.y=="undefined"?(t.clientHeight-r)/2:e.y,o=typeof e.closeCallback=="undefined"?null:e.closeCallback,u=null;return TGE.BrowserDetect.platform==="Android"&&TGE.BrowserDetect.browser==="Mozilla"&&TGE.BrowserDetect.OSversion==="4.0"?u=null:getDistributionPartner()==="A0009"?u=null:(u=document.createElement("div"),u.style.position="absolute",u.style.zIndex=3,u.style.left=i.toString()+"px",u.style.top=s.toString()+"px",u.style.width=n.toString()+"px",u.style.height=r.toString()+"px",u.style.overflow="hidden",u.style.border="none",t.insertBefore(u,t.firstChild),u.innerHTML="<object type='text/html' width='"+n+"px' height='"+(r+4).toString()+"px' data='"+e.adURL+"'></object>"),new TGE.Advertisement({element:u,closeCallback:o})},TGE.Advertisement.DisplayModalOverlayAd=function(e){var t=e.parentDiv,n=e.adWidth,r=e.adHeight,i=typeof e.skipDelay=="undefined"?0:e.skipDelay,s=typeof e.headerText=="undefined"?"This game sponsored by:":e.headerText,o=typeof e.overlayRed=="undefined"?1:e.overlayRed,u=typeof e.overlayGreen=="undefined"?1:e.overlayGreen,a=typeof e.overlayBlue=="undefined"?1:e.overlayBlue,f=typeof e.overlayOpacity=="undefined"?1:e.overlayOpacity,l=typeof e.closeCallback=="undefined"?null:e.closeCallback;if(TGE.BrowserDetect.platform==="Android"&&TGE.BrowserDetect.browser==="Mozilla"&&TGE.BrowserDetect.OSversion==="4.0"){l!==null&&l.call();return}if(getDistributionPartner()==="A0009"){l!==null&&l.call();return}var c=document.createElement("div");c.id="ad_overlay",c.style.zIndex=3,c.style.position="absolute",c.style.width=t.clientWidth+"px",c.style.height=t.clientHeight+"px",c.style.backgroundColor="rgba("+Math.round(o*255).toString()+","+Math.round(u*255).toString()+","+Math.round(a*255).toString()+","+f.toString()+")",t.insertBefore(c,t.firstChild);var h=null;if(typeof e.closeButton=="string"){var p=30;h=document.createElement("div"),h.id="tge_ad_close_button",h.style.position="absolute",h.style.display="none";var d=Math.round(t.clientWidth*.0156),v=t.clientWidth-d-p;h.style.top=d.toString()+"px",h.style.left=v.toString()+"px",h.innerHTML="<img src='"+e.closeButton+"'>",h.style.cursor="pointer",c.insertBefore(h,c.firstChild)}var p=30,m=document.createElement("div");m.id="tge_ad_resume_button",m.style.position="absolute",m.style.display="none";var d=Math.round(t.clientHeight*.904),v=(t.clientWidth-302)/2;m.style.top=d.toString()+"px",m.style.left=v.toString()+"px",m.style.width="300px",m.style.marginLeft="auto",m.style.marginRight="auto",m.style.textAlign="center",m.style.paddingTop="6px",m.style.paddingBottom="6px",m.style.backgroundColor="#f00",m.style.border="solid 1px #444",m.style.borderRadius="5px",m.style.color="#fff",m.style.fontSize="17px",m.style.fontWeight="bold",m.innerHTML="Resume Game Play",m.style.cursor="pointer",c.insertBefore(m,c.firstChild);var g=!TGE.BrowserDetect.isMobileDevice||TGE.BrowserDetect.platform==="Windows Phone"?"click":"touchstart";h!==null&&h.addEventListener(g,TGE.Advertisement._CloseAd.bind(this,c,l),!1),m.addEventListener(g,TGE.Advertisement._CloseAd.bind(this,c,l),!1),i>0?setTimeout(TGE.Advertisement._ShowOverlayCloseButtons.bind(this,c),i*1e3):TGE.Advertisement._ShowOverlayCloseButtons(c),c.addEventListener("click",TGE.Advertisement._BlockEvent,!1),c.addEventListener("mousedown",TGE.Advertisement._BlockEvent,!1),c.addEventListener("mouseup",TGE.Advertisement._BlockEvent,!1),c.addEventListener("mousemove",TGE.Advertisement._BlockEvent,!1);var y=document.createElement("div");y.id="ad_div",y.style.position="absolute";var d=(t.clientHeight-(r+70))/2;y.style.top=d.toString()+"px",y.style.marginLeft="auto",y.style.marginRight="auto",y.style.width="100%",y.style.overflow="hidden",y.style.color="#333",y.style.fontSize="20px",y.style.fontWeight="bold",y.style.textAlign="center",c.insertBefore(y,c.firstChild),y.innerHTML="<div style='padding-bottom: 15px;'>"+s+"</div><object type='text/html' width='"+n+"px' height='"+(r+4).toString()+"px' data='"+e.adURL+"'></object><div style='color: #666; font-size: 10px; font-weight: normal; padding-left: "+(n-72).toString()+"px;'>Advertisement</div>"},TGE.Advertisement.DisplayChildBrowserAd=function(e){window.plugins.childBrowser.onClose=e.closeCallback,window.plugins.childBrowser.showWebPage(e.adURL,{showLocationBar:!0,showAddress:!1,showNavigationBar:!0})},TGE.Advertisement._CloseAd=function(e,t,n){e.parentNode.removeChild(e),t!==null&&t.call()},TGE.Advertisement._ShowOverlayCloseButtons=function(e){var t=document.getElementById("tge_ad_close_button");t!=null&&(t.style.display="block");var n=document.getElementById("tge_ad_resume_button");n!=null&&(n.style.display="block")},TGE.Advertisement._BlockEvent=function(e){return e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation(),!1},TGE.Achievement=function(e,t,n,r){return this._id=e,this._earned=!1,this.name=t,this.description=n,this.imageID=r,this},TGE.Achievement.prototype={_id:null,earned:function(){this._earned=!0},hasBeenEarned:function(){return this._earned},id:function(){return this._id}},TGE.Achievements=function(){return this.lockedIconID=null,this.earnedAchievementCallback=null,this},TGE.Achievements.HigherScoresAreBetter=!0,TGE.Achievements.BestScore=null,TGE.Achievements._FRIENDSTER_API_URL="http://www.littlegrey.net/temp/tresensa/friendster",TGE.Achievements.SubmitScore=function(e){var t=new TGE.Achievements;t.submitScore(e)},TGE.Achievements.ShowAchievementsScreen=function(e){getDistributionPartner()==="A0014"&&typeof MNDirect!="undefined"?TGE.PlayPhoneWrapper.showAchievementsScreen():e.call()},TGE.Achievements.EnableParterUI=function(e){getDistributionPartner()==="A0014"&&(e?TGE.PlayPhoneWrapper.showDashboardButton():TGE.PlayPhoneWrapper.hideDashboardButton())},TGE.Achievements.prototype={_achievements:[],_achievementIDs:[],createAchievement:function(e,t,n,r){this._achievements[e]=new TGE.Achievement(e,t,n,r),this._achievementIDs.push(e)},saveCompletedAchievements:function(){var e="",t=this._achievementIDs.length;for(var n=0;n<t;n++){var r=this.getAchievementAt(n);r.hasBeenEarned()&&(e+=n,e+=" ")}var i="";t=e.length;for(c=0;c<t;c++)e.charAt(c)===" "?i+=Math.floor(Math.random()*10).toString():i+=String.fromCharCode(e.charCodeAt(c)+50);if(i.length>0){var s=new Date,o=999;s.setDate(s.getDate()+o);var u=i+(o==null?"":"; expires="+s.toUTCString());document.cookie="tgeachv1="+u}},loadCompletedAchievements:function(){var e=null,t,n,r,i=document.cookie.split(";");for(t=0;t<i.length;t++)n=i[t].substr(0,i[t].indexOf("=")),r=i[t].substr(i[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n=="tgeachv1"&&(e=r);if(e){var s="";len=e.length;for(c=0;c<len;c++){var o=e.charCodeAt(c);e.charCodeAt(c)<=57?s+=" ":s+=String.fromCharCode(e.charCodeAt(c)-50)}var u=s.split(" ");for(var a=0;a<u.length;a++)u[a].length>0&&this.earnedAchievementAt(parseInt(u[a]),!0)}},clearAchievements:function(){var e=new Date,t=999;e.setDate(e.getDate()+t);var n=""+(t==null?"":"; expires="+e.toUTCString());document.cookie="tgeachv1="+n},numberOfAchievements:function(){return this._achievementIDs.length},getAchievement:function(e){return this._achievements[e]},getAchievementAt:function(e){return this.getAchievement(this._achievementIDs[e])},earnedAchievementAt:function(e,t){this.earnedAchievement(this._achievementIDs[e],t)},earnedAchievement:function(e,t){t=typeof t=="undefined"?!1:t;var n=this._achievements[e];n&&(n.hasBeenEarned()||(n.earned(),!t&&this.earnedAchievementCallback&&this.earnedAchievementCallback.call(null,n),this.submitAchievementToPartner(n,t),this.saveCompletedAchievements()))},submitScore:function(e){var t=!1;TGE.Achievements.BestScore===null?(TGE.Achievements.BestScore=e,t=!1):TGE.Achievements.HigherScoresAreBetter&&e>TGE.Achievements.BestScore?(TGE.Achievements.BestScore=e,t=!0):!TGE.Achievements.HigherScoresAreBetter&&e<TGE.Achievements.BestScore&&(TGE.Achievements.BestScore=e,t=!0);if(getDistributionPartner()==="A0009"&&parent.kongregate)parent.kongregate.stats.submit("highscore",e);else if(getDistributionPartner()==="A0010"){var n=parseInt(getQueryString().user),r=parseInt(getQueryString().hid);if(!isNaN(n)&&!isNaN(r)&&n>0&&r>=0){var i=Sha1.hash(r.toString()+e.toString()+"troisdixchix"+n.toString()),s="http://www.digyourowngrave.com/high_scores/exclusive/auto_submit_score.php?user_id="+n+"&game_id="+r+"&score="+e+"&key="+i,o=document.createElement("img");o.src=s}}else if(getDistributionPartner()==="A0013"){var u=getQueryString().session_key,a=getQueryString().gameName;if(u&&a){var f=new FriendsterSocialLeaderBoard,l={id:getQueryString().user_id,score:e,sessionKey:u,gameName:a};f.AutoSubmitScore(l);if(t){var s=TGE.Achievements._FRIENDSTER_API_URL+"/richwallpost.php?gameName="+a+"&score="+e+"&session_key="+u,o=document.createElement("img");o.src=s}}}else getDistributionPartner()==="A0014"?TGE.PlayPhoneWrapper.submitScore(e):TGE.BrowserDetect.usingPhoneGap&&TGE.BrowserDetect.oniOS},submitAchievementToPartner:function(e,t){if(e)if(getDistributionPartner()==="A0009"&&parent.kongregate)parent.kongregate.stats.submit(e.id(),1);else if(getDistributionPartner()==="A0010"){var n=parseInt(getQueryString().aid),r=parseInt(getQueryString().user);if(!isNaN(n)&&!isNaN(r)&&n>=0&&r>0){var i=this._achievementIDs.indexOf(e.id());if(i>=0){var s=n+i,o=Sha1.hash(s.toString()+"troisdixchix"+r.toString()),u="http://www.digyourowngrave.com/high_scores/exclusive/auto_submit_achievement.php?user_id="+r+"&achievement="+s+"&key="+o,a=document.createElement("img");a.src=u}}}else if(!t&&getDistributionPartner()==="A0013"){var f=getQueryString().session_key,l=getQueryString().gameName;if(f&&l){var c=encodeURIComponent(e.name),u=TGE.Achievements._FRIENDSTER_API_URL+"/richwallpost.php?gameName="+l+"&achv="+c+"&session_key="+f,a=document.createElement("img");a.src=u}}else if(getDistributionPartner()==="A0014"){var i=this._achievementIDs.indexOf(e.id());TGE.PlayPhoneWrapper.achievementEarned(i)}else TGE.BrowserDetect.usingPhoneGap&&TGE.BrowserDetect.oniOS}},FriendsterSocialLeaderBoard.prototype={GetUserDetails:function(e){var t={id:"",sessionKey:0,score:0};e(t)},AutoSubmitScore:function(e){for(var t=0;t<this.loginDetails.length;t++){var n={};n.sParams="",n.sParams+="avatar_id="+e.id,n.sParams+="&session_key="+e.sessionKey,n.sParams+="&game_name="+e.gameName,n.sParams+="&score="+e.score,n.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard",n.requestType="POST",n.callback=function(){},this.sendMessage(n)}},SubmitScore:function(e){var t={};t.sParams="",t.sParams+="avatar_id="+e.id,t.sParams+="&session_key="+e.sessionKey,t.sParams+="&game_name="+this.userConfiguration.GameCode,t.sParams+="&score="+e.score,t.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard",t.requestType="POST",t.callback=e.callback,this.sendMessage(t)},GetLeaderboard:function(e){if(e.id!="undefined"&&e.id!=undefined){var t={};t.sParams="",t.sParams+="avatar_id="+e.id,t.sParams+="&session_key="+e.sessionKey,t.sParams+="&game_name="+this.userConfiguration.GameCode,t.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard?"+t.sParams,t.requestType="GET",t.callback=e.callback,this.sendMessage(t)}else this.userConfiguration.ErrorHandler("backend-error")},sendMessage:function(e,t){var n,r=this,i=e,s=t;if(window.XDomainRequest)this.xdr=new XDomainRequest,this.xdr?(this.xdr.onerror=this.err.bind(this),this.xdr.ontimeout=this.timeo.bind(this),this.xdr.onprogress=this.progres.bind(this),this.xdr.onload=function(){var e=r.xdr.responseText,t=JSON.parse(e);t.Error==undefined&&t.Error==null?(i.callback(t),s!=undefined&&r.updateLoginDetails(t)):r.userConfiguration.ErrorHandler("backend-error")},this.xdr.timeout="2000",this.xdr.open(i.requestType,i.sURL+"?"+i.sParams),this.xdr.send()):this.userConfiguration.ErrorHandler("backend-error");else{window.XMLHttpRequest?n=new XMLHttpRequest:n=new ActiveXObject("Microsoft.XMLHTTP");try{n.onreadystatechange=function(){if(n.readyState==4)if(n.status!=200)r.userConfiguration.ErrorHandler("backend-error");else if(e.callback!=null){var t=JSON.parse(n.responseText);t.Error==undefined&&t.Error==null?(e.callback(t),s!=undefined&&r.updateLoginDetails(t)):r.userConfiguration.ErrorHandler("backend-error")}}}catch(o){this.userConfiguration.ErrorHandler("backend-error")}try{n.open(e.requestType,e.sURL,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(e.sParams)}catch(o){this.userConfiguration.ErrorHandler("backend-error")}}},err:function(){this.userConfiguration.ErrorHandler("backend-error")},timeo:function(){this.userConfiguration.ErrorHandler("backend-error")},progres:function(){},stopdata:function(){this.abort()},UpdateConfig:function(e){this.userConfiguration.ErrorHandler=e.ErrorHandler,this.userConfiguration.SocialNetwork=String(e.SocialNetwork).toLowerCase()}},TGE.PlayPhoneWrapper={dashboardButton:null,pendingAchievements:[],initialize:function(){if(typeof MNDirect=="undefined"){TGE.log("***** ERROR: PlayPhone SDK was not loaded properly.");return}MNDirect.AppReloadClient.setAppReloadHandler(MNDirect.AppReloadClient.APP_RELOAD_ALLOWED),MNDirect.AppReloadClient.setAppAfterReloadHandler(MNDirect.AppReloadClient.APP_AFTER_RELOAD_AUTO),MNDirectPopup.init(MNDirectPopup.MNDIRECTPOPUP_WELCOME);var e=78100,t="08b10129-d2f5da4f-eb68767e-85df7a2d";MNDirect.init(e,t),MNDirectUIHelper.showDashboard(),MNDirectUIHelper.addEventHandler(MNDirectUIHelper.EventName.onHideDashboard,TGE.PlayPhoneWrapper.onHideDashboard),MNDirect.addEventHandler(MNDirect.EventName.onUserLogin,TGE.PlayPhoneWrapper.onUserLogin),MNDirect.addEventHandler(MNDirect.EventName.onUserLogout,TGE.PlayPhoneWrapper.onUserLogout)},onHideDashboard:function(e){var t=MNDirect.getSession().isUserLoggedIn();t||MNDirectUIHelper.showDashboard()},onUserLogin:function(e){var t=MNDirect.getSession().isUserLoggedIn();if(t){TGE.PlayPhoneWrapper.hideDashboard();if(TGE.PlayPhoneWrapper.pendingAchievements.length>0){for(var n=0;n<TGE.PlayPhoneWrapper.pendingAchievements.length;n++)TGE.PlayPhoneWrapper.achievementEarned(TGE.PlayPhoneWrapper.pendingAchievements[n]);TGE.PlayPhoneWrapper.pendingAchievements=[]}}},onUserLogout:function(e){MNDirectUIHelper.showDashboard()},dashboardButtonClicked:function(e){MNDirect.execAppCommand("jumpToLeaderboard",null),MNDirectUIHelper.showDashboard()},hideDashboard:function(){MNDirectUIHelper.hideDashboard();if(TGE.Game&&TGE.Game.GetInstance()){TGE.Game.GetInstance()._determineCanvasPosition();if(TGE.PlayPhoneWrapper.dashboardButton===null){var e=TGE.Game.GetInstance().mCanvasDiv;TGE.PlayPhoneWrapper.dashboardButton=document.createElement("div");var t=80,n=10,r=TGE.PlayPhoneWrapper.dashboardButton;r.id="playphone_dashboard_button",r.style.position="absolute";var i=n*(TGE.BrowserDetect.isMobileDevice?3:1),s=e.clientWidth-n-t;r.style.top=i.toString()+"px",r.style.left=s.toString()+"px",r.innerHTML="<img src='http://slb.tresensa.com/playphone/dashboard_button.png'>",r.style.cursor="pointer",r.style.zIndex=5,e.insertBefore(r,e.firstChild);var o=TGE.BrowserDetect.isMobileDevice?"touchstart":"click";r.addEventListener(o,TGE.PlayPhoneWrapper.dashboardButtonClicked,!1)}}},showDashboardButton:function(){TGE.PlayPhoneWrapper.dashboardButton!==null&&(TGE.PlayPhoneWrapper.dashboardButton.style.display="block")},hideDashboardButton:function(){TGE.PlayPhoneWrapper.dashboardButton!==null&&(TGE.PlayPhoneWrapper.dashboardButton.style.display="none")},showAchievementsScreen:function(){if(typeof MNDirect=="undefined")return;MNDirect.execAppCommand("jumpToAchievements",null),MNDirectUIHelper.showDashboard()},submitScore:function(e){if(typeof MNDirect=="undefined")return;MNDirect.postGameScore(e)},achievementEarned:function(e){if(typeof MNDirect=="undefined"||typeof MNDirect.getSession()=="undefined"||!MNDirect.getSession().isUserLoggedIn()){TGE.PlayPhoneWrapper.pendingAchievements.push(e);return}var t=e+1,n=function(e){e.hadError()&&TGE.log("***** ERROR: PlayPhone SDK could not unlock achievement id "+t+", "+e.getErrorMessage())};MNDirect.serviceProvider.Achievements.reqCurrUserUnlockAchievement(n,t)}},getDistributionPartner()==="A0014"&&loadScript("http://webui.social.playphone.com/web_mnsapi/MNDirectHost.js.php",TGE.PlayPhoneWrapper.initialize),TGE.PlatformCompatibility=function(){return this},TGE.PlatformCompatibility.prototype={isAudioSupported:function(){var e=document.createElement("audio"),t=!1;try{if(t=!!e.canPlayType)t=new Boolean(t),t.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),t.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),t.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),t.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(n){}return t},isAudioFormatSupported:function(e){var t=document.createElement("audio"),n=!1,r;try{if(n=!!t.canPlayType){n=new Boolean(n);switch(e){case"ogg":r=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");break;case"mp3":r=t.canPlayType("audio/mpeg;").replace(/^no$/,"");break;case"wav":r=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");break;case"m4a":r=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,"");break;default:}}}catch(i){}return r},isCanvasSupported:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},isVideoSupported:function(){var e=document.createElement("video"),t=!1;try{if(t=!!e.canPlayType)t=new Boolean(t),t.ogg=e.canPlayType('video/ogg; codecs="theora"'),t.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"'),t.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"')}catch(n){}return t},isDragAndDropSupported:function(){var e=document.createElement("div");return bool="draggable"in e||"ondragstart"in e&&"ondrop"in e,bool},isGeolocationSupported:function(){return!!navigator.geolocation},isWebGlSupported:function(){try{var e=document.createElement("canvas"),t;t=!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl")&&!e.getContext("webgl")),e=undefined}catch(n){t=!1}return t},isHistorySupported:function(){return!!window.history&&!!history.pushState},isVideoSupported:function(){var e=document.createElement("video"),t=!1},isLocalStorageSupported:function(){try{return localStorage.setItem(mod,mod),localStorage.removeItem(mod),!0}catch(e){return!1}},isSessionStorageSupported:function(){try{return sessionStorage.setItem(mod,mod),sessionStorage.removeItem(mod),!0}catch(e){return!1}},isSVGSupported:function(){return ns={svg:"http://www.w3.org/2000/svg"},!!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect}},TGE.DeviceOrientation=function(){return this},TGE.DeviceOrientation.prototype={orientationChangeCallBack:null,RegisterOrientationChange:function(e){TGE.DeviceOrientation.prototype.orientationChangeCallBack=e,window.addEventListener("orientationchange",TGE.DeviceOrientation.prototype.internalOrientationChanged),TGE.DeviceOrientation.prototype.internalOrientationChanged()},internalOrientationChanged:function(){window.orientation===90||window.orientation===-90?TGE.DeviceOrientation.prototype.orientationChangeCallBack("landscape"):TGE.DeviceOrientation.prototype.orientationChangeCallBack("portrait")}};var Sha1={};Sha1.hash=function(e,t){t=typeof t=="undefined"?!0:t,t&&(e=Utf8.encode(e));var n=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);var r=e.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(var o=0;o<i;o++){s[o]=new Array(16);for(var u=0;u<16;u++)s[o][u]=e.charCodeAt(o*64+u*4)<<24|e.charCodeAt(o*64+u*4+1)<<16|e.charCodeAt(o*64+u*4+2)<<8|e.charCodeAt(o*64+u*4+3)}s[i-1][14]=(e.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(e.length-1)*8&4294967295;var a=1732584193,f=4023233417,l=2562383102,c=271733878,h=3285377520,p=new Array(80),d,v,m,g,y;for(var o=0;o<i;o++){for(var b=0;b<16;b++)p[b]=s[o][b];for(var b=16;b<80;b++)p[b]=Sha1.ROTL(p[b-3]^p[b-8]^p[b-14]^p[b-16],1);d=a,v=f,m=l,g=c,y=h;for(var b=0;b<80;b++){var w=Math.floor(b/20),E=Sha1.ROTL(d,5)+Sha1.f(w,v,m,g)+y+n[w]+p[b]&4294967295;y=g,g=m,m=Sha1.ROTL(v,30),v=d,d=E}a=a+d&4294967295,f=f+v&4294967295,l=l+m&4294967295,c=c+g&4294967295,h=h+y&4294967295}return Sha1.toHexStr(a)+Sha1.toHexStr(f)+Sha1.toHexStr(l)+Sha1.toHexStr(c)+Sha1.toHexStr(h)},Sha1.f=function(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}},Sha1.ROTL=function(e,t){return e<<t|e>>>32-t},Sha1.toHexStr=function(e){var t="",n;for(var r=7;r>=0;r--)n=e>>>r*4&15,t+=n.toString(16);return t};var Utf8={};Utf8.encode=function(e){var t=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|t&63)});return t=t.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|t&63)}),t},Utf8.decode=function(e){var t=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&15)<<12|(e.charCodeAt(1)&63)<<6|e.charCodeAt(2)&63;return String.fromCharCode(t)});return t=t.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(t)}),t};var CWTween={ato:[],bu:!1,bpt:0,pause:function(e){if(e)this.bpt==0&&(this.bpt=Date.now());else if(this.bpt!=0){var t=Date.now()-this.bpt;for(var n in this.ato)this.ato[n]._startTime+=t;this.bpt=0,this.bu||requestAnimFrame(this.uf.bind(this))}},removeAll:function(){for(var e in this.ato)this.ato.splice(e,1)},remove:function(e){for(var t in this.ato)if(this.ato[t]._targetObj==e){this.ato.splice(t,1);return}},to:function(e,t,n,r){this.remove(e);var i={};i._targetObj=e,i._duration=t*1e3,i._startTime=Date.now(),i._Data={};for(var s in n){if(n[s]===null)continue;i._Data[s]=[e[s],n[s]]}r&&(r.hasOwnProperty("onComplete")&&(i._cbk=r.onComplete),r.hasOwnProperty("ease")&&(i._ef=CWTween.Easing[r.ease.name][r.ease.hasOwnProperty("type")?r.ease.type:"In"],i._ep=this.PEV(r.ease)),r.hasOwnProperty("delay")&&(i._delay=r.delay*1e3),r.hasOwnProperty("reverse")&&(i._rvr=r.reverse)),!this.bu&&this.bpt===0&&(requestAnimFrame(this.uf.bind(this)),this.bu=!0),this.ato.push(i)},uf:function(){if(this.ato.length>0&&this.bpt==0){requestAnimFrame(this.uf.bind(this)),this.time=Date.now();var e,t,n,r;for(var i in this.ato){t=this.ato[i];if(t._targetObj.MarkedForRemoval()==1)this.ato.splice(i,1);else if(t.hasOwnProperty("_delay"))e=(this.time-t._startTime)/t._delay,e>1&&(delete t._delay,t._startTime=Date.now());else{e=(this.time-t._startTime)/t._duration,e>1?r=e=1:t.hasOwnProperty("_ef")?r=t._ef(e,t._ep):r=e;for(var s in t._Data)t._targetObj[s]=Math.round((t._Data[s][0]+(t._Data[s][1]-t._Data[s][0])*r)*100)/100;if(e==1)if(t.hasOwnProperty("_rvr")){var o;for(var s in t._Data)o=t._Data[s][0],t._Data[s][0]=t._Data[s][1],t._Data[s][1]=o;t._startTime=Date.now(),t._rvr--,t._rvr==0&&delete t._rvr}else this.ato.splice(i,1),t.hasOwnProperty("_cbk")&&t._cbk()}}}else this.bu=!1},PEV:function(e){var t;switch(e.name){case"Back":t=e.hasOwnProperty("params")?e.params:1.70158;break;case"Elastic":t=e.hasOwnProperty("params")?e.params:1;break;default:t=0}return t}};CWTween.Easing={Back:{In:function(e,t){return e*e*((t+1)*e-t)},Out:function(e,t){return(e-=1)*e*((t+1)*e+t)+1},InOut:function(e,t){var n=t*1.525;return(e*=2)<1?.5*e*e*((n+1)*e-n):.5*((e-=2)*e*((n+1)*e+n)+2)}},Bounce:{In:function(e){return 1-CWTween.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?CWTween.Easing.Bounce.In(e*2)*.5:CWTween.Easing.Bounce.Out(e*2-1)*.5+.5}},Elastic:{In:function(e,t){return-(t*Math.pow(2,10*(e-=1))*Math.sin((e-.3/(2*Math.PI)*(Math.asin(1/t)||0))*2*Math.PI/.3))},Out:function(e,t){return t*Math.pow(2,-10*e)*Math.sin((e-.3/(2*Math.PI)*(Math.asin(1/t)||0))*2*Math.PI/.3)+1},InOut:function(e,t){var n=.3/(2*Math.PI)*(Math.asin(1/t)||0),r=2*Math.PI;return(e*=2)<1?-0.5*t*Math.pow(2,10*(e-=1))*Math.sin((e-n)*r/.45):t*Math.pow(2,-10*(e-=1))*Math.sin((e-n)*r/.45)*.5+1}},Exponential:{In:function(e){return Math.pow(2,10*(e-1))-.001},Out:function(e){return 1-Math.pow(2,-10*e)},InOut:function(e){return(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}};var Box2D={};(function(e,t){function n(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(e,t,n){n.get instanceof Function&&e.__defineGetter__(t,n.get),n.set instanceof Function&&e.__defineSetter__(t,n.set)}),e.inherit=function(e,t){n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},e.generateCallback=function(e,t){return function(){t.apply(e,arguments)}},e.NVector=function(e){e===t&&(e=0);for(var n=Array(e||0),r=0;r<e;++r)n[r]=0;return n},e.is=function(e,n){return e===null?!1:n instanceof Function&&e instanceof n?!0:e.constructor.__implements!=t&&e.constructor.__implements[n]?!0:!1},e.parseUInt=function(e){return Math.abs(parseInt(e))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;typeof Box2D=="undefined"&&(Box2D={}),typeof Box2D.Collision=="undefined"&&(Box2D.Collision={}),typeof Box2D.Collision.Shapes=="undefined"&&(Box2D.Collision.Shapes={}),typeof Box2D.Common=="undefined"&&(Box2D.Common={}),typeof Box2D.Common.Math=="undefined"&&(Box2D.Common.Math={}),typeof Box2D.Dynamics=="undefined"&&(Box2D.Dynamics={}),typeof Box2D.Dynamics.Contacts=="undefined"&&(Box2D.Dynamics.Contacts={}),typeof Box2D.Dynamics.Controllers=="undefined"&&(Box2D.Dynamics.Controllers={}),typeof Box2D.Dynamics.Joints=="undefined"&&(Box2D.Dynamics.Joints={}),function(){function e(){e.b2AABB.apply(this,arguments)}function t(){t.b2Bound.apply(this,arguments)}function n(){n.b2BoundValues.apply(this,arguments),this.constructor===n&&this.b2BoundValues.apply(this,arguments)}function r(){r.b2Collision.apply(this,arguments)}function i(){i.b2ContactID.apply(this,arguments),this.constructor===i&&this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function o(){o.b2Distance.apply(this,arguments)}function u(){u.b2DistanceInput.apply(this,arguments)}function a(){a.b2DistanceOutput.apply(this,arguments)}function f(){f.b2DistanceProxy.apply(this,arguments)}function l(){l.b2DynamicTree.apply(this,arguments),this.constructor===l&&this.b2DynamicTree.apply(this,arguments)}function c(){c.b2DynamicTreeBroadPhase.apply(this,arguments)}function h(){h.b2DynamicTreeNode.apply(this,arguments)}function p(){p.b2DynamicTreePair.apply(this,arguments)}function d(){d.b2Manifold.apply(this,arguments),this.constructor===d&&this.b2Manifold.apply(this,arguments)}function v(){v.b2ManifoldPoint.apply(this,arguments),this.constructor===v&&this.b2ManifoldPoint.apply(this,arguments)}function m(){m.b2Point.apply(this,arguments)}function g(){g.b2RayCastInput.apply(this,arguments),this.constructor===g&&this.b2RayCastInput.apply(this,arguments)}function y(){y.b2RayCastOutput.apply(this,arguments)}function b(){b.b2Segment.apply(this,arguments)}function w(){w.b2SeparationFunction.apply(this,arguments)}function E(){E.b2Simplex.apply(this,arguments),this.constructor===E&&this.b2Simplex.apply(this,arguments)}function S(){S.b2SimplexCache.apply(this,arguments)}function x(){x.b2SimplexVertex.apply(this,arguments)}function T(){T.b2TimeOfImpact.apply(this,arguments)}function N(){N.b2TOIInput.apply(this,arguments)}function C(){C.b2WorldManifold.apply(this,arguments),this.constructor===C&&this.b2WorldManifold.apply(this,arguments)}function k(){k.ClipVertex.apply(this,arguments)}function L(){L.Features.apply(this,arguments)}function A(){A.b2CircleShape.apply(this,arguments),this.constructor===A&&this.b2CircleShape.apply(this,arguments)}function O(){O.b2EdgeChainDef.apply(this,arguments),this.constructor===O&&this.b2EdgeChainDef.apply(this,arguments)}function M(){M.b2EdgeShape.apply(this,arguments),this.constructor===M&&this.b2EdgeShape.apply(this,arguments)}function _(){_.b2MassData.apply(this,arguments)}function D(){D.b2PolygonShape.apply(this,arguments),this.constructor===D&&this.b2PolygonShape.apply(this,arguments)}function P(){P.b2Shape.apply(this,arguments),this.constructor===P&&this.b2Shape.apply(this,arguments)}function H(){H.b2Color.apply(this,arguments),this.constructor===H&&this.b2Color.apply(this,arguments)}function B(){B.b2Settings.apply(this,arguments)}function j(){j.b2Mat22.apply(this,arguments),this.constructor===j&&this.b2Mat22.apply(this,arguments)}function F(){F.b2Mat33.apply(this,arguments),this.constructor===F&&this.b2Mat33.apply(this,arguments)}function I(){I.b2Math.apply(this,arguments)}function q(){q.b2Sweep.apply(this,arguments)}function R(){R.b2Transform.apply(this,arguments),this.constructor===R&&this.b2Transform.apply(this,arguments)}function U(){U.b2Vec2.apply(this,arguments),this.constructor===U&&this.b2Vec2.apply(this,arguments)}function z(){z.b2Vec3.apply(this,arguments),this.constructor===z&&this.b2Vec3.apply(this,arguments)}function W(){W.b2Body.apply(this,arguments),this.constructor===W&&this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments),this.constructor===X&&this.b2BodyDef.apply(this,arguments)}function V(){V.b2ContactFilter.apply(this,arguments)}function $(){$.b2ContactImpulse.apply(this,arguments)}function J(){J.b2ContactListener.apply(this,arguments)}function K(){K.b2ContactManager.apply(this,arguments),this.constructor===K&&this.b2ContactManager.apply(this,arguments)}function Q(){Q.b2DebugDraw.apply(this,arguments),this.constructor===Q&&this.b2DebugDraw.apply(this,arguments)}function G(){G.b2DestructionListener.apply(this,arguments)}function Y(){Y.b2FilterData.apply(this,arguments)}function Z(){Z.b2Fixture.apply(this,arguments),this.constructor===Z&&this.b2Fixture.apply(this,arguments)}function et(){et.b2FixtureDef.apply(this,arguments),this.constructor===et&&this.b2FixtureDef.apply(this,arguments)}function tt(){tt.b2Island.apply(this,arguments),this.constructor===tt&&this.b2Island.apply(this,arguments)}function nt(){nt.b2TimeStep.apply(this,arguments)}function rt(){rt.b2World.apply(this,arguments),this.constructor===rt&&this.b2World.apply(this,arguments)}function it(){it.b2CircleContact.apply(this,arguments)}function st(){st.b2Contact.apply(this,arguments),this.constructor===st&&this.b2Contact.apply(this,arguments)}function ot(){ot.b2ContactConstraint.apply(this,arguments),this.constructor===ot&&this.b2ContactConstraint.apply(this,arguments)}function ut(){ut.b2ContactConstraintPoint.apply(this,arguments)}function at(){at.b2ContactEdge.apply(this,arguments)}function ft(){ft.b2ContactFactory.apply(this,arguments),this.constructor===ft&&this.b2ContactFactory.apply(this,arguments)}function lt(){lt.b2ContactRegister.apply(this,arguments)}function ct(){ct.b2ContactResult.apply(this,arguments)}function ht(){ht.b2ContactSolver.apply(this,arguments),this.constructor===ht&&this.b2ContactSolver.apply(this,arguments)}function pt(){pt.b2EdgeAndCircleContact.apply(this,arguments)}function dt(){dt.b2NullContact.apply(this,arguments),this.constructor===dt&&this.b2NullContact.apply(this,arguments)}function vt(){vt.b2PolyAndCircleContact.apply(this,arguments)}function mt(){mt.b2PolyAndEdgeContact.apply(this,arguments)}function gt(){gt.b2PolygonContact.apply(this,arguments)}function yt(){yt.b2PositionSolverManifold.apply(this,arguments),this.constructor===yt&&this.b2PositionSolverManifold.apply(this,arguments)}function bt(){bt.b2BuoyancyController.apply(this,arguments)}function wt(){wt.b2ConstantAccelController.apply(this,arguments)}function Et(){Et.b2ConstantForceController.apply(this,arguments)}function St(){St.b2Controller.apply(this,arguments)}function xt(){xt.b2ControllerEdge.apply(this,arguments)}function Tt(){Tt.b2GravityController.apply(this,arguments)}function Nt(){Nt.b2TensorDampingController.apply(this,arguments)}function Ct(){Ct.b2DistanceJoint.apply(this,arguments),this.constructor===Ct&&this.b2DistanceJoint.apply(this,arguments)}function kt(){kt.b2DistanceJointDef.apply(this,arguments),this.constructor===kt&&this.b2DistanceJointDef.apply(this,arguments)}function Lt(){Lt.b2FrictionJoint.apply(this,arguments),this.constructor===Lt&&this.b2FrictionJoint.apply(this,arguments)}function At(){At.b2FrictionJointDef.apply(this,arguments),this.constructor===At&&this.b2FrictionJointDef.apply(this,arguments)}function Ot(){Ot.b2GearJoint.apply(this,arguments),this.constructor===Ot&&this.b2GearJoint.apply(this,arguments)}function Mt(){Mt.b2GearJointDef.apply(this,arguments),this.constructor===Mt&&this.b2GearJointDef.apply(this,arguments)}function _t(){_t.b2Jacobian.apply(this,arguments)}function Dt(){Dt.b2Joint.apply(this,arguments),this.constructor===Dt&&this.b2Joint.apply(this,arguments)}function Pt(){Pt.b2JointDef.apply(this,arguments),this.constructor===Pt&&this.b2JointDef.apply(this,arguments)}function Ht(){Ht.b2JointEdge.apply(this,arguments)}function Bt(){Bt.b2LineJoint.apply(this,arguments),this.constructor===Bt&&this.b2LineJoint.apply(this,arguments)}function jt(){jt.b2LineJointDef.apply(this,arguments),this.constructor===jt&&this.b2LineJointDef.apply(this,arguments)}function Ft(){Ft.b2MouseJoint.apply(this,arguments),this.constructor===Ft&&this.b2MouseJoint.apply(this,arguments)}function It(){It.b2MouseJointDef.apply(this,arguments),this.constructor===It&&this.b2MouseJointDef.apply(this,arguments)}function qt(){qt.b2PrismaticJoint.apply(this,arguments),this.constructor===qt&&this.b2PrismaticJoint.apply(this,arguments)}function Rt(){Rt.b2PrismaticJointDef.apply(this,arguments),this.constructor===Rt&&this.b2PrismaticJointDef.apply(this,arguments)}function Ut(){Ut.b2PulleyJoint.apply(this,arguments),this.constructor===Ut&&this.b2PulleyJoint.apply(this,arguments)}function zt(){zt.b2PulleyJointDef.apply(this,arguments),this.constructor===zt&&this.b2PulleyJointDef.apply(this,arguments)}function Wt(){Wt.b2RevoluteJoint.apply(this,arguments),this.constructor===Wt&&this.b2RevoluteJoint.apply(this,arguments)}function Xt(){Xt.b2RevoluteJointDef.apply(this,arguments),this.constructor===Xt&&this.b2RevoluteJointDef.apply(this,arguments)}function Vt(){Vt.b2WeldJoint.apply(this,arguments),this.constructor===Vt&&this.b2WeldJoint.apply(this,arguments)}function $t(){$t.b2WeldJointDef.apply(this,arguments),this.constructor===$t&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=e,Box2D.Collision.b2Bound=t,Box2D.Collision.b2BoundValues=n,Box2D.Collision.b2Collision=r,Box2D.Collision.b2ContactID=i,Box2D.Collision.b2ContactPoint=s,Box2D.Collision.b2Distance=o,Box2D.Collision.b2DistanceInput=u,Box2D.Collision.b2DistanceOutput=a,Box2D.Collision.b2DistanceProxy=f,Box2D.Collision.b2DynamicTree=l,Box2D.Collision.b2DynamicTreeBroadPhase=c,Box2D.Collision.b2DynamicTreeNode=h,Box2D.Collision.b2DynamicTreePair=p,Box2D.Collision.b2Manifold=d,Box2D.Collision.b2ManifoldPoint=v,Box2D.Collision.b2Point=m,Box2D.Collision.b2RayCastInput=g,Box2D.Collision.b2RayCastOutput=y,Box2D.Collision.b2Segment=b,Box2D.Collision.b2SeparationFunction=w,Box2D.Collision.b2Simplex=E,Box2D.Collision.b2SimplexCache=S,Box2D.Collision.b2SimplexVertex=x,Box2D.Collision.b2TimeOfImpact=T,Box2D.Collision.b2TOIInput=N,Box2D.Collision.b2WorldManifold=C,Box2D.Collision.ClipVertex=k,Box2D.Collision.Features=L,Box2D.Collision.Shapes.b2CircleShape=A,Box2D.Collision.Shapes.b2EdgeChainDef=O,Box2D.Collision.Shapes.b2EdgeShape=M,Box2D.Collision.Shapes.b2MassData=_,Box2D.Collision.Shapes.b2PolygonShape=D,Box2D.Collision.Shapes.b2Shape=P,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=H,Box2D.Common.b2Settings=B,Box2D.Common.Math.b2Mat22=j,Box2D.Common.Math.b2Mat33=F,Box2D.Common.Math.b2Math=I,Box2D.Common.Math.b2Sweep=q,Box2D.Common.Math.b2Transform=R,Box2D.Common.Math.b2Vec2=U,Box2D.Common.Math.b2Vec3=z,Box2D.Dynamics.b2Body=W,Box2D.Dynamics.b2BodyDef=X,Box2D.Dynamics.b2ContactFilter=V,Box2D.Dynamics.b2ContactImpulse=$,Box2D.Dynamics.b2ContactListener=J,Box2D.Dynamics.b2ContactManager=K,Box2D.Dynamics.b2DebugDraw=Q,Box2D.Dynamics.b2DestructionListener=G,Box2D.Dynamics.b2FilterData=Y,Box2D.Dynamics.b2Fixture=Z,Box2D.Dynamics.b2FixtureDef=et,Box2D.Dynamics.b2Island=tt,Box2D.Dynamics.b2TimeStep=nt,Box2D.Dynamics.b2World=rt,Box2D.Dynamics.Contacts.b2CircleContact=it,Box2D.Dynamics.Contacts.b2Contact=st,Box2D.Dynamics.Contacts.b2ContactConstraint=ot,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ut,Box2D.Dynamics.Contacts.b2ContactEdge=at,Box2D.Dynamics.Contacts.b2ContactFactory=ft,Box2D.Dynamics.Contacts.b2ContactRegister=lt,Box2D.Dynamics.Contacts.b2ContactResult=ct,Box2D.Dynamics.Contacts.b2ContactSolver=ht,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=pt,Box2D.Dynamics.Contacts.b2NullContact=dt,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=vt,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=mt,Box2D.Dynamics.Contacts.b2PolygonContact=gt,Box2D.Dynamics.Contacts.b2PositionSolverManifold=yt,Box2D.Dynamics.Controllers.b2BuoyancyController=bt,Box2D.Dynamics.Controllers.b2ConstantAccelController=wt,Box2D.Dynamics.Controllers.b2ConstantForceController=Et,Box2D.Dynamics.Controllers.b2Controller=St,Box2D.Dynamics.Controllers.b2ControllerEdge=xt,Box2D.Dynamics.Controllers.b2GravityController=Tt,Box2D.Dynamics.Controllers.b2TensorDampingController=Nt,Box2D.Dynamics.Joints.b2DistanceJoint=Ct,Box2D.Dynamics.Joints.b2DistanceJointDef=kt,Box2D.Dynamics.Joints.b2FrictionJoint=Lt,Box2D.Dynamics.Joints.b2FrictionJointDef=At,Box2D.Dynamics.Joints.b2GearJoint=Ot,Box2D.Dynamics.Joints.b2GearJointDef=Mt,Box2D.Dynamics.Joints.b2Jacobian=_t,Box2D.Dynamics.Joints.b2Joint=Dt,Box2D.Dynamics.Joints.b2JointDef=Pt,Box2D.Dynamics.Joints.b2JointEdge=Ht,Box2D.Dynamics.Joints.b2LineJoint=Bt,Box2D.Dynamics.Joints.b2LineJointDef=jt,Box2D.Dynamics.Joints.b2MouseJoint=Ft,Box2D.Dynamics.Joints.b2MouseJointDef=It,Box2D.Dynamics.Joints.b2PrismaticJoint=qt,Box2D.Dynamics.Joints.b2PrismaticJointDef=Rt,Box2D.Dynamics.Joints.b2PulleyJoint=Ut,Box2D.Dynamics.Joints.b2PulleyJointDef=zt,Box2D.Dynamics.Joints.b2RevoluteJoint=Wt,Box2D.Dynamics.Joints.b2RevoluteJointDef=Xt,Box2D.Dynamics.Joints.b2WeldJoint=Vt,Box2D.Dynamics.Joints.b2WeldJointDef=$t}(),Box2D.postDefs=[],function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,r=Box2D.Common.b2Settings,i=Box2D.Common.Math.b2Math,s=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,u=Box2D.Common.Math.b2Vec2,a=Box2D.Collision.b2AABB,f=Box2D.Collision.b2Bound,l=Box2D.Collision.b2BoundValues,c=Box2D.Collision.b2Collision,h=Box2D.Collision.b2ContactID,p=Box2D.Collision.b2ContactPoint,d=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,m=Box2D.Collision.b2DistanceOutput,g=Box2D.Collision.b2DistanceProxy,y=Box2D.Collision.b2DynamicTree,b=Box2D.Collision.b2DynamicTreeBroadPhase,w=Box2D.Collision.b2DynamicTreeNode,E=Box2D.Collision.b2DynamicTreePair,S=Box2D.Collision.b2Manifold,x=Box2D.Collision.b2ManifoldPoint,T=Box2D.Collision.b2Point,N=Box2D.Collision.b2RayCastInput,C=Box2D.Collision.b2RayCastOutput,k=Box2D.Collision.b2Segment,L=Box2D.Collision.b2SeparationFunction,A=Box2D.Collision.b2Simplex,O=Box2D.Collision.b2SimplexCache,M=Box2D.Collision.b2SimplexVertex,_=Box2D.Collision.b2TimeOfImpact,D=Box2D.Collision.b2TOIInput,P=Box2D.Collision.b2WorldManifold,H=Box2D.Collision.ClipVertex,B=Box2D.Collision.Features,j=Box2D.Collision.IBroadPhase;a.b2AABB=function(){this.lowerBound=new u,this.upperBound=new u},a.prototype.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return e=(e=this.upperBound.x-this.lowerBound.x>=0&&e>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},a.prototype.GetCenter=function(){return new u((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},a.prototype.GetExtents=function(){return new u((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},a.prototype.Contains=function(e){var t=!0;return t=(t=(t=(t=t&&this.lowerBound.x<=e.lowerBound.x)&&this.lowerBound.y<=e.lowerBound.y)&&e.upperBound.x<=this.upperBound.x)&&e.upperBound.y<=this.upperBound.y},a.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(u),f=e.normal,l=0,c=0,h=l=0;h=0;if(Math.abs(o)<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{l=1/o,c=(this.lowerBound.x-i)*l,l=(this.upperBound.x-i)*l,h=-1,c>l&&(h=c,c=l,l=h,h=1),c>n&&(f.x=h,f.y=0,n=c),r=Math.min(r,l);if(n>r)return!1}if(a<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{l=1/u,c=(this.lowerBound.y-s)*l,l=(this.upperBound.y-s)*l,h=-1,c>l&&(h=c,c=l,l=h,h=1),c>n&&(f.y=h,f.x=0,n=c),r=Math.min(r,l);if(n>r)return!1}return e.fraction=n,!0},a.prototype.TestOverlap=function(e){var t=e.lowerBound.y-this.upperBound.y,n=this.lowerBound.y-e.upperBound.y;return e.lowerBound.x-this.upperBound.x>0||t>0?!1:this.lowerBound.x-e.upperBound.x>0||n>0?!1:!0},a.Combine=function(e,t){var n=new a;return n.Combine(e,t),n},a.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},f.b2Bound=function(){},f.prototype.IsLower=function(){return(this.value&1)==0},f.prototype.IsUpper=function(){return(this.value&1)==1},f.prototype.Swap=function(e){var t=this.value,n=this.proxy,r=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=n,e.stabbingCount=r},l.b2BoundValues=function(){},l.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},c.b2Collision=function(){},c.ClipSegmentToLine=function(e,t,n,r){r===undefined&&(r=0);var i,s=0;i=t[0];var o=i.v;i=t[1];var u=i.v,a=n.x*o.x+n.y*o.y-r;return i=n.x*u.x+n.y*u.y-r,a<=0&&e[s++].Set(t[0]),i<=0&&e[s++].Set(t[1]),a*i<0&&(n=a/(a-i),i=e[s],i=i.v,i.x=o.x+n*(u.x-o.x),i.y=o.y+n*(u.y-o.y),i=e[s],i.id=(a>0?t[0]:t[1]).id,++s),s},c.EdgeSeparation=function(e,t,n,r,i){n===undefined&&(n=0),parseInt(e.m_vertexCount);var s=e.m_vertices;e=e.m_normals;var o=parseInt(r.m_vertexCount),u=r.m_vertices,a,f;a=t.R,f=e[n],e=a.col1.x*f.x+a.col2.x*f.y,r=a.col1.y*f.x+a.col2.y*f.y,a=i.R;var l=a.col1.x*e+a.col1.y*r;a=a.col2.x*e+a.col2.y*r;for(var c=0,h=Number.MAX_VALUE,p=0;p<o;++p)f=u[p],f=f.x*l+f.y*a,f<h&&(h=f,c=p);return f=s[n],a=t.R,n=t.position.x+(a.col1.x*f.x+a.col2.x*f.y),t=t.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=u[c],a=i.R,s=i.position.x+(a.col1.x*f.x+a.col2.x*f.y),i=i.position.y+(a.col1.y*f.x+a.col2.y*f.y),s-=n,i-=t,s*e+i*r},c.FindMaxSeparation=function(e,t,n,r,i){var s=parseInt(t.m_vertexCount),o=t.m_normals,u,a;a=i.R,u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y),l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R,u=t.m_centroid,f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y),l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y),a=f*n.R.col1.x+l*n.R.col1.y,l=f*n.R.col2.x+l*n.R.col2.y,f=0;for(var h=-Number.MAX_VALUE,p=0;p<s;++p)u=o[p],u=u.x*a+u.y*l,u>h&&(h=u,f=p);o=c.EdgeSeparation(t,n,f,r,i),u=parseInt(f-1>=0?f-1:s-1),a=c.EdgeSeparation(t,n,u,r,i),l=parseInt(f+1<s?f+1:0),h=c.EdgeSeparation(t,n,l,r,i);var d=p=0,v=0;if(a>o&&a>h)v=-1,p=u,d=a;else{if(!(h>o))return e[0]=f,o;v=1,p=l,d=h}for(;;){f=v==-1?p-1>=0?p-1:s-1:p+1<s?p+1:0,o=c.EdgeSeparation(t,n,f,r,i);if(!(o>d))break;p=f,d=o}return e[0]=p,d},c.FindIncidentEdge=function(e,t,n,r,i,s){r===undefined&&(r=0),parseInt(t.m_vertexCount);var o=t.m_normals,u=parseInt(i.m_vertexCount);t=i.m_vertices,i=i.m_normals;var a;a=n.R,n=o[r],o=a.col1.x*n.x+a.col2.x*n.y;var f=a.col1.y*n.x+a.col2.y*n.y;a=s.R,n=a.col1.x*o+a.col1.y*f,f=a.col2.x*o+a.col2.y*f,o=n,a=0;for(var l=Number.MAX_VALUE,c=0;c<u;++c)n=i[c],n=o*n.x+f*n.y,n<l&&(l=n,a=c);i=parseInt(a),o=parseInt(i+1<u?i+1:0),u=e[0],n=t[i],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=i,u.id.features.incidentVertex=0,u=e[1],n=t[o],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=o,u.id.features.incidentVertex=1},c.MakeClipPointVector=function(){var e=new Vector(2);return e[0]=new H,e[1]=new H,e},c.CollidePolygons=function(e,t,n,i,s){var o;e.m_pointCount=0;var u=t.m_radius+i.m_radius;o=0,c.s_edgeAO[0]=o;var a=c.FindMaxSeparation(c.s_edgeAO,t,n,i,s);o=c.s_edgeAO[0];if(!(a>u)){var f=0;c.s_edgeBO[0]=f;var l=c.FindMaxSeparation(c.s_edgeBO,i,s,t,n);f=c.s_edgeBO[0];if(!(l>u)){var h=0,p=0;l>.98*a+.001?(a=i,i=t,t=s,n=n,h=f,e.m_type=S.e_faceB,p=1):(a=t,i=i,t=n,n=s,h=o,e.m_type=S.e_faceA,p=0),o=c.s_incidentEdge,c.FindIncidentEdge(o,a,t,h,i,n),f=parseInt(a.m_vertexCount),s=a.m_vertices,a=s[h];var d;d=h+1<f?s[parseInt(h+1)]:s[0],h=c.s_localTangent,h.Set(d.x-a.x,d.y-a.y),h.Normalize(),s=c.s_localNormal,s.x=h.y,s.y=-h.x,i=c.s_planePoint,i.Set(.5*(a.x+d.x),.5*(a.y+d.y)),l=c.s_tangent,f=t.R,l.x=f.col1.x*h.x+f.col2.x*h.y,l.y=f.col1.y*h.x+f.col2.y*h.y;var v=c.s_tangent2;v.x=-l.x,v.y=-l.y,h=c.s_normal,h.x=l.y,h.y=-l.x;var m=c.s_v11,g=c.s_v12;m.x=t.position.x+(f.col1.x*a.x+f.col2.x*a.y),m.y=t.position.y+(f.col1.y*a.x+f.col2.y*a.y),g.x=t.position.x+(f.col1.x*d.x+f.col2.x*d.y),g.y=t.position.y+(f.col1.y*d.x+f.col2.y*d.y),t=h.x*m.x+h.y*m.y,f=l.x*g.x+l.y*g.y+u,d=c.s_clipPoints1,a=c.s_clipPoints2,g=0,g=c.ClipSegmentToLine(d,o,v,-l.x*m.x-l.y*m.y+u);if(!(g<2)){g=c.ClipSegmentToLine(a,d,l,f);if(!(g<2)){e.m_localPlaneNormal.SetV(s),e.m_localPoint.SetV(i);for(i=s=0;i<r.b2_maxManifoldPoints;++i)o=a[i],h.x*o.v.x+h.y*o.v.y-t<=u&&(l=e.m_points[s],f=n.R,v=o.v.x-n.position.x,m=o.v.y-n.position.y,l.m_localPoint.x=v*f.col1.x+m*f.col1.y,l.m_localPoint.y=v*f.col2.x+m*f.col2.y,l.m_id.Set(o.id),l.m_id.features.flip=p,++s);e.m_pointCount=s}}}}},c.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s,o;s=n.R,o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y);n=n.position.y+(s.col1.y*o.x+s.col2.y*o.y),s=i.R,o=r.m_p,u=i.position.x+(s.col1.x*o.x+s.col2.x*o.y)-u,i=i.position.y+(s.col1.y*o.x+s.col2.y*o.y)-n,s=t.m_radius+r.m_radius,u*u+i*i>s*s||(e.m_type=S.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0)},c.CollidePolygonAndCircle=function(e,t,n,r,i){var s=e.m_pointCount=0,o=0,u,a;a=i.R,u=r.m_p;var f=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);s=i.position.x+(a.col1.x*u.x+a.col2.x*u.y)-n.position.x,o=f-n.position.y,a=n.R,n=s*a.col1.x+o*a.col1.y,a=s*a.col2.x+o*a.col2.y;var l=0;f=-Number.MAX_VALUE,i=t.m_radius+r.m_radius;var c=parseInt(t.m_vertexCount),h=t.m_vertices;t=t.m_normals;for(var p=0;p<c;++p){u=h[p],s=n-u.x,o=a-u.y,u=t[p],s=u.x*s+u.y*o;if(s>i)return;s>f&&(f=s,l=p)}s=parseInt(l),o=parseInt(s+1<c?s+1:0),u=h[s],h=h[o];if(f<Number.MIN_VALUE)e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.SetV(t[l]),e.m_localPoint.x=.5*(u.x+h.x),e.m_localPoint.y=.5*(u.y+h.y);else{f=(n-h.x)*(u.x-h.x)+(a-h.y)*(u.y-h.y);if((n-u.x)*(h.x-u.x)+(a-u.y)*(h.y-u.y)<=0){if((n-u.x)*(n-u.x)+(a-u.y)*(a-u.y)>i*i)return;e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.x=n-u.x,e.m_localPlaneNormal.y=a-u.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(u)}else if(f<=0){if((n-h.x)*(n-h.x)+(a-h.y)*(a-h.y)>i*i)return;e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.x=n-h.x,e.m_localPlaneNormal.y=a-h.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(h)}else{l=.5*(u.x+h.x),u=.5*(u.y+h.y),f=(n-l)*t[s].x+(a-u)*t[s].y;if(f>i)return;e.m_pointCount=1,e.m_type=S.e_faceA,e.m_localPlaneNormal.x=t[s].x,e.m_localPlaneNormal.y=t[s].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(l,u)}}e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0},c.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.y-r.y;return i>0||s>0?!1:n.x-r.x>0||o>0?!1:!0},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=c.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=c.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=c.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new u,Box2D.Collision.b2Collision.s_localNormal=new u,Box2D.Collision.b2Collision.s_planePoint=new u,Box2D.Collision.b2Collision.s_normal=new u,Box2D.Collision.b2Collision.s_tangent=new u,Box2D.Collision.b2Collision.s_tangent2=new u,Box2D.Collision.b2Collision.s_v11=new u,Box2D.Collision.b2Collision.s_v12=new u,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new u,Box2D.Collision.b2Collision.b2_nullFeature=255}),h.b2ContactID=function(){this.features=new B},h.prototype.b2ContactID=function(){this.features._m_id=this},h.prototype.Set=function(e){this.key=e._key},h.prototype.Copy=function(){var e=new h;return e.key=this.key,e},Object.defineProperty(h.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(h.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),p.b2ContactPoint=function(){this.position=new u,this.velocity=new u,this.normal=new u,this.id=new h},d.b2Distance=function(){},d.Distance=function(e,t,n){++d.b2_gjkCalls;var s=n.proxyA,o=n.proxyB,a=n.transformA,f=n.transformB,l=d.s_simplex;l.ReadCache(t,s,a,o,f);var c=l.m_vertices,h=d.s_saveA,p=d.s_saveB,v=0;l.GetClosestPoint().LengthSquared();for(var m=0,g,y=0;y<20;){v=l.m_count;for(m=0;m<v;m++)h[m]=c[m].indexA,p[m]=c[m].indexB;switch(l.m_count){case 1:break;case 2:l.Solve2();break;case 3:l.Solve3();break;default:r.b2Assert(!1)}if(l.m_count==3)break;g=l.GetClosestPoint(),g.LengthSquared(),m=l.GetSearchDirection();if(m.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;g=c[l.m_count],g.indexA=s.GetSupport(i.MulTMV(a.R,m.GetNegative())),g.wA=i.MulX(a,s.GetVertex(g.indexA)),g.indexB=o.GetSupport(i.MulTMV(f.R,m)),g.wB=i.MulX(f,o.GetVertex(g.indexB)),g.w=i.SubtractVV(g.wB,g.wA),++y,++d.b2_gjkIters;var b=!1;for(m=0;m<v;m++)if(g.indexA==h[m]&&g.indexB==p[m]){b=!0;break}if(b)break;++l.m_count}d.b2_gjkMaxIters=i.Max(d.b2_gjkMaxIters,y),l.GetWitnessPoints(e.pointA,e.pointB),e.distance=i.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=y,l.WriteCache(t),n.useRadii&&(t=s.m_radius,o=o.m_radius,e.distance>t+o&&e.distance>Number.MIN_VALUE?(e.distance-=t+o,n=i.SubtractVV(e.pointB,e.pointA),n.Normalize(),e.pointA.x+=t*n.x,e.pointA.y+=t*n.y,e.pointB.x-=o*n.x,e.pointB.y-=o*n.y):(g=new u,g.x=.5*(e.pointA.x+e.pointB.x),g.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=g.x,e.pointA.y=e.pointB.y=g.y,e.distance=0))},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new A,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),v.b2DistanceInput=function(){},m.b2DistanceOutput=function(){this.pointA=new u,this.pointB=new u},g.b2DistanceProxy=function(){},g.prototype.Set=function(i){switch(i.GetType()){case n.e_circleShape:i=i instanceof e?i:null,this.m_vertices=new Vector(1,!0),this.m_vertices[0]=i.m_p,this.m_count=1,this.m_radius=i.m_radius;break;case n.e_polygonShape:i=i instanceof t?i:null,this.m_vertices=i.m_vertices,this.m_count=i.m_vertexCount,this.m_radius=i.m_radius;break;default:r.b2Assert(!1)}},g.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},g.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},g.prototype.GetVertexCount=function(){return this.m_count},g.prototype.GetVertex=function(e){return e===undefined&&(e=0),r.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},y.b2DynamicTree=function(){},y.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},y.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),i=r.b2_aabbExtension,s=r.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-i,n.aabb.lowerBound.y=e.lowerBound.y-s,n.aabb.upperBound.x=e.upperBound.x+i,n.aabb.upperBound.y=e.upperBound.y+s,n.userData=t,this.InsertLeaf(n),n},y.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},y.prototype.MoveProxy=function(e,t,n){r.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var i=r.b2_aabbExtension+r.b2_aabbMultiplier*(n.x>0?n.x:-n.x);return n=r.b2_aabbExtension+r.b2_aabbMultiplier*(n.y>0?n.y:-n.y),e.aabb.lowerBound.x=t.lowerBound.x-i,e.aabb.lowerBound.y=t.lowerBound.y-n,e.aabb.upperBound.x=t.upperBound.x+i,e.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(e),!0},y.prototype.Rebalance=function(e){e===undefined&&(e=0);if(this.m_root!=null)for(var t=0;t<e;t++){for(var n=this.m_root,r=0;n.IsLeaf()==0;)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},y.prototype.GetFatAABB=function(e){return e.aabb},y.prototype.GetUserData=function(e){return e.userData},y.prototype.Query=function(e,t){if(this.m_root!=null){var n=new Vector,r=0;for(n[r++]=this.m_root;r>0;){var i=n[--r];if(i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!e(i))break}else n[r++]=i.child1,n[r++]=i.child2}}},y.prototype.RayCast=function(e,t){if(this.m_root!=null){var n=t.p1,r=t.p2,s=i.SubtractVV(n,r);s.Normalize(),s=i.CrossFV(1,s);var o=i.AbsV(s),u=t.maxFraction,f=new a,l=0,c=0;l=n.x+u*(r.x-n.x),c=n.y+u*(r.y-n.y),f.lowerBound.x=Math.min(n.x,l),f.lowerBound.y=Math.min(n.y,c),f.upperBound.x=Math.max(n.x,l),f.upperBound.y=Math.max(n.y,c);var h=new Vector,p=0;for(h[p++]=this.m_root;p>0;){u=h[--p];if(u.aabb.TestOverlap(f)!=0){l=u.aabb.GetCenter(),c=u.aabb.GetExtents();if(!(Math.abs(s.x*(n.x-l.x)+s.y*(n.y-l.y))-o.x*c.x-o.y*c.y>0))if(u.IsLeaf()){l=new N,l.p1=t.p1,l.p2=t.p2,l.maxFraction=t.maxFraction,u=e(l,u);if(u==0)break;u>0&&(l=n.x+u*(r.x-n.x),c=n.y+u*(r.y-n.y),f.lowerBound.x=Math.min(n.x,l),f.lowerBound.y=Math.min(n.y,c),f.upperBound.x=Math.max(n.x,l),f.upperBound.y=Math.max(n.y,c))}else h[p++]=u.child1,h[p++]=u.child2}}}},y.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new w},y.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},y.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null)this.m_root=e,this.m_root.parent=null;else{var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1;n=n.child2,n=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-t.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-t.y)?r:n}while(n.IsLeaf()==0);t=n.parent,r=this.AllocateNode(),r.parent=t,r.userData=null,r.aabb.Combine(e.aabb,n.aabb);if(t){n.parent.child1==n?t.child1=r:t.child2=r,r.child1=n,r.child2=e,n.parent=r,e.parent=r;do{if(t.aabb.Contains(r.aabb))break;t.aabb.Combine(t.child1.aabb,t.child2.aabb),r=t,t=t.parent}while(t)}else r.child1=n,r.child2=e,n.parent=r,this.m_root=e.parent=r}},y.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var t=e.parent,n=t.parent;e=t.child1==e?t.child2:t.child1;if(n){n.child1==t?n.child1=e:n.child2=e,e.parent=n;for(this.FreeNode(t);n;){t=n.aabb,n.aabb=a.Combine(n.child1.aabb,n.child2.aabb);if(t.Contains(n.aabb))break;n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(t)}},b.b2DynamicTreeBroadPhase=function(){this.m_tree=new y,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},b.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},b.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},b.prototype.MoveProxy=function(e,t,n){this.m_tree.MoveProxy(e,t,n)&&this.BufferMove(e)},b.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},b.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},b.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},b.prototype.GetProxyCount=function(){return this.m_proxyCount},b.prototype.UpdatePairs=function(e){var t=this,n=t.m_pairCount=0,r;for(n=0;n<t.m_moveBuffer.length;++n){r=t.m_moveBuffer[n];var i=t.m_tree.GetFatAABB(r);t.m_tree.Query(function(e){if(e==r)return!0;t.m_pairCount==t.m_pairBuffer.length&&(t.m_pairBuffer[t.m_pairCount]=new E);var n=t.m_pairBuffer[t.m_pairCount];return n.proxyA=e<r?e:r,n.proxyB=e>=r?e:r,++t.m_pairCount,!0},i)}for(n=t.m_moveBuffer.length=0;n<t.m_pairCount;){i=t.m_pairBuffer[n];var s=t.m_tree.GetUserData(i.proxyA),o=t.m_tree.GetUserData(i.proxyB);e(s,o);for(++n;n<t.m_pairCount;){s=t.m_pairBuffer[n];if(s.proxyA!=i.proxyA||s.proxyB!=i.proxyB)break;++n}}},b.prototype.Query=function(e,t){this.m_tree.Query(e,t)},b.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},b.prototype.Validate=function(){},b.prototype.Rebalance=function(e){e===undefined&&(e=0),this.m_tree.Rebalance(e)},b.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},b.prototype.UnBufferMove=function(e){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(e)),1)},b.prototype.ComparePairs=function(){return 0},b.__implements={},b.__implements[j]=!0,w.b2DynamicTreeNode=function(){this.aabb=new a},w.prototype.IsLeaf=function(){return this.child1==null},E.b2DynamicTreePair=function(){},S.b2Manifold=function(){this.m_pointCount=0},S.prototype.b2Manifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var e=0;e<r.b2_maxManifoldPoints;e++)this.m_points[e]=new x;this.m_localPlaneNormal=new u,this.m_localPoint=new u},S.prototype.Reset=function(){for(var e=0;e<r.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof x?this.m_points[e]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},S.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<r.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof x?this.m_points[t]:null).Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},S.prototype.Copy=function(){var e=new S;return e.Set(this),e},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),x.b2ManifoldPoint=function(){this.m_localPoint=new u,this.m_id=new h},x.prototype.b2ManifoldPoint=function(){this.Reset()},x.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},x.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},T.b2Point=function(){this.p=new u},T.prototype.Support=function(){return this.p},T.prototype.GetFirstVertex=function(){return this.p},N.b2RayCastInput=function(){this.p1=new u,this.p2=new u},N.prototype.b2RayCastInput=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=1),e&&this.p1.SetV(e),t&&this.p2.SetV(t),this.maxFraction=n},C.b2RayCastOutput=function(){this.normal=new u},k.b2Segment=function(){this.p1=new u,this.p2=new u},k.prototype.TestSegment=function(e,t,n,r){r===undefined&&(r=0);var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y;n=this.p2.y-this.p1.y;var u=-(this.p2.x-this.p1.x),a=100*Number.MIN_VALUE,f=-(s*n+o*u);if(f>a){var l=i.x-this.p1.x,c=i.y-this.p1.y;i=l*n+c*u;if(0<=i&&i<=r*f){r=-s*c+o*l;if(-a*f<=r&&r<=f*(1+a))return i/=f,r=Math.sqrt(n*n+u*u),n/=r,u/=r,e[0]=i,t.Set(n,u),!0}}return!1},k.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},k.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+t*e,this.p2.y=this.p1.y+n*e},k.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+t*e,this.p1.y=this.p2.y+n*e},L.b2SeparationFunction=function(){this.m_localPoint=new u,this.m_axis=new u},L.prototype.Initialize=function(e,t,n,s,o){this.m_proxyA=t,this.m_proxyB=s;var a=parseInt(e.count);r.b2Assert(0<a&&a<3);var f,l,c,h,p=h=c=s=t=0,d=0;p=0,a==1?(this.m_type=L.e_points,f=this.m_proxyA.GetVertex(e.indexA[0]),l=this.m_proxyB.GetVertex(e.indexB[0]),a=f,e=n.R,t=n.position.x+(e.col1.x*a.x+e.col2.x*a.y),s=n.position.y+(e.col1.y*a.x+e.col2.y*a.y),a=l,e=o.R,c=o.position.x+(e.col1.x*a.x+e.col2.x*a.y),h=o.position.y+(e.col1.y*a.x+e.col2.y*a.y),this.m_axis.x=c-t,this.m_axis.y=h-s,this.m_axis.Normalize()):(e.indexB[0]==e.indexB[1]?(this.m_type=L.e_faceA,t=this.m_proxyA.GetVertex(e.indexA[0]),s=this.m_proxyA.GetVertex(e.indexA[1]),l=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(t.x+s.x),this.m_localPoint.y=.5*(t.y+s.y),this.m_axis=i.CrossVF(i.SubtractVV(s,t),1),this.m_axis.Normalize(),a=this.m_axis,e=n.R,p=e.col1.x*a.x+e.col2.x*a.y,d=e.col1.y*a.x+e.col2.y*a.y,a=this.m_localPoint,e=n.R,t=n.position.x+(e.col1.x*a.x+e.col2.x*a.y),s=n.position.y+(e.col1.y*a.x+e.col2.y*a.y),a=l,e=o.R,c=o.position.x+(e.col1.x*a.x+e.col2.x*a.y),h=o.position.y+(e.col1.y*a.x+e.col2.y*a.y),p=(c-t)*p+(h-s)*d):e.indexA[0]==e.indexA[0]?(this.m_type=L.e_faceB,c=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]),f=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(c.x+h.x),this.m_localPoint.y=.5*(c.y+h.y),this.m_axis=i.CrossVF(i.SubtractVV(h,c),1),this.m_axis.Normalize(),a=this.m_axis,e=o.R,p=e.col1.x*a.x+e.col2.x*a.y,d=e.col1.y*a.x+e.col2.y*a.y,a=this.m_localPoint,e=o.R,c=o.position.x+(e.col1.x*a.x+e.col2.x*a.y),h=o.position.y+(e.col1.y*a.x+e.col2.y*a.y),a=f,e=n.R,t=n.position.x+(e.col1.x*a.x+e.col2.x*a.y),s=n.position.y+(e.col1.y*a.x+e.col2.y*a.y),p=(t-c)*p+(s-h)*d):(t=this.m_proxyA.GetVertex(e.indexA[0]),s=this.m_proxyA.GetVertex(e.indexA[1]),c=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]),i.MulX(n,f),f=i.MulMV(n.R,i.SubtractVV(s,t)),i.MulX(o,l),p=i.MulMV(o.R,i.SubtractVV(h,c)),o=f.x*f.x+f.y*f.y,l=p.x*p.x+p.y*p.y,e=i.SubtractVV(p,f),n=f.x*e.x+f.y*e.y,e=p.x*e.x+p.y*e.y,f=f.x*p.x+f.y*p.y,d=o*l-f*f,p=0,d!=0&&(p=i.Clamp((f*e-n*l)/d,0,1)),(f*p+e)/l<0&&(p=i.Clamp((f-n)/o,0,1)),f=new u,f.x=t.x+p*(s.x-t.x),f.y=t.y+p*(s.y-t.y),l=new u,l.x=c.x+p*(h.x-c.x),l.y=c.y+p*(h.y-c.y),p==0||p==1?(this.m_type=L.e_faceB,this.m_axis=i.CrossVF(i.SubtractVV(h,c),1),this.m_axis.Normalize(),this.m_localPoint=l):(this.m_type=L.e_faceA,this.m_axis=i.CrossVF(i.SubtractVV(s,t),1),this.m_localPoint=f)),p<0&&this.m_axis.NegativeSelf())},L.prototype.Evaluate=function(e,t){var n,s,o=0;switch(this.m_type){case L.e_points:return n=i.MulTMV(e.R,this.m_axis),s=i.MulTMV(t.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),s=this.m_proxyB.GetSupportVertex(s),n=i.MulX(e,n),s=i.MulX(t,s),o=(s.x-n.x)*this.m_axis.x+(s.y-n.y)*this.m_axis.y;case L.e_faceA:return o=i.MulMV(e.R,this.m_axis),n=i.MulX(e,this.m_localPoint),s=i.MulTMV(t.R,o.GetNegative()),s=this.m_proxyB.GetSupportVertex(s),s=i.MulX(t,s),o=(s.x-n.x)*o.x+(s.y-n.y)*o.y;case L.e_faceB:return o=i.MulMV(t.R,this.m_axis),s=i.MulX(t,this.m_localPoint),n=i.MulTMV(e.R,o.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),n=i.MulX(e,n),o=(n.x-s.x)*o.x+(n.y-s.y)*o.y;default:return r.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),A.b2Simplex=function(){this.m_v1=new M,this.m_v2=new M,this.m_v3=new M,this.m_vertices=new Vector(3)},A.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},A.prototype.ReadCache=function(e,t,n,s,o){r.b2Assert(0<=e.count&&e.count<=3);var u,a;this.m_count=e.count;for(var f=this.m_vertices,l=0;l<this.m_count;l++){var c=f[l];c.indexA=e.indexA[l],c.indexB=e.indexB[l],u=t.GetVertex(c.indexA),a=s.GetVertex(c.indexB),c.wA=i.MulX(n,u),c.wB=i.MulX(o,a),c.w=i.SubtractVV(c.wB,c.wA),c.a=0}if(this.m_count>1){e=e.metric,u=this.GetMetric();if(u<.5*e||2*e<u||u<Number.MIN_VALUE)this.m_count=0}this.m_count==0&&(c=f[0],c.indexA=0,c.indexB=0,u=t.GetVertex(0),a=s.GetVertex(0),c.wA=i.MulX(n,u),c.wB=i.MulX(o,a),c.w=i.SubtractVV(c.wB,c.wA),this.m_count=1)},A.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=Box2D.parseUInt(this.m_count);for(var t=this.m_vertices,n=0;n<this.m_count;n++)e.indexA[n]=Box2D.parseUInt(t[n].indexA),e.indexB[n]=Box2D.parseUInt(t[n].indexB)},A.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=i.SubtractVV(this.m_v2.w,this.m_v1.w);return i.CrossVV(e,this.m_v1.w.GetNegative())>0?i.CrossFV(1,e):i.CrossVF(e,1);default:return r.b2Assert(!1),new u}},A.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return r.b2Assert(!1),new u;case 1:return this.m_v1.w;case 2:return new u(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return r.b2Assert(!1),new u}},A.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:r.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:r.b2Assert(!1)}},A.prototype.GetMetric=function(){switch(this.m_count){case 0:return r.b2Assert(!1),0;case 1:return 0;case 2:return i.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return i.CrossVV(i.SubtractVV(this.m_v2.w,this.m_v1.w),i.SubtractVV(this.m_v3.w,this.m_v1.w));default:return r.b2Assert(!1),0}},A.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=i.SubtractVV(t,e);e=-(e.x*n.x+e.y*n.y),e<=0?this.m_count=this.m_v1.a=1:(t=t.x*n.x+t.y*n.y,t<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(n=1/(t+e),this.m_v1.a=t*n,this.m_v2.a=e*n,this.m_count=2))},A.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=i.SubtractVV(t,e),s=i.Dot(e,r),o=i.Dot(t,r);s=-s;var u=i.SubtractVV(n,e),a=i.Dot(e,u),f=i.Dot(n,u);a=-a;var l=i.SubtractVV(n,t),c=i.Dot(t,l);l=i.Dot(n,l),c=-c,u=i.CrossVV(r,u),r=u*i.CrossVV(t,n),n=u*i.CrossVV(n,e),e=u*i.CrossVV(e,t),s<=0&&a<=0?this.m_count=this.m_v1.a=1:o>0&&s>0&&e<=0?(f=1/(o+s),this.m_v1.a=o*f,this.m_v2.a=s*f,this.m_count=2):f>0&&a>0&&n<=0?(o=1/(f+a),this.m_v1.a=f*o,this.m_v3.a=a*o,this.m_count=2,this.m_v2.Set(this.m_v3)):o<=0&&c<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):f<=0&&l<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):l>0&&c>0&&r<=0?(o=1/(l+c),this.m_v2.a=l*o,this.m_v3.a=c*o,this.m_count=2,this.m_v1.Set(this.m_v3)):(o=1/(r+n+e),this.m_v1.a=r*o,this.m_v2.a=n*o,this.m_v3.a=e*o,this.m_count=3)},O.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},M.b2SimplexVertex=function(){},M.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},_.b2TimeOfImpact=function(){},_.TimeOfImpact=function(e){++_.b2_toiCalls;var t=e.proxyA,n=e.proxyB,s=e.sweepA,o=e.sweepB;r.b2Assert(s.t0==o.t0),r.b2Assert(1-s.t0>Number.MIN_VALUE);var u=t.m_radius+n.m_radius;e=e.tolerance;var a=0,f=0,l=0;_.s_cache.count=0;for(_.s_distanceInput.useRadii=!1;;){s.GetTransform(_.s_xfA,a),o.GetTransform(_.s_xfB,a),_.s_distanceInput.proxyA=t,_.s_distanceInput.proxyB=n,_.s_distanceInput.transformA=_.s_xfA,_.s_distanceInput.transformB=_.s_xfB,d.Distance(_.s_distanceOutput,_.s_cache,_.s_distanceInput);if(_.s_distanceOutput.distance<=0){a=1;break}_.s_fcn.Initialize(_.s_cache,t,_.s_xfA,n,_.s_xfB);var c=_.s_fcn.Evaluate(_.s_xfA,_.s_xfB);if(c<=0){a=1;break}f==0&&(l=c>u?i.Max(u-e,.75*u):i.Max(c-e,.02*u));if(c-l<.5*e){if(f==0){a=1;break}break}var h=a,p=a,v=1;c=c,s.GetTransform(_.s_xfA,v),o.GetTransform(_.s_xfB,v);var m=_.s_fcn.Evaluate(_.s_xfA,_.s_xfB);if(m>=l){a=1;break}for(var g=0;;){var y=0;y=g&1?p+(l-c)*(v-p)/(m-c):.5*(p+v),s.GetTransform(_.s_xfA,y),o.GetTransform(_.s_xfB,y);var b=_.s_fcn.Evaluate(_.s_xfA,_.s_xfB);if(i.Abs(b-l)<.025*e){h=y;break}b>l?(p=y,c=b):(v=y,m=b),++g,++_.b2_toiRootIters;if(g==50)break}_.b2_toiMaxRootIters=i.Max(_.b2_toiMaxRootIters,g);if(h<(1+100*Number.MIN_VALUE)*a)break;a=h,f++,++_.b2_toiIters;if(f==1e3)break}return _.b2_toiMaxIters=i.Max(_.b2_toiMaxIters,f),a},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new O,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new v,Box2D.Collision.b2TimeOfImpact.s_xfA=new o,Box2D.Collision.b2TimeOfImpact.s_xfB=new o,Box2D.Collision.b2TimeOfImpact.s_fcn=new L,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new m}),D.b2TOIInput=function(){this.proxyA=new g,this.proxyB=new g,this.sweepA=new s,this.sweepB=new s},P.b2WorldManifold=function(){this.m_normal=new u},P.prototype.b2WorldManifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var e=0;e<r.b2_maxManifoldPoints;e++)this.m_points[e]=new u},P.prototype.Initialize=function(e,t,n,r,i){n===undefined&&(n=0),i===undefined&&(i=0);if(e.m_pointCount!=0){var s=0,o,u,a=0,f=0,l=0,c=0,h=0;o=0;switch(e.m_type){case S.e_circles:u=t.R,o=e.m_localPoint,s=t.position.x+u.col1.x*o.x+u.col2.x*o.y,t=t.position.y+u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_points[0].m_localPoint,e=r.position.x+u.col1.x*o.x+u.col2.x*o.y,r=r.position.y+u.col1.y*o.x+u.col2.y*o.y,o=e-s,u=r-t,a=o*o+u*u,a>Number.MIN_VALUE*Number.MIN_VALUE?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=u/a):(this.m_normal.x=1,this.m_normal.y=0),o=t+n*this.m_normal.y,r-=i*this.m_normal.y,this.m_points[0].x=.5*(s+n*this.m_normal.x+(e-i*this.m_normal.x)),this.m_points[0].y=.5*(o+r);break;case S.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,o=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(o-c)*f-i)*a,this.m_points[s].y=o+.5*(n-(h-l)*a-(o-c)*f-i)*f;break;case S.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,o=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(o-c)*f-n)*a,this.m_points[s].y=o+.5*(i-(h-l)*a-(o-c)*f-n)*f}}},H.ClipVertex=function(){this.v=new u,this.id=new h},H.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},B.Features=function(){},Object.defineProperty(B.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(B.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(B.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(B.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(B.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(B.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(B.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(B.prototype,"flip",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var e=Box2D.Common.b2Settings,t=Box2D.Collision.Shapes.b2CircleShape,n=Box2D.Collision.Shapes.b2EdgeChainDef,r=Box2D.Collision.Shapes.b2EdgeShape,i=Box2D.Collision.Shapes.b2MassData,s=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Collision.Shapes.b2Shape,u=Box2D.Common.Math.b2Mat22,a=Box2D.Common.Math.b2Math,f=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,c=Box2D.Collision.b2Distance,h=Box2D.Collision.b2DistanceInput,p=Box2D.Collision.b2DistanceOutput,d=Box2D.Collision.b2DistanceProxy,v=Box2D.Collision.b2SimplexCache;Box2D.inherit(t,Box2D.Collision.Shapes.b2Shape),t.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,t.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new l},t.prototype.Copy=function(){var e=new t;return e.Set(this),e},t.prototype.Set=function(e){this.__super.Set.call(this,e),Box2D.is(e,t)&&this.m_p.SetV((e instanceof t?e:null).m_p)},t.prototype.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);return n=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),r=t.x-r,n=t.y-n,r*r+n*n<=this.m_radius*this.m_radius},t.prototype.RayCast=function(e,t,n){var r=n.R,i=t.p1.x-(n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y));n=t.p1.y-(n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y)),r=t.p2.x-t.p1.x;var s=t.p2.y-t.p1.y,o=i*r+n*s,u=r*r+s*s,a=o*o-u*(i*i+n*n-this.m_radius*this.m_radius);return a<0||u<Number.MIN_VALUE?!1:(o=-(o+Math.sqrt(a)),0<=o&&o<=t.maxFraction*u?(o/=u,e.fraction=o,e.normal.x=i+o*r,e.normal.y=n+o*s,e.normal.Normalize(),!0):!1)},t.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);n=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),e.lowerBound.Set(r-this.m_radius,n-this.m_radius),e.upperBound.Set(r+this.m_radius,n+this.m_radius)},t.prototype.ComputeMass=function(t,n){n===undefined&&(n=0),t.mass=n*e.b2_pi*this.m_radius*this.m_radius,t.center.SetV(this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},t.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0),n=a.MulX(n,this.m_p);var i=-(a.Dot(e,n)-t);if(i<-this.m_radius+Number.MIN_VALUE)return 0;if(i>this.m_radius)return r.SetV(n),Math.PI*this.m_radius*this.m_radius;t=this.m_radius*this.m_radius;var s=i*i;return i=t*(Math.asin(i/this.m_radius)+Math.PI/2)+i*Math.sqrt(t-s),t=-2/3*Math.pow(t-s,1.5)/i,r.x=n.x+e.x*t,r.y=n.y+e.y*t,i},t.prototype.GetLocalPosition=function(){return this.m_p},t.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},t.prototype.GetRadius=function(){return this.m_radius},t.prototype.SetRadius=function(e){e===undefined&&(e=0),this.m_radius=e},t.prototype.b2CircleShape=function(e){e===undefined&&(e=0),this.__super.b2Shape.call(this),this.m_type=o.e_circleShape,this.m_radius=e},n.b2EdgeChainDef=function(){},n.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape),r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,r.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new l,this.m_v1=new l,this.m_v2=new l,this.m_coreV1=new l,this.m_coreV2=new l,this.m_normal=new l,this.m_direction=new l,this.m_cornerDir1=new l,this.m_cornerDir2=new l},r.prototype.TestPoint=function(){return!1},r.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u;n=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o),r=100*Number.MIN_VALUE;var f=-(i*a+s*n);if(f>r){o=t.p1.x-o;var l=t.p1.y-u;u=o*a+l*n;if(0<=u&&u<=t.maxFraction*f){t=-i*l+s*o;if(-r*f<=t&&t<=f*(1+r))return u/=f,e.fraction=u,t=Math.sqrt(a*a+n*n),e.normal.x=a/t,e.normal.y=n/t,!0}}return!1},r.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y);n=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y),r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<n?(e.lowerBound.y=i,e.upperBound.y=n):(e.lowerBound.y=n,e.upperBound.y=i)},r.prototype.ComputeMass=function(e){e.mass=0,e.center.SetV(this.m_v1),e.I=0},r.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=new l(e.x*t,e.y*t),s=a.MulX(n,this.m_v1);n=a.MulX(n,this.m_v2);var o=a.Dot(e,s)-t;e=a.Dot(e,n)-t;if(o>0){if(e>0)return 0;s.x=-e/(o-e)*s.x+o/(o-e)*n.x,s.y=-e/(o-e)*s.y+o/(o-e)*n.y}else e>0&&(n.x=-e/(o-e)*s.x+o/(o-e)*n.x,n.y=-e/(o-e)*s.y+o/(o-e)*n.y);return r.x=(i.x+s.x+n.x)/3,r.y=(i.y+s.y+n.y)/3,.5*((s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x))},r.prototype.GetLength=function(){return this.m_length},r.prototype.GetVertex1=function(){return this.m_v1},r.prototype.GetVertex2=function(){return this.m_v2},r.prototype.GetCoreVertex1=function(){return this.m_coreV1},r.prototype.GetCoreVertex2=function(){return this.m_coreV2},r.prototype.GetNormalVector=function(){return this.m_normal},r.prototype.GetDirectionVector=function(){return this.m_direction},r.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},r.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},r.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},r.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},r.prototype.GetFirstVertex=function(e){var t=e.R;return new l(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},r.prototype.GetNextEdge=function(){return this.m_nextEdge},r.prototype.GetPrevEdge=function(){return this.m_prevEdge},r.prototype.Support=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y);return e=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y),i*t+s*n>o*t+e*n?(this.s_supportVec.x=i,this.s_supportVec.y=s):(this.s_supportVec.x=o,this.s_supportVec.y=e),this.s_supportVec},r.prototype.b2EdgeShape=function(t,n){this.__super.b2Shape.call(this),this.m_type=o.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=t,this.m_v2=n,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-e.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-e.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-e.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-e.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},r.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},r.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},i.b2MassData=function(){this.mass=0,this.center=new l(0,0),this.I=0},Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape),s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,s.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},s.prototype.Copy=function(){var e=new s;return e.Set(this),e},s.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,s)){e=e instanceof s?e:null,this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e.m_vertices[t]),this.m_normals[t].SetV(e.m_normals[t])}},s.prototype.SetAsArray=function(e,t){t===undefined&&(t=0);var n=new Vector,r=0,i;for(r=0;r<e.length;++r)i=e[r],n.push(i);this.SetAsVector(n,t)},s.AsArray=function(e,t){t===undefined&&(t=0);var n=new s;return n.SetAsArray(e,t),n},s.prototype.SetAsVector=function(t,n){n===undefined&&(n=0),n==0&&(n=t.length),e.b2Assert(2<=n),this.m_vertexCount=n,this.Reserve(n);var r=0;for(r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(t[r]);for(r=0;r<this.m_vertexCount;++r){var i=parseInt(r),o=parseInt(r+1<this.m_vertexCount?r+1:0);i=a.SubtractVV(this.m_vertices[o],this.m_vertices[i]),e.b2Assert(i.LengthSquared()>Number.MIN_VALUE),this.m_normals[r].SetV(a.CrossVF(i,1)),this.m_normals[r].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)},s.AsVector=function(e,t){t===undefined&&(t=0);var n=new s;return n.SetAsVector(e,t),n},s.prototype.SetAsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},s.AsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=new s;return n.SetAsBox(e,t),n},s.prototype.SetAsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n,e=new f,e.position=n,e.R.Set(r);for(n=0;n<this.m_vertexCount;++n)this.m_vertices[n]=a.MulX(e,this.m_vertices[n]),this.m_normals[n]=a.MulMV(e.R,this.m_normals[n])},s.AsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0);var i=new s;return i.SetAsOrientedBox(e,t,n,r),i},s.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=a.CrossVF(a.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},s.AsEdge=function(e,t){var n=new s;return n.SetAsEdge(e,t),n},s.prototype.TestPoint=function(e,t){var n;n=e.R;for(var r=t.x-e.position.x,i=t.y-e.position.y,s=r*n.col1.x+i*n.col1.y,o=r*n.col2.x+i*n.col2.y,u=0;u<this.m_vertexCount;++u){n=this.m_vertices[u],r=s-n.x,i=o-n.y,n=this.m_normals[u];if(n.x*r+n.y*i>0)return!1}return!0},s.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s=0,o=0,u,a;s=t.p1.x-n.position.x,o=t.p1.y-n.position.y,u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x,o=t.p2.y-n.position.y,u=n.R,t=s*u.col1.x+o*u.col1.y-f,u=s*u.col2.x+o*u.col2.y-l;for(var c=parseInt(-1),h=0;h<this.m_vertexCount;++h){a=this.m_vertices[h],s=a.x-f,o=a.y-l,a=this.m_normals[h],s=a.x*s+a.y*o,o=a.x*t+a.y*u;if(o==0){if(s<0)return!1}else o<0&&s<r*o?(r=s/o,c=h):o>0&&s<i*o&&(i=s/o);if(i<r-Number.MIN_VALUE)return!1}return c>=0?(e.fraction=r,u=n.R,a=this.m_normals[c],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},s.prototype.ComputeAABB=function(e,t){for(var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s,a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y);r=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),i=i<f?i:f,s=s<r?s:r,o=o>f?o:f,u=u>r?u:r}e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},s.prototype.ComputeMass=function(e,t){t===undefined&&(t=0);if(this.m_vertexCount==2)e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;else{for(var n=0,r=0,i=0,s=0,o=1/3,u=0;u<this.m_vertexCount;++u){var a=this.m_vertices[u],f=u+1<this.m_vertexCount?this.m_vertices[parseInt(u+1)]:this.m_vertices[0],l=a.x-0,c=a.y-0,h=f.x-0,p=f.y-0,d=l*p-c*h,v=.5*d;i+=v,n+=v*o*(0+a.x+f.x),r+=v*o*(0+a.y+f.y),a=l,c=c,h=h,p=p,s+=d*(o*(.25*(a*a+h*a+h*h)+(0*a+0*h))+0+(o*(.25*(c*c+p*c+p*p)+(0*c+0*p))+0))}e.mass=t*i,n*=1/i,r*=1/i,e.center.Set(n,r),e.I=t*s}},s.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var s=a.MulTMV(n.R,e),o=t-a.Dot(e,n.position),u=new Vector_a2j_Number,f=0,c=parseInt(-1);t=parseInt(-1);var h=!1;for(e=e=0;e<this.m_vertexCount;++e){u[e]=a.Dot(s,this.m_vertices[e])-o;var p=u[e]<-Number.MIN_VALUE;e>0&&(p?h||(c=e-1,f++):h&&(t=e-1,f++)),h=p}switch(f){case 0:return h?(e=new i,this.ComputeMass(e,1),r.SetV(a.MulX(n,e.center)),e.mass):0;case 1:c==-1?c=this.m_vertexCount-1:t=this.m_vertexCount-1}e=parseInt((c+1)%this.m_vertexCount),s=parseInt((t+1)%this.m_vertexCount),o=(0-u[c])/(u[e]-u[c]),u=(0-u[t])/(u[s]-u[t]),c=new l(this.m_vertices[c].x*(1-o)+this.m_vertices[e].x*o,this.m_vertices[c].y*(1-o)+this.m_vertices[e].y*o),t=new l(this.m_vertices[t].x*(1-u)+this.m_vertices[s].x*u,this.m_vertices[t].y*(1-u)+this.m_vertices[s].y*u),u=0,o=new l,f=this.m_vertices[e];for(e=e;e!=s;)e=(e+1)%this.m_vertexCount,h=e==s?t:this.m_vertices[e],p=.5*((f.x-c.x)*(h.y-c.y)-(f.y-c.y)*(h.x-c.x)),u+=p,o.x+=p*(c.x+f.x+h.x)/3,o.y+=p*(c.y+f.y+h.y)/3,f=h;return o.Multiply(1/u),r.SetV(a.MulX(n,o)),u},s.prototype.GetVertexCount=function(){return this.m_vertexCount},s.prototype.GetVertices=function(){return this.m_vertices},s.prototype.GetNormals=function(){return this.m_normals},s.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},s.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},s.prototype.Validate=function(){return!1},s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=o.e_polygonShape,this.m_centroid=new l,this.m_vertices=new Vector,this.m_normals=new Vector},s.prototype.Reserve=function(e){e===undefined&&(e=0);for(var t=parseInt(this.m_vertices.length);t<e;t++)this.m_vertices[t]=new l,this.m_normals[t]=new l},s.ComputeCentroid=function(e,t){t===undefined&&(t=0);for(var n=new l,r=0,i=1/3,s=0;s<t;++s){var o=e[s],u=s+1<t?e[parseInt(s+1)]:e[0],a=.5*((o.x-0)*(u.y-0)-(o.y-0)*(u.x-0));r+=a,n.x+=a*i*(0+o.x+u.x),n.y+=a*i*(0+o.y+u.y)}return n.x*=1/r,n.y*=1/r,n},s.ComputeOBB=function(e,t,n){n===undefined&&(n=0);var r=0,i=new Vector(n+1);for(r=0;r<n;++r)i[r]=t[r];i[n]=i[0],t=Number.MAX_VALUE;for(r=1;r<=n;++r){var s=i[parseInt(r-1)],o=i[r].x-s.x,u=i[r].y-s.y,a=Math.sqrt(o*o+u*u);o/=a,u/=a;for(var f=-u,l=o,c=a=Number.MAX_VALUE,h=-Number.MAX_VALUE,p=-Number.MAX_VALUE,d=0;d<n;++d){var v=i[d].x-s.x,m=i[d].y-s.y,g=o*v+u*m;v=f*v+l*m,g<a&&(a=g),v<c&&(c=v),g>h&&(h=g),v>p&&(p=v)}d=(h-a)*(p-c),d<.95*t&&(t=d,e.R.col1.x=o,e.R.col1.y=u,e.R.col2.x=f,e.R.col2.y=l,o=.5*(a+h),u=.5*(c+p),f=e.R,e.center.x=s.x+(f.col1.x*o+f.col2.x*u),e.center.y=s.y+(f.col1.y*o+f.col2.y*u),e.extents.x=.5*(h-a),e.extents.y=.5*(p-c))}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new u}),o.b2Shape=function(){},o.prototype.Copy=function(){return null},o.prototype.Set=function(e){this.m_radius=e.m_radius},o.prototype.GetType=function(){return this.m_type},o.prototype.TestPoint=function(){return!1},o.prototype.RayCast=function(){return!1},o.prototype.ComputeAABB=function(){},o.prototype.ComputeMass=function(){},o.prototype.ComputeSubmergedArea=function(){return 0},o.TestOverlap=function(e,t,n,r){var i=new h;return i.proxyA=new d,i.proxyA.Set(e),i.proxyB=new d,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0,e=new v,e.count=0,t=new p,c.Distance(t,e,i),t.distance<10*Number.MIN_VALUE},o.prototype.b2Shape=function(){this.m_type=o.e_unknownShape,this.m_radius=e.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Math;e.b2Color=function(){this._b=this._g=this._r=0},e.prototype.b2Color=function(e,t,r){e===undefined&&(e=0),t===undefined&&(t=0),r===undefined&&(r=0),this._r=Box2D.parseUInt(255*n.Clamp(e,0,1)),this._g=Box2D.parseUInt(255*n.Clamp(t,0,1)),this._b=Box2D.parseUInt(255*n.Clamp(r,0,1))},e.prototype.Set=function(e,t,r){e===undefined&&(e=0),t===undefined&&(t=0),r===undefined&&(r=0),this._r=Box2D.parseUInt(255*n.Clamp(e,0,1)),this._g=Box2D.parseUInt(255*n.Clamp(t,0,1)),this._b=Box2D.parseUInt(255*n.Clamp(r,0,1))},Object.defineProperty(e.prototype,"r",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._r=Box2D.parseUInt(255*n.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"g",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._g=Box2D.parseUInt(255*n.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"b",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._b=Box2D.parseUInt(255*n.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),t.b2Settings=function(){},t.b2MixFriction=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),Math.sqrt(e*t)},t.b2MixRestitution=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},t.b2Assert=function(e){if(!e)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*t.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*t.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*t.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*t.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*t.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*t.b2_pi})}(),function(){var e=Box2D.Common.Math.b2Mat22,t=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,i=Box2D.Common.Math.b2Transform,s=Box2D.Common.Math.b2Vec2,o=Box2D.Common.Math.b2Vec3;e.b2Mat22=function(){this.col1=new s,this.col2=new s},e.prototype.b2Mat22=function(){this.SetIdentity()},e.FromAngle=function(t){t===undefined&&(t=0);var n=new e;return n.Set(t),n},e.FromVV=function(t,n){var r=new e;return r.SetVV(t,n),r},e.prototype.Set=function(e){e===undefined&&(e=0);var t=Math.cos(e);e=Math.sin(e),this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t},e.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},e.prototype.Copy=function(){var t=new e;return t.SetM(this),t},e.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},e.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},e.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},e.prototype.GetInverse=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s!=0&&(s=1/s),e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},e.prototype.Solve=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},e.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},t.b2Mat33=function(){this.col1=new o,this.col2=new o,this.col3=new o},t.prototype.b2Mat33=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=null),!e&&!t&&!n?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n))},t.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},t.prototype.Copy=function(){return new t(this.col1,this.col2,this.col3)},t.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},t.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},t.prototype.Solve22=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},t.prototype.Solve33=function(e,t,n,r){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0);var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return p!=0&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},n.b2Math=function(){},n.IsValid=function(e){return e===undefined&&(e=0),isFinite(e)},n.Dot=function(e,t){return e.x*t.x+e.y*t.y},n.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},n.CrossVF=function(e,t){return t===undefined&&(t=0),new s(t*e.y,-t*e.x)},n.CrossFV=function(e,t){return e===undefined&&(e=0),new s(-e*t.y,e*t.x)},n.MulMV=function(e,t){return new s(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)},n.MulTMV=function(e,t){return new s(n.Dot(t,e.col1),n.Dot(t,e.col2))},n.MulX=function(e,t){var r=n.MulMV(e.R,t);return r.x+=e.position.x,r.y+=e.position.y,r},n.MulXT=function(e,t){var r=n.SubtractVV(t,e.position),i=r.x*e.R.col1.x+r.y*e.R.col1.y;return r.y=r.x*e.R.col2.x+r.y*e.R.col2.y,r.x=i,r},n.AddVV=function(e,t){return new s(e.x+t.x,e.y+t.y)},n.SubtractVV=function(e,t){return new s(e.x-t.x,e.y-t.y)},n.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},n.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},n.MulFV=function(e,t){return e===undefined&&(e=0),new s(e*t.x,e*t.y)},n.AddMM=function(t,r){return e.FromVV(n.AddVV(t.col1,r.col1),n.AddVV(t.col2,r.col2))},n.MulMM=function(t,r){return e.FromVV(n.MulMV(t,r.col1),n.MulMV(t,r.col2))},n.MulTMM=function(t,r){var i=new s(n.Dot(t.col1,r.col1),n.Dot(t.col2,r.col1)),o=new s(n.Dot(t.col1,r.col2),n.Dot(t.col2,r.col2));return e.FromVV(i,o)},n.Abs=function(e){return e===undefined&&(e=0),e>0?e:-e},n.AbsV=function(e){return new s(n.Abs(e.x),n.Abs(e.y))},n.AbsM=function(t){return e.FromVV(n.AbsV(t.col1),n.AbsV(t.col2))},n.Min=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e<t?e:t},n.MinV=function(e,t){return new s(n.Min(e.x,t.x),n.Min(e.y,t.y))},n.Max=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},n.MaxV=function(e,t){return new s(n.Max(e.x,t.x),n.Max(e.y,t.y))},n.Clamp=function(e,t,n){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),e<t?t:e>n?n:e},n.ClampV=function(e,t,r){return n.MaxV(t,n.MinV(e,r))},n.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},n.Random=function(){return Math.random()*2-1},n.RandomRange=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=Math.random();return n=(t-e)*n+e},n.NextPowerOfTwo=function(e){return e===undefined&&(e=0),e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},n.IsPowerOfTwo=function(e){return e===undefined&&(e=0),e>0&&(e&e-1)==0},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new s(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=e.FromVV(new s(1,0),new s(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new i(n.b2Vec2_zero,n.b2Mat22_identity)}),r.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},r.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},r.prototype.Copy=function(){var e=new r;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},r.prototype.GetTransform=function(e,t){t===undefined&&(t=0),e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y,e.R.Set((1-t)*this.a0+t*this.a);var n=e.R;e.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y,e.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y},r.prototype.Advance=function(e){e===undefined&&(e=0);if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},i.b2Transform=function(){this.position=new s,this.R=new e},i.prototype.b2Transform=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),e&&(this.position.SetV(e),this.R.SetM(t))},i.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},i.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},i.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},i.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},s.prototype.SetZero=function(){this.y=this.x=0},s.prototype.Set=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},s.prototype.SetV=function(e){this.x=e.x,this.y=e.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),new s(e,t)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},s.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},s.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e},s.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},s.prototype.MulTM=function(e){var t=n.Dot(this,e.col1);this.y=n.Dot(this,e.col2),this.x=t},s.prototype.CrossVF=function(e){e===undefined&&(e=0);var t=this.x;this.x=e*this.y,this.y=-e*t},s.prototype.CrossFV=function(e){e===undefined&&(e=0);var t=this.x;this.x=-e*this.y,this.y=e*t},s.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},s.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},s.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},s.prototype.IsValid=function(){return n.IsValid(this.x)&&n.IsValid(this.y)},o.b2Vec3=function(){},o.prototype.b2Vec3=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},o.prototype.SetZero=function(){this.x=this.y=this.z=0},o.prototype.Set=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},o.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},o.prototype.GetNegative=function(){return new o(-this.x,-this.y,-this.z)},o.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},o.prototype.Copy=function(){return new o(this.x,this.y,this.z)},o.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},o.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},o.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e,this.z*=e}}(),function(){var e=Box2D.Common.Math.b2Math,t=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,r=Box2D.Common.Math.b2Vec2,i=Box2D.Common.b2Color,s=Box2D.Common.b2Settings,o=Box2D.Collision.b2AABB,u=Box2D.Collision.b2ContactPoint,a=Box2D.Collision.b2DynamicTreeBroadPhase,f=Box2D.Collision.b2RayCastInput,l=Box2D.Collision.b2RayCastOutput,c=Box2D.Collision.Shapes.b2CircleShape,h=Box2D.Collision.Shapes.b2EdgeShape,p=Box2D.Collision.Shapes.b2MassData,d=Box2D.Collision.Shapes.b2PolygonShape,v=Box2D.Collision.Shapes.b2Shape,m=Box2D.Dynamics.b2Body,g=Box2D.Dynamics.b2BodyDef,y=Box2D.Dynamics.b2ContactFilter,b=Box2D.Dynamics.b2ContactImpulse,w=Box2D.Dynamics.b2ContactListener,E=Box2D.Dynamics.b2ContactManager,S=Box2D.Dynamics.b2DebugDraw,x=Box2D.Dynamics.b2DestructionListener,T=Box2D.Dynamics.b2FilterData,N=Box2D.Dynamics.b2Fixture,C=Box2D.Dynamics.b2FixtureDef,k=Box2D.Dynamics.b2Island,L=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World,O=Box2D.Dynamics.Contacts.b2Contact,M=Box2D.Dynamics.Contacts.b2ContactFactory,_=Box2D.Dynamics.Contacts.b2ContactSolver,D=Box2D.Dynamics.Joints.b2Joint,P=Box2D.Dynamics.Joints.b2PulleyJoint;m.b2Body=function(){this.m_xf=new n,this.m_sweep=new t,this.m_linearVelocity=new r,this.m_force=new r},m.prototype.connectEdges=function(t,n,r){r===undefined&&(r=0);var i=Math.atan2(n.GetDirectionVector().y,n.GetDirectionVector().x);r=e.MulFV(Math.tan((i-r)*.5),n.GetDirectionVector()),r=e.SubtractVV(r,n.GetNormalVector()),r=e.MulFV(s.b2_toiSlop,r),r=e.AddVV(r,n.GetVertex1());var o=e.AddVV(t.GetDirectionVector(),n.GetDirectionVector());o.Normalize();var u=e.Dot(t.GetDirectionVector(),n.GetNormalVector())>0;return t.SetNextEdge(n,r,o,u),n.SetPrevEdge(t,r,o,u),i},m.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==1)return null;var t=new N;return t.Create(this,this.m_xf,e),this.m_flags&m.e_activeFlag&&t.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,t.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=A.e_newFixture,t},m.prototype.CreateFixture2=function(e,t){t===undefined&&(t=0);var n=new C;return n.shape=e,n.density=t,this.CreateFixture(n)},m.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()!=1){for(var t=this.m_fixtureList,n=null;t!=null;){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next;break}n=t,t=t.m_next}for(t=this.m_contactList;t;){n=t.contact,t=t.next;var r=n.GetFixtureA(),i=n.GetFixtureB();(e==r||e==i)&&this.m_world.m_contactManager.Destroy(n)}this.m_flags&m.e_activeFlag&&e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},m.prototype.SetPositionAndAngle=function(e,t){t===undefined&&(t=0);var n;if(this.m_world.IsLocked()!=1){this.m_xf.R.Set(t),this.m_xf.position.SetV(e),n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t,r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(r,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},m.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},m.prototype.GetTransform=function(){return this.m_xf},m.prototype.GetPosition=function(){return this.m_xf.position},m.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},m.prototype.GetAngle=function(){return this.m_sweep.a},m.prototype.SetAngle=function(e){e===undefined&&(e=0),this.SetPositionAndAngle(this.GetPosition(),e)},m.prototype.GetWorldCenter=function(){return this.m_sweep.c},m.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},m.prototype.SetLinearVelocity=function(e){this.m_type!=m.b2_staticBody&&this.m_linearVelocity.SetV(e)},m.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},m.prototype.SetAngularVelocity=function(e){e===undefined&&(e=0),this.m_type!=m.b2_staticBody&&(this.m_angularVelocity=e)},m.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},m.prototype.GetDefinition=function(){var e=new g;return e.type=this.GetType(),e.allowSleep=(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag,e.bullet=(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag,e.awake=(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},m.prototype.ApplyForce=function(e,t){this.m_type==m.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},m.prototype.ApplyTorque=function(e){e===undefined&&(e=0),this.m_type==m.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e)},m.prototype.ApplyImpulse=function(e,t){this.m_type==m.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x))},m.prototype.Split=function(t){for(var n=this.GetLinearVelocity().Copy(),r=this.GetAngularVelocity(),i=this.GetWorldCenter(),s=this.m_world.CreateBody(this.GetDefinition()),o,u=this.m_fixtureList;u;)if(t(u)){var a=u.m_next;o?o.m_next=a:this.m_fixtureList=a,this.m_fixtureCount--,u.m_next=s.m_fixtureList,s.m_fixtureList=u,s.m_fixtureCount++,u.m_body=s,u=a}else o=u,u=u.m_next;return this.ResetMassData(),s.ResetMassData(),o=this.GetWorldCenter(),t=s.GetWorldCenter(),o=e.AddVV(n,e.CrossFV(r,e.SubtractVV(o,i))),n=e.AddVV(n,e.CrossFV(r,e.SubtractVV(t,i))),this.SetLinearVelocity(o),s.SetLinearVelocity(n),this.SetAngularVelocity(r),s.SetAngularVelocity(r),this.SynchronizeFixtures(),s.SynchronizeFixtures(),s},m.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=i,t=n}r.m_fixtureCount=0;var r=this,i=e;r.GetWorldCenter(),i.GetWorldCenter(),r.GetLinearVelocity().Copy(),i.GetLinearVelocity().Copy(),r.GetAngularVelocity(),i.GetAngularVelocity(),r.ResetMassData(),this.SynchronizeFixtures()},m.prototype.GetMass=function(){return this.m_mass},m.prototype.GetInertia=function(){return this.m_I},m.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},m.prototype.SetMassData=function(t){s.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()!=1&&this.m_type==m.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&(this.m_flags&m.e_fixedRotationFlag)==0&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I);var n=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center),this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},m.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero();if(this.m_type!=m.b2_staticBody&&this.m_type!=m.b2_kinematicBody){for(var t=r.Make(0,0),n=this.m_fixtureList;n;n=n.m_next)if(n.m_density!=0){var i=n.GetMassData();this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):this.m_invMass=this.m_mass=1,this.m_I>0&&(this.m_flags&m.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,n=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(t),this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},m.prototype.GetWorldPoint=function(e){var t=this.m_xf.R;return e=new r(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},m.prototype.GetWorldVector=function(t){return e.MulMV(this.m_xf.R,t)},m.prototype.GetLocalPoint=function(t){return e.MulXT(this.m_xf,t)},m.prototype.GetLocalVector=function(t){return e.MulTMV(this.m_xf.R,t)},m.prototype.GetLinearVelocityFromWorldPoint=function(e){return new r(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},m.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R;return e=new r(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,new r(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},m.prototype.GetLinearDamping=function(){return this.m_linearDamping},m.prototype.SetLinearDamping=function(e){e===undefined&&(e=0),this.m_linearDamping=e},m.prototype.GetAngularDamping=function(){return this.m_angularDamping},m.prototype.SetAngularDamping=function(e){e===undefined&&(e=0),this.m_angularDamping=e},m.prototype.SetType=function(e){e===undefined&&(e=0);if(this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==m.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},m.prototype.GetType=function(){return this.m_type},m.prototype.SetBullet=function(e){e?this.m_flags|=m.e_bulletFlag:this.m_flags&=~m.e_bulletFlag},m.prototype.IsBullet=function(){return(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag},m.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=m.e_allowSleepFlag:(this.m_flags&=~m.e_allowSleepFlag,this.SetAwake(!0))},m.prototype.SetAwake=function(e){e?(this.m_flags|=m.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~m.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},m.prototype.IsAwake=function(){return(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag},m.prototype.SetFixedRotation=function(e){e?this.m_flags|=m.e_fixedRotationFlag:this.m_flags&=~m.e_fixedRotationFlag,this.ResetMassData()},m.prototype.IsFixedRotation=function(){return(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag},m.prototype.SetActive=function(e){if(e!=this.IsActive()){var t;if(e){this.m_flags|=m.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.CreateProxy(e,this.m_xf)}else{this.m_flags&=~m.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxy(e);for(e=this.m_contactList;e;)t=e,e=e.next,this.m_world.m_contactManager.Destroy(t.contact);this.m_contactList=null}}},m.prototype.IsActive=function(){return(this.m_flags&m.e_activeFlag)==m.e_activeFlag},m.prototype.IsSleepingAllowed=function(){return(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag},m.prototype.GetFixtureList=function(){return this.m_fixtureList},m.prototype.GetJointList=function(){return this.m_jointList},m.prototype.GetControllerList=function(){return this.m_controllerList},m.prototype.GetContactList=function(){return this.m_contactList},m.prototype.GetNext=function(){return this.m_next},m.prototype.GetUserData=function(){return this.m_userData},m.prototype.SetUserData=function(e){this.m_userData=e},m.prototype.GetWorld=function(){return this.m_world},m.prototype.b2Body=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=m.e_bulletFlag),e.fixedRotation&&(this.m_flags|=m.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=m.e_allowSleepFlag),e.awake&&(this.m_flags|=m.e_awakeFlag),e.active&&(this.m_flags|=m.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=e.type,this.m_type==m.b2_dynamicBody?this.m_invMass=this.m_mass=1:this.m_invMass=this.m_mass=0,this.m_invI=this.m_I=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},m.prototype.SynchronizeFixtures=function(){var e=m.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y),n=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(n,e,this.m_xf)},m.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},m.prototype.ShouldCollide=function(e){if(this.m_type!=m.b2_dynamicBody&&e.m_type!=m.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},m.prototype.Advance=function(e){e===undefined&&(e=0),this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new n,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),g.b2BodyDef=function(){this.position=new r,this.linearVelocity=new r},g.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=m.b2_staticBody,this.active=!0,this.inertiaScale=1},y.b2ContactFilter=function(){},y.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();return n.groupIndex==r.groupIndex&&n.groupIndex!=0?n.groupIndex>0:(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0},y.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e instanceof N?e:null,t):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new y}),b.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(s.b2_maxManifoldPoints)},w.b2ContactListener=function(){},w.prototype.BeginContact=function(){},w.prototype.EndContact=function(){},w.prototype.PreSolve=function(){},w.prototype.PostSolve=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new w}),E.b2ContactManager=function(){},E.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=y.b2_defaultFilter,this.m_contactListener=w.b2_defaultListener,this.m_contactFactory=new M(this.m_allocator),this.m_broadPhase=new a},E.prototype.AddPair=function(e,t){var n=e instanceof N?e:null,r=t instanceof N?t:null,i=n.GetBody(),s=r.GetBody();if(i!=s){for(var o=s.GetContactList();o;){if(o.other==i){var u=o.contact.GetFixtureA(),a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}s.ShouldCollide(i)!=0&&this.m_contactFilter.ShouldCollide(n,r)!=0&&(o=this.m_contactFactory.Create(n,r),n=o.GetFixtureA(),r=o.GetFixtureB(),i=n.m_body,s=r.m_body,o.m_prev=null,o.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=o),this.m_world.m_contactList=o,o.m_nodeA.contact=o,o.m_nodeA.other=s,o.m_nodeA.prev=null,o.m_nodeA.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=o.m_nodeA),i.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=i,o.m_nodeB.prev=null,o.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=o.m_nodeB),s.m_contactList=o.m_nodeB,++this.m_world.m_contactCount)}},E.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},E.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB();t=t.GetBody(),n=n.GetBody(),e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==t.m_contactList&&(t.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==n.m_contactList&&(n.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},E.prototype.Collide=function(){for(var e=this.m_world.m_contactList;e;){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();if(r.IsAwake()==0&&i.IsAwake()==0)e=e.GetNext();else{if(e.m_flags&O.e_filterFlag){if(i.ShouldCollide(r)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}if(this.m_contactFilter.ShouldCollide(t,n)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}e.m_flags&=~O.e_filterFlag}this.m_broadPhase.TestOverlap(t.m_proxy,n.m_proxy)==0?(t=e,e=t.GetNext(),this.Destroy(t)):(e.Update(this.m_contactListener),e=e.GetNext())}}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new u}),S.b2DebugDraw=function(){},S.prototype.b2DebugDraw=function(){},S.prototype.SetFlags=function(){},S.prototype.GetFlags=function(){},S.prototype.AppendFlags=function(){},S.prototype.ClearFlags=function(){},S.prototype.SetSprite=function(){},S.prototype.GetSprite=function(){},S.prototype.SetDrawScale=function(){},S.prototype.GetDrawScale=function(){},S.prototype.SetLineThickness=function(){},S.prototype.GetLineThickness=function(){},S.prototype.SetAlpha=function(){},S.prototype.GetAlpha=function(){},S.prototype.SetFillAlpha=function(){},S.prototype.GetFillAlpha=function(){},S.prototype.SetXFormScale=function(){},S.prototype.GetXFormScale=function(){},S.prototype.DrawPolygon=function(){},S.prototype.DrawSolidPolygon=function(){},S.prototype.DrawCircle=function(){},S.prototype.DrawSolidCircle=function(){},S.prototype.DrawSegment=function(){},S.prototype.DrawTransform=function(){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),x.b2DestructionListener=function(){},x.prototype.SayGoodbyeJoint=function(){},x.prototype.SayGoodbyeFixture=function(){},T.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},T.prototype.Copy=function(){var e=new T;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},N.b2Fixture=function(){this.m_filter=new T},N.prototype.GetType=function(){return this.m_shape.GetType()},N.prototype.GetShape=function(){return this.m_shape},N.prototype.SetSensor=function(e){if(this.m_isSensor!=e){this.m_isSensor=e;if(this.m_body!=null)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.SetSensor(n.IsSensor()||r.IsSensor()),e=e.next}}},N.prototype.IsSensor=function(){return this.m_isSensor},N.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(!this.m_body)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.FlagForFiltering(),e=e.next}},N.prototype.GetFilterData=function(){return this.m_filter.Copy()},N.prototype.GetBody=function(){return this.m_body},N.prototype.GetNext=function(){return this.m_next},N.prototype.GetUserData=function(){return this.m_userData},N.prototype.SetUserData=function(e){this.m_userData=e},N.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},N.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},N.prototype.GetMassData=function(e){return e===undefined&&(e=null),e==null&&(e=new p),this.m_shape.ComputeMass(e,this.m_density),e},N.prototype.SetDensity=function(e){e===undefined&&(e=0),this.m_density=e},N.prototype.GetDensity=function(){return this.m_density},N.prototype.GetFriction=function(){return this.m_friction},N.prototype.SetFriction=function(e){e===undefined&&(e=0),this.m_friction=e},N.prototype.GetRestitution=function(){return this.m_restitution},N.prototype.SetRestitution=function(e){e===undefined&&(e=0),this.m_restitution=e},N.prototype.GetAABB=function(){return this.m_aabb},N.prototype.b2Fixture=function(){this.m_aabb=new o,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},N.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=e,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},N.prototype.Destroy=function(){this.m_shape=null},N.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},N.prototype.DestroyProxy=function(e){this.m_proxy!=null&&(e.DestroyProxy(this.m_proxy),this.m_proxy=null)},N.prototype.Synchronize=function(t,n,r){if(this.m_proxy){var i=new o,s=new o;this.m_shape.ComputeAABB(i,n),this.m_shape.ComputeAABB(s,r),this.m_aabb.Combine(i,s),n=e.SubtractVV(r.position,n.position),t.MoveProxy(this.m_proxy,this.m_aabb,n)}},C.b2FixtureDef=function(){this.filter=new T},C.prototype.b2FixtureDef=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},k.b2Island=function(){},k.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},k.prototype.Initialize=function(e,t,n,r,i,s){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0);var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null},k.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},k.prototype.Solve=function(t,n,r){var i=0,o=0,u;for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.GetType()==m.b2_dynamicBody&&(o.m_linearVelocity.x+=t.dt*(n.x+o.m_invMass*o.m_force.x),o.m_linearVelocity.y+=t.dt*(n.y+o.m_invMass*o.m_force.y),o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque,o.m_linearVelocity.Multiply(e.Clamp(1-t.dt*o.m_linearDamping,0,1)),o.m_angularVelocity*=e.Clamp(1-t.dt*o.m_angularDamping,0,1));this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator),n=this.m_contactSolver,n.InitVelocityConstraints(t);for(i=0;i<this.m_jointCount;++i)u=this.m_joints[i],u.InitVelocityConstraints(t);for(i=0;i<t.velocityIterations;++i){for(o=0;o<this.m_jointCount;++o)u=this.m_joints[o],u.SolveVelocityConstraints(t);n.SolveVelocityConstraints()}for(i=0;i<this.m_jointCount;++i)u=this.m_joints[i],u.FinalizeVelocityConstraints();n.FinalizeVelocityConstraints();for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()!=m.b2_staticBody){var a=t.dt*o.m_linearVelocity.x,f=t.dt*o.m_linearVelocity.y;a*a+f*f>s.b2_maxTranslationSquared&&(o.m_linearVelocity.Normalize(),o.m_linearVelocity.x*=s.b2_maxTranslation*t.inv_dt,o.m_linearVelocity.y*=s.b2_maxTranslation*t.inv_dt),a=t.dt*o.m_angularVelocity,a*a>s.b2_maxRotationSquared&&(o.m_angularVelocity=o.m_angularVelocity<0?-s.b2_maxRotation*t.inv_dt:s.b2_maxRotation*t.inv_dt),o.m_sweep.c0.SetV(o.m_sweep.c),o.m_sweep.a0=o.m_sweep.a,o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x,o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y,o.m_sweep.a+=t.dt*o.m_angularVelocity,o.SynchronizeTransform()}}for(i=0;i<t.positionIterations;++i){a=n.SolvePositionConstraints(s.b2_contactBaumgarte),f=!0;for(o=0;o<this.m_jointCount;++o)u=this.m_joints[o],u=u.SolvePositionConstraints(s.b2_contactBaumgarte),f=f&&u;if(a&&f)break}this.Report(n.m_constraints);if(r){r=Number.MAX_VALUE,n=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,a=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.GetType()!=m.b2_staticBody&&((o.m_flags&m.e_allowSleepFlag)==0&&(r=o.m_sleepTime=0),(o.m_flags&m.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>a||e.Dot(o.m_linearVelocity,o.m_linearVelocity)>n?r=o.m_sleepTime=0:(o.m_sleepTime+=t.dt,r=e.Min(r,o.m_sleepTime)));if(r>=s.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.SetAwake(!1)}},k.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){n=this.m_bodies[t];if(n.GetType()!=m.b2_staticBody){var i=e.dt*n.m_linearVelocity.x,o=e.dt*n.m_linearVelocity.y;i*i+o*o>s.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=s.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=s.b2_maxTranslation*e.inv_dt),i=e.dt*n.m_angularVelocity,i*i>s.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-s.b2_maxRotation*e.inv_dt:s.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}}for(t=0;t<e.positionIterations;++t){i=r.SolvePositionConstraints(.75),o=!0;for(n=0;n<this.m_jointCount;++n){var u=this.m_joints[n].SolvePositionConstraints(s.b2_contactBaumgarte);o=o&&u}if(i&&o)break}this.Report(r.m_constraints)},k.prototype.Report=function(e){if(this.m_listener!=null)for(var t=0;t<this.m_contactCount;++t){for(var n=this.m_contacts[t],r=e[t],i=0;i<r.pointCount;++i)k.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,k.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,k.s_impulse)}},k.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},k.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},k.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new b}),L.b2TimeStep=function(){},L.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},A.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new E,this.m_contactSolver=new _,this.m_island=new k},A.prototype.b2World=function(e,t){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,A.m_warmStarting=!0,A.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_groundBody=this.CreateBody(new g)},A.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},A.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},A.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},A.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},A.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next)for(var r=n.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)},A.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},A.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},A.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;e=new m(e,this),e.m_prev=null;if(e.m_next=this.m_bodyList)this.m_bodyList.m_prev=e;return this.m_bodyList=e,++this.m_bodyCount,e},A.prototype.DestroyBody=function(e){if(this.IsLocked()!=1){for(var t=e.m_jointList;t;){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}for(t=e.m_controllerList;t;)n=t,t=t.nextController,n.controller.RemoveBody(e);for(t=e.m_contactList;t;)n=t,t=t.next,this.m_contactManager.Destroy(n.contact);e.m_contactList=null;for(t=e.m_fixtureList;t;)n=t,t=t.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(n),n.DestroyProxy(this.m_contactManager.m_broadPhase),n.Destroy();e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount}},A.prototype.CreateJoint=function(e){var t=D.Create(e,null);t.m_prev=null;if(t.m_next=this.m_jointList)this.m_jointList.m_prev=t;this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null;if(t.m_edgeA.next=t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null;if(t.m_edgeB.next=t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next;return t},A.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,D.Destroy(e,null),--this.m_jointCount;if(t==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next},A.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList=e,e.m_world=this,this.m_controllerCount++,e},A.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},A.prototype.CreateController=function(e){if(e.m_world!=this)throw Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},A.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},A.prototype.SetWarmStarting=function(e){A.m_warmStarting=e},A.prototype.SetContinuousPhysics=function(e){A.m_continuousPhysics=e},A.prototype.GetBodyCount=function(){return this.m_bodyCount},A.prototype.GetJointCount=function(){return this.m_jointCount},A.prototype.GetContactCount=function(){return this.m_contactCount},A.prototype.SetGravity=function(e){this.m_gravity=e},A.prototype.GetGravity=function(){return this.m_gravity},A.prototype.GetGroundBody=function(){return this.m_groundBody},A.prototype.Step=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.m_flags&A.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~A.e_newFixture),this.m_flags|=A.e_locked;var r=A.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,r.inv_dt=e>0?1/e:0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=A.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),A.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~A.e_locked},A.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},A.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags(),t,n,s;new r,new r,new r;var u;new o,new o,u=[new r,new r,new r,new r];var a=new i(0,0,0);if(e&S.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){u=t.m_xf;for(n=t.GetFixtureList();n;n=n.m_next)s=n.GetShape(),t.IsActive()==0?a.Set(.5,.5,.3):t.GetType()==m.b2_staticBody?a.Set(.5,.9,.5):t.GetType()==m.b2_kinematicBody?a.Set(.5,.5,.9):t.IsAwake()==0?a.Set(.6,.6,.6):a.Set(.9,.7,.7),this.DrawShape(s,u,a)}if(e&S.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(e&S.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(e&S.e_pairBit){a.Set(.3,.9,.9);for(t=this.m_contactManager.m_contactList;t;t=t.GetNext())s=t.GetFixtureA(),n=t.GetFixtureB(),s=s.GetAABB().GetCenter(),n=n.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(s,n,a)}if(e&S.e_aabbBit){s=this.m_contactManager.m_broadPhase,u=[new r,new r,new r,new r];for(t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=0)for(n=t.GetFixtureList();n;n=n.GetNext()){var f=s.GetFatAABB(n.m_proxy);u[0].Set(f.lowerBound.x,f.lowerBound.y),u[1].Set(f.upperBound.x,f.lowerBound.y),u[2].Set(f.upperBound.x,f.upperBound.y),u[3].Set(f.lowerBound.x,f.upperBound.y),this.m_debugDraw.DrawPolygon(u,4,a)}}if(e&S.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)u=A.s_xf,u.R=t.m_xf.R,u.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(u)}},A.prototype.QueryAABB=function(e,t){var n=this.m_contactManager.m_broadPhase;n.Query(function(t){return e(n.GetUserData(t))},t)},A.prototype.QueryShape=function(e,t,r){r===undefined&&(r=null),r==null&&(r=new n,r.SetIdentity());var i=this.m_contactManager.m_broadPhase,s=new o;t.ComputeAABB(s,r),i.Query(function(n){return n=i.GetUserData(n)instanceof N?i.GetUserData(n):null,v.TestOverlap(t,r,n.GetShape(),n.GetBody().GetTransform())?e(n):!0},s)},A.prototype.QueryPoint=function(e,t){var n=this.m_contactManager.m_broadPhase,r=new o;r.lowerBound.Set(t.x-s.b2_linearSlop,t.y-s.b2_linearSlop),r.upperBound.Set(t.x+s.b2_linearSlop,t.y+s.b2_linearSlop),n.Query(function(r){return r=n.GetUserData(r)instanceof N?n.GetUserData(r):null,r.TestPoint(t)?e(r):!0},r)},A.prototype.RayCast=function(e,t,n){var i=this.m_contactManager.m_broadPhase,s=new l,o=new f(t,n);i.RayCast(function(o,u){var a=i.GetUserData(u);a=a instanceof N?a:null;if(a.RayCast(s,o)){var f=s.fraction,l=new r((1-f)*t.x+f*n.x,(1-f)*t.y+f*n.y);return e(a,l,s.normal,f)}return o.maxFraction},o)},A.prototype.RayCastOne=function(e,t){var n;return this.RayCast(function(e,t,r,i){return i===undefined&&(i=0),n=e,i},e,t),n},A.prototype.RayCastAll=function(e,t){var n=new Vector;return this.RayCast(function(e){return n[n.length]=e,1},e,t),n},A.prototype.GetBodyList=function(){return this.m_bodyList},A.prototype.GetJointList=function(){return this.m_jointList},A.prototype.GetContactList=function(){return this.m_contactList},A.prototype.IsLocked=function(){return(this.m_flags&A.e_locked)>0},A.prototype.Solve=function(e){for(var t,n=this.m_controllerList;n;n=n.m_next)n.Step(e);n=this.m_island,n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~m.e_islandFlag;for(var r=this.m_contactList;r;r=r.m_next)r.m_flags&=~O.e_islandFlag;for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;parseInt(this.m_bodyCount),r=this.s_stack;for(var i=this.m_bodyList;i;i=i.m_next)if(!(i.m_flags&m.e_islandFlag)&&i.IsAwake()!=0&&i.IsActive()!=0&&i.GetType()!=m.b2_staticBody){n.Clear();var s=0;r[s++]=i;for(i.m_flags|=m.e_islandFlag;s>0;){t=r[--s],n.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()!=m.b2_staticBody){for(var o,u=t.m_contactList;u;u=u.next)u.contact.m_flags&O.e_islandFlag||u.contact.IsSensor()!=1&&u.contact.IsEnabled()!=0&&u.contact.IsTouching()!=0&&(n.AddContact(u.contact),u.contact.m_flags|=O.e_islandFlag,o=u.other,o.m_flags&m.e_islandFlag||(r[s++]=o,o.m_flags|=m.e_islandFlag));for(t=t.m_jointList;t;t=t.next)t.joint.m_islandFlag!=1&&(o=t.other,o.IsActive()!=0&&(n.AddJoint(t.joint),t.joint.m_islandFlag=!0,o.m_flags&m.e_islandFlag||(r[s++]=o,o.m_flags|=m.e_islandFlag)))}}n.Solve(e,this.m_gravity,this.m_allowSleep);for(s=0;s<n.m_bodyCount;++s)t=n.m_bodies[s],t.GetType()==m.b2_staticBody&&(t.m_flags&=~m.e_islandFlag)}for(s=0;s<r.length;++s){if(!r[s])break;r[s]=null}for(t=this.m_bodyList;t;t=t.m_next)t.IsAwake()==0||t.IsActive()==0||t.GetType()!=m.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},A.prototype.SolveTOI=function(e){var t,n,r,i=this.m_island;i.Initialize(this.m_bodyCount,s.b2_maxTOIContactsPerIsland,s.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var o=A.s_queue;for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~m.e_islandFlag,t.m_sweep.t0=0;for(r=this.m_contactList;r;r=r.m_next)r.m_flags&=~(O.e_toiFlag|O.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(;;){var u=null,a=1;for(r=this.m_contactList;r;r=r.m_next)if(r.IsSensor()!=1&&r.IsEnabled()!=0&&r.IsContinuous()!=0){t=1;if(r.m_flags&O.e_toiFlag)t=r.m_toi;else{t=r.m_fixtureA,n=r.m_fixtureB,t=t.m_body,n=n.m_body;if(!(t.GetType()==m.b2_dynamicBody&&t.IsAwake()!=0||n.GetType()==m.b2_dynamicBody&&n.IsAwake()!=0))continue;var f=t.m_sweep.t0;t.m_sweep.t0<n.m_sweep.t0?(f=n.m_sweep.t0,t.m_sweep.Advance(f)):n.m_sweep.t0<t.m_sweep.t0&&(f=t.m_sweep.t0,n.m_sweep.Advance(f)),t=r.ComputeTOI(t.m_sweep,n.m_sweep),s.b2Assert(0<=t&&t<=1),t>0&&t<1&&(t=(1-t)*f+t,t>1&&(t=1)),r.m_toi=t,r.m_flags|=O.e_toiFlag}Number.MIN_VALUE<t&&t<a&&(u=r,a=t)}if(u==null||1-100*Number.MIN_VALUE<a)break;t=u.m_fixtureA,n=u.m_fixtureB,t=t.m_body,n=n.m_body,A.s_backupA.Set(t.m_sweep),A.s_backupB.Set(n.m_sweep),t.Advance(a),n.Advance(a),u.Update(this.m_contactManager.m_contactListener),u.m_flags&=~O.e_toiFlag;if(u.IsSensor()==1||u.IsEnabled()==0)t.m_sweep.Set(A.s_backupA),n.m_sweep.Set(A.s_backupB),t.SynchronizeTransform(),n.SynchronizeTransform();else if(u.IsTouching()!=0){t=t,t.GetType()!=m.b2_dynamicBody&&(t=n),i.Clear(),u=r=0,o[r+u++]=t;for(t.m_flags|=m.e_islandFlag;u>0;){t=o[r++],--u,i.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()==m.b2_dynamicBody){for(n=t.m_contactList;n;n=n.next){if(i.m_contactCount==i.m_contactCapacity)break;n.contact.m_flags&O.e_islandFlag||n.contact.IsSensor()!=1&&n.contact.IsEnabled()!=0&&n.contact.IsTouching()!=0&&(i.AddContact(n.contact),n.contact.m_flags|=O.e_islandFlag,f=n.other,f.m_flags&m.e_islandFlag||(f.GetType()!=m.b2_staticBody&&(f.Advance(a),f.SetAwake(!0)),o[r+u]=f,++u,f.m_flags|=m.e_islandFlag))}for(t=t.m_jointList;t;t=t.next)i.m_jointCount!=i.m_jointCapacity&&t.joint.m_islandFlag!=1&&(f=t.other,f.IsActive()!=0&&(i.AddJoint(t.joint),t.joint.m_islandFlag=!0,f.m_flags&m.e_islandFlag||(f.GetType()!=m.b2_staticBody&&(f.Advance(a),f.SetAwake(!0)),o[r+u]=f,++u,f.m_flags|=m.e_islandFlag)))}}r=A.s_timestep,r.warmStarting=!1,r.dt=(1-a)*e.dt,r.inv_dt=1/r.dt,r.dtRatio=0,r.velocityIterations=e.velocityIterations,r.positionIterations=e.positionIterations,i.SolveTOI(r);for(a=a=0;a<i.m_bodyCount;++a){t=i.m_bodies[a],t.m_flags&=~m.e_islandFlag;if(t.IsAwake()!=0&&t.GetType()==m.b2_dynamicBody){t.SynchronizeFixtures();for(n=t.m_contactList;n;n=n.next)n.contact.m_flags&=~O.e_toiFlag}}for(a=0;a<i.m_contactCount;++a)r=i.m_contacts[a],r.m_flags&=~(O.e_toiFlag|O.e_islandFlag);for(a=0;a<i.m_jointCount;++a)r=i.m_joints[a],r.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},A.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf.position,i=n.m_xf.position,s=e.GetAnchorA(),o=e.GetAnchorB(),u=A.s_jointColor;switch(e.m_type){case D.e_distanceJoint:this.m_debugDraw.DrawSegment(s,o,u);break;case D.e_pulleyJoint:t=e instanceof P?e:null,e=t.GetGroundAnchorA(),t=t.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(e,s,u),this.m_debugDraw.DrawSegment(t,o,u),this.m_debugDraw.DrawSegment(e,t,u);break;case D.e_mouseJoint:this.m_debugDraw.DrawSegment(s,o,u);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,s,u),this.m_debugDraw.DrawSegment(s,o,u),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(i,o,u)}},A.prototype.DrawShape=function(t,n,r){switch(t.m_type){case v.e_circleShape:var i=t instanceof c?t:null;this.m_debugDraw.DrawSolidCircle(e.MulX(n,i.m_p),i.m_radius,n.R.col1,r);break;case v.e_polygonShape:i=0,i=t instanceof d?t:null,t=parseInt(i.GetVertexCount());var s=i.GetVertices(),o=new Vector(t);for(i=0;i<t;++i)o[i]=e.MulX(n,s[i]);this.m_debugDraw.DrawSolidPolygon(o,t,r);break;case v.e_edgeShape:i=t instanceof h?t:null,this.m_debugDraw.DrawSegment(e.MulX(n,i.GetVertex1()),e.MulX(n,i.GetVertex2()),r)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new L,Box2D.Dynamics.b2World.s_xf=new n,Box2D.Dynamics.b2World.s_backupA=new t,Box2D.Dynamics.b2World.s_backupB=new t,Box2D.Dynamics.b2World.s_timestep=new L,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new i(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2Shape,i=Box2D.Dynamics.Contacts.b2CircleContact,s=Box2D.Dynamics.Contacts.b2Contact,o=Box2D.Dynamics.Contacts.b2ContactConstraint,u=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,a=Box2D.Dynamics.Contacts.b2ContactEdge,f=Box2D.Dynamics.Contacts.b2ContactFactory,l=Box2D.Dynamics.Contacts.b2ContactRegister,c=Box2D.Dynamics.Contacts.b2ContactResult,h=Box2D.Dynamics.Contacts.b2ContactSolver,p=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,d=Box2D.Dynamics.Contacts.b2NullContact,v=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,m=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,g=Box2D.Dynamics.Contacts.b2PolygonContact,y=Box2D.Dynamics.Contacts.b2PositionSolverManifold,b=Box2D.Dynamics.b2Body,w=Box2D.Dynamics.b2TimeStep,E=Box2D.Common.b2Settings,S=Box2D.Common.Math.b2Mat22,x=Box2D.Common.Math.b2Math,T=Box2D.Common.Math.b2Vec2,N=Box2D.Collision.b2Collision,C=Box2D.Collision.b2ContactID,k=Box2D.Collision.b2Manifold,L=Box2D.Collision.b2TimeOfImpact,A=Box2D.Collision.b2TOIInput,O=Box2D.Collision.b2WorldManifold;Box2D.inherit(i,Box2D.Dynamics.Contacts.b2Contact),i.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,i.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},i.Create=function(){return new i},i.Destroy=function(){},i.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},i.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();N.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)},s.b2Contact=function(){this.m_nodeA=new a,this.m_nodeB=new a,this.m_manifold=new k,this.m_oldManifold=new k},s.prototype.GetManifold=function(){return this.m_manifold},s.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag},s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag},s.prototype.SetSensor=function(e){e?this.m_flags|=s.e_sensorFlag:this.m_flags&=~s.e_sensorFlag},s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag},s.prototype.SetEnabled=function(e){e?this.m_flags|=s.e_enabledFlag:this.m_flags&=~s.e_enabledFlag},s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag},s.prototype.GetNext=function(){return this.m_next},s.prototype.GetFixtureA=function(){return this.m_fixtureA},s.prototype.GetFixtureB=function(){return this.m_fixtureB},s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag},s.prototype.b2Contact=function(){},s.prototype.Reset=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),this.m_flags=s.e_enabledFlag;if(!e||!t)this.m_fixtureB=this.m_fixtureA=null;else{if(e.IsSensor()||t.IsSensor())this.m_flags|=s.e_sensorFlag;var n=e.GetBody(),r=t.GetBody();if(n.GetType()!=b.b2_dynamicBody||n.IsBullet()||r.GetType()!=b.b2_dynamicBody||r.IsBullet())this.m_flags|=s.e_continuousFlag;this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}},s.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=s.e_enabledFlag;var n=!1;t=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag;var i=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body,u=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag)u&&(n=this.m_fixtureA.GetShape(),u=this.m_fixtureB.GetShape(),i=i.GetTransform(),o=o.GetTransform(),n=r.TestOverlap(n,i,u,o)),this.m_manifold.m_pointCount=0;else{i.GetType()!=b.b2_dynamicBody||i.IsBullet()||o.GetType()!=b.b2_dynamicBody||o.IsBullet()?this.m_flags|=s.e_continuousFlag:this.m_flags&=~s.e_continuousFlag;if(u){this.Evaluate(),n=this.m_manifold.m_pointCount>0;for(u=0;u<this.m_manifold.m_pointCount;++u){var a=this.m_manifold.m_points[u];a.m_normalImpulse=0,a.m_tangentImpulse=0;for(var f=a.m_id,l=0;l<this.m_oldManifold.m_pointCount;++l){var c=this.m_oldManifold.m_points[l];if(c.m_id.key==f.key){a.m_normalImpulse=c.m_normalImpulse,a.m_tangentImpulse=c.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;n!=t&&(i.SetAwake(!0),o.SetAwake(!0))}n?this.m_flags|=s.e_touchingFlag:this.m_flags&=~s.e_touchingFlag,t==0&&n==1&&e.BeginContact(this),t==1&&n==0&&e.EndContact(this),(this.m_flags&s.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)},s.prototype.Evaluate=function(){},s.prototype.ComputeTOI=function(e,t){return s.s_input.proxyA.Set(this.m_fixtureA.GetShape()),s.s_input.proxyB.Set(this.m_fixtureB.GetShape()),s.s_input.sweepA=e,s.s_input.sweepB=t,s.s_input.tolerance=E.b2_linearSlop,L.TimeOfImpact(s.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new A}),o.b2ContactConstraint=function(){this.localPlaneNormal=new T,this.localPoint=new T,this.normal=new T,this.normalMass=new S,this.K=new S},o.prototype.b2ContactConstraint=function(){this.points=new Vector(E.b2_maxManifoldPoints);for(var e=0;e<E.b2_maxManifoldPoints;e++)this.points[e]=new u},u.b2ContactConstraintPoint=function(){this.localPoint=new T,this.rA=new T,this.rB=new T},a.b2ContactEdge=function(){},f.b2ContactFactory=function(){},f.prototype.b2ContactFactory=function(e){this.m_allocator=e,this.InitializeRegisters()},f.prototype.AddType=function(e,t,n,r){n===undefined&&(n=0),r===undefined&&(r=0),this.m_registers[n][r].createFcn=e,this.m_registers[n][r].destroyFcn=t,this.m_registers[n][r].primary=!0,n!=r&&(this.m_registers[r][n].createFcn=e,this.m_registers[r][n].destroyFcn=t,this.m_registers[r][n].primary=!1)},f.prototype.InitializeRegisters=function(){this.m_registers=new Vector(r.e_shapeTypeCount);for(var e=0;e<r.e_shapeTypeCount;e++){this.m_registers[e]=new Vector(r.e_shapeTypeCount);for(var t=0;t<r.e_shapeTypeCount;t++)this.m_registers[e][t]=new l}this.AddType(i.Create,i.Destroy,r.e_circleShape,r.e_circleShape),this.AddType(v.Create,v.Destroy,r.e_polygonShape,r.e_circleShape),this.AddType(g.Create,g.Destroy,r.e_polygonShape,r.e_polygonShape),this.AddType(p.Create,p.Destroy,r.e_edgeShape,r.e_circleShape),this.AddType(m.Create,m.Destroy,r.e_polygonShape,r.e_edgeShape)},f.prototype.Create=function(e,t){var n=parseInt(e.GetType()),r=parseInt(t.GetType());return n=this.m_registers[n][r],n.pool?(r=n.pool,n.pool=r.m_next,n.poolCount--,r.Reset(e,t),r):(r=n.createFcn,r!=null?(n.primary?(r=r(this.m_allocator),r.Reset(e,t)):(r=r(this.m_allocator),r.Reset(t,e)),r):null)},f.prototype.Destroy=function(e){e.m_manifold.m_pointCount>0&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=parseInt(e.m_fixtureA.GetType()),n=parseInt(e.m_fixtureB.GetType());t=this.m_registers[t][n],t.poolCount++,e.m_next=t.pool,t.pool=e,t=t.destroyFcn,t(e,this.m_allocator)},l.b2ContactRegister=function(){},c.b2ContactResult=function(){this.position=new T,this.normal=new T,this.id=new C},h.b2ContactSolver=function(){this.m_step=new w,this.m_constraints=new Vector},h.prototype.b2ContactSolver=function(){},h.prototype.Initialize=function(e,t,n,r){n===undefined&&(n=0);var i;this.m_step.Set(e),this.m_allocator=r,e=0;for(this.m_constraintCount=n;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new o;for(e=0;e<n;++e){i=t[e],r=i.m_fixtureA;var s=i.m_fixtureB,u=r.m_shape.m_radius,a=s.m_shape.m_radius,f=r.m_body,l=s.m_body,c=i.GetManifold(),p=E.b2MixFriction(r.GetFriction(),s.GetFriction()),d=E.b2MixRestitution(r.GetRestitution(),s.GetRestitution()),v=f.m_linearVelocity.x,m=f.m_linearVelocity.y,g=l.m_linearVelocity.x,y=l.m_linearVelocity.y,b=f.m_angularVelocity,w=l.m_angularVelocity;E.b2Assert(c.m_pointCount>0),h.s_worldManifold.Initialize(c,f.m_xf,u,l.m_xf,a),s=h.s_worldManifold.m_normal.x,i=h.s_worldManifold.m_normal.y,r=this.m_constraints[e],r.bodyA=f,r.bodyB=l,r.manifold=c,r.normal.x=s,r.normal.y=i,r.pointCount=c.m_pointCount,r.friction=p,r.restitution=d,r.localPlaneNormal.x=c.m_localPlaneNormal.x,r.localPlaneNormal.y=c.m_localPlaneNormal.y,r.localPoint.x=c.m_localPoint.x,r.localPoint.y=c.m_localPoint.y,r.radius=u+a,r.type=c.m_type;for(u=0;u<r.pointCount;++u){p=c.m_points[u],a=r.points[u],a.normalImpulse=p.m_normalImpulse,a.tangentImpulse=p.m_tangentImpulse,a.localPoint.SetV(p.m_localPoint),p=a.rA.x=h.s_worldManifold.m_points[u].x-f.m_sweep.c.x,d=a.rA.y=h.s_worldManifold.m_points[u].y-f.m_sweep.c.y;var S=a.rB.x=h.s_worldManifold.m_points[u].x-l.m_sweep.c.x,x=a.rB.y=h.s_worldManifold.m_points[u].y-l.m_sweep.c.y,T=p*i-d*s,N=S*i-x*s;T*=T,N*=N,a.normalMass=1/(f.m_invMass+l.m_invMass+f.m_invI*T+l.m_invI*N);var C=f.m_mass*f.m_invMass+l.m_mass*l.m_invMass;C+=f.m_mass*f.m_invI*T+l.m_mass*l.m_invI*N,a.equalizedMass=1/C,N=i,C=-s,T=p*C-d*N,N=S*C-x*N,T*=T,N*=N,a.tangentMass=1/(f.m_invMass+l.m_invMass+f.m_invI*T+l.m_invI*N),a.velocityBias=0,p=r.normal.x*(g+ -w*x-v- -b*d)+r.normal.y*(y+w*S-m-b*p),p<-E.b2_velocityThreshold&&(a.velocityBias+=-r.restitution*p)}r.pointCount==2&&(y=r.points[0],g=r.points[1],c=f.m_invMass,f=f.m_invI,v=l.m_invMass,l=l.m_invI,m=y.rA.x*i-y.rA.y*s,y=y.rB.x*i-y.rB.y*s,b=g.rA.x*i-g.rA.y*s,g=g.rB.x*i-g.rB.y*s,s=c+v+f*m*m+l*y*y,i=c+v+f*b*b+l*g*g,l=c+v+f*m*b+l*y*g,s*s<100*(s*i-l*l)?(r.K.col1.Set(s,l),r.K.col2.Set(l,i),r.K.GetInverse(r.normalMass)):r.pointCount=1)}},h.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var n=this.m_constraints[t],r=n.bodyA,i=n.bodyB,s=r.m_invMass,o=r.m_invI,u=i.m_invMass,a=i.m_invI,f=n.normal.x,l=n.normal.y,c=l,h=-f,p=0,d=0;if(e.warmStarting){d=n.pointCount;for(p=0;p<d;++p){var v=n.points[p];v.normalImpulse*=e.dtRatio,v.tangentImpulse*=e.dtRatio;var m=v.normalImpulse*f+v.tangentImpulse*c,g=v.normalImpulse*l+v.tangentImpulse*h;r.m_angularVelocity-=o*(v.rA.x*g-v.rA.y*m),r.m_linearVelocity.x-=s*m,r.m_linearVelocity.y-=s*g,i.m_angularVelocity+=a*(v.rB.x*g-v.rB.y*m),i.m_linearVelocity.x+=u*m,i.m_linearVelocity.y+=u*g}}else{d=n.pointCount;for(p=0;p<d;++p)r=n.points[p],r.normalImpulse=0,r.tangentImpulse=0}}},h.prototype.SolveVelocityConstraints=function(){for(var e=0,t,n=0,r=0,i=0,s=r=r=n=n=0,o=n=n=0,u=n=i=0,a=0,f,l=0;l<this.m_constraintCount;++l){i=this.m_constraints[l];var c=i.bodyA,h=i.bodyB,p=c.m_angularVelocity,d=h.m_angularVelocity,v=c.m_linearVelocity,m=h.m_linearVelocity,g=c.m_invMass,y=c.m_invI,b=h.m_invMass,w=h.m_invI;u=i.normal.x;var E=a=i.normal.y;f=-u,o=i.friction;for(e=0;e<i.pointCount;e++)t=i.points[e],n=m.x-d*t.rB.y-v.x+p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,n=n*E+r*f,n=t.tangentMass*-n,r=o*t.normalImpulse,r=x.Clamp(t.tangentImpulse+n,-r,r),n=r-t.tangentImpulse,s=n*E,n*=f,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.tangentImpulse=r;parseInt(i.pointCount);if(i.pointCount==1)t=i.points[0],n=m.x+ -d*t.rB.y-v.x- -p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,i=n*u+r*a,n=-t.normalMass*(i-t.velocityBias),r=t.normalImpulse+n,r=r>0?r:0,n=r-t.normalImpulse,s=n*u,n*=a,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.normalImpulse=r;else{t=i.points[0],e=i.points[1],n=t.normalImpulse,o=e.normalImpulse;var S=(m.x-d*t.rB.y-v.x+p*t.rA.y)*u+(m.y+d*t.rB.x-v.y-p*t.rA.x)*a,T=(m.x-d*e.rB.y-v.x+p*e.rA.y)*u+(m.y+d*e.rB.x-v.y-p*e.rA.x)*a;r=S-t.velocityBias,s=T-e.velocityBias,f=i.K,r-=f.col1.x*n+f.col2.x*o;for(s-=f.col1.y*n+f.col2.y*o;;){f=i.normalMass,E=-(f.col1.x*r+f.col2.x*s),f=-(f.col1.y*r+f.col2.y*s);if(E>=0&&f>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=-t.normalMass*r,f=0,T=i.K.col1.y*E+s;if(E>=0&&T>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=0,f=-e.normalMass*s,S=i.K.col2.x*f+r;if(f>=0&&S>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}f=E=0,S=r,T=s;if(S>=0&&T>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}break}}c.m_angularVelocity=p,h.m_angularVelocity=d}},h.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],n=t.manifold,r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}},h.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);for(var t=0,n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;h.s_psm.Initialize(r);for(var l=h.s_psm.m_normal,c=0;c<r.pointCount;c++){var p=r.points[c],d=h.s_psm.m_points[c],v=h.s_psm.m_separations[c],m=d.x-i.m_sweep.c.x,g=d.y-i.m_sweep.c.y,y=d.x-s.m_sweep.c.x;d=d.y-s.m_sweep.c.y,t=t<v?t:v,v=x.Clamp(e*(v+E.b2_linearSlop),-E.b2_maxLinearCorrection,0),v=-p.equalizedMass*v,p=v*l.x,v*=l.y,i.m_sweep.c.x-=o*p,i.m_sweep.c.y-=o*v,i.m_sweep.a-=u*(m*v-g*p),i.SynchronizeTransform(),s.m_sweep.c.x+=a*p,s.m_sweep.c.y+=a*v,s.m_sweep.a+=f*(y*v-d*p),s.SynchronizeTransform()}}return t>-1.5*E.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new O,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new y}),Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact),p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,p.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(){return new p},p.Destroy=function(){},p.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},p.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)},p.prototype.b2CollideEdgeAndCircle=function(){},Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact),d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,d.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},d.prototype.Evaluate=function(){},Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact),v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,v.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},v.Create=function(){return new v},v.Destroy=function(){},v.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),E.b2Assert(e.GetType()==r.e_polygonShape),E.b2Assert(t.GetType()==r.e_circleShape)},v.prototype.Evaluate=function(){var t=this.m_fixtureA.m_body,r=this.m_fixtureB.m_body;N.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)},Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact),m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,m.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.Create=function(){return new m},m.Destroy=function(){},m.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),E.b2Assert(e.GetType()==r.e_polygonShape),E.b2Assert(t.GetType()==r.e_edgeShape)},m.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,r.m_xf)},m.prototype.b2CollidePolyAndEdge=function(){},Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact),g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,g.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},g.Create=function(){return new g},g.Destroy=function(){},g.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},g.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();N.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,t.m_xf)},y.b2PositionSolverManifold=function(){},y.prototype.b2PositionSolverManifold=function(){this.m_normal=new T,this.m_separations=new Vector_a2j_Number(E.b2_maxManifoldPoints),this.m_points=new Vector(E.b2_maxManifoldPoints);for(var e=0;e<E.b2_maxManifoldPoints;e++)this.m_points[e]=new T},y.prototype.Initialize=function(e){E.b2Assert(e.pointCount>0);var t=0,n=0,r=0,i,s=0,o=0;switch(e.type){case k.e_circles:i=e.bodyA.m_xf.R,r=e.localPoint,t=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),n=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R,r=e.points[0].localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),i=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),r=s-t,o=i-n;var u=r*r+o*o;u>Number.MIN_VALUE*Number.MIN_VALUE?(u=Math.sqrt(u),this.m_normal.x=r/u,this.m_normal.y=o/u):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(t+s),this.m_points[0].y=.5*(n+i),this.m_separations[0]=r*this.m_normal.x+o*this.m_normal.y-e.radius;break;case k.e_faceA:i=e.bodyA.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyA.m_xf.R,r=e.localPoint,s=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].x=n,this.m_points[t].y=r;break;case k.e_faceB:i=e.bodyB.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyB.m_xf.R,r=e.localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new T,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new T})}(),function(){var e=Box2D.Common.Math.b2Mat22,t=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Vec2,r=Box2D.Common.b2Color,i=Box2D.Dynamics.Controllers.b2BuoyancyController,s=Box2D.Dynamics.Controllers.b2ConstantAccelController,o=Box2D.Dynamics.Controllers.b2ConstantForceController,u=Box2D.Dynamics.Controllers.b2Controller,a=Box2D.Dynamics.Controllers.b2ControllerEdge,f=Box2D.Dynamics.Controllers.b2GravityController,l=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(i,Box2D.Dynamics.Controllers.b2Controller),i.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,i.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new n(0,-1),this.density=this.offset=0,this.velocity=new n(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},i.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;if(t.IsAwake()!=0){for(var r=new n,i=new n,s=0,o=0,u=t.GetFixtureList();u;u=u.GetNext()){var a=new n,f=u.GetShape().ComputeSubmergedArea(this.normal,this.offset,t.GetTransform(),a);s+=f,r.x+=f*a.x,r.y+=f*a.y;var l=0;l=1,o+=f*l,i.x+=f*a.x*l,i.y+=f*a.y*l}r.x/=s,r.y/=s,i.x/=o,i.y/=o,s<Number.MIN_VALUE||(o=this.gravity.GetNegative(),o.Multiply(this.density*s),t.ApplyForce(o,i),i=t.GetLinearVelocityFromWorldPoint(r),i.Subtract(this.velocity),i.Multiply(-this.linearDrag*s),t.ApplyForce(i,r),t.ApplyTorque(-t.GetInertia()/t.GetMass()*s*t.GetAngularVelocity()*this.angularDrag))}}}},i.prototype.Draw=function(e){var t=new n,i=new n;t.x=this.normal.x*this.offset+this.normal.y*1e3,t.y=this.normal.y*this.offset-this.normal.x*1e3,i.x=this.normal.x*this.offset-this.normal.y*1e3,i.y=this.normal.y*this.offset+this.normal.x*1e3;var s=new r(0,0,1);e.DrawSegment(t,i,s)},Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller),s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new n(0,0)},s.prototype.Step=function(e){e=new n(this.A.x*e.dt,this.A.y*e.dt);for(var t=this.m_bodyList;t;t=t.nextBody){var r=t.body;r.IsAwake()&&r.SetLinearVelocity(new n(r.GetLinearVelocity().x+e.x,r.GetLinearVelocity().y+e.y))}},Box2D.inherit(o,Box2D.Dynamics.Controllers.b2Controller),o.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,o.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new n(0,0)},o.prototype.Step=function(){for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}},u.b2Controller=function(){},u.prototype.Step=function(){},u.prototype.Draw=function(){},u.prototype.AddBody=function(e){var t=new a;t.controller=this,t.body=e,t.nextBody=this.m_bodyList,t.prevBody=null,this.m_bodyList=t,t.nextBody&&(t.nextBody.prevBody=t),this.m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList=t,t.nextController&&(t.nextController.prevController=t),e.m_controllerCount++},u.prototype.RemoveBody=function(e){for(var t=e.m_controllerList;t&&t.controller!=this;)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),this.m_bodyList==t&&(this.m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,this.m_bodyCount--},u.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},u.prototype.GetNext=function(){return this.m_next},u.prototype.GetWorld=function(){return this.m_world},u.prototype.GetBodyList=function(){return this.m_bodyList},a.b2ControllerEdge=function(){},Box2D.inherit(f,Box2D.Dynamics.Controllers.b2Controller),f.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,f.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},f.prototype.Step=function(){var e=null,t=null,r=null,i=0,s=null,o=null,u=null,a=0,f=0,l=0;a=null;if(this.invSqr)for(e=this.m_bodyList;e;e=e.nextBody){t=e.body,r=t.GetWorldCenter(),i=t.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody)o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f,l<Number.MIN_VALUE||(a=new n(a,f),a.Multiply(this.G/l/Math.sqrt(l)*i*o.GetMass()),t.IsAwake()&&t.ApplyForce(a,r),a.Multiply(-1),o.IsAwake()&&o.ApplyForce(a,u))}else for(e=this.m_bodyList;e;e=e.nextBody){t=e.body,r=t.GetWorldCenter(),i=t.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody)o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f,l<Number.MIN_VALUE||(a=new n(a,f),a.Multiply(this.G/l*i*o.GetMass()),t.IsAwake()&&t.ApplyForce(a,r),a.Multiply(-1),o.IsAwake()&&o.ApplyForce(a,u))}},Box2D.inherit(l,Box2D.Dynamics.Controllers.b2Controller),l.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,l.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new e,this.maxTimestep=0},l.prototype.SetAxisAligned=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,this.maxTimestep=e>0||t>0?1/Math.max(e,t):0},l.prototype.Step=function(e){e=e.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var r=this.m_bodyList;r;r=r.nextBody){var i=r.body;if(i.IsAwake()){var s=i.GetWorldVector(t.MulMV(this.T,i.GetLocalVector(i.GetLinearVelocity())));i.SetLinearVelocity(new n(i.GetLinearVelocity().x+s.x*e,i.GetLinearVelocity().y+s.y*e))}}}}}(),function(){var e=Box2D.Common.b2Settings,t=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3,o=Box2D.Dynamics.Joints.b2DistanceJoint,u=Box2D.Dynamics.Joints.b2DistanceJointDef,a=Box2D.Dynamics.Joints.b2FrictionJoint,f=Box2D.Dynamics.Joints.b2FrictionJointDef,l=Box2D.Dynamics.Joints.b2GearJoint,c=Box2D.Dynamics.Joints.b2GearJointDef,h=Box2D.Dynamics.Joints.b2Jacobian,p=Box2D.Dynamics.Joints.b2Joint,d=Box2D.Dynamics.Joints.b2JointDef,v=Box2D.Dynamics.Joints.b2JointEdge,m=Box2D.Dynamics.Joints.b2LineJoint,g=Box2D.Dynamics.Joints.b2LineJointDef,y=Box2D.Dynamics.Joints.b2MouseJoint,b=Box2D.Dynamics.Joints.b2MouseJointDef,w=Box2D.Dynamics.Joints.b2PrismaticJoint,E=Box2D.Dynamics.Joints.b2PrismaticJointDef,S=Box2D.Dynamics.Joints.b2PulleyJoint,x=Box2D.Dynamics.Joints.b2PulleyJointDef,T=Box2D.Dynamics.Joints.b2RevoluteJoint,N=Box2D.Dynamics.Joints.b2RevoluteJointDef,C=Box2D.Dynamics.Joints.b2WeldJoint,k=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.inherit(o,Box2D.Dynamics.Joints.b2Joint),o.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,o.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_u=new i},o.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},o.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},o.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},o.prototype.GetReactionTorque=function(){return 0},o.prototype.GetLength=function(){return this.m_length},o.prototype.SetLength=function(e){e===undefined&&(e=0),this.m_length=e},o.prototype.GetFrequency=function(){return this.m_frequencyHz},o.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},o.prototype.GetDampingRatio=function(){return this.m_dampingRatio},o.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},o.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},o.prototype.InitVelocityConstraints=function(t){var n,r=0,i=this.m_bodyA,s=this.m_bodyB;n=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,u=this.m_localAnchor1.y-i.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=r,n=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,f=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*f,f=n.col1.y*a+n.col2.y*f,a=r,this.m_u.x=s.m_sweep.c.x+a-i.m_sweep.c.x-o,this.m_u.y=s.m_sweep.c.y+f-i.m_sweep.c.y-u,r=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),r>e.b2_linearSlop?this.m_u.Multiply(1/r):this.m_u.SetZero(),n=o*this.m_u.y-u*this.m_u.x;var l=a*this.m_u.y-f*this.m_u.x;n=i.m_invMass+i.m_invI*n*n+s.m_invMass+s.m_invI*l*l,this.m_mass=n!=0?1/n:0;if(this.m_frequencyHz>0){r-=this.m_length,l=2*Math.PI*this.m_frequencyHz;var c=this.m_mass*l*l;this.m_gamma=t.dt*(2*this.m_mass*this.m_dampingRatio*l+t.dt*c),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=r*t.dt*c*this.m_gamma,this.m_mass=n+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}t.warmStarting?(this.m_impulse*=t.dtRatio,t=this.m_impulse*this.m_u.x,n=this.m_impulse*this.m_u.y,i.m_linearVelocity.x-=i.m_invMass*t,i.m_linearVelocity.y-=i.m_invMass*n,i.m_angularVelocity-=i.m_invI*(o*n-u*t),s.m_linearVelocity.x+=s.m_invMass*t,s.m_linearVelocity.y+=s.m_invMass*n,s.m_angularVelocity+=s.m_invI*(a*n-f*t)):this.m_impulse=0},o.prototype.SolveVelocityConstraints=function(){var e,t=this.m_bodyA,n=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=-this.m_mass*(this.m_u.x*(n.m_linearVelocity.x+ -n.m_angularVelocity*u-(t.m_linearVelocity.x+ -t.m_angularVelocity*i))+this.m_u.y*(n.m_linearVelocity.y+n.m_angularVelocity*o-(t.m_linearVelocity.y+t.m_angularVelocity*r))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=s,e=s*this.m_u.x,s*=this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*e,t.m_linearVelocity.y-=t.m_invMass*s,t.m_angularVelocity-=t.m_invI*(r*s-i*e),n.m_linearVelocity.x+=n.m_invMass*e,n.m_linearVelocity.y+=n.m_invMass*s,n.m_angularVelocity+=n.m_invI*(o*s-u*e)},o.prototype.SolvePositionConstraints=function(){var t;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,i=this.m_bodyB;t=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=t.col1.x*s+t.col2.x*o;o=t.col1.y*s+t.col2.y*o,s=u,t=i.m_xf.R;var a=this.m_localAnchor2.x-i.m_sweep.localCenter.x,f=this.m_localAnchor2.y-i.m_sweep.localCenter.y;u=t.col1.x*a+t.col2.x*f,f=t.col1.y*a+t.col2.y*f,a=u,u=i.m_sweep.c.x+a-n.m_sweep.c.x-s;var l=i.m_sweep.c.y+f-n.m_sweep.c.y-o;t=Math.sqrt(u*u+l*l),u/=t,l/=t,t-=this.m_length,t=r.Clamp(t,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection);var c=-this.m_mass*t;return this.m_u.Set(u,l),u=c*this.m_u.x,l=c*this.m_u.y,n.m_sweep.c.x-=n.m_invMass*u,n.m_sweep.c.y-=n.m_invMass*l,n.m_sweep.a-=n.m_invI*(s*l-o*u),i.m_sweep.c.x+=i.m_invMass*u,i.m_sweep.c.y+=i.m_invMass*l,i.m_sweep.a+=i.m_invI*(a*l-f*u),n.SynchronizeTransform(),i.SynchronizeTransform(),r.Abs(t)<e.b2_linearSlop},Box2D.inherit(u,Box2D.Dynamics.Joints.b2JointDef),u.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,u.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},u.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},u.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r)),e=r.x-n.x,n=r.y-n.y,this.length=Math.sqrt(e*e+n*n),this.dampingRatio=this.frequencyHz=0},Box2D.inherit(a,Box2D.Dynamics.Joints.b2Joint),a.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,a.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new i,this.m_localAnchorB=new i,this.m_linearMass=new t,this.m_linearImpulse=new i},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},a.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},a.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_angularImpulse},a.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},a.prototype.GetMaxForce=function(){return this.m_maxForce},a.prototype.SetMaxTorque=function(e){e===undefined&&(e=0),this.m_maxTorque=e},a.prototype.GetMaxTorque=function(){return this.m_maxTorque},a.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},a.prototype.InitVelocityConstraints=function(e){var n,r=0,i=this.m_bodyA,s=this.m_bodyB;n=i.m_xf.R;var o=this.m_localAnchorA.x-i.m_sweep.localCenter.x,u=this.m_localAnchorA.y-i.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=r,n=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,f=this.m_localAnchorB.y-s.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*f,f=n.col1.y*a+n.col2.y*f,a=r,n=i.m_invMass,r=s.m_invMass;var l=i.m_invI,c=s.m_invI,h=new t;h.col1.x=n+r,h.col2.x=0,h.col1.y=0,h.col2.y=n+r,h.col1.x+=l*u*u,h.col2.x+=-l*o*u,h.col1.y+=-l*o*u,h.col2.y+=l*o*o,h.col1.x+=c*f*f,h.col2.x+=-c*a*f,h.col1.y+=-c*a*f,h.col2.y+=c*a*a,h.GetInverse(this.m_linearMass),this.m_angularMass=l+c,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting?(this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio,e=this.m_linearImpulse,i.m_linearVelocity.x-=n*e.x,i.m_linearVelocity.y-=n*e.y,i.m_angularVelocity-=l*(o*e.y-u*e.x+this.m_angularImpulse),s.m_linearVelocity.x+=r*e.x,s.m_linearVelocity.y+=r*e.y,s.m_angularVelocity+=c*(a*e.y-f*e.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},a.prototype.SolveVelocityConstraints=function(e){var t,n=0,s=this.m_bodyA,o=this.m_bodyB,u=s.m_linearVelocity,a=s.m_angularVelocity,f=o.m_linearVelocity,l=o.m_angularVelocity,c=s.m_invMass,h=o.m_invMass,p=s.m_invI,d=o.m_invI;t=s.m_xf.R;var v=this.m_localAnchorA.x-s.m_sweep.localCenter.x,m=this.m_localAnchorA.y-s.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n,t=o.m_xf.R;var g=this.m_localAnchorB.x-o.m_sweep.localCenter.x,y=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=t.col1.x*g+t.col2.x*y,y=t.col1.y*g+t.col2.y*y,g=n,t=0,n=-this.m_angularMass*(l-a);var b=this.m_angularImpulse;t=e.dt*this.m_maxTorque,this.m_angularImpulse=r.Clamp(this.m_angularImpulse+n,-t,t),n=this.m_angularImpulse-b,a-=p*n,l+=d*n,t=r.MulMV(this.m_linearMass,new i(-(f.x-l*y-u.x+a*m),-(f.y+l*g-u.y-a*v))),n=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(t),t=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),t=r.SubtractVV(this.m_linearImpulse,n),u.x-=c*t.x,u.y-=c*t.y,a-=p*(v*t.y-m*t.x),f.x+=h*t.x,f.y+=h*t.y,l+=d*(g*t.y-y*t.x),s.m_angularVelocity=a,o.m_angularVelocity=l},a.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef),f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,f.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},f.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_frictionJoint,this.maxTorque=this.maxForce=0},f.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new i,this.m_groundAnchor2=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_J=new h},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},l.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},l.prototype.GetReactionTorque=function(e){e===undefined&&(e=0);var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r;return r=t.col1.y*n+t.col2.y*r,n=i,e*(this.m_impulse*this.m_J.angularB-n*this.m_impulse*this.m_J.linearB.y+r*this.m_impulse*this.m_J.linearB.x)},l.prototype.GetRatio=function(){return this.m_ratio},l.prototype.SetRatio=function(e){e===undefined&&(e=0),this.m_ratio=e},l.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type),n=parseInt(e.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var r=0,i=0;this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==p.e_revoluteJoint?(this.m_revolute1=e.joint1 instanceof T?e.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),r=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1 instanceof w?e.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),r=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==p.e_revoluteJoint?(this.m_revolute2=e.joint2 instanceof T?e.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),i=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2 instanceof w?e.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),i=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=r+this.m_ratio*i,this.m_impulse=0},l.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s=0,o=0,u=0,a=0,f=u=0,l=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,l+=r.m_invI):(t=t.m_xf.R,o=this.m_prismatic1.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=r.m_xf.R,u=this.m_localAnchor1.x-r.m_sweep.localCenter.x,a=this.m_localAnchor1.y-r.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f,u=u*o-a*s,this.m_J.linearA.Set(-s,-o),this.m_J.angularA=-u,l+=r.m_invMass+r.m_invI*u*u),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*i.m_invI):(t=n.m_xf.R,o=this.m_prismatic2.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=i.m_xf.R,u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f,u=u*o-a*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*o),this.m_J.angularB=-this.m_ratio*u,l+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*u*u)),this.m_mass=l>0?1/l:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},l.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity);this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularA,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularB},l.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,n=this.m_bodyB,r=0,i=0;return r=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),i=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),r=-this.m_mass*(this.m_constant-(r+this.m_ratio*i)),t.m_sweep.c.x+=t.m_invMass*r*this.m_J.linearA.x,t.m_sweep.c.y+=t.m_invMass*r*this.m_J.linearA.y,t.m_sweep.a+=t.m_invI*r*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*r*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*r*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*r*this.m_J.angularB,t.SynchronizeTransform(),n.SynchronizeTransform(),0<e.b2_linearSlop},Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef),c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,c.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},c.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},h.b2Jacobian=function(){this.linearA=new i,this.linearB=new i},h.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},h.prototype.Set=function(e,t,n,r){t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},h.prototype.Compute=function(e,t,n,r){return t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},p.b2Joint=function(){this.m_edgeA=new v,this.m_edgeB=new v,this.m_localCenterA=new i,this.m_localCenterB=new i},p.prototype.GetType=function(){return this.m_type},p.prototype.GetAnchorA=function(){return null},p.prototype.GetAnchorB=function(){return null},p.prototype.GetReactionForce=function(){return null},p.prototype.GetReactionTorque=function(){return 0},p.prototype.GetBodyA=function(){return this.m_bodyA},p.prototype.GetBodyB=function(){return this.m_bodyB},p.prototype.GetNext=function(){return this.m_next},p.prototype.GetUserData=function(){return this.m_userData},p.prototype.SetUserData=function(e){this.m_userData=e},p.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},p.Create=function(e){var t=null;switch(e.type){case p.e_distanceJoint:t=new o(e instanceof u?e:null);break;case p.e_mouseJoint:t=new y(e instanceof b?e:null);break;case p.e_prismaticJoint:t=new w(e instanceof E?e:null);break;case p.e_revoluteJoint:t=new T(e instanceof N?e:null);break;case p.e_pulleyJoint:t=new S(e instanceof x?e:null);break;case p.e_gearJoint:t=new l(e instanceof c?e:null);break;case p.e_lineJoint:t=new m(e instanceof g?e:null);break;case p.e_weldJoint:t=new C(e instanceof k?e:null);break;case p.e_frictionJoint:t=new a(e instanceof f?e:null)}return t},p.Destroy=function(){},p.prototype.b2Joint=function(t){e.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_next=this.m_prev=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData},p.prototype.InitVelocityConstraints=function(){},p.prototype.SolveVelocityConstraints=function(){},p.prototype.FinalizeVelocityConstraints=function(){},p.prototype.SolvePositionConstraints=function(){return!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),d.b2JointDef=function(){},d.prototype.b2JointDef=function(){this.type=p.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},v.b2JointEdge=function(){},Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint),m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,m.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_localXAxis1=new i,this.m_localYAxis1=new i,this.m_axis=new i,this.m_perp=new i,this.m_K=new t,this.m_impulse=new i},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},m.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},m.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},m.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},m.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},m.prototype.IsLimitEnabled=function(){return this.m_enableLimit},m.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},m.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},m.prototype.GetUpperLimit=function(){return this.m_upperTranslation},m.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},m.prototype.IsMotorEnabled=function(){return this.m_enableMotor},m.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},m.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},m.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},m.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},m.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},m.prototype.GetMotorForce=function(){return this.m_motorImpulse},m.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=p.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},m.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,i=this.m_bodyB,s,o=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var u=n.GetTransform();i.GetTransform(),s=n.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y;o=s.col1.x*a+s.col2.x*f,f=s.col1.y*a+s.col2.y*f,a=o,s=i.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*l+s.col2.x*c,c=s.col1.y*l+s.col2.y*c,l=o,s=i.m_sweep.c.x+l-n.m_sweep.c.x-a,o=i.m_sweep.c.y+c-n.m_sweep.c.y-f,this.m_invMassA=n.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(r.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(s+a)*this.m_axis.y-(o+f)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(r.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(s+a)*this.m_perp.y-(o+f)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x,u=this.m_invMassA,a=this.m_invMassB,f=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=u+a+f*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+a+f*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(s=this.m_axis.x*s+this.m_axis.y*o,r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?this.m_limitState=p.e_equalLimits:s<=this.m_lowerTranslation?this.m_limitState!=p.e_atLowerLimit&&(this.m_limitState=p.e_atLowerLimit,this.m_impulse.y=0):s>=this.m_upperTranslation?this.m_limitState!=p.e_atUpperLimit&&(this.m_limitState=p.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=p.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,o=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,u=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,n.m_linearVelocity.x-=this.m_invMassA*t,n.m_linearVelocity.y-=this.m_invMassA*s,n.m_angularVelocity-=this.m_invIA*o,i.m_linearVelocity.x+=this.m_invMassB*t,i.m_linearVelocity.y+=this.m_invMassB*s,i.m_angularVelocity+=this.m_invIB*u):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},m.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,s=t.m_linearVelocity,o=t.m_angularVelocity,u=n.m_linearVelocity,a=n.m_angularVelocity,f=0,l=0,c=0,h=0;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(h=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(u.x-s.x)+this.m_axis.y*(u.y-s.y)+this.m_a2*a-this.m_a1*o)),f=this.m_motorImpulse,l=e.dt*this.m_maxMotorForce,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+h,-l,l),h=this.m_motorImpulse-f,f=h*this.m_axis.x,l=h*this.m_axis.y,c=h*this.m_a1,h*=this.m_a2,s.x-=this.m_invMassA*f,s.y-=this.m_invMassA*l,o-=this.m_invIA*c,u.x+=this.m_invMassB*f,u.y+=this.m_invMassB*l,a+=this.m_invIB*h),l=this.m_perp.x*(u.x-s.x)+this.m_perp.y*(u.y-s.y)+this.m_s2*a-this.m_s1*o,this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit?(c=this.m_axis.x*(u.x-s.x)+this.m_axis.y*(u.y-s.y)+this.m_a2*a-this.m_a1*o,f=this.m_impulse.Copy(),e=this.m_K.Solve(new i,-l,-c),this.m_impulse.Add(e),this.m_limitState==p.e_atLowerLimit?this.m_impulse.y=r.Max(this.m_impulse.y,0):this.m_limitState==p.e_atUpperLimit&&(this.m_impulse.y=r.Min(this.m_impulse.y,0)),l=-l-(this.m_impulse.y-f.y)*this.m_K.col2.x,c=0,c=this.m_K.col1.x!=0?l/this.m_K.col1.x+f.x:f.x,this.m_impulse.x=c,e.x=this.m_impulse.x-f.x,e.y=this.m_impulse.y-f.y,f=e.x*this.m_perp.x+e.y*this.m_axis.x,l=e.x*this.m_perp.y+e.y*this.m_axis.y,c=e.x*this.m_s1+e.y*this.m_a1,h=e.x*this.m_s2+e.y*this.m_a2):(e=0,e=this.m_K.col1.x!=0?-l/this.m_K.col1.x:0,this.m_impulse.x+=e,f=e*this.m_perp.x,l=e*this.m_perp.y,c=e*this.m_s1,h=e*this.m_s2),s.x-=this.m_invMassA*f,s.y-=this.m_invMassA*l,o-=this.m_invIA*c,u.x+=this.m_invMassB*f,u.y+=this.m_invMassB*l,a+=this.m_invIB*h,t.m_linearVelocity.SetV(s),t.m_angularVelocity=o,n.m_linearVelocity.SetV(u),n.m_angularVelocity=a},m.prototype.SolvePositionConstraints=function(){var n=this.m_bodyA,s=this.m_bodyB,o=n.m_sweep.c,u=n.m_sweep.a,a=s.m_sweep.c,f=s.m_sweep.a,l,c=0,h=0,p=0,d=0,v=l=0,m=0;h=!1;var g=0,y=t.FromAngle(u);p=t.FromAngle(f),l=y,m=this.m_localAnchor1.x-this.m_localCenterA.x;var b=this.m_localAnchor1.y-this.m_localCenterA.y;c=l.col1.x*m+l.col2.x*b,b=l.col1.y*m+l.col2.y*b,m=c,l=p,p=this.m_localAnchor2.x-this.m_localCenterB.x,d=this.m_localAnchor2.y-this.m_localCenterB.y,c=l.col1.x*p+l.col2.x*d,d=l.col1.y*p+l.col2.y*d,p=c,l=a.x+p-o.x-m,c=a.y+d-o.y-b;if(this.m_enableLimit){this.m_axis=r.MulMV(y,this.m_localXAxis1),this.m_a1=(l+m)*this.m_axis.y-(c+b)*this.m_axis.x,this.m_a2=p*this.m_axis.y-d*this.m_axis.x;var w=this.m_axis.x*l+this.m_axis.y*c;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?(g=r.Clamp(w,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection),v=r.Abs(w),h=!0):w<=this.m_lowerTranslation?(g=r.Clamp(w-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-w,h=!0):w>=this.m_upperTranslation&&(g=r.Clamp(w-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection),v=w-this.m_upperTranslation,h=!0)}return this.m_perp=r.MulMV(y,this.m_localYAxis1),this.m_s1=(l+m)*this.m_perp.y-(c+b)*this.m_perp.x,this.m_s2=p*this.m_perp.y-d*this.m_perp.x,y=new i,b=this.m_perp.x*l+this.m_perp.y*c,v=r.Max(v,r.Abs(b)),m=0,h?(h=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=h+p+d*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+p+d*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_K.Solve(y,-b,-g)):(h=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,l=this.m_invIB,g=h+p+d*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,h=0,h=g!=0?-b/g:0,y.x=h,y.y=0),g=y.x*this.m_perp.x+y.y*this.m_axis.x,h=y.x*this.m_perp.y+y.y*this.m_axis.y,b=y.x*this.m_s1+y.y*this.m_a1,y=y.x*this.m_s2+y.y*this.m_a2,o.x-=this.m_invMassA*g,o.y-=this.m_invMassA*h,u-=this.m_invIA*b,a.x+=this.m_invMassB*g,a.y+=this.m_invMassB*h,f+=this.m_invIB*y,n.m_sweep.a=u,s.m_sweep.a=f,n.SynchronizeTransform(),s.SynchronizeTransform(),v<=e.b2_linearSlop&&m<=e.b2_angularSlop},Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef),g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,g.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i,this.localAxisA=new i},g.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},g.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},Box2D.inherit(y,Box2D.Dynamics.Joints.b2Joint),y.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,y.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.m_localAnchor=new i,this.m_target=new i,this.m_impulse=new i,this.m_mass=new t,this.m_C=new i},y.prototype.GetAnchorA=function(){return this.m_target},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},y.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse.x,e*this.m_impulse.y)},y.prototype.GetReactionTorque=function(){return 0},y.prototype.GetTarget=function(){return this.m_target},y.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=e},y.prototype.GetMaxForce=function(){return this.m_maxForce},y.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},y.prototype.GetFrequency=function(){return this.m_frequencyHz},y.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},y.prototype.GetDampingRatio=function(){return this.m_dampingRatio},y.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},y.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_gamma=this.m_beta=0},y.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=n*r*r;this.m_gamma=e.dt*(2*n*this.m_dampingRatio*r+e.dt*i),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=e.dt*i*this.m_gamma,i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,r=this.m_localAnchor.y-t.m_sweep.localCenter.y;var s=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r,n=s,i=t.m_invMass,s=t.m_invI,this.K1.col1.x=i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i,this.K2.col1.x=s*r*r,this.K2.col2.x=-s*n*r,this.K2.col1.y=-s*n*r,this.K2.col2.y=s*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+n-this.m_target.x,this.m_C.y=t.m_sweep.c.y+r-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=i*this.m_impulse.x,t.m_linearVelocity.y+=i*this.m_impulse.y,t.m_angularVelocity+=s*(n*this.m_impulse.y-r*this.m_impulse.x)},y.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r=0,i=0;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r,r=t.m_linearVelocity.x+ -t.m_angularVelocity*o;var u=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=u+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,u=-(n.col1.x*r+n.col2.x*i),i=-(n.col1.y*r+n.col2.y*i),n=this.m_impulse.x,r=this.m_impulse.y,this.m_impulse.x+=u,this.m_impulse.y+=i,e=e.dt*this.m_maxForce,this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length()),u=this.m_impulse.x-n,i=this.m_impulse.y-r,t.m_linearVelocity.x+=t.m_invMass*u,t.m_linearVelocity.y+=t.m_invMass*i,t.m_angularVelocity+=t.m_invI*(s*i-o*u)},y.prototype.SolvePositionConstraints=function(){return!0},Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef),b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new i},b.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_localXAxis1=new i,this.m_localYAxis1=new i,this.m_axis=new i,this.m_perp=new i,this.m_K=new n,this.m_impulse=new s},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},w.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},w.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},w.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},w.prototype.IsLimitEnabled=function(){return this.m_enableLimit},w.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},w.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},w.prototype.GetUpperLimit=function(){return this.m_upperTranslation},w.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},w.prototype.IsMotorEnabled=function(){return this.m_enableMotor},w.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},w.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},w.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},w.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},w.prototype.GetMotorForce=function(){return this.m_motorImpulse},w.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=p.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},w.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,i=this.m_bodyB,s,o=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var u=n.GetTransform();i.GetTransform(),s=n.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y;o=s.col1.x*a+s.col2.x*f,f=s.col1.y*a+s.col2.y*f,a=o,s=i.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*l+s.col2.x*c,c=s.col1.y*l+s.col2.y*c,l=o,s=i.m_sweep.c.x+l-n.m_sweep.c.x-a,o=i.m_sweep.c.y+c-n.m_sweep.c.y-f,this.m_invMassA=n.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(r.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(s+a)*this.m_axis.y-(o+f)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(r.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(s+a)*this.m_perp.y-(o+f)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x,u=this.m_invMassA,a=this.m_invMassB,f=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=u+a+f*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1+l*this.m_s2,this.m_K.col1.z=f*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+l,this.m_K.col2.z=f*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=u+a+f*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(s=this.m_axis.x*s+this.m_axis.y*o,r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?this.m_limitState=p.e_equalLimits:s<=this.m_lowerTranslation?this.m_limitState!=p.e_atLowerLimit&&(this.m_limitState=p.e_atLowerLimit,this.m_impulse.z=0):s>=this.m_upperTranslation?this.m_limitState!=p.e_atUpperLimit&&(this.m_limitState=p.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=p.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,o=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,u=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,n.m_linearVelocity.x-=this.m_invMassA*t,n.m_linearVelocity.y-=this.m_invMassA*s,n.m_angularVelocity-=this.m_invIA*o,i.m_linearVelocity.x+=this.m_invMassB*t,i.m_linearVelocity.y+=this.m_invMassB*s,i.m_angularVelocity+=this.m_invIB*u):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},w.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,o=t.m_linearVelocity,u=t.m_angularVelocity,a=n.m_linearVelocity,f=n.m_angularVelocity,l=0,c=0,h=0,d=0;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(d=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*f-this.m_a1*u)),l=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+d,-e,e),d=this.m_motorImpulse-l,l=d*this.m_axis.x,c=d*this.m_axis.y,h=d*this.m_a1,d*=this.m_a2,o.x-=this.m_invMassA*l,o.y-=this.m_invMassA*c,u-=this.m_invIA*h,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,f+=this.m_invIB*d),h=this.m_perp.x*(a.x-o.x)+this.m_perp.y*(a.y-o.y)+this.m_s2*f-this.m_s1*u,c=f-u,this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit?(e=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*f-this.m_a1*u,l=this.m_impulse.Copy(),e=this.m_K.Solve33(new s,-h,-c,-e),this.m_impulse.Add(e),this.m_limitState==p.e_atLowerLimit?this.m_impulse.z=r.Max(this.m_impulse.z,0):this.m_limitState==p.e_atUpperLimit&&(this.m_impulse.z=r.Min(this.m_impulse.z,0)),h=-h-(this.m_impulse.z-l.z)*this.m_K.col3.x,c=-c-(this.m_impulse.z-l.z)*this.m_K.col3.y,c=this.m_K.Solve22(new i,h,c),c.x+=l.x,c.y+=l.y,this.m_impulse.x=c.x,this.m_impulse.y=c.y,e.x=this.m_impulse.x-l.x,e.y=this.m_impulse.y-l.y,e.z=this.m_impulse.z-l.z,l=e.x*this.m_perp.x+e.z*this.m_axis.x,c=e.x*this.m_perp.y+e.z*this.m_axis.y,h=e.x*this.m_s1+e.y+e.z*this.m_a1,d=e.x*this.m_s2+e.y+e.z*this.m_a2):(e=this.m_K.Solve22(new i,-h,-c),this.m_impulse.x+=e.x,this.m_impulse.y+=e.y,l=e.x*this.m_perp.x,c=e.x*this.m_perp.y,h=e.x*this.m_s1+e.y,d=e.x*this.m_s2+e.y),o.x-=this.m_invMassA*l,o.y-=this.m_invMassA*c,u-=this.m_invIA*h,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,f+=this.m_invIB*d,t.m_linearVelocity.SetV(o),t.m_angularVelocity=u,n.m_linearVelocity.SetV(a),n.m_angularVelocity=f},w.prototype.SolvePositionConstraints=function(){var n=this.m_bodyA,o=this.m_bodyB,u=n.m_sweep.c,a=n.m_sweep.a,f=o.m_sweep.c,l=o.m_sweep.a,c,h=0,p=0,d=0,v=h=c=0,m=0;p=!1;var g=0,y=t.FromAngle(a),b=t.FromAngle(l);c=y,m=this.m_localAnchor1.x-this.m_localCenterA.x;var w=this.m_localAnchor1.y-this.m_localCenterA.y;h=c.col1.x*m+c.col2.x*w,w=c.col1.y*m+c.col2.y*w,m=h,c=b,b=this.m_localAnchor2.x-this.m_localCenterB.x,d=this.m_localAnchor2.y-this.m_localCenterB.y,h=c.col1.x*b+c.col2.x*d,d=c.col1.y*b+c.col2.y*d,b=h,c=f.x+b-u.x-m,h=f.y+d-u.y-w;if(this.m_enableLimit){this.m_axis=r.MulMV(y,this.m_localXAxis1),this.m_a1=(c+m)*this.m_axis.y-(h+w)*this.m_axis.x,this.m_a2=b*this.m_axis.y-d*this.m_axis.x;var E=this.m_axis.x*c+this.m_axis.y*h;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?(g=r.Clamp(E,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection),v=r.Abs(E),p=!0):E<=this.m_lowerTranslation?(g=r.Clamp(E-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-E,p=!0):E>=this.m_upperTranslation&&(g=r.Clamp(E-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection),v=E-this.m_upperTranslation,p=!0)}return this.m_perp=r.MulMV(y,this.m_localYAxis1),this.m_s1=(c+m)*this.m_perp.y-(h+w)*this.m_perp.x,this.m_s2=b*this.m_perp.y-d*this.m_perp.x,y=new s,w=this.m_perp.x*c+this.m_perp.y*h,b=l-a-this.m_refAngle,v=r.Max(v,r.Abs(w)),m=r.Abs(b),p?(p=this.m_invMassA,d=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=p+d+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1+h*this.m_s2,this.m_K.col1.z=c*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+h,this.m_K.col2.z=c*this.m_a1+h*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+d+c*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_K.Solve33(y,-w,-b,-g)):(p=this.m_invMassA,d=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,g=c*this.m_s1+h*this.m_s2,E=c+h,this.m_K.col1.Set(p+d+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,g,0),this.m_K.col2.Set(g,E,0),g=this.m_K.Solve22(new i,-w,-b),y.x=g.x,y.y=g.y,y.z=0),g=y.x*this.m_perp.x+y.z*this.m_axis.x,p=y.x*this.m_perp.y+y.z*this.m_axis.y,w=y.x*this.m_s1+y.y+y.z*this.m_a1,y=y.x*this.m_s2+y.y+y.z*this.m_a2,u.x-=this.m_invMassA*g,u.y-=this.m_invMassA*p,a-=this.m_invIA*w,f.x+=this.m_invMassB*g,f.y+=this.m_invMassB*p,l+=this.m_invIB*y,n.m_sweep.a=a,o.m_sweep.a=l,n.SynchronizeTransform(),o.SynchronizeTransform(),v<=e.b2_linearSlop&&m<=e.b2_angularSlop},Box2D.inherit(E,Box2D.Dynamics.Joints.b2JointDef),E.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,E.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i,this.localAxisA=new i},E.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},E.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint),S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,S.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new i,this.m_groundAnchor2=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_u1=new i,this.m_u2=new i},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},S.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},S.prototype.GetReactionTorque=function(){return 0},S.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},S.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},S.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(t*t+e*e)},S.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(t*t+e*e)},S.prototype.GetRatio=function(){return this.m_ratio},S.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=r.Min(e.maxLengthA,this.m_constant-this.m_ratio*S.b2_minPulleyLength),this.m_maxLength2=r.Min(e.maxLengthB,(this.m_constant-S.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},S.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,r=this.m_bodyB,i;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=u,i=r.m_sweep.c.x+a,u=r.m_sweep.c.y+f;var l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(n.m_sweep.c.x+s-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),n.m_sweep.c.y+o-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(i-l,u-c),i=this.m_u1.Length(),u=this.m_u2.Length(),i>e.b2_linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),u>e.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),this.m_constant-i-this.m_ratio*u>0?(this.m_state=p.e_inactiveLimit,this.m_impulse=0):this.m_state=p.e_atUpperLimit,i<this.m_maxLength1?(this.m_limitState1=p.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=p.e_atUpperLimit,u<this.m_maxLength2?(this.m_limitState2=p.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=p.e_atUpperLimit,i=s*this.m_u1.y-o*this.m_u1.x,u=a*this.m_u2.y-f*this.m_u2.x,this.m_limitMass1=n.m_invMass+n.m_invI*i*i,this.m_limitMass2=r.m_invMass+r.m_invI*u*u,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting?(this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio,t=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,i=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*t,n.m_linearVelocity.y+=n.m_invMass*i,n.m_angularVelocity+=n.m_invI*(s*i-o*t),r.m_linearVelocity.x+=r.m_invMass*u,r.m_linearVelocity.y+=r.m_invMass*l,r.m_angularVelocity+=r.m_invI*(a*l-f*u)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},S.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=n.col1.x*i+n.col2.x*s;s=n.col1.y*i+n.col2.y*s,i=o,n=t.m_xf.R;var u=this.m_localAnchor2.x-t.m_sweep.localCenter.x,a=this.m_localAnchor2.y-t.m_sweep.localCenter.y;o=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=o;var f=o=n=0,l=0;n=l=n=l=f=o=n=0,this.m_state==p.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*s,o=e.m_linearVelocity.y+e.m_angularVelocity*i,f=t.m_linearVelocity.x+ -t.m_angularVelocity*a,l=t.m_linearVelocity.y+t.m_angularVelocity*u,n=-(this.m_u1.x*n+this.m_u1.y*o)-this.m_ratio*(this.m_u2.x*f+this.m_u2.y*l),l=this.m_pulleyMass*-n,n=this.m_impulse,this.m_impulse=r.Max(0,this.m_impulse+l),l=this.m_impulse-n,n=-l*this.m_u1.x,o=-l*this.m_u1.y,f=-this.m_ratio*l*this.m_u2.x,l=-this.m_ratio*l*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*o,e.m_angularVelocity+=e.m_invI*(i*o-s*n),t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(u*l-a*f)),this.m_limitState1==p.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*s,o=e.m_linearVelocity.y+e.m_angularVelocity*i,n=-(this.m_u1.x*n+this.m_u1.y*o),l=-this.m_limitMass1*n,n=this.m_limitImpulse1,this.m_limitImpulse1=r.Max(0,this.m_limitImpulse1+l),l=this.m_limitImpulse1-n,n=-l*this.m_u1.x,o=-l*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*o,e.m_angularVelocity+=e.m_invI*(i*o-s*n)),this.m_limitState2==p.e_atUpperLimit&&(f=t.m_linearVelocity.x+ -t.m_angularVelocity*a,l=t.m_linearVelocity.y+t.m_angularVelocity*u,n=-(this.m_u2.x*f+this.m_u2.y*l),l=-this.m_limitMass2*n,n=this.m_limitImpulse2,this.m_limitImpulse2=r.Max(0,this.m_limitImpulse2+l),l=this.m_limitImpulse2-n,f=-l*this.m_u2.x,l=-l*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(u*l-a*f))},S.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,n=this.m_bodyB,i,s=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,u=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,f=0,l=0,c=0,h=0,d=i=0,v=0,m=0,g=d=m=i=d=i=0;return this.m_state==p.e_atUpperLimit&&(i=t.m_xf.R,f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,l=this.m_localAnchor1.y-t.m_sweep.localCenter.y,d=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=d,i=n.m_xf.R,c=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,d=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=d,i=t.m_sweep.c.x+f,d=t.m_sweep.c.y+l,v=n.m_sweep.c.x+c,m=n.m_sweep.c.y+h,this.m_u1.Set(i-s,d-o),this.m_u2.Set(v-u,m-a),i=this.m_u1.Length(),d=this.m_u2.Length(),i>e.b2_linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),d>e.b2_linearSlop?this.m_u2.Multiply(1/d):this.m_u2.SetZero(),i=this.m_constant-i-this.m_ratio*d,g=r.Max(g,-i),i=r.Clamp(i+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_pulleyMass*i,i=-m*this.m_u1.x,d=-m*this.m_u1.y,v=-this.m_ratio*m*this.m_u2.x,m=-this.m_ratio*m*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*i,t.m_sweep.c.y+=t.m_invMass*d,t.m_sweep.a+=t.m_invI*(f*d-l*i),n.m_sweep.c.x+=n.m_invMass*v,n.m_sweep.c.y+=n.m_invMass*m,n.m_sweep.a+=n.m_invI*(c*m-h*v),t.SynchronizeTransform(),n.SynchronizeTransform()),this.m_limitState1==p.e_atUpperLimit&&(i=t.m_xf.R,f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,l=this.m_localAnchor1.y-t.m_sweep.localCenter.y,d=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=d,i=t.m_sweep.c.x+f,d=t.m_sweep.c.y+l,this.m_u1.Set(i-s,d-o),i=this.m_u1.Length(),i>e.b2_linearSlop?(this.m_u1.x*=1/i,this.m_u1.y*=1/i):this.m_u1.SetZero(),i=this.m_maxLength1-i,g=r.Max(g,-i),i=r.Clamp(i+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_limitMass1*i,i=-m*this.m_u1.x,d=-m*this.m_u1.y,t.m_sweep.c.x+=t.m_invMass*i,t.m_sweep.c.y+=t.m_invMass*d,t.m_sweep.a+=t.m_invI*(f*d-l*i),t.SynchronizeTransform()),this.m_limitState2==p.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,d=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=d,v=n.m_sweep.c.x+c,m=n.m_sweep.c.y+h,this.m_u2.Set(v-u,m-a),d=this.m_u2.Length(),d>e.b2_linearSlop?(this.m_u2.x*=1/d,this.m_u2.y*=1/d):this.m_u2.SetZero(),i=this.m_maxLength2-d,g=r.Max(g,-i),i=r.Clamp(i+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_limitMass2*i,v=-m*this.m_u2.x,m=-m*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*v,n.m_sweep.c.y+=n.m_invMass*m,n.m_sweep.a+=n.m_invI*(c*m-h*v),n.SynchronizeTransform()),g<e.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new i,this.groundAnchorB=new i,this.localAnchorA=new i,this.localAnchorB=new i},x.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},x.prototype.Initialize=function(e,t,n,r,i,s,o){o===undefined&&(o=0),this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s),e=i.x-n.x,n=i.y-n.y,this.lengthA=Math.sqrt(e*e+n*n),n=s.x-r.x,r=s.y-r.y,this.lengthB=Math.sqrt(n*n+r*r),this.ratio=o,o=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=o-this.ratio*S.b2_minPulleyLength,this.maxLengthB=(o-S.b2_minPulleyLength)/this.ratio},Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint),T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,T.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.K3=new t,this.impulse3=new s,this.impulse2=new i,this.reduced=new i,this.m_localAnchor1=new i,this.m_localAnchor2=new i,this.m_impulse=new s,this.m_mass=new n},T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},T.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse.x,e*this.m_impulse.y)},T.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},T.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},T.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},T.prototype.IsLimitEnabled=function(){return this.m_enableLimit},T.prototype.EnableLimit=function(e){this.m_enableLimit=e},T.prototype.GetLowerLimit=function(){return this.m_lowerAngle},T.prototype.GetUpperLimit=function(){return this.m_upperAngle},T.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_lowerAngle=e,this.m_upperAngle=t},T.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},T.prototype.EnableMotor=function(e){this.m_enableMotor=e},T.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},T.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},T.prototype.SetMaxMotorTorque=function(e){e===undefined&&(e=0),this.m_maxMotorTorque=e},T.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},T.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=p.e_inactiveLimit},T.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,i=this.m_bodyB,s,o=0;s=n.m_xf.R;var u=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;o=s.col1.x*u+s.col2.x*a,a=s.col1.y*u+s.col2.y*a,u=o,s=i.m_xf.R;var f=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;o=s.col1.x*f+s.col2.x*l,l=s.col1.y*f+s.col2.y*l,f=o,s=n.m_invMass,o=i.m_invMass;var c=n.m_invI,h=i.m_invI;this.m_mass.col1.x=s+o+a*a*c+l*l*h,this.m_mass.col2.x=-a*u*c-l*f*h,this.m_mass.col3.x=-a*c-l*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=s+o+u*u*c+f*f*h,this.m_mass.col3.y=u*c+f*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,this.m_motorMass=1/(c+h),this.m_enableMotor==0&&(this.m_motorImpulse=0);if(this.m_enableLimit){var d=i.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;r.Abs(this.m_upperAngle-this.m_lowerAngle)<2*e.b2_angularSlop?this.m_limitState=p.e_equalLimits:d<=this.m_lowerAngle?(this.m_limitState!=p.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=p.e_atLowerLimit):d>=this.m_upperAngle?(this.m_limitState!=p.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=p.e_atUpperLimit):(this.m_limitState=p.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=p.e_inactiveLimit;t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x,d=this.m_impulse.y,n.m_linearVelocity.x-=s*t,n.m_linearVelocity.y-=s*d,n.m_angularVelocity-=c*(u*d-a*t+this.m_motorImpulse+this.m_impulse.z),i.m_linearVelocity.x+=o*t,i.m_linearVelocity.y+=o*d,i.m_angularVelocity+=h*(f*d-l*t+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},T.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,i=0,s=i=0,o=0,u=0,a=0,f=t.m_linearVelocity,l=t.m_angularVelocity,c=n.m_linearVelocity,h=n.m_angularVelocity,d=t.m_invMass,v=n.m_invMass,m=t.m_invI,g=n.m_invI;this.m_enableMotor&&this.m_limitState!=p.e_equalLimits&&(s=this.m_motorMass*-(h-l-this.m_motorSpeed),o=this.m_motorImpulse,u=e.dt*this.m_maxMotorTorque,this.m_motorImpulse=r.Clamp(this.m_motorImpulse+s,-u,u),s=this.m_motorImpulse-o,l-=m*s,h+=g*s);if(this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit){e=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=e.col1.x*s+e.col2.x*o,o=e.col1.y*s+e.col2.y*o,s=i,e=n.m_xf.R,u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=e.col1.x*u+e.col2.x*a,a=e.col1.y*u+e.col2.y*a,u=i,e=c.x+ -h*a-f.x- -l*o;var y=c.y+h*u-f.y-l*s;this.m_mass.Solve33(this.impulse3,-e,-y,-(h-l)),this.m_limitState==p.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==p.e_atLowerLimit?(i=this.m_impulse.z+this.impulse3.z,i<0&&(this.m_mass.Solve22(this.reduced,-e,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==p.e_atUpperLimit&&(i=this.m_impulse.z+this.impulse3.z,i>0&&(this.m_mass.Solve22(this.reduced,-e,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),f.x-=d*this.impulse3.x,f.y-=d*this.impulse3.y,l-=m*(s*this.impulse3.y-o*this.impulse3.x+this.impulse3.z),c.x+=v*this.impulse3.x,c.y+=v*this.impulse3.y,h+=g*(u*this.impulse3.y-a*this.impulse3.x+this.impulse3.z)}else e=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=e.col1.x*s+e.col2.x*o,o=e.col1.y*s+e.col2.y*o,s=i,e=n.m_xf.R,u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=e.col1.x*u+e.col2.x*a,a=e.col1.y*u+e.col2.y*a,u=i,this.m_mass.Solve22(this.impulse2,-(c.x+ -h*a-f.x- -l*o),-(c.y+h*u-f.y-l*s)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,f.x-=d*this.impulse2.x,f.y-=d*this.impulse2.y,l-=m*(s*this.impulse2.y-o*this.impulse2.x),c.x+=v*this.impulse2.x,c.y+=v*this.impulse2.y,h+=g*(u*this.impulse2.y-a*this.impulse2.x);t.m_linearVelocity.SetV(f),t.m_angularVelocity=l,n.m_linearVelocity.SetV(c),n.m_angularVelocity=h},T.prototype.SolvePositionConstraints=function(){var t=0,n,i=this.m_bodyA,s=this.m_bodyB,o=0,u=n=0,a=0,f=0;if(this.m_enableLimit&&this.m_limitState!=p.e_inactiveLimit){t=s.m_sweep.a-i.m_sweep.a-this.m_referenceAngle;var l=0;this.m_limitState==p.e_equalLimits?(t=r.Clamp(t-this.m_lowerAngle,-e.b2_maxAngularCorrection,e.b2_maxAngularCorrection),l=-this.m_motorMass*t,o=r.Abs(t)):this.m_limitState==p.e_atLowerLimit?(t-=this.m_lowerAngle,o=-t,t=r.Clamp(t+e.b2_angularSlop,-e.b2_maxAngularCorrection,0),l=-this.m_motorMass*t):this.m_limitState==p.e_atUpperLimit&&(o=t-=this.m_upperAngle,t=r.Clamp(t-e.b2_angularSlop,0,e.b2_maxAngularCorrection),l=-this.m_motorMass*t),i.m_sweep.a-=i.m_invI*l,s.m_sweep.a+=s.m_invI*l,i.SynchronizeTransform(),s.SynchronizeTransform()}n=i.m_xf.R,l=this.m_localAnchor1.x-i.m_sweep.localCenter.x,t=this.m_localAnchor1.y-i.m_sweep.localCenter.y,u=n.col1.x*l+n.col2.x*t,t=n.col1.y*l+n.col2.y*t,l=u,n=s.m_xf.R;var c=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y;u=n.col1.x*c+n.col2.x*h,h=n.col1.y*c+n.col2.y*h,c=u,a=s.m_sweep.c.x+c-i.m_sweep.c.x-l,f=s.m_sweep.c.y+h-i.m_sweep.c.y-t;var d=a*a+f*f;n=Math.sqrt(d),u=i.m_invMass;var v=s.m_invMass,m=i.m_invI,g=s.m_invI,y=10*e.b2_linearSlop;return d>y*y&&(d=1/(u+v),a=d*-a,f=d*-f,i.m_sweep.c.x-=.5*u*a,i.m_sweep.c.y-=.5*u*f,s.m_sweep.c.x+=.5*v*a,s.m_sweep.c.y+=.5*v*f,a=s.m_sweep.c.x+c-i.m_sweep.c.x-l,f=s.m_sweep.c.y+h-i.m_sweep.c.y-t),this.K1.col1.x=u+v,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=u+v,this.K2.col1.x=m*t*t,this.K2.col2.x=-m*l*t,this.K2.col1.y=-m*l*t,this.K2.col2.y=m*l*l,this.K3.col1.x=g*h*h,this.K3.col2.x=-g*c*h,this.K3.col1.y=-g*c*h,this.K3.col2.y=g*c*c,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(T.tImpulse,-a,-f),a=T.tImpulse.x,f=T.tImpulse.y,i.m_sweep.c.x-=i.m_invMass*a,i.m_sweep.c.y-=i.m_invMass*f,i.m_sweep.a-=i.m_invI*(l*f-t*a),s.m_sweep.c.x+=s.m_invMass*a,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(c*f-h*a),i.SynchronizeTransform(),s.SynchronizeTransform(),n<=e.b2_linearSlop&&o<=e.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new i}),Box2D.inherit(N,Box2D.Dynamics.Joints.b2JointDef),N.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,N.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},N.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},N.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint),C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,C.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new i,this.m_localAnchorB=new i,this.m_impulse=new s,this.m_mass=new n},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},C.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new i(e*this.m_impulse.x,e*this.m_impulse.y)},C.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},C.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new n},C.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=r.m_invMass,n=i.m_invMass;var f=r.m_invI,l=i.m_invI;this.m_mass.col1.x=t+n+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=t*this.m_impulse.x,r.m_linearVelocity.y-=t*this.m_impulse.y,r.m_angularVelocity-=f*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=n*this.m_impulse.x,i.m_linearVelocity.y+=n*this.m_impulse.y,i.m_angularVelocity+=l*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},C.prototype.SolveVelocityConstraints=function(){var e,t=0,n=this.m_bodyA,r=this.m_bodyB,i=n.m_linearVelocity,o=n.m_angularVelocity,u=r.m_linearVelocity,a=r.m_angularVelocity,f=n.m_invMass,l=r.m_invMass,c=n.m_invI,h=r.m_invI;e=n.m_xf.R;var p=this.m_localAnchorA.x-n.m_sweep.localCenter.x,d=this.m_localAnchorA.y-n.m_sweep.localCenter.y;t=e.col1.x*p+e.col2.x*d,d=e.col1.y*p+e.col2.y*d,p=t,e=r.m_xf.R;var v=this.m_localAnchorB.x-r.m_sweep.localCenter.x,m=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*v+e.col2.x*m,m=e.col1.y*v+e.col2.y*m,v=t,e=u.x-a*m-i.x+o*d,t=u.y+a*v-i.y-o*p;var g=a-o,y=new s;this.m_mass.Solve33(y,-e,-t,-g),this.m_impulse.Add(y),i.x-=f*y.x,i.y-=f*y.y,o-=c*(p*y.y-d*y.x+y.z),u.x+=l*y.x,u.y+=l*y.y,a+=h*(v*y.y-m*y.x+y.z),n.m_angularVelocity=o,r.m_angularVelocity=a},C.prototype.SolvePositionConstraints=function(){var t,n=0,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var u=this.m_localAnchorA.x-i.m_sweep.localCenter.x,a=this.m_localAnchorA.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=o.m_xf.R;var f=this.m_localAnchorB.x-o.m_sweep.localCenter.x,l=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=n,t=i.m_invMass,n=o.m_invMass;var c=i.m_invI,h=o.m_invI,p=o.m_sweep.c.x+f-i.m_sweep.c.x-u,d=o.m_sweep.c.y+l-i.m_sweep.c.y-a,v=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,m=10*e.b2_linearSlop,g=Math.sqrt(p*p+d*d),y=r.Abs(v);return g>m&&(c*=1,h*=1),this.m_mass.col1.x=t+n+a*a*c+l*l*h,this.m_mass.col2.x=-a*u*c-l*f*h,this.m_mass.col3.x=-a*c-l*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+u*u*c+f*f*h,this.m_mass.col3.y=u*c+f*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,m=new s,this.m_mass.Solve33(m,-p,-d,-v),i.m_sweep.c.x-=t*m.x,i.m_sweep.c.y-=t*m.y,i.m_sweep.a-=c*(u*m.y-a*m.x+m.z),o.m_sweep.c.x+=n*m.x,o.m_sweep.c.y+=n*m.y,o.m_sweep.a+=h*(f*m.y-l*m.x+m.z),i.SynchronizeTransform(),o.SynchronizeTransform(),g<=e.b2_linearSlop&&y<=e.b2_angularSlop},Box2D.inherit(k,Box2D.Dynamics.Joints.b2JointDef),k.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,k.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new i,this.localAnchorB=new i},k.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=p.e_weldJoint,this.referenceAngle=0},k.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var e=Box2D.Dynamics.b2DebugDraw;e.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},e.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"},e.prototype.b2DebugDraw=function(){this.m_drawFlags=0},e.prototype.SetFlags=function(e){e===undefined&&(e=0),this.m_drawFlags=e},e.prototype.GetFlags=function(){return this.m_drawFlags},e.prototype.AppendFlags=function(e){e===undefined&&(e=0),this.m_drawFlags|=e},e.prototype.ClearFlags=function(e){e===undefined&&(e=0),this.m_drawFlags&=~e},e.prototype.SetSprite=function(e){this.m_ctx=e},e.prototype.GetSprite=function(){return this.m_ctx},e.prototype.SetDrawScale=function(e){e===undefined&&(e=0),this.m_drawScale=e},e.prototype.GetDrawScale=function(){return this.m_drawScale},e.prototype.SetLineThickness=function(e){e===undefined&&(e=0),this.m_lineThickness=e,this.m_ctx.strokeWidth=e},e.prototype.GetLineThickness=function(){return this.m_lineThickness},e.prototype.SetAlpha=function(e){e===undefined&&(e=0),this.m_alpha=e},e.prototype.GetAlpha=function(){return this.m_alpha},e.prototype.SetFillAlpha=function(e){e===undefined&&(e=0),this.m_fillAlpha=e},e.prototype.GetFillAlpha=function(){return this.m_fillAlpha},e.prototype.SetXFormScale=function(e){e===undefined&&(e=0),this.m_xformScale=e},e.prototype.GetXFormScale=function(){return this.m_xformScale},e.prototype.DrawPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.moveTo(e[0].x*i,e[0].y*i);for(n=1;n<t;n++)r.lineTo(e[n].x*i,e[n].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.stroke()}},e.prototype.DrawSolidPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.fillStyle=this._color(n.color,this.m_fillAlpha),r.moveTo(e[0].x*i,e[0].y*i);for(n=1;n<t;n++)r.lineTo(e[n].x*i,e[n].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.fill(),r.stroke()}},e.prototype.DrawCircle=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.arc(e.x*i,e.y*i,t*i,0,Math.PI*2,!0),r.closePath(),r.stroke()}},e.prototype.DrawSolidCircle=function(e,t,n,r){if(t){var i=this.m_ctx,s=this.m_drawScale,o=e.x*s,u=e.y*s;i.moveTo(0,0),i.beginPath(),i.strokeStyle=this._color(r.color,this.m_alpha),i.fillStyle=this._color(r.color,this.m_fillAlpha),i.arc(o,u,t*s,0,Math.PI*2,!0),i.moveTo(o,u),i.lineTo((e.x+n.x*t)*s,(e.y+n.y*t)*s),i.closePath(),i.fill(),i.stroke()}},e.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.color,this.m_alpha),r.beginPath(),r.moveTo(e.x*i,e.y*i),r.lineTo(t.x*i,t.y*i),r.closePath(),r.stroke()},e.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n,(e.position.y+this.m_xformScale*e.R.col1.y)*n),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n,(e.position.y+this.m_xformScale*e.R.col2.y)*n),t.closePath(),t.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;(function(){var e=Math,t=function(e){return e>>0},n=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":/trident/i.test(navigator.userAgent)?"ms":"opera"in window?"O":"",r=/android/gi.test(navigator.appVersion),i=/iphone|ipad/gi.test(navigator.appVersion),s=/playbook/gi.test(navigator.appVersion),o=/hp-tablet/gi.test(navigator.appVersion),u="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,a="ontouchstart"in window&&!o,f=n+"Transform"in document.documentElement.style,l=i||s,c=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1)}}(),h=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),p="onorientationchange"in window?"orientationchange":"resize",d=a?"touchstart":"mousedown",v=a?"touchmove":"mousemove",m=a?"touchend":"mouseup",g=a?"touchcancel":"mouseup",y=n=="Moz"?"DOMMouseScroll":"mousewheel",b="translate"+(u?"3d(":"("),w=u?",0)":")",E=function(e,t){var s=this,o=document,c;s.wrapper=typeof e=="object"?e:o.getElementById(e),s.wrapper.style.overflow="hidden",s.scroller=s.wrapper.children[0],s.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:r,hideScrollbar:i,fadeScrollbar:i&&u,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(c in t)s.options[c]=t[c];s.x=s.options.x,s.y=s.options.y,s.options.useTransform=f?s.options.useTransform:!1,s.options.hScrollbar=s.options.hScroll&&s.options.hScrollbar,s.options.vScrollbar=s.options.vScroll&&s.options.vScrollbar,s.options.zoom=s.options.useTransform&&s.options.zoom,s.options.useTransition=l&&s.options.useTransition,s.options.zoom&&r&&(b="translate(",w=")"),s.scroller.style[n+"TransitionProperty"]=s.options.useTransform?"-"+n.toLowerCase()+"-transform":"top left",s.scroller.style[n+"TransitionDuration"]="0",s.scroller.style[n+"TransformOrigin"]="0 0",s.options.useTransition&&(s.scroller.style[n+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)"),s.options.useTransform?s.scroller.style[n+"Transform"]=b+s.x+"px,"+s.y+"px"+w:s.scroller.style.cssText+=";position:absolute;top:"+s.y+"px;left:"+s.x+"px",s.options.useTransition&&(s.options.fixedScrollbar=!0),s.refresh(),s._bind(p,window),s._bind(d),a||(s._bind("mouseout",s.wrapper),s.options.wheelAction!="none"&&s._bind(y)),s.options.checkDOMChanges&&(s.checkDOMTime=setInterval(function(){s._checkDOMChanges()},500))};E.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var t=this;switch(e.type){case d:if(!a&&e.button!==0)return;t._start(e);break;case v:t._move(e);break;case m:case g:t._end(e);break;case p:t._resize();break;case y:t._wheel(e);break;case"mouseout":t._mouseout(e);break;case"webkitTransitionEnd":t._transitionEnd(e)}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(r){var i=this,s=document,o;if(!i[r+"Scrollbar"]){i[r+"ScrollbarWrapper"]&&(f&&(i[r+"ScrollbarIndicator"].style[n+"Transform"]=""),i[r+"ScrollbarWrapper"].parentNode.removeChild(i[r+"ScrollbarWrapper"]),i[r+"ScrollbarWrapper"]=null,i[r+"ScrollbarIndicator"]=null);return}i[r+"ScrollbarWrapper"]||(o=s.createElement("div"),i.options.scrollbarClass?o.className=i.options.scrollbarClass+r.toUpperCase():o.style.cssText="position:absolute;z-index:100;"+(r=="h"?"height:7px;bottom:1px;left:2px;right:"+(i.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(i.hScrollbar?"7":"2")+"px;top:2px;right:1px"),o.style.cssText+=";pointer-events:none;-"+n+"-transition-property:opacity;-"+n+"-transition-duration:"+(i.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(i.options.hideScrollbar?"0":"1"),i.wrapper.appendChild(o),i[r+"ScrollbarWrapper"]=o,o=s.createElement("div"),i.options.scrollbarClass||(o.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-"+n+"-background-clip:padding-box;-"+n+"-box-sizing:border-box;"+(r=="h"?"height:100%":"width:100%")+";-"+n+"-border-radius:3px;border-radius:3px"),o.style.cssText+=";pointer-events:none;-"+n+"-transition-property:-"+n+"-transform;-"+n+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+n+"-transition-duration:0;-"+n+"-transform:"+b+"0,0"+w,i.options.useTransition&&(o.style.cssText+=";-"+n+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),i[r+"ScrollbarWrapper"].appendChild(o),i[r+"ScrollbarIndicator"]=o),r=="h"?(i.hScrollbarSize=i.hScrollbarWrapper.clientWidth,i.hScrollbarIndicatorSize=e.max(t(i.hScrollbarSize*i.hScrollbarSize/i.scrollerW),8),i.hScrollbarIndicator.style.width=i.hScrollbarIndicatorSize+"px",i.hScrollbarMaxScroll=i.hScrollbarSize-i.hScrollbarIndicatorSize,i.hScrollbarProp=i.hScrollbarMaxScroll/i.maxScrollX):(i.vScrollbarSize=i.vScrollbarWrapper.clientHeight,i.vScrollbarIndicatorSize=e.max(t(i.vScrollbarSize*i.vScrollbarSize/i.scrollerH),8),i.vScrollbarIndicator.style.height=i.vScrollbarIndicatorSize+"px",i.vScrollbarMaxScroll=i.vScrollbarSize-i.vScrollbarIndicatorSize,i.vScrollbarProp=i.vScrollbarMaxScroll/i.maxScrollY),i._scrollbarPos(r,!0)},_resize:function(){var e=this;setTimeout(function(){e.refresh()},r?200:0)},_pos:function(e,r){e=this.hScroll?e:0,r=this.vScroll?r:0,this.options.useTransform?this.scroller.style[n+"Transform"]=b+e+"px,"+r+"px"+w+" scale("+this.scale+")":(e=t(e),r=t(r),this.scroller.style.left=e+"px",this.scroller.style.top=r+"px"),this.x=e,this.y=r,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(e,r){var i=this,s=e=="h"?i.x:i.y,o;if(!i[e+"Scrollbar"])return;s=i[e+"ScrollbarProp"]*s,s<0?(i.options.fixedScrollbar||(o=i[e+"ScrollbarIndicatorSize"]+t(s*3),o<8&&(o=8),i[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=o+"px"),s=0):s>i[e+"ScrollbarMaxScroll"]&&(i.options.fixedScrollbar?s=i[e+"ScrollbarMaxScroll"]:(o=i[e+"ScrollbarIndicatorSize"]-t((s-i[e+"ScrollbarMaxScroll"])*3),o<8&&(o=8),i[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=o+"px",s=i[e+"ScrollbarMaxScroll"]+(i[e+"ScrollbarIndicatorSize"]-o))),i[e+"ScrollbarWrapper"].style[n+"TransitionDelay"]="0",i[e+"ScrollbarWrapper"].style.opacity=r&&i.options.hideScrollbar?"0":"1",i[e+"ScrollbarIndicator"].style[n+"Transform"]=b+(e=="h"?s+"px,0":"0,"+s+"px")+w},_start:function(t){var r=this,i=a?t.touches[0]:t,s,o,u,f,l;if(!r.enabled)return;r.options.onBeforeScrollStart&&r.options.onBeforeScrollStart.call(r,t),(r.options.useTransition||r.options.zoom)&&r._transitionTime(0),r.moved=!1,r.animating=!1,r.zoomed=!1,r.distX=0,r.distY=0,r.absDistX=0,r.absDistY=0,r.dirX=0,r.dirY=0,r.options.zoom&&a&&t.touches.length>1&&(f=e.abs(t.touches[0].pageX-t.touches[1].pageX),l=e.abs(t.touches[0].pageY-t.touches[1].pageY),r.touchesDistStart=e.sqrt(f*f+l*l),r.originX=e.abs(t.touches[0].pageX+t.touches[1].pageX-r.wrapperOffsetLeft*2)/2-r.x,r.originY=e.abs(t.touches[0].pageY+t.touches[1].pageY-r.wrapperOffsetTop*2)/2-r.y,r.options.onZoomStart&&r.options.onZoomStart.call(r,t));if(r.options.momentum){r.options.useTransform?(s=getComputedStyle(r.scroller,null)[n+"Transform"].replace(/[^0-9-.,]/g,"").split(","),o=s[4]*1,u=s[5]*1):(o=getComputedStyle(r.scroller,null).left.replace(/[^0-9-]/g,"")*1,u=getComputedStyle(r.scroller,null).top.replace(/[^0-9-]/g,"")*1);if(o!=r.x||u!=r.y)r.options.useTransition?r._unbind("webkitTransitionEnd"):h(r.aniTime),r.steps=[],r._pos(o,u)}r.absStartX=r.x,r.absStartY=r.y,r.startX=r.x,r.startY=r.y,r.pointX=i.pageX,r.pointY=i.pageY,r.startTime=t.timeStamp||Date.now(),r.options.onScrollStart&&r.options.onScrollStart.call(r,t),r._bind(v),r._bind(m),r._bind(g)},_move:function(t){var r=this,i=a?t.touches[0]:t,s=i.pageX-r.pointX,o=i.pageY-r.pointY,u=r.x+s,f=r.y+o,l,c,h,p=t.timeStamp||Date.now();r.options.onBeforeScrollMove&&r.options.onBeforeScrollMove.call(r,t);if(r.options.zoom&&a&&t.touches.length>1){l=e.abs(t.touches[0].pageX-t.touches[1].pageX),c=e.abs(t.touches[0].pageY-t.touches[1].pageY),r.touchesDist=e.sqrt(l*l+c*c),r.zoomed=!0,h=1/r.touchesDistStart*r.touchesDist*this.scale,h<r.options.zoomMin?h=.5*r.options.zoomMin*Math.pow(2,h/r.options.zoomMin):h>r.options.zoomMax&&(h=2*r.options.zoomMax*Math.pow(.5,r.options.zoomMax/h)),r.lastScale=h/this.scale,u=this.originX-this.originX*r.lastScale+this.x,f=this.originY-this.originY*r.lastScale+this.y,this.scroller.style[n+"Transform"]=b+u+"px,"+f+"px"+w+" scale("+h+")",r.options.onZoom&&r.options.onZoom.call(r,t);return}r.pointX=i.pageX,r.pointY=i.pageY;if(u>0||u<r.maxScrollX)u=r.options.bounce?r.x+s/2:u>=0||r.maxScrollX>=0?0:r.maxScrollX;if(f>r.minScrollY||f<r.maxScrollY)f=r.options.bounce?r.y+o/2:f>=r.minScrollY||r.maxScrollY>=0?r.minScrollY:r.maxScrollY;r.distX+=s,r.distY+=o,r.absDistX=e.abs(r.distX),r.absDistY=e.abs(r.distY);if(r.absDistX<6&&r.absDistY<6)return;r.options.lockDirection&&(r.absDistX>r.absDistY+5?(f=r.y,o=0):r.absDistY>r.absDistX+5&&(u=r.x,s=0)),r.moved=!0,r._pos(u,f),r.dirX=s>0?-1:s<0?1:0,r.dirY=o>0?-1:o<0?1:0,p-r.startTime>300&&(r.startTime=p,r.startX=r.x,r.startY=r.y),r.options.onScrollMove&&r.options.onScrollMove.call(r,t)},_end:function(r){if(a&&r.touches.length!=0)return;var i=this,s=a?r.changedTouches[0]:r,o,u,f={dist:0,time:0},l={dist:0,time:0},c=(r.timeStamp||Date.now())-i.startTime,h=i.x,p=i.y,d,y,E,S,x;i._unbind(v),i._unbind(m),i._unbind(g),i.options.onBeforeScrollEnd&&i.options.onBeforeScrollEnd.call(i,r);if(i.zoomed){x=i.scale*i.lastScale,x=Math.max(i.options.zoomMin,x),x=Math.min(i.options.zoomMax,x),i.lastScale=x/i.scale,i.scale=x,i.x=i.originX-i.originX*i.lastScale+i.x,i.y=i.originY-i.originY*i.lastScale+i.y,i.scroller.style[n+"TransitionDuration"]="200ms",i.scroller.style[n+"Transform"]=b+i.x+"px,"+i.y+"px"+w+" scale("+i.scale+")",i.zoomed=!1,i.refresh(),i.options.onZoomEnd&&i.options.onZoomEnd.call(i,r);return}if(!i.moved){a&&(i.doubleTapTimer&&i.options.zoom?(clearTimeout(i.doubleTapTimer),i.doubleTapTimer=null,i.options.onZoomStart&&i.options.onZoomStart.call(i,r),i.zoom(i.pointX,i.pointY,i.scale==1?i.options.doubleTapZoom:1),i.options.onZoomEnd&&setTimeout(function(){i.options.onZoomEnd.call(i,r)},200)):i.doubleTapTimer=setTimeout(function(){i.doubleTapTimer=null,o=s.target;while(o.nodeType!=1)o=o.parentNode;o.tagName!="SELECT"&&o.tagName!="INPUT"&&o.tagName!="TEXTAREA"&&(u=document.createEvent("MouseEvents"),u.initMouseEvent("click",!0,!0,r.view,1,s.screenX,s.screenY,s.clientX,s.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,0,null),u._fake=!0,o.dispatchEvent(u))},i.options.zoom?250:0)),i._resetPos(200),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(c<300&&i.options.momentum){f=h?i._momentum(h-i.startX,c,-i.x,i.scrollerW-i.wrapperW+i.x,i.options.bounce?i.wrapperW:0):f,l=p?i._momentum(p-i.startY,c,-i.y,i.maxScrollY<0?i.scrollerH-i.wrapperH+i.y-i.minScrollY:0,i.options.bounce?i.wrapperH:0):l,h=i.x+f.dist,p=i.y+l.dist;if(i.x>0&&h>0||i.x<i.maxScrollX&&h<i.maxScrollX)f={dist:0,time:0};if(i.y>i.minScrollY&&p>i.minScrollY||i.y<i.maxScrollY&&p<i.maxScrollY)l={dist:0,time:0}}if(f.dist||l.dist){E=e.max(e.max(f.time,l.time),10),i.options.snap&&(d=h-i.absStartX,y=p-i.absStartY,e.abs(d)<i.options.snapThreshold&&e.abs(y)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(S=i._snap(h,p),h=S.x,p=S.y,E=e.max(S.time,E))),i.scrollTo(t(h),t(p),E),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(i.options.snap){d=h-i.absStartX,y=p-i.absStartY,e.abs(d)<i.options.snapThreshold&&e.abs(y)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(S=i._snap(i.x,i.y),(S.x!=i.x||S.y!=i.y)&&i.scrollTo(S.x,S.y,S.time)),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}i._resetPos(200),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r)},_resetPos:function(e){var t=this,r=t.x>=0?0:t.x<t.maxScrollX?t.maxScrollX:t.x,i=t.y>=t.minScrollY||t.maxScrollY>0?t.minScrollY:t.y<t.maxScrollY?t.maxScrollY:t.y;if(r==t.x&&i==t.y){t.moved&&(t.moved=!1,t.options.onScrollEnd&&t.options.onScrollEnd.call(t)),t.hScrollbar&&t.options.hideScrollbar&&(n=="webkit"&&(t.hScrollbarWrapper.style[n+"TransitionDelay"]="300ms"),t.hScrollbarWrapper.style.opacity="0"),t.vScrollbar&&t.options.hideScrollbar&&(n=="webkit"&&(t.vScrollbarWrapper.style[n+"TransitionDelay"]="300ms"),t.vScrollbarWrapper.style.opacity="0");return}t.scrollTo(r,i,e||0)},_wheel:function(e){var t=this,n,r,i,s,o;if("wheelDeltaX"in e)n=e.wheelDeltaX/12,r=e.wheelDeltaY/12;else if("wheelDelta"in e)n=r=e.wheelDelta/12;else{if(!("detail"in e))return;n=r=-e.detail*3}if(t.options.wheelAction=="zoom"){o=t.scale*Math.pow(2,1/3*(r?r/Math.abs(r):0)),o<t.options.zoomMin&&(o=t.options.zoomMin),o>t.options.zoomMax&&(o=t.options.zoomMax),o!=t.scale&&(!t.wheelZoomCount&&t.options.onZoomStart&&t.options.onZoomStart.call(t,e),t.wheelZoomCount++,t.zoom(e.pageX,e.pageY,o,400),setTimeout(function(){t.wheelZoomCount--,!t.wheelZoomCount&&t.options.onZoomEnd&&t.options.onZoomEnd.call(t,e)},400));return}i=t.x+n,s=t.y+r,i>0?i=0:i<t.maxScrollX&&(i=t.maxScrollX),s>t.minScrollY?s=t.minScrollY:s<t.maxScrollY&&(s=t.maxScrollY),t.scrollTo(i,s,0)},_mouseout:function(e){var t=e.relatedTarget;if(!t){this._end(e);return}while(t=t.parentNode)if(t==this.wrapper)return;this._end(e)},_transitionEnd:function(e){var t=this;if(e.target!=t.scroller)return;t._unbind("webkitTransitionEnd"),t._startAni()},_startAni:function(){var t=this,n=t.x,r=t.y,i=Date.now(),s,o,u;if(t.animating)return;if(!t.steps.length){t._resetPos(400);return}s=t.steps.shift(),s.x==n&&s.y==r&&(s.time=0),t.animating=!0,t.moved=!0;if(t.options.useTransition){t._transitionTime(s.time),t._pos(s.x,s.y),t.animating=!1,s.time?t._bind("webkitTransitionEnd"):t._resetPos(0);return}u=function(){var a=Date.now(),f,l;if(a>=i+s.time){t._pos(s.x,s.y),t.animating=!1,t.options.onAnimationEnd&&t.options.onAnimationEnd.call(t),t._startAni();return}a=(a-i)/s.time-1,o=e.sqrt(1-a*a),f=(s.x-n)*o+n,l=(s.y-r)*o+r,t._pos(f,l),t.animating&&(t.aniTime=c(u))},u()},_transitionTime:function(e){e+="ms",this.scroller.style[n+"TransitionDuration"]=e,this.hScrollbar&&(this.hScrollbarIndicator.style[n+"TransitionDuration"]=e),this.vScrollbar&&(this.vScrollbarIndicator.style[n+"TransitionDuration"]=e)},_momentum:function(n,r,i,s,o){var u=6e-4,a=e.abs(n)/r,f=a*a/(2*u),l=0,c=0;return n>0&&f>i?(c=o/(6/(f/a*u)),i+=c,a=a*i/f,f=i):n<0&&f>s&&(c=o/(6/(f/a*u)),s+=c,a=a*s/f,f=s),f*=n<0?-1:1,l=a/u,{dist:f,time:t(l)}},_offset:function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent)t-=e.offsetLeft,n-=e.offsetTop;return e!=this.wrapper&&(t*=this.scale,n*=this.scale),{left:t,top:n}},_snap:function(n,r){var i=this,s,o,u,a,f,l;u=i.pagesX.length-1;for(s=0,o=i.pagesX.length;s<o;s++)if(n>=i.pagesX[s]){u=s;break}u==i.currPageX&&u>0&&i.dirX<0&&u--,n=i.pagesX[u],f=e.abs(n-i.pagesX[i.currPageX]),f=f?e.abs(i.x-n)/f*500:0,i.currPageX=u,u=i.pagesY.length-1;for(s=0;s<u;s++)if(r>=i.pagesY[s]){u=s;break}return u==i.currPageY&&u>0&&i.dirY<0&&u--,r=i.pagesY[u],l=e.abs(r-i.pagesY[i.currPageY]),l=l?e.abs(i.y-r)/l*500:0,i.currPageY=u,a=t(e.max(f,l))||200,{x:n,y:r,time:a}},_bind:function(e,t,n){(t||this.scroller).addEventListener(e,this,!!n)},_unbind:function(e,t,n){(t||this.scroller).removeEventListener(e,this,!!n)},destroy:function(){var e=this;e.scroller.style[n+"Transform"]="",e.hScrollbar=!1,e.vScrollbar=!1,e._scrollbar("h"),e._scrollbar("v"),e._unbind(p,window),e._unbind(d),e._unbind(v),e._unbind(m),e._unbind(g),e.options.hasTouch||(e._unbind("mouseout",e.wrapper),e._unbind(y)),e.options.useTransition&&e._unbind("webkitTransitionEnd"),e.options.checkDOMChanges&&clearInterval(e.checkDOMTime),e.options.onDestroy&&e.options.onDestroy.call(e)},refresh:function(){var e=this,r,i,s,o,u=0,a=0;e.scale<e.options.zoomMin&&(e.scale=e.options.zoomMin),e.wrapperW=e.wrapper.clientWidth||1,e.wrapperH=e.wrapper.clientHeight||1,e.minScrollY=-e.options.topOffset||0,e.scrollerW=t(e.scroller.offsetWidth*e.scale),e.scrollerH=t((e.scroller.offsetHeight+e.minScrollY)*e.scale),e.maxScrollX=e.wrapperW-e.scrollerW,e.maxScrollY=e.wrapperH-e.scrollerH+e.minScrollY,e.dirX=0,e.dirY=0,e.options.onRefresh&&e.options.onRefresh.call(e),e.hScroll=e.options.hScroll&&e.maxScrollX<0,e.vScroll=e.options.vScroll&&(!e.options.bounceLock&&!e.hScroll||e.scrollerH>e.wrapperH),e.hScrollbar=e.hScroll&&e.options.hScrollbar,e.vScrollbar=e.vScroll&&e.options.vScrollbar&&e.scrollerH>e.wrapperH,r=e._offset(e.wrapper),e.wrapperOffsetLeft=-r.left,e.wrapperOffsetTop=-r.top;if(typeof e.options.snap=="string"){e.pagesX=[],e.pagesY=[],o=e.scroller.querySelectorAll(e.options.snap);for(i=0,s=o.length;i<s;i++)u=e._offset(o[i]),u.left+=e.wrapperOffsetLeft,u.top+=e.wrapperOffsetTop,e.pagesX[i]=u.left<e.maxScrollX?e.maxScrollX:u.left*e.scale,e.pagesY[i]=u.top<e.maxScrollY?e.maxScrollY:u.top*e.scale}else if(e.options.snap){e.pagesX=[];while(u>=e.maxScrollX)e.pagesX[a]=u,u-=e.wrapperW,a++;e.maxScrollX%e.wrapperW&&(e.pagesX[e.pagesX.length]=e.maxScrollX-e.pagesX[e.pagesX.length-1]+e.pagesX[e.pagesX.length-1]),u=0,a=0,e.pagesY=[];while(u>=e.maxScrollY)e.pagesY[a]=u,u-=e.wrapperH,a++;e.maxScrollY%e.wrapperH&&(e.pagesY[e.pagesY.length]=e.maxScrollY-e.pagesY[e.pagesY.length-1]+e.pagesY[e.pagesY.length-1])}e._scrollbar("h"),e._scrollbar("v"),e.zoomed||(e.scroller.style[n+"TransitionDuration"]="0",e._resetPos(200))},scrollTo:function(e,t,n,r){var i=this,s=e,o,u;i.stop(),s.length||(s=[{x:e,y:t,time:n,relative:r}]);for(o=0,u=s.length;o<u;o++)s[o].relative&&(s[o].x=i.x-s[o].x,s[o].y=i.y-s[o].y),i.steps.push({x:s[o].x,y:s[o].y,time:s[o].time||0});i._startAni()},scrollToElement:function(t,n){var r=this,i;t=t.nodeType?t:r.scroller.querySelector(t);if(!t)return;i=r._offset(t),i.left+=r.wrapperOffsetLeft,i.top+=r.wrapperOffsetTop,i.left=i.left>0?0:i.left<r.maxScrollX?r.maxScrollX:i.left,i.top=i.top>r.minScrollY?r.minScrollY:i.top<r.maxScrollY?r.maxScrollY:i.top,n=n===undefined?e.max(e.abs(i.left)*2,e.abs(i.top)*2):n,r.scrollTo(i.left,i.top,n)},scrollToPage:function(e,t,n){var r=this,i,s;n=n===undefined?400:n,r.options.onScrollStart&&r.options.onScrollStart.call(r),r.options.snap?(e=e=="next"?r.currPageX+1:e=="prev"?r.currPageX-1:e,t=t=="next"?r.currPageY+1:t=="prev"?r.currPageY-1:t,e=e<0?0:e>r.pagesX.length-1?r.pagesX.length-1:e,t=t<0?0:t>r.pagesY.length-1?r.pagesY.length-1:t,r.currPageX=e,r.currPageY=t,i=r.pagesX[e],s=r.pagesY[t]):(i=-r.wrapperW*e,s=-r.wrapperH*t,i<r.maxScrollX&&(i=r.maxScrollX),s<r.maxScrollY&&(s=r.maxScrollY)),r.scrollTo(i,s,n)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(v),this._unbind(m),this._unbind(g)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind("webkitTransitionEnd"):h(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(e,t,r,i){var s=this,o=r/s.scale;if(!s.options.useTransform)return;s.zoomed=!0,i=i===undefined?200:i,e=e-s.wrapperOffsetLeft-s.x,t=t-s.wrapperOffsetTop-s.y,s.x=e-e*o+s.x,s.y=t-t*o+s.y,s.scale=r,s.refresh(),s.x=s.x>0?0:s.x<s.maxScrollX?s.maxScrollX:s.x,s.y=s.y>s.minScrollY?s.minScrollY:s.y<s.maxScrollY?s.maxScrollY:s.y,s.scroller.style[n+"TransitionDuration"]=i+"ms",s.scroller.style[n+"Transform"]=b+s.x+"px,"+s.y+"px"+w+" scale("+r+")",s.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},typeof exports!="undefined"?exports.iScroll=E:window.iScroll=E})();function GameOver(e){return TGE.Screen.call(this,e),this.mAd,this.score=0,this}function MainMenu(e){return TGE.Screen.call(this,e),this.playBtn,this}function PauseScreen(e){return TGE.Screen.call(this,e),this}PoolGame=function(){PoolGame.superclass.constructor.call(this);var e=[{id:"loadingscreen",url:"images/loadingscreen/loadingscreen.jpg"}],t=[{id:"mainmenu_bg",url:"images/splashscreen/mainmenu_bg.jpg"},{id:"mainmenu_spark",url:"images/splashscreen/mainmenu_spark.png"},{id:"mainmenu_uptext",url:"images/splashscreen/mainmenu_uptext.png"},{id:"playBtn",url:"images/splashscreen/playbutton.png"},{id:"playagainbtn",url:"images/gameoverscreen/playagainbtn.png"},{id:"facebookbtn",url:"images/gameoverscreen/logofacebook.png"},{id:"twitterbtn",url:"images/gameoverscreen/logotwitter.png"},{id:"gameoverbg",url:"images/gameoverscreen/gameoverbg.jpg"},{id:"gamebg",url:"images/gamescreen/pooltable.jpg"},{id:"disablebtn",url:"images/disablebtn.png"},{id:"poolcue",url:"images/stick.png"},{id:"strikerball",url:"images/gamescreen/whiteball.png"},{id:"poolball",url:"images/gamescreen/redball.png"},{id:"levelupscreenBG",url:"images/levelupscreen/levelupscreen.jpg"},{id:"nextlevel",url:"images/levelupscreen/nextlevelbtn.png"},{id:"replay",url:"images/levelupscreen/replay.png"},{id:"helpButton",url:"images/gamescreen/instructionbtn.png"},{id:"pauseButton",url:"images/gamescreen/pausebtn.png"},{id:"soundButton",url:"images/gamescreen/sound.png"},{id:"muteButton",url:"images/gamescreen/mute.png"},{id:"pocketball",url:"images/gamescreen/pocket.png"},{id:"instructionscreend",url:"images/instructionscreen/instructionscreend.jpg"},{id:"instructionPlayButton",url:"images/instructionscreen/playbttuon.png"},{id:"pausescreen",url:"images/pausescreen/pausescreen.png"},{id:"resumeButton",url:"images/pausescreen/resumebutton.png"},{id:"ballTurns",url:"images/gamescreen/ballturns.png"},{id:"directionball",url:"images/gamescreen/tangentreference.png"},{id:"disableBallTurns",url:"images/gamescreen/ballturnsdis.png"},{id:"logocodewalla",url:"images/gameoverscreen/logocodewalla.png"},{id:"logotresensa",url:"images/gameoverscreen/logotresensa.png"}],n=[];this.mDeviceInfo=TGE.BrowserDetect.platform,this.isDevice=!0;if(this.mDeviceInfo==="Windows"||this.mDeviceInfo==="Mac")this.isDevice=!1;t=t.concat(n),this.assetManager.assignImageAssetList("loading",e),this.assetManager.assignImageAssetList("required",t),this.assetManager.rootLocation="images/assets-1.0.0",this.poolCue=null,this.strikerBall=null,this.turnBall=null,this.poewerSpeed=0,this.poewerSpeedStartX=0,this.powerOn=!1,this.pocketCoOrds=new Array,this.nGameState=0,this.currentnGameState=1,this.turnBallsArr=new Array,this.moveStarted=!1,this.levelBalls=new Array(1,3,3,4,4,5,5,6,6),this.levelBallsPotted=0,this.level=1,this.levelChances=new Array(5,4,3,5,4,5,4,5,4),this.strikerBallInside=!1,this.strikerBallAnimDone=!1,this.isLevelUp=!1,this.mouseClickedOnce=0,this.objWhiteBall={},this.score=0,this.scoreText=null,this.helpbtn=null,this.totalScore=0,this.directionBall=null,this.scale=30,this.world=null,this.turn=0,this.bodyCollided=!1,this.bIsGameTutsOn=!0,this.temp=null,this.popUpArray,this.inc=1,this.tempScore=0,this.circleCoords,this.coOrdinatesForTangent="",this.referenceBall,this.pocketInOneGo=0,this.isMute=!1,this.redBallIn=!1,this.pauseBtn,this.box2d={b2Vec2:Box2D.Common.Math.b2Vec2,b2AABB:Box2D.Collision.b2AABB,b2BodyDef:Box2D.Dynamics.b2BodyDef,b2Body:Box2D.Dynamics.b2Body,b2FixtureDef:Box2D.Dynamics.b2FixtureDef,b2Fixture:Box2D.Dynamics.b2Fixture,b2World:Box2D.Dynamics.b2World,b2MassData:Box2D.Collision.Shapes.b2MassData,b2PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape:Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw:!0,b2MouseJointDef:Box2D.Dynamics.Joints.b2MouseJointDef},this.setUpPhysics(),this.arrBox2dObjes=[]},PoolGame.prototype.subclassSetupLayers=function(){this.CreateLayer("gamebg"),this.CreateLayer("background"),this.CreateLayer("poolobjects"),this.CreateLayer("gameover")},PoolGame.prototype.subclassStartPlaying=function(){this.pocketInOneGo=0,this.circleCoords=new Array,this.turnBallsArr.splice(0,this.turnBallsArr.length),this.mouseClickedOnce=0,this.turn=0,this.pocketCoOrds.splice(0,this.pocketCoOrds.length),this.moveStarted=!1,this.strikerBallInside=!1,this.isLevelUp=!1,this.levelBallsPotted=this.levelBalls[this.level-1],this.nGameState=1,this.strikerBallAnimDone=!1,this.isRedBallPotted=!1,this.levelChances=new Array(5,4,3,5,4,5,4,5,4),this.popUpArray=[],this.arrStageObjes=[];while(this.arrBox2dObjes.length>0)this.world.DestroyBody(this.arrBox2dObjes[0]),this.arrBox2dObjes.splice(0,1);this.storePocketCoords(),this.CreateWorldEntity(TGE.ScreenEntity).Setup(this.stage.width/2,this.stage.height/2,"gamebg"),this.inGameTutText=this.CreateUIEntity(TGE.Text).Setup(this.stage.width/2,this.stage.height/3,"","20px Arial","center","middle","#ecff1a","gamebg"),this.inGameTutText_secondLine=this.CreateUIEntity(TGE.Text).Setup(this.stage.width/2,this.stage.height/3+25,"","20px Arial","center","middle","#ecff1a","gamebg"),this.generatePoolBalls(),this.objWhiteBall.TGEBALL=this.CreateWorldEntity(TGE.ScreenEntity).Setup(this.stage.width/2,this.stage.height/2,"strikerball"),this.objWhiteBall.TGEBALL.alpha=.6,this.scoreText=this.CreateUIEntity(TGE.Text).Setup(197,507,""+this.score,"20px Arial","center","middle","#fff","background"),this.levelText=this.CreateUIEntity(TGE.Text).Setup(387,507,""+this.level,"20px Arial","center","middle","#fff","background"),this.helpBtn=this.CreateUIEntity(TGE.Button).Setup(750,509,"helpButton",PoolGame.prototype.showInstructions.bind(this),2,"background"),this.referenceBall=this.CreateWorldEntity(TGE.ScreenEntity).Setup(0,0,"directionball"),this.referenceBall.visible=!1,this.showInGameTut(1),this.nGameState=1},PoolGame.prototype.disableTipBtnClick=function(){this.playAudio("click"),this.disableBtn.markForRemoval(),this.showInGameTut(0),this.bIsGameTutsOn=!1},PoolGame.prototype.subclassMouseDown=function(){if(this.mMouseX>730&&this.mMouseX<871&&this.mMouseY>487&&this.mMouseY<524){this.mouseClickedOnce=5;return}this.moveStarted&&this.nGameState==1&&this.checkCollision(this.objWhiteBall.TGEBALL)==""&&(this.mouseClickedOnce=1);if(this.nGameState==3){this.powerOn=!0,this.setRotation(0),this.bodyCollided=!1;var e=Math.cos(this.poolCue.rotation*.0174532925)*(this.objWhiteBall.TGEBALL.x-this.mMouseX),t=Math.sin(this.poolCue.rotation*.0174532925)*(this.objWhiteBall.TGEBALL.y-this.mMouseY);this.poewerSpeedStartX=Math.sqrt(e*e+t*t)}},PoolGame.prototype.subclassMouseUp=function(){if(this.mouseClickedOnce==5){this.mouseClickedOnce=0;return}this.mouseClickedOnce==1&&(this.nGameState=2,this.isDevice?this.showInGameTut(3):this.showInGameTut(2),this.currentnGameState=this.nGameState,this.moveStarted=!1,this.mouseClickedOnce=0),this.nGameState==2?(this.mouseClickedOnce=0,this.objWhiteBall.TGEBALL.alpha=1,this.mouseClickedOnce=0,this.generateStick(),this.setRotation(0),this.nGameState=3,this.currentnGameState=this.nGameState):this.nGameState==3&&(this.referenceBall.x=0,this.referenceBall.y=0,this.referenceBall.visible=!1,this.coOrdinatesForTangent="",this.poewerSpeed<0?(this.bodyCollided=!1,this.createStrikerBall(this.objWhiteBall.TGEBALL.x,this.objWhiteBall.TGEBALL.y),this.powerOn=!1,this.currentnGameState=this.nGameState,this.poolCue.x=this.objWhiteBall.TGEBALL.x,this.poolCue.y=this.objWhiteBall.TGEBALL.y,this.playAudio("soundcue"),this.objWhiteBall.BOX2DBALL.SetLinearVelocity({x:-(new Number(Math.cos(this.poolCue.rotation*.0174532925)*this.poewerSpeed)).toPrecision(15),y:-(new Number(Math.sin(this.poolCue.rotation*.0174532925)*this.poewerSpeed)).toPrecision(15)}),this.nGameState=5,this.poolCue.markForRemoval(),this.poolCue=null,this.currentnGameState=this.nGameState,this.poewerSpeed=0,this.showInGameTut(0)):this.powerOn=!0)},PoolGame.prototype.subclassMouseMove=function(){if(this.nGameState==1)this.mMouseX>125&&this.mMouseX<835&&this.mMouseY>71&&this.mMouseY<409&&!this.checkPocketCollision(this.objWhiteBall.TGEBALL)&&(this.objWhiteBall.TGEBALL.x=this.mMouseX,this.objWhiteBall.TGEBALL.y=this.mMouseY,this.moveStarted=!0);else if(this.nGameState==3){this.referenceBall.x=0,this.referenceBall.y=0,this.referenceBall.visible=!1,this.coOrdinatesForTangent="",this.bodyCollided=!1;if(this.powerOn){var e=Math.cos(this.poolCue.rotation*.0174532925)*(this.objWhiteBall.TGEBALL.x-this.mMouseX),t=Math.sin(this.poolCue.rotation*.0174532925)*(this.objWhiteBall.TGEBALL.y-this.mMouseY);this.poewerSpeed=Math.sqrt(e*e+t*t),this.poewerSpeed=this.poewerSpeedStartX-this.poewerSpeed,this.poewerSpeed<-70&&(this.poewerSpeed=-70),this.poewerSpeed>0&&(this.poewerSpeed=0)}else this.poewerSpeed=0;this.setRotation(this.poewerSpeed)}},PoolGame.prototype.subclassUpdateGame=function(e){this.nGameState==5&&(this.world.Step(1/60,10,10),this.world.ClearForces(),this.setUpdatedBallPosition())},PoolGame.prototype.setRotation=function(e){var t=Math.atan2(this.objWhiteBall.TGEBALL.y-this.mMouseY,this.objWhiteBall.TGEBALL.x-this.mMouseX)*180/Math.PI;this.poolCue.SetRotation(t),this.poolCue.x=this.objWhiteBall.TGEBALL.x+Math.cos(t*.0174532925)*e,this.poolCue.y=this.objWhiteBall.TGEBALL.y+Math.sin(t*.0174532925)*e},PoolGame.prototype.generateStick=function(){for(var e in this.arrBox2dObjes)this.arrBox2dObjes[e].SetLinearVelocity({x:0,y:0});return this.poolCue&&this.poolCue.markForRemoval(),this.nGameState=3,this.poolCue=this.CreateWorldEntity(TGE.ScreenEntity).Setup(this.objWhiteBall.TGEBALL.x,this.objWhiteBall.TGEBALL.y,"poolcue"),this.poolCue.scaleX=scaleY=-1,this.poewerSpeed=0,this.setRotation(0),!0},PoolGame.prototype.setUpdatedBallPosition=function(){var e=!1,t=this.objWhiteBall.TGEBALL.x,n=this.objWhiteBall.TGEBALL.y;if(!this.strikerBallInside){this.objWhiteBall.TGEBALL.x=this.objWhiteBall.BOX2DBALL.GetPosition().x*this.scale,this.objWhiteBall.TGEBALL.y=this.objWhiteBall.BOX2DBALL.GetPosition().y*this.scale,t=-this.objWhiteBall.TGEBALL.x,n=-this.objWhiteBall.TGEBALL.y;if(this.objWhiteBall.BOX2DBALL.GetLinearVelocity().x>=.2||this.objWhiteBall.BOX2DBALL.GetLinearVelocity().x<-0.2&&this.objWhiteBall.BOX2DBALL.GetLinearVelocity().y>=.2||this.objWhiteBall.BOX2DBALL.GetLinearVelocity().y<-0.2)e=!0}for(var r=0;r<this.arrStageObjes.length;r++){t=this.arrStageObjes[r].x,n=this.arrStageObjes[r].y,this.arrStageObjes[r].x=this.arrBox2dObjes[r].GetPosition().x*this.scale,this.arrStageObjes[r].y=this.arrBox2dObjes[r].GetPosition().y*this.scale,t=-this.arrStageObjes[r].x,n=-this.arrStageObjes[r].y;if(this.arrBox2dObjes[r].GetLinearVelocity().x>=.2||this.arrBox2dObjes[r].GetLinearVelocity().x<-0.2&&this.arrBox2dObjes[r].GetLinearVelocity().y>=.2||this.arrBox2dObjes[r].GetLinearVelocity().y<-0.2)e=!0}this.checkForCollision(e);if(!e){this.pocketInOneGo=0;if(this.levelChances[this.level-1]>0){if(this.levelBallsPotted==0)this.isLevelUp=!0,this.temp=this.level,this.onGameEnd();else if(!this.strikerBallInside){if(!this.isRedBallPotted){this.inc=1,this.turn++,this.turnBallsArr[this.turn-1].SetImage("disableBallTurns"),this.levelChances[this.level-1]=this.levelChances[this.level-1]-1;if(this.levelChances[this.level-1]==0)return this.levelBallsPotted==0?(this.isLevelUp=!0,this.temp=this.level,this.onGameEnd()):(this.onGameEnd(),this.temp=this.level,this.temp=this.level),!1}else this.isRedBallPotted=!1;this.world.DestroyBody(this.objWhiteBall.BOX2DBALL),this.objWhiteBall.BOX2DBALL=null;if(!this.generateStick())return;this.poewerSpeed=0,this.nGameState=3}else if(this.strikerBallAnimDone){if(!this.isRedBallPotted){this.inc=1,this.turn++,this.turnBallsArr[this.turn-1].SetImage("disableBallTurns"),this.levelChances[this.level-1]=this.levelChances[this.level-1]-1;if(this.levelChances[this.level-1]==0)return this.levelBallsPotted==0?(this.isLevelUp=!0,this.temp=this.level,this.onGameEnd()):(this.onGameEnd(),this.temp=this.level,this.temp=this.level),!1}else this.isRedBallPotted=!1;this.powerSpeed=0,this.nGameState=1,this.objWhiteBall.TGEBALL.alpha=.6,this.showInGameTut(1),this.strikerBallAnimDone=!1,this.strikerBallInside=!1,this.moveStarted=!0}}else this.levelBallsPotted==0?(this.isLevelUp=!0,this.temp=this.level,this.onGameEnd()):(this.onGameEnd(),this.temp=this.level)}},PoolGame.prototype.checkForCollision=function(e){for(var t=0;t<this.arrStageObjes.length;t++)this.checkPocketCollision(this.arrStageObjes[t])&&(this.playAudio("soundpocket"),this.levelBallsPotted--,this.inc+=1,this.inc!=1?(this.pocketInOneGo==1?(this.showScoreAnimPopUp(this.arrStageObjes[t].x,this.arrStageObjes[t].y,1e3*(this.inc-1)+500),this.score+=1e3*(this.inc-1)+500,this.tempScore+=1e3*(this.inc-1)+500):(this.showScoreAnimPopUp(this.arrStageObjes[t].x,this.arrStageObjes[t].y,1e3*(this.inc-1)),this.score+=1e3*(this.inc-1),this.tempScore+=1e3*(this.inc-1)),this.pocketInOneGo=1):(this.showScoreAnimPopUp(this.arrStageObjes[t].x,this.arrStageObjes[t].y,1e3),this.score+=1e3,this.tempScore+=1e3,this.pocketInOneGo=1),this.world.DestroyBody(this.arrBox2dObjes[t]),CWTween.to(this.arrStageObjes[t],.1,{scaleX:.4,scaleY:.4},{onComplete:this._completFunc.bind(this,this.arrStageObjes[t])}),this.arrStageObjes.splice(t,1),this.arrBox2dObjes.splice(t,1),this.circleCoords.splice(t,1));!this.strikerBallInside&&this.checkPocketCollision(this.objWhiteBall.TGEBALL)&&(this.showScoreAnimPopUp(this.objWhiteBall.TGEBALL.x,this.objWhiteBall.TGEBALL.y,-1e3),this.playAudio("soundpocket"),this.inc=1,this.score-=1e3,this.tempScore-=1e3,this.strikerBallInside=!0,this.strikerBallAnimDone=!1,this.objWhiteBall.BOX2DBALL&&(this.world.DestroyBody(this.objWhiteBall.BOX2DBALL),this.objWhiteBall.BOX2DBALL=null),CWTween.to(this.objWhiteBall.TGEBALL,.1,{scaleX:.4,scaleY:.4},{onComplete:this._completFunc1.bind(this,this.objWhiteBall.TGEBALL)}))},PoolGame.prototype.showScoreAnimPopUp=function(e,t,n){var r=this.CreateUIEntity(TGE.Text).Setup(e,t,""+n,"22px Arial","center","middle","#fff","background");r.scaleX=r.scaleY=.3,CWTween.to(r,.5,{scaleX:1,scaleY:1,x:this.stage.width/2,y:this.stage.height/2},{onComplete:this.onCompleteAnimPopUp.bind(this)}),this.popUpArray[this.popUpArray.length]=r},PoolGame.prototype.onCompleteAnimPopUp=function(){CWTween.to(this.popUpArray[0],.2,{scaleX:1.2,scaleY:1.2},{reverse:3,onComplete:this.onRemoveTextPopUp.bind(this,this.popUpArray[0])}),this.popUpArray.splice(0,1)},PoolGame.prototype.onRemoveTextPopUp=function(e){CWTween.to(e,.5,{x:190,y:500},{onComplete:this.onRemoveTextPopUp1.bind(this,e)})},PoolGame.prototype.onRemoveTextPopUp1=function(e){this.scoreText.text=this.score,e.markForRemoval()},PoolGame.prototype.checkPocketCollision=function(e){for(var t=0;t<this.pocketCoOrds.length;t++)if(this.pocketCoOrds[t].hitTestPoint(e.x,e.y))return e.x=this.pocketCoOrds[t].x,e.y=this.pocketCoOrds[t].y,!0;return!1},PoolGame.prototype._completFunc=function(e){this.isRedBallPotted=!0,e.markForRemoval()},PoolGame.prototype._completFunc1=function(e){this.isRedBallPotted=!1,this.strikerBallAnimDone=!0,this.objWhiteBall.TGEBALL.x=300,this.objWhiteBall.TGEBALL.y=300,this.objWhiteBall.TGEBALL.scaleX=1,this.objWhiteBall.TGEBALL.scaleY=1,this.objWhiteBall.TGEBALL.alpha=0},PoolGame.prototype.checkOtherBalls=function(e,t){for(var n=0;n<this.arrStageObjes.length;n++)if(this.arrStageObjes[n].x==e&&this.arrStageObjes[n].y==t)return!0;return!1},PoolGame.prototype.checkCollision=function(e){for(var t=0;t<this.arrStageObjes.length;t++)if(this.arrStageObjes[t].hitTestPoint(e.x,e.y))return""+t;return""},PoolGame.prototype.storePocketCoords=function(){var e=new Array(112,480,846,112,480,846),t=0;for(var n=0;n<6;n++)n<3?t=57:t=423,this.pocketCoOrds[n]=this.CreateWorldEntity(TGE.ScreenEntity).Setup(e[n],t,"pocketball","background"),this.pocketCoOrds[n].SetAlpha(0),this.pocketCoOrds[n].scaleX=this.pocketCoOrds[n].scaleY=1.1},PoolGame.prototype.createStrikerBall=function(e,t){var n=new this.box2d.b2FixtureDef;n.density=.5,n.friction=.05,n.restitution=.6;var r=new this.box2d.b2BodyDef;r.type=this.box2d.b2Body.b2_dynamicBody,r.position.x=e/this.scale,r.position.y=t/this.scale,r.bullet=!0,n.shape=new this.box2d.b2CircleShape(15/this.scale),this.objWhiteBall.BOX2DBALL&&this.world.DestroyBody(this.objWhiteBall.BOX2DBALL),this.objWhiteBall.BOX2DBALL=this.world.CreateBody(r),this.objWhiteBall.BOX2DBALL.CreateFixture(n),this.objWhiteBall.BOX2DBALL.SetLinearDamping(.7)},PoolGame.prototype.showInstructions=function(){this.playAudio("click"),this.currentnGameState=this.nGameState,this.nGameState=10,this.isDevice||(this.InstructionScreen=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"instructionscreend","gameover")),this.helpBtn.mouseEnabled=!1,this.resume=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.48),this.mScreenManager.YFromPercentage(.85),"instructionPlayButton",PoolGame.prototype.playagain.bind(this),2,"gameover")},PoolGame.prototype.storeCircleCoords=function(e){var t=new Array;for(var n=0;n<=360;n++){var r=n*174532925,i=14,s=i*Math.cos(r)+e.x,o=i*Math.sin(r)+e.y;t.push(o+","+s)}this.circleCoords.push(t)},PoolGame.prototype.generatePoolBalls=function(){for(var e=0;e<this.levelBalls[this.level-1];){var t=Math.floor(Math.random()*670)+150,n=Math.floor(Math.random()*310)+95,r=new this.box2d.b2FixtureDef;r.density=.5,r.friction=.05,r.restitution=.6;var i=new this.box2d.b2BodyDef;i.type=this.box2d.b2Body.b2_dynamicBody,i.position.x=t/this.scale,i.position.y=n/this.scale,i.bullet=!0,r.shape=new this.box2d.b2CircleShape(15/this.scale);var s=this.world.CreateBody(i);s.CreateFixture(r),s.SetLinearDamping(.7),this.arrBox2dObjes.push(s);var o=this.CreateWorldEntity(TGE.ScreenEntity).Setup(s.GetPosition().x*this.scale,s.GetPosition().y*this.scale,"poolball");this.storeCircleCoords(o),o.SetScale(1.14,1.14),this.arrStageObjes.push(o),e++}this.generateTurnsBall(),this.world.Step(1/60,10,10),this.world.ClearForces();for(var e=0;e<this.arrStageObjes.length;e++)this.arrStageObjes[e].x=this.arrBox2dObjes[e].GetPosition().x*this.scale,this.arrStageObjes[e].y=this.arrBox2dObjes[e].GetPosition().y*this.scale},PoolGame.prototype.generateTurnsBall=function(){var e=540,t=511;for(var n=0;n<this.levelChances[this.level-1];)this.turnBall=this.CreateWorldEntity(TGE.ScreenEntity).Setup(e,t,"ballTurns"),this.turnBallsArr.push(this.turnBall),e+=40,n++},PoolGame.prototype.playagain=function(){this.playAudio("click"),this.helpBtn.mouseEnabled=!0,this.InstructionScreen.Hide(),this.resume.Hide(),this.nGameState=this.currentnGameState},PoolGame.prototype.pauseGame=function(){this.playAudio("click"),this.PauseGame(!0)},PoolGame.prototype.Update=function(){PoolGame.superclass.Update.call(this),this.nGameState==3&&!this.mPaused&&this.drawInclinedLine()},CanvasRenderingContext2D.prototype.dashedLine=function(e,t,n,r,i){i==undefined&&(i=7),this.moveTo(e,t),this.lineWidth=3;var s=n-e,o=r-t,u=Math.floor(Math.sqrt(s*s+o*o)/i),a=s/u,f=o/u,l=0;while(l++<u)e+=a,t+=f,this[l%2==0?"moveTo":"lineTo"](e,t);this[l%2==0?"moveTo":"lineTo"](n,r),this.stroke()},PoolGame.prototype.drawInclinedLine=function(){var e=this.stage._mCanvasContext;e.strokeStyle="#ffffff",e.globalAlpha=.5,e.beginPath();var t=this.poolCue.rotation*.0174532925,n="",e=this.stage._mCanvasContext;e.strokeStyle="#ffffff",e.globalAlpha=.3,e.beginPath();var t=this.poolCue.rotation*.0174532925,n="";if(this.coOrdinatesForTangent=="")for(var r=1;r<=809;r+=1){n=this.drawCircleCoordsForCollision(this.objWhiteBall.TGEBALL.x+r*Math.cos(t),this.objWhiteBall.TGEBALL.y+r*Math.sin(t));if(n!=""){e.dashedLine(this.objWhiteBall.TGEBALL.x,this.objWhiteBall.TGEBALL.y,this.objWhiteBall.TGEBALL.x+r*Math.cos(t),this.objWhiteBall.TGEBALL.y+r*Math.sin(t));if(this.coOrdinatesForTangent.split(",").length==4){var i=Math.atan((this.referenceBall.y-this.coOrdinatesForTangent.split(",")[3])/(this.referenceBall.x-this.coOrdinatesForTangent.split(",")[2]));this.referenceBall.x>this.coOrdinatesForTangent.split(",")[2]?e.dashedLine(parseFloat(this.coOrdinatesForTangent.split(",")[2]),parseFloat(this.coOrdinatesForTangent.split(",")[3]),parseFloat(this.coOrdinatesForTangent.split(",")[2])-50*Math.cos(i),parseFloat(this.coOrdinatesForTangent.split(",")[3])-50*Math.sin(i)):e.dashedLine(parseFloat(this.coOrdinatesForTangent.split(",")[2]),parseFloat(this.coOrdinatesForTangent.split(",")[3]),parseFloat(this.coOrdinatesForTangent.split(",")[2])+50*Math.cos(i),parseFloat(this.coOrdinatesForTangent.split(",")[3])+50*Math.sin(i))}else this.referenceBall.y>=408||this.referenceBall.y<=72?e.dashedLine(this.referenceBall.x,this.referenceBall.y,this.referenceBall.x-50*Math.cos(180*.0174532925-t),this.referenceBall.y-50*Math.sin(180*.0174532925-t)):e.dashedLine(this.referenceBall.x,this.referenceBall.y,this.referenceBall.x+50*Math.cos(180*.0174532925-t),this.referenceBall.y+50*Math.sin(180*.0174532925-t));break}}else{var s=Math.sqrt(Math.pow(this.coOrdinatesForTangent.split(",")[0]-this.objWhiteBall.TGEBALL.x,2)+Math.pow(this.coOrdinatesForTangent.split(",")[1]-this.objWhiteBall.TGEBALL.y,2));e.dashedLine(this.objWhiteBall.TGEBALL.x,this.objWhiteBall.TGEBALL.y,this.objWhiteBall.TGEBALL.x+s*Math.cos(t),this.objWhiteBall.TGEBALL.y+s*Math.sin(t));if(this.coOrdinatesForTangent.split(",").length==4){var i=Math.atan((this.referenceBall.y-this.coOrdinatesForTangent.split(",")[3])/(this.referenceBall.x-this.coOrdinatesForTangent.split(",")[2]));this.referenceBall.x>this.coOrdinatesForTangent.split(",")[2]?e.dashedLine(parseFloat(this.coOrdinatesForTangent.split(",")[2]),parseFloat(this.coOrdinatesForTangent.split(",")[3]),parseFloat(this.coOrdinatesForTangent.split(",")[2])-50*Math.cos(i),parseFloat(this.coOrdinatesForTangent.split(",")[3])-50*Math.sin(i)):e.dashedLine(parseFloat(this.coOrdinatesForTangent.split(",")[2]),parseFloat(this.coOrdinatesForTangent.split(",")[3]),parseFloat(this.coOrdinatesForTangent.split(",")[2])+50*Math.cos(i),parseFloat(this.coOrdinatesForTangent.split(",")[3])+50*Math.sin(i))}else this.referenceBall.y>=408||this.referenceBall.y<=72?e.dashedLine(this.referenceBall.x,this.referenceBall.y,this.referenceBall.x-50*Math.cos(180*.0174532925-t),this.referenceBall.y-50*Math.sin(180*.0174532925-t)):e.dashedLine(this.referenceBall.x,this.referenceBall.y,this.referenceBall.x+50*Math.cos(180*.0174532925-t),this.referenceBall.y+50*Math.sin(180*.0174532925-t))}},PoolGame.prototype.drawCircleCoordsForCollision=function(e,t){var n="";this.referenceBall.x=e,this.referenceBall.y=t;var r=this.checkForDirectionBallCollision();return r!=""&&(this.referenceBall.visible=!0,this.referenceBall.alpha=.5,this.coOrdinatesForTangent=e+","+t+","+r),r},PoolGame.prototype.checkForDirectionBallCollision=function(){for(var e=0;e<this.arrStageObjes.length;e++){var t=Math.sqrt(Math.pow(this.referenceBall.x-this.arrStageObjes[e].x,2)+Math.pow(this.referenceBall.y-this.arrStageObjes[e].y,2));if(t<=28)return this.arrStageObjes[e].x+","+this.arrStageObjes[e].y}return this.referenceBall.hitTestPoint(852,this.referenceBall.y+14*Math.sin(this.poolCue.rotation*.0174532925))||this.referenceBall.hitTestPoint(110,this.referenceBall.y+14*Math.sin(this.poolCue.rotation*.0174532925))?"x":this.referenceBall.hitTestPoint(this.referenceBall.x+14*Math.cos(this.poolCue.rotation*.0174532925),52)||this.referenceBall.hitTestPoint(this.referenceBall.x+14*Math.cos(this.poolCue.rotation*.0174532925),430)?"y":""},PoolGame.prototype.setUpPhysics=function(){this.world=new this.box2d.b2World(new this.box2d.b2Vec2(0,0),!0);var e=new this.box2d.b2FixtureDef;e.density=1,e.friction=.05,e.restitution=.6;var t=new this.box2d.b2BodyDef;t.type=this.box2d.b2Body.b2_staticBody,t.position.x=800/this.scale,t.position.y=561/this.scale,e.shape=new this.box2d.b2PolygonShape,e.shape.SetAsEdge({x:1,y:1},{x:1,y:11.1}),t.position.Set(84/this.scale,60/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:1},{x:1,y:10.9}),t.position.Set(817/this.scale,67/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:0},{x:11.2,y:0}),t.position.Set(118/this.scale,57/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:0},{x:11.2,y:0}),t.position.Set(118/this.scale,425/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:0},{x:11.2,y:0}),t.position.Set(478/this.scale,57/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:0},{x:11.2,y:0}),t.position.Set(478/this.scale,425/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1.5,y:.6},{x:3,y:1.6}),t.position.Set(58/this.scale,8/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1.7,y:.1},{x:3,y:1.6}),t.position.Set(24/this.scale,43/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:2,y:.5},{x:1,y:1.5}),t.position.Set(52/this.scale,10/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:2.5,y:1},{x:1,y:1}),t.position.Set(430/this.scale,5/this.scale),this.body1=this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:.8,y:1.5},{x:1.5,y:.5}),t.position.Set(430/this.scale,12/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:.5},{x:2,y:1.5}),t.position.Set(450/this.scale,13/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:.6,y:1.7},{x:2,y:.8}),t.position.Set(795/this.scale,6/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:.8,y:1.9},{x:2,y:.5}),t.position.Set(823/this.scale,41/this.scale),this.body1=this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:1},{x:2,y:2}),t.position.Set(820/this.scale,5/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:.6,y:2},{x:2,y:.8}),t.position.Set(88/this.scale,401/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:.8,y:2},{x:2,y:.5}),t.position.Set(54/this.scale,377/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:1},{x:2,y:2}),t.position.Set(55/this.scale,395/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:2.5,y:1},{x:1,y:1}),t.position.Set(432/this.scale,415/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:.8,y:1.5},{x:1.5,y:.5}),t.position.Set(464/this.scale,410/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:.5},{x:2,y:1.5}),t.position.Set(423/this.scale,410/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:3,y:1.6},{x:1.5,y:.6}),t.position.Set(801/this.scale,376/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:2,y:1.5},{x:0,y:.1}),t.position.Set(813/this.scale,422/this.scale),this.world.CreateBody(t).CreateFixture(e),e.shape.SetAsEdge({x:1,y:1.5},{x:2,y:.2}),t.position.Set(820/this.scale,408/this.scale),this.world.CreateBody(t).CreateFixture(e),this.bIsBox2DSetup=!0;var n=new Box2D.Dynamics.b2ContactListener,r=this;n.BeginContact=function(e,t){r.position1="",r.position2="";if(r.nGameState==5){var n=new Box2D.Collision.b2WorldManifold;e.GetWorldManifold(n);var i=e.GetFixtureA().GetBody(),s=e.GetFixtureB().GetBody(),o=r.arrBox2dObjes.indexOf(i);if(i==r.objWhiteBall.BOX2DBALL||o>0)o=r.arrBox2dObjes.indexOf(s);o>=0&&r.playAudio("soundball"),r.bodyCollided=!0}},this.world.SetContactListener(n)},PoolGame.prototype.showInGameTut=function(e){this.bIsGameTutsOn&&(CWTween.to(this.inGameTutText,.3,{alpha:0,y:this.inGameTutText.y-50},{onComplete:this.onScaleDownAnimComplete.bind(this,e)}),CWTween.to(this.inGameTutText_secondLine,.3,{alpha:0,y:this.inGameTutText_secondLine.y-50}))},PoolGame.prototype.onScaleDownAnimComplete=function(e){this.inGameTutText_secondLine.text="",this.inGameTutText.y=this.stage.height/3.5,this.inGameTutText_secondLine.y=this.stage.height/3.5+25;switch(e){case 0:this.inGameTutText.text="";break;case 1:this.inGameTutText.text="把白球放在桌面的任意位置.";break;case 2:this.inGameTutText.text="触摸球杆之后向后拖动以调整击球力度，旋转球杆调整角度，",this.inGameTutText_secondLine.text="松手之后击球.";break;case 3:this.inGameTutText.text="触摸球杆之后向后拖动以调整击球力度，旋转球杆调整角度，",this.inGameTutText_secondLine.text="松手之后击球.";break;case 4:this.inGameTutText.markForRemoval(),this.inGameTutText=this.CreateUIEntity(TGE.Text).Setup(this.stage.width/2,this.stage.height/2.5,"","25px Arial","center","middle","#ecff1a","gamebg"),this.inGameTutText.text="太棒了 ! 再来一次吧.";break;case 5:this.inGameTutText.markForRemoval(),this.inGameTutText=this.CreateUIEntity(TGE.Text).Setup(this.stage.width/2,this.stage.height/2.5,"","25px Arial","center","middle","#ecff1a","gamebg"),this.inGameTutText.text="恭喜 ! 太棒了."}this.inGameTutText.alpha=0,this.inGameTutText_secondLine.alpha=0,CWTween.to(this.inGameTutText,.3,{alpha:1,y:this.inGameTutText.y-50}),CWTween.to(this.inGameTutText_secondLine,.3,{alpha:1,y:this.inGameTutText_secondLine.y-50})},PoolGame.prototype.onGameEnd=function(){for(var e=0;e<this.arrBox2dObjes.length;e++)this.world.DestroyBody(this.arrBox2dObjes[e]),this.arrBox2dObjes.splice(e,1);this.objWhiteBall.BOX2DBALL&&(this.world.DestroyBody(this.objWhiteBall.BOX2DBALL),this.objWhiteBall.BOX2DBALL=null),this.nGameState=0,this.bIsGameTutsOn?(this.isLevelUp?this.showInGameTut(5):this.showInGameTut(4),CWTween.to(this.objWhiteBall.TGEBALL,3,{scaleX:1},{onComplete:this.onEndAnimComplete.bind(this)})):this.EndGame(),this.bIsGameTutsOn=!1},PoolGame.prototype.onEndAnimComplete=function(e){this.EndGame()},PoolGame.prototype.playAudio=function(e){switch(e){case"levelup":this.audioManager.Play({id:"levelup",loop:"0"});break;case"soundball":this.audioManager.Play({id:"soundball",loop:"0"});break;case"soundcue":this.audioManager.Play({id:"soundcue",loop:"0"});break;case"soundpocket":this.audioManager.Play({id:"soundpocket",loop:"0"});break;case"click":this.audioManager.Play({id:"click",loop:"0"});break;case"levellose":this.audioManager.Play({id:"levellose",loop:"0"})}},PoolGame.prototype.toggleSound=function(){this.playAudio("click"),this.audioManager.mMuted?(this.sound.SetImage("soundButton",1,2),this.isMute=!1):(this.sound.SetImage("muteButton",1,2),this.isMute=!0),this.audioManager.ToggleMute()},extend(PoolGame,TGE.Game),GameOver.prototype=new TGE.Screen,GameOver.prototype.constructor=GameOver,GameOver.prototype.Setup=function(){this.Game().ClearScene();var e=document.getElementById("game_canvas");this.Game().score<0?this.score=0:this.score=this.Game().score,this.Game().isLevelUp?this.Game().level!=8?(this.Game().showLbBtns=!1,this.Game().playAudio("levelup"),this.bg=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"levelupscreenBG","gameover"),this.levelTxt=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.3),this.mScreenManager.YFromPercentage(.63),"第 "+(this.Game().level+1)+" 级解锁 !"," 30px Arial","center","middle","#fff","gameover"),this.msgTxt=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.3),this.mScreenManager.YFromPercentage(.43),"太棒了!","bold 50px Arial","center","middle","#ecff19","gameover"),this.scoreTxt=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.3),this.mScreenManager.YFromPercentage(.53),"你获得了 "+this.Game().score+" 分","30px Arial","center","middle","#fff","gameover"),this.nxtBtn=this.CreateUIEntity(TGE.Button).Setup(197,420,"nextlevel",GameOver.prototype.nextLevelBtnClick.bind(this),2,"gameover"),this.replyBtn=this.CreateUIEntity(TGE.Button).Setup(420,420,"replay",GameOver.prototype.replayLevelBtnClick.bind(this),2,"gameover")):(this.Game().showLbBtns=!0,this.Game().playAudio("levelup"),this.bg=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"gameoverbg","gameover"),this.msgTxt=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.3),this.mScreenManager.YFromPercentage(.42),"太棒了!","bold 50px Arial","center","middle","#ecff19","gameover"),this.scoreTxt=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.3),this.mScreenManager.YFromPercentage(.55),"你获得了 "+this.Game().score+" 分","30px Arial","center","middle","#fff","gameover"),this.nxtBtn=this.CreateUIEntity(TGE.Button).Setup(197,370,"playagainbtn",GameOver.prototype.playAgain.bind(this),2,"gameover"),this.replyBtn=this.CreateUIEntity(TGE.Button).Setup(420,370,"replay",GameOver.prototype.replayLevelBtnClick.bind(this),2,"gameover"),this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.1),this.mScreenManager.YFromPercentage(.08),"logocodewalla","gameover"),this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.95),this.mScreenManager.YFromPercentage(.12),"logotresensa","gameover")):(this.Game().showLbBtns=!0,this.Game().playAudio("levellose"),this.bg=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"gameoverbg","gameover"),this.Game().score>0&&(this.msgTxt=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.3),this.mScreenManager.YFromPercentage(.42),"太棒了!","bold 50px Arial","center","middle","#ecff19","gameover")),this.scoreTxt=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.3),this.mScreenManager.YFromPercentage(.55),"你获得了 "+this.Game().score+" 分","30px Arial","center","middle","#fff","gameover"),this.Game().score<0&&(this.scoreTxt.text="你获得了 0 分"),this.replyBtn=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.32),this.mScreenManager.YFromPercentage(.7),"replay",GameOver.prototype.replayLevelBtnClick.bind(this),2,"gameover"),this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.1),this.mScreenManager.YFromPercentage(.08),"logocodewalla","gameover"),this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.95),this.mScreenManager.YFromPercentage(.12),"logotresensa","gameover")),this.Game().showLbBtns,this.Game().showLbBtns=!1},GameOver.prototype.replayLevelBtnClick=function(){this.Game().playAudio("click"),this.removeAllData(),this.Game().ClearScene(),this.Game().StartPlaying(),this.Game().score-=this.Game().tempScore,this.Game().scoreText.text=this.Game().score,this.Game().tempScore=0,this.Game().inc=1,this.Game().isMute==1,this.Game().level=this.Game().temp,this.Close()},GameOver.prototype.nextLevelBtnClick=function(){this.Game().playAudio("click"),this.removeAllData(),this.Game().ClearScene(),this.Game().inc=1,this.Game().tempScore=0,this.Game().level++,this.Game().StartPlaying(),this.Close()},GameOver.prototype.mainMenuBtnClick=function(){this.Game().playAudio("click"),this.removeAllData(),this.Close()},GameOver.prototype.removeAllData=function(){this.replyBtn.markForRemoval(),this.nxtBtn&&this.nxtBtn.markForRemoval(),this.msgTxt&&this.msgTxt.markForRemoval(),this.scoreTxt.markForRemoval(),this.fbBtn&&this.fbBtn.markForRemoval(),this.twiiterBtn&&this.twiiterBtn.markForRemoval(),this.fbBtn=null,this.twiiterBtn=null,this.levelTxt=null,this.msgTxt=null,this.replyBtn=null,this.nxtBtn=null,this.scoreTxt=null},GameOver.prototype.playAgain=function(){this.Game().playAudio("click"),this.removeAllData(),this.Game().ClearScene(),this.Game().inc=1,this.Game().tempScore=0,this.Game().level=1,this.Game().score=0,this.Game().StartPlaying(),this.Game().isMute==1?this.Game().sound.SetImage("muteButton",1,2):this.Game().sound.SetImage("soundButton",1,2),this.Close()},GameOver.prototype.triggerLeaderboard=function(e){var t=new LeaderBoardWidgetConfig;t.lbWidgetConfig.GAME.TRY_AGAIN_METHOD=this.playAgain.bind(this),t.lbWidgetConfig.GAME.LB_TYPE=e,t.lbWidgetConfig.GAME.GAME_SCORE=this.score},GameOver.prototype.socialNetWorkTwitter=function(){this.mAd!==null,this.triggerLeaderboard("twitter")},GameOver.prototype.socialNetWorkFacebook=function(){this.mAd!==null,this.triggerLeaderboard("facebook")},LoadingScreen=function(e){return TGE.Screen.call(this,e),this.mLoadingText=null,this},LoadingScreen.prototype={Setup:function(){this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"loadingscreen",this.mScreenManager.mLayerName),this.isLevelUp=!0,this.mLoadingText=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"努力加载中 0%","bold 30px Arial","center","middle","#d8fe00",this.mScreenManager.mLayerName)},UpdateProgress:function(e){var t="努力加载中.. "+Math.round(e*100).toString()+"%";this.mLoadingText.text=t}},extend(LoadingScreen,TGE.Screen),MainMenu.prototype=new TGE.Screen,MainMenu.prototype.constructor=MainMenu,MainMenu.prototype.Setup=function(){this.FillBackground("#FFF"),this.mainmenu_bg=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.width/2,this.height/2,"mainmenu_bg",this.mScreenManager.mLayerName),this.mainmenu_spark=this.CreateUIEntity(TGE.ScreenEntity).Setup(478,250,"mainmenu_spark",this.mScreenManager.mLayerName),this.mainmenu_uptext=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.width/2,this.height/2,"mainmenu_uptext",this.mScreenManager.mLayerName),this.playBtn=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.75),"playBtn",MainMenu.prototype.playGame.bind(this),2,this.mScreenManager.mLayerName)},MainMenu.prototype.Update=function(e){this.mainmenu_spark.rotation=this.mainmenu_spark.rotation+e*4},MainMenu.prototype.playGame=function(){this.Game().playAudio("click"),this.Game().StartPlaying(),this.Close()},PauseScreen.prototype=new TGE.Screen,PauseScreen.prototype.constructor=PauseScreen,PauseScreen.prototype.Setup=function(){this.pausebg=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"pausescreen",this.mScreenManager.mLayerName),this.resumeButton=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"resumeButton",PauseScreen.prototype.playagain.bind(this),2,this.mScreenManager.mLayerName),this.Game().sound.mouseEnabled=!1,this.Game().helpBtn.mouseEnabled=!1,this.Game().pauseBtn.mouseEnabled=!1},PauseScreen.prototype.playagain=function(){this.Game().playAudio("click"),this.Game().PauseGame(!1),this.resumeButton.Hide(),this.Game().sound.mouseEnabled=!0,this.Game().helpBtn.mouseEnabled=!0,this.Game().pauseBtn.mouseEnabled=!0,this.Close()};(function(e){function t(){}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";(function(e){function r(e,t){return this.slice(e,t)}function i(e,t){var n,r=e.length;arguments.length<2&&(t=0);for(n=0;n<r;++n,++t)this[t]=e[n]&255}function s(e){var t,n;if(typeof e=="number"){t=new Array(e);for(n=0;n<e;++n)t[n]=0}else t=e.slice(0);return t.subarray=r,t.buffer=t,t.byteLength=t.length,t.set=i,typeof e=="object"&&e.buffer&&(t.buffer=e.buffer),t}try{var t=new Uint8Array(1);return}catch(n){}e.Uint8Array=s,e.Uint32Array=s,e.Int32Array=s})(e),function(e){if(e.opera)return;if("response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype)return;var t;e.VBArray?t=function(){return new Uint8Array((new VBArray(this.responseBody)).toArray())}:t=function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:t})}(e),e.btoa||(e.btoa=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e)return e;do n=e.charCodeAt(l++),r=e.charCodeAt(l++),i=e.charCodeAt(l++),f=n<<16|r<<8|i,s=f>>18&63,o=f>>12&63,u=f>>6&63,a=f&63,p[c++]=t.charAt(s)+t.charAt(o)+t.charAt(u)+t.charAt(a);while(l<e.length);h=p.join("");var d=e.length%3;return(d?h.slice(0,d-3):h)+"===".slice(d||3)}),t.prototype.fontFamily="fjs"+(999999*Math.random()|0),t.prototype.url="",t.prototype.format="",t.prototype.data="",t.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",t.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},t.prototype.systemfont=!1,t.prototype.loaded=!1,t.prototype.onload=function(){},t.prototype.onerror=function(){},t.prototype.canvas=!1,t.prototype.context=!1,t.prototype.validate=function(e,t,n,r,i){if(i!==!1&&i<0){this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed).");return}var s=document.defaultView.getComputedStyle(e,""),o=s.getPropertyValue("width").replace("px","");o>0?(document.head.removeChild(t),document.body.removeChild(e),this.loaded=!0,this.onload()):setTimeout(function(){r.validate(e,t,n,r,i===!1?!1:i-50)},50)},t.prototype.ondownloaded=function(){var e=function(e){return String.fromCharCode(e)},t=function(t){if(t<256)return e(0)+e(t);var n=t>>8,r=t&255;return e(n)+e(r)},n=function(e){return e<0&&(e=4294967295+e+1),parseInt(e,10).toString(16)},r=function(e,t){return 256*e+t},i=function(e,t){var n=e>>7===1,r;return e&=127,r=256*e+t,n?r-32768:r},s=function(e,t,n,r){return 16777216*e+65536*t+256*n+r},o=function(e){this.onerror(e)},u=e(0)+e(1)+e(0)+e(0),a="OTTO",f=this.data,l=e(f[0])+e(f[1])+e(f[2])+e(f[3]),c=l===u,h=c?!1:l===a;if(c)this.format="truetype";else{if(!h){o("Error: file at "+this.url+" cannot be interpreted as OpenType font.");return}this.format="opentype"}var p=r(f[4],f[5]),d=12,v,m=d+16*p,g={},y;for(v=d;v<m;v+=16)y=e(f[v])+e(f[v+1])+e(f[v+2])+e(f[v+3]),g[y]={name:y,checksum:s(f[v+4],f[v+5],f[v+6],f[v+7]),offset:s(f[v+8],f[v+9],f[v+10],f[v+11]),length:s(f[v+12],f[v+13],f[v+14],f[v+15])};var b=function(e){return g[e]?e:(o("Error: font is missing the required OpenType '"+e+"' table."),!1)};y=b("head");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1]+f[v+2]+f[v+3];var w=r(f[v+18],f[v+19]);this.metrics.quadsize=w,y=b("hhea");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1]+f[v+2]+f[v+3],this.metrics.ascent=i(f[v+4],f[v+5])/w,this.metrics.descent=i(f[v+6],f[v+7])/w,this.metrics.leading=i(f[v+8],f[v+9])/w,y=b("OS/2");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1],this.metrics.weightclass=r(f[v+4],f[v+5]),y=b("cmap");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1],p=r(f[v+2],f[v+3]);var E,S,x,T,N,C=!1;for(var E=0;E<p;E++)S=v+4+E*8,x=r(f[S],f[S+1]),T=r(f[S+2],f[S+3]),N=s(f[S+4],f[S+5],f[S+6],f[S+7]),x===3&&T===1&&(C=N);var k="A";if(C!==!1){v+=C,l=r(f[v],f[v+1]);if(l===4){var L=r(f[v+6],f[v+7])/2,A=function(e){return[9,10,11,12,13,32,133,160,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288].indexOf(e)===-1},O=v+14,M=v+14+2*L,_=!1;for(;O<M;O+=2){_=r(f[O],f[O+1]);if(A(_))break;_=!1}if(_!==!1){k=String.fromCharCode(_);var D=-(_-1)+65536,P=btoa(e(0)+t(_)+t(65535)+t(0)+t(_)+t(65535)+t(D)+t(1));this.base64=this.base64.substring(0,380)+P+this.base64.substring(380+P.length)}}}this.bootstrapValidation(k,!1)},t.prototype.bootstrapValidation=function(e,t){var n=this.fontFamily+" testfont",r=document.createElement("style");r.setAttribute("type","text/css"),r.innerHTML="@font-face {\n  font-family: '"+n+"';\n"+"  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n"+"       format('truetype');}",document.head.appendChild(r);var i=!1;this.systemfont||(i=this.toStyleNode(),document.head.appendChild(i));var s=document.createElement("p");s.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",s.style.fontFamily="'"+this.fontFamily+"', '"+n+"'",s.innerHTML=e+e+e+e+e+e+e+e+e+e,document.body.appendChild(s);if(!document.defaultView.getComputedStyle)this.onload(),error("Error: document.defaultView.getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var o=this.systemfont?1e3:this.metrics.quadsize,u=document.createElement("canvas");u.width=o,u.height=o,this.canvas=u;var a=u.getContext("2d");a.font="1em '"+this.fontFamily+"'",a.fillStyle="white",a.fillRect(-1,-1,o+2,o+2),a.fillStyle="black",a.fillText("test text",50,o/2),this.context=a;var f=this,l=function(){f.validate(s,r,i,f,t)};setTimeout(l,50)}},t.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},t.prototype.loadFont=function(){var e=this;if(this.url.indexOf(".")===-1){setTimeout(function(){e.processSystemFont()},10);return}var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=function(n){var r=t.response;r?(e.data=new Uint8Array(r),e.ondownloaded()):e.onerror("Error downloading font resource from "+e.url)},t.send(null)},t.prototype.styleNode=!1,t.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css";var e="@font-face {\n";return e+="  font-family: '"+this.fontFamily+"';\n",e+="  src: url('"+this.url+"') format('"+this.format+"');\n",e+="}",this.styleNode.innerHTML=e,this.styleNode},t.prototype.measureText=function(e,t){if(!this.loaded)return error("measureText() was called while the font was not yet loaded"),!1;this.context.font=t+"px '"+this.fontFamily+"'";var n=this.context.measureText(e);n.fontsize=t,n.ascent=0,n.descent=0,n.bounds={minx:0,maxx:n.width,miny:0,maxy:0},n.height=0;var r=[],i=n.width/this.metrics.quadsize;i<=1?r.push(e):r.push(e);var s=r.length,o;for(o=0;o<s;o++)this.measureSegment(r[o],t,n);return n},t.prototype.measureSegment=function(e,t,n){var r=function(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},i,s=document.createElement("div");s.style.position="absolute",s.style.opacity=0,s.style.font=t+"px '"+this.fontFamily+"'";var o=10;s.innerHTML=e;for(i=1;i<o;i++)s.innerHTML+="<br/>"+e;document.body.appendChild(s),n.leading=1.2*t;var u=r(s,"height");u=u.replace("px",""),u>=t*o&&(n.leading=u/o|0),document.body.removeChild(s);if(/^\s*$/.test(e))return n;var a=this.canvas,f=this.context,l=this.systemfont?1e3:this.metrics.quadsize,c=l,h=l,p=l/2,d=50,v=(l-n.width)/2;v!==(v|0)&&(v|=0),f.fillStyle="white",f.fillRect(-d,-d,c+2*d,h+2*d),f.fillStyle="black",f.fillText(e,v,p);var m=n.width+d|0,g=4*t,y=v-d/2,b=p-g/2,w=f.getImageData(y,b,m,g).data,i=0,E=0,S=m*4,x=w.length,T=g/2;while(++i<x&&w[i]===255);var N=i/S|0;i=x-1;while(--i>0&&w[i]===255);var C=i/S|0;for(i=0,E=0;E<m&&w[i]===255;)i+=S,i>=x&&(E++,i=i-x+4);var k=E,L=1;for(i=x-3,E=0;E<m&&w[i]===255;)i-=S,i<0&&(E++,i=x-3-L++*4);var A=m-E;return n.ascent=T-N,n.descent=C-T,n.bounds={minx:k-d/2,maxx:A-d/2,miny:-n.descent,maxy:n.ascent},n.height=1+(C-N),n},Object.defineProperty(t.prototype,"src",{set:function(e){this.url=e,this.loadFont()}}),e.Font=t})(window);