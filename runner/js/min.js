var viewporter;(function(){var e;viewporter={forceDetection:!1,preventPageScroll:!1,ACTIVE:function(){return/ipad/i.test(navigator.userAgent)?!1:/webos/i.test(navigator.userAgent)?!0:"ontouchstart"in window?!0:!1}(),READY:!1,isLandscape:function(){return window.orientation===90||window.orientation===-90},ready:function(e){window.addEventListener("viewportready",e,!1)},change:function(e){window.addEventListener("viewportchange",e,!1)},refresh:function(){e&&e.prepareVisualViewport()}};if(!viewporter.ACTIVE)return;var t=function(){var e=this;this.IS_ANDROID=/Android/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);var t=function(){e.prepareVisualViewport();var t=window.orientation;window.addEventListener("orientationchange",function(){window.orientation!==t&&(e.prepareVisualViewport(),t=window.orientation)},!1),document.body.addEventListener("touchmove",function(e){viewporter.preventPageScroll&&e.preventDefault()},!1),document.body.addEventListener("touchstart",function(){viewporter.preventPageScroll&&e.prepareVisualViewport()},!1)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){t()},!1):t()};t.prototype={getProfile:function(){if(viewporter.forceDetection)return null;for(var e in viewporter.profiles)if((new RegExp(e)).test(navigator.userAgent))return viewporter.profiles[e];return null},postProcess:function(){viewporter.READY=!0,this.triggerWindowEvent(this._firstUpdateExecuted?"viewportchange":"viewportready"),this._firstUpdateExecuted=!0},prepareVisualViewport:function(){var e=this;if(navigator.standalone)return this.postProcess();document.documentElement.style.minHeight="5000px";var t=window.innerHeight,n=this.getProfile(),r=viewporter.isLandscape()?"landscape":"portrait";window.scrollTo(0,e.IS_ANDROID?1:0);var i=40,s=window.setInterval(function(){function o(){return n?window.innerHeight===n[r]:!1}function u(){return window.innerHeight>t}window.scrollTo(0,e.IS_ANDROID?1:0),i--;if((e.IS_ANDROID?o():u())||i<0)document.documentElement.style.minHeight=window.innerHeight+"px",document.getElementById("viewporter").style.position="relative",document.getElementById("viewporter").style.height=window.innerHeight+"px",clearInterval(s),e.postProcess()},10)},triggerWindowEvent:function(e){var t=document.createEvent("Event");t.initEvent(e,!1,!1),window.dispatchEvent(t)}},e=new t})(),viewporter.profiles={MZ601:{portrait:696,landscape:1176},"GT-I9000|GT-I9100|Nexus S":{portrait:508,landscape:295},"GT-P1000":{portrait:657,landscape:400},"Desire_A8181|DesireHD_A9191":{portrait:533,landscape:320}};function PxLoader(e){e=e||{},e.statusInterval==null&&(e.statusInterval=5e3),e.loggingDelay==null&&(e.loggingDelay=2e4),e.noProgressTimeout==null&&(e.noProgressTimeout=Infinity);var t=[],n=[],r,i=+(new Date),s={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},o=function(e){return e==null?[]:Array.isArray(e)?e:[e]};this.add=function(e){e.tags=new PxLoaderTags(e.tags),e.priority==null&&(e.priority=Infinity),t.push({resource:e,state:s.QUEUED})},this.addProgressListener=function(e,t){n.push({callback:e,tags:new PxLoaderTags(t)})},this.addCompletionListener=function(e,t){n.push({tags:new PxLoaderTags(t),callback:function(t){t.completedCount===t.totalCount&&e()}})};var u=function(e){e=o(e);var t=function(t){var n=t.resource,r=Infinity;for(var i=0;i<n.tags.length;i++)for(var s=0;s<Math.min(e.length,r);s++){if(n.tags[i]==e[s]&&s<r){r=s;if(r===0)break}if(r===0)break}return r};return function(e,n){var r=t(e),i=t(n);return r<i?-1:r>i?1:e.priority<n.priority?-1:e.priority>n.priority?1:0}};this.start=function(e){r=+(new Date);var n=u(e);t.sort(n);for(var i=0,o=t.length;i<o;i++){var f=t[i];f.status=s.WAITING,f.resource.start(this)}setTimeout(a,100)};var a=function(){var n=!1,r=+(new Date)-i,o=r>=e.noProgressTimeout,u=r>=e.loggingDelay;for(var f=0,l=t.length;f<l;f++){var h=t[f];if(h.status!==s.WAITING)continue;h.resource.checkStatus(),h.status===s.WAITING&&(o?h.resource.onTimeout():n=!0)}u&&n&&c(),n&&setTimeout(a,e.statusInterval)};this.isBusy=function(){for(var e=0,n=t.length;e<n;e++)if(t[e].status===s.QUEUED||t[e].status===s.WAITING)return!0;return!1};var f=function(e,r){var o=null;for(var u=0,a=t.length;u<a;u++)if(t[u].resource===e){o=t[u];break}if(o==null||o.status!==s.WAITING)return;o.status=r,i=+(new Date);var f=e.tags.length;for(var u=0,c=n.length;u<c;u++){var h=n[u],p;h.tags.length===0?p=!0:p=e.tags.contains(h.tags),p&&l(o,h)}};this.onLoad=function(e){f(e,s.LOADED)},this.onError=function(e){f(e,s.ERROR)},this.onTimeout=function(e){f(e,s.TIMEOUT)};var l=function(e,n){var r=0,i=0;for(var o=0,u=t.length;o<u;o++){var a=t[o],f=!1;n.tags.length===0?f=!0:f=a.resource.tags.contains(n.tags),f&&(i++,(a.status===s.LOADED||a.status===s.ERROR||a.status===s.TIMEOUT)&&r++)}n.callback({resource:e.resource,loaded:e.status===s.LOADED,error:e.status===s.ERROR,timeout:e.status===s.TIMEOUT,completedCount:r,totalCount:i})},c=this.log=function(e){if(!window.console)return;var n=Math.round((+(new Date)-r)/1e3);window.console.log("PxLoader elapsed: "+n+" sec");for(var i=0,o=t.length;i<o;i++){var u=t[i];if(!e&&u.status!==s.WAITING)continue;var a="PxLoader: #"+i+" "+u.resource.getName();switch(u.status){case s.QUEUED:a+=" (Not Started)";break;case s.WAITING:a+=" (Waiting)";break;case s.LOADED:a+=" (Loaded)";break;case s.ERROR:a+=" (Error)";break;case s.TIMEOUT:a+=" (Timeout)"}u.resource.tags.length>0&&(a+=" Tags: ["+u.resource.tags.join(",")+"]"),window.console.log(a)}}}function PxLoaderTags(e){this.array=[],this.object={},this.value=null,this.length=0;if(e!==null&&e!==undefined){if(Array.isArray(e))this.array=e;else if(typeof e=="object")for(var t in e)this.array.push(t);else this.array.push(e),this.value=e;this.length=this.array.length;for(var n=0;n<this.length;n++)this.object[this.array[n]]=!0}this.contains=function(e){if(this.length===0||e.length===0)return!1;if(this.length===1)return e.length===1?this.value===e.value:e.object.hasOwnProperty(this.value);if(e.length<this.length)return e.contains(this);for(var t in this.object)if(e.object[t])return!0;return!1}}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)=="[object Array]"});function PxLoaderImage(e,t,n){var r=this,i=null;this.img=new Image,this.tags=t,this.priority=n;var s=function(){r.img.readyState=="complete"&&(a(),i.onLoad(r))},o=function(){a(),i.onLoad(r)},u=function(){a(),i.onError(r)},a=function(){r.unbind("load",o),r.unbind("readystatechange",s),r.unbind("error",u)};this.start=function(t){i=t,r.bind("load",o),r.bind("readystatechange",s),r.bind("error",u),r.img.src=e},this.checkStatus=function(){r.img.complete&&(a(),i.onLoad(r))},this.onTimeout=function(){a(),r.img.complete?i.onLoad(r):i.onTimeout(r)},this.getName=function(){return e},this.bind=function(e,t){r.img.addEventListener?r.img.addEventListener(e,t,!1):r.img.attachEvent&&r.img.attachEvent("on"+e,t)},this.unbind=function(e,t){r.img.removeEventListener?r.img.removeEventListener(e,t,!1):r.img.detachEvent&&r.img.detachEvent("on"+e,t)}}PxLoader.prototype.addImage=function(e,t,n){var r=new PxLoaderImage(e,t,n);return this.add(r),r.img};function extend(e,t){var n=e.prototype,r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t);for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i])}function getElementPosition(e){var t=e,n="",r=0,i=0;if(t==null)return null;while(typeof t=="object"&&typeof t.tagName!="undefined"){i+=t.offsetTop,r+=t.offsetLeft,n=t.tagName.toUpperCase(),n=="BODY"&&(t=0),typeof t=="object"&&typeof t.offsetParent=="object"&&(t=t.offsetParent);if(t==null)return null}return{x:r,y:i}}function getQueryString(){var e={},t=location.search.substring(1),n=/([^&=]+)=([^&]*)/g,r;while(r=n.exec(t))e[decodeURIComponent(r[1])]=decodeURIComponent(r[2]);return e}function getDistributionPartner(){var e=getQueryString().dst;return typeof e=="string"?e:null}function loadScript(e,t){var n=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=t,r.onload=t,n.appendChild(r)}function FriendsterSocialLeaderBoard(){return this.config={SERVER_URL:"http://prod.tresensa.com:8585",ErrorHandler:null},this.loginDetails=[{social_network:"friendster",id:""}],this.userConfiguration={SERVER_URL:this.config.SERVER_URL,APP_URL:this.config.APP_URL,APP_KEY:this.config.APP_KEY,APP_ID:this.config.APP_ID,GameCode:this.config.GameCode,ErrorHandler:this.config.ErrorHandler,SocialNetwork:String(this.config.SocialNetwork).toLowerCase()},this}var TGE=TGE||{};TGE.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))},TGE.debugLog=function(){},Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),TGE.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"an unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.platform=this.searchString(this.dataPlatform)||"an unknown OS or Device",this.OSversion=this.detectOSversion(this.platform),this.isMobileDevice=this.platform!=="Windows"&&this.platform!=="Mac"&&this.platform!=="Linux",this.oniOS=this.platform==="iPhone"||this.platform==="iPad",this.onAndroid=this.platform==="Android",this.usingPhoneGap=window.PhoneGap||window.cordova||window.Cordova},detectOSversion:function(e){var t="-1",n="",r=navigator.userAgent.toString();switch(e){case"Windows Phone":n=/Windows Phone OS\s+[\d\.]+/,t=String(r.match(n)).substring(17,20);break;case"iPhone":case"iPad":n=/OS\s+[\d\_]+/,t=String(r.match(n)).substring(3,6);break;case"Windows":n=/Windows NT\s+[\d\.]+/;var i=String(r.match(n)).substring(11,14);i=="6.1"?t="7":i=="5.1"?t="XP":i=="5.2"?t="XP":i=="6.0"?t="Vista":i=="5.01"?t="2000 SP1":i=="5.0"&&(t="2000");break;case"Mac":n=/Mac OS X\s+[\d\_]+/,t=String(r.match(n)).substring(9,13);break;case"Android":n=/ndroid\s+[\d\.]+/,t=String(r.match(n)).substring(7,10)}return t},searchString:function(e){for(var t=0;t<e.length;t++)if(e[t]!=null){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!==-1)return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t===-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Silk",identity:"Silk",versionSearch:"Silk"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.vendor,subString:"BlackBerry",identity:"BlackBerry"}],dataPlatform:[{string:navigator.userAgent,subString:"Windows Phone",identity:"Windows Phone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"Silk",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.userAgent,subString:"Mobile",identity:"Mobile"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},TGE.BrowserDetect.init();if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var _vp=document.querySelector("meta[name=viewport]");_vp&&_vp.setAttribute("content","maximum-scale=1, minimum-scale=1, initial-scale=1, user-scalable=no")}TGE.Matrix=function(e,t,n,r,i,s){e=typeof e!="undefined"?e:1,t=typeof t!="undefined"?t:0,n=typeof n!="undefined"?n:0,r=typeof r!="undefined"?r:1,i=typeof i!="undefined"?i:0,s=typeof s!="undefined"?s:0,this._internal=[e,n,i,t,r,s,0,0,1]},TGE.Matrix.RotationMatrix=function(e){var t=new TGE.Matrix;return t._internal[0]=Math.cos(e),t._internal[1]=-Math.sin(e),t._internal[3]=Math.sin(e),t._internal[4]=Math.cos(e),t},TGE.Matrix.ScaleMatrix=function(e,t){return(new TGE.Matrix).scale(e,t)},TGE.Matrix.TranslationMatrix=function(e,t){return(new TGE.Matrix).translate(e,t)},TGE.Matrix.prototype={_internal:null,identity:function(){var e=this._internal;return e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0,e[0]=e[4]=e[8]=1,this},copyFrom:function(e){var t=this._internal,n=e._internal;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},concat:function(e){var t=this._internal,n=e._internal,r=t[0]*n[0]+t[1]*n[3]+t[2]*n[6],i=t[0]*n[1]+t[1]*n[4]+t[2]*n[7],s=t[0]*n[2]+t[1]*n[5]+t[2]*n[8],o=t[3]*n[0]+t[4]*n[3]+t[5]*n[6],u=t[3]*n[1]+t[4]*n[4]+t[5]*n[7],a=t[3]*n[2]+t[4]*n[5]+t[5]*n[8],f=t[6]*n[0]+t[7]*n[3]+t[8]*n[6],l=t[6]*n[1]+t[7]*n[4]+t[8]*n[7],c=t[6]*n[2]+t[7]*n[5]+t[8]*n[8];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=u,t[5]=a,t[6]=f,t[7]=l,t[8]=c,this},rotate:function(e){return this.concat(TGE.Matrix.RotationMatrix(e*TGE.DEG2RAD))},scale:function(e,t){var n=this._internal;return n[0]*=e,n[1]*=t,n[3]*=e,n[4]*=t,this},translate:function(e,t){return this._internal[2]+=e,this._internal[5]+=t,this},transformPoint:function(e){var t=e.x,n=e.y;return e.x=t*this._internal[0]+n*this._internal[1]+this._internal[2],e.y=t*this._internal[3]+n*this._internal[4]+this._internal[5],e}},TGE.Point=function(e,t){return e=typeof e!="undefined"?e:0,t=typeof t!="undefined"?t:0,this.x=e,this.y=t,this},TGE.Point.prototype={setTo:function(e,t){this.x=e,this.y=t},copyFrom:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return new this.constructor(this.x+e.x,this.y+e.y)},subtract:function(e){return new this.constructor(this.x-e.x,this.y-e.y)},offset:function(e,t){return this.x+=e,this.y+=t,this},rotate:function(e){var t=e*TGE.DEG2RAD;return new this.constructor(this.x*Math.cos(t)-this.y*Math.sin(t),this.y*Math.cos(t)+this.x*Math.sin(t))},rotateThis:function(e){var t=e*TGE.DEG2RAD,n=this.x*Math.cos(t)-this.y*Math.sin(t),r=this.y*Math.cos(t)+this.x*Math.sin(t);return this.setTo(n,r),this}},TGE.Vector2D=function(e,t){TGE.Vector2D.superclass.constructor.call(this,e,t)},TGE.Vector2D.prototype={magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dotProduct:function(e){return this.x*e.x+this.y*e.y},crossProduct:function(e){return this.x*e.y-this.y*e.x},angleBetween:function(e){var t=this.magnitude()*e.magnitude();return t===0?0:Math.acos(this.dotProduct(e)/t)*TGE.RAD2DEG}},extend(TGE.Vector2D,TGE.Point),TGE.Rectangle=function(e,t,n,r){e=typeof e!="undefined"?e:0,t=typeof t!="undefined"?t:0,n=typeof n!="undefined"?n:0,r=typeof r!="undefined"?r:0,this.x=e,this.y=t,this.width=n,this.height=r},TGE.Rectangle.prototype={intersects:function(e,t,n){t=typeof t=="undefined"?1:t,n=typeof n=="undefined"?1:n;var r=this.width*(1-t)/2,i=this.height*(1-t)/2,s=this.x+r,o=this.y+i,u=this.x+this.width-r,a=this.y+this.height-i;r=e.width*(1-n)/2,i=e.height*(1-n)/2;var f=e.x+r,l=e.y+i,c=e.x+e.width-r,h=e.y+e.height-i;return f>=s&&c<=u&&l>=o&&h<=a?!0:u<f||s>c||a<l||o>h?!1:!0},union:function(e){var t=this.x+this.width,n=this.y+this.height,r=e.x+e.width,i=e.y+e.height;this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y);var s=Math.max(t,r),o=Math.max(n,i);this.width=s-this.x,this.height=o-this.y}},TGE.PI=3.1415926535,TGE.TWO_PI=6.2831853072,TGE.RAD2DEG=57.2957795,TGE.DEG2RAD=.0174532925,TGE.POSITIVE_X_VECTOR=new TGE.Vector2D(1,0),TGE.NEGATIVE_X_VECTOR=new TGE.Vector2D(-1,0),TGE.POSITIVE_Y_VECTOR=new TGE.Vector2D(0,1),TGE.NEGATIVE_Y_VECTOR=new TGE.Vector2D(0,-1),TGE.DisplayObject=function(){return this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.alpha=1,this.backgroundColor=null,this.visible=!0,this.width=0,this.height=0,this.registrationX=.5,this.registrationY=.5,this.parent=null,this.stage=null,this.mouseEnabled=!1,this.instanceName="",this._mLocalTransform=new TGE.Matrix,this._mLocalTransformNoReg=new TGE.Matrix,this._mWorldTransform=new TGE.Matrix,this._mWorldTransformNoReg=new TGE.Matrix,this._mRegistrationTransform=new TGE.Matrix,this._mTopLeft=new TGE.Point,this._mBottomRight=new TGE.Point,this._mAABB=new TGE.Rectangle,this._boundingInfoDirty=!0,this},TGE.DisplayObject.prototype={_mPreviousX:0,_mPreviousY:0,_mPreviousScaleX:1,_mPreviousScaleY:1,_mPreviousRotation:0,_mPreviousRegistrationX:0,_mPreviousRegistrationY:0,_mPreviousVisibility:!1,_mLocalTransform:null,_mLocalTransformNoReg:null,_mLocalTransformDirty:!0,_mWorldTransform:null,_mWorldTransformNoReg:null,_mWorldTransformDirty:!0,_mRegistrationTransform:null,_mTopLeft:0,_mBottomRight:0,_mAABB:null,_boundingInfoDirty:!0,_mWorldAlpha:1,_mIgnoreProperties:!1,_mMouseOver:!1,_visibilityChanged:!1,setLocalTransform:function(e,t,n,r,i,s){var o=this._mLocalTransform._internal;o[0]=e,o[1]=n,o[2]=i,o[3]=t,o[4]=r,o[5]=s,this._mIgnoreProperties=!0,this._mLocalTransformDirty=!0},useDisplayProperties:function(){this._mIgnoreProperties=!1,this._mLocalTransformDirty=!0},getBounds:function(){return this._checkVisibilityChange(),this._boundingInfoDirty&&this._updateAABB(),this._mAABB},hitTestPoint:function(e,t){var n=this.x-this.registrationX*this.width,r=this.x+(1-this.registrationX)*this.width,i=this.y-this.registrationY*this.height,s=this.y+(1-this.registrationY)*this.height;return e>this.x-this.registrationX*this.width&&e<this.x+(1-this.registrationX)*this.width&&t>this.y-this.registrationY*this.height&&t<this.y+(1-this.registrationY)*this.height},clearChildren:function(){},markForRemoval:function(){},numChildren:function(e){return 0},isMouseOver:function(){return this._mMouseOver},_draw:function(e){this._checkVisibilityChange();if(!this.visible)return;this._updateTransformations(),this.stage!==null&&this.mouseEnabled&&this.stage._mMouseTargets.push(this),e.save();var t=this._mWorldTransform._internal,n=this.stage===null?1:this.stage._mScale,r=t[0]*n,i=t[3]*n,s=t[1]*n,o=t[4]*n,u=t[2]*n,a=t[5]*n;this._mIgnoreProperties||this.rotation!==0?e.setTransform(r,i,s,o,u,a):e.setTransform(r,i,s,o,u|0,a|0),e.globalAlpha=this._mWorldAlpha,this.backgroundColor!==null&&(e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.width,this.height)),this._drawClass(e),e.restore()},_drawClass:function(e){},_updateTransformations:function(){this._mWorldTransformDirty=!1;var e=this.x!==this._mPreviousX||this.y!==this._mPreviousY||this.scaleX!==this._mPreviousScaleX||this.scaleY!==this._mPreviousScaleY||this.rotation!==this._mPreviousRotation||this._visibilityChanged;e&&!this._mIgnoreProperties&&(this._visibilityChanged=!1,this._mPreviousX=this.x,this._mPreviousY=this.y,this._mPreviousScaleX=this.scaleX,this._mPreviousScaleY=this.scaleY,this._mPreviousRotation=this.rotation,this._mLocalTransformDirty=!0);if(this.registrationX!==this._mPreviousRegistrationX||this.registrationY!==this._mPreviousRegistrationY){this._mPreviousRegistrationX=this.registrationX,this._mPreviousRegistrationY=this.registrationY;var t=-this.width*this.registrationX,n=-this.height*this.registrationY;this._mRegistrationTransform.identity(),this._mRegistrationTransform.translate(t,n)}if(this._mLocalTransformDirty){if(!this._mIgnoreProperties){this._mLocalTransform.identity();var r=this._mLocalTransform._internal;r[2]=this.x,r[5]=this.y,this.rotation!==0&&this._mLocalTransform.rotate(this.rotation);if(this.scaleX!==1||this.scaleY!==1)r[0]*=this.scaleX,r[1]*=this.scaleY,r[3]*=this.scaleX,r[4]*=this.scaleY}this._mLocalTransformNoReg.copyFrom(this._mLocalTransform),this._mLocalTransform.concat(this._mRegistrationTransform)}if(this.parent!==null){if(this._mLocalTransformDirty||this.parent._mWorldTransformDirty)this._mWorldTransform.copyFrom(this.parent._mWorldTransformNoReg),this._mWorldTransform.concat(this._mLocalTransform),this._mWorldTransformNoReg.copyFrom(this.parent._mWorldTransformNoReg),this._mWorldTransformNoReg.concat(this._mLocalTransformNoReg),this._mWorldTransformDirty=!0}else this._mWorldTransform.copyFrom(this._mLocalTransform),this._mWorldTransformDirty=this._mLocalTransformDirty;this._mWorldTransformDirty&&this._setBoundingInfoDirty(),this._mWorldAlpha=this.parent!==null?this.parent._mWorldAlpha*this.alpha:this.alpha,this._mLocalTransformDirty=!1},_updateAABB:function(){this._mTopLeft.x=0,this._mTopLeft.y=0,this._mBottomRight.x=this.width,this._mBottomRight.y=this.height,this._mWorldTransform.transformPoint(this._mTopLeft),this._mWorldTransform.transformPoint(this._mBottomRight);var e=Math.min(this._mTopLeft.x,this._mBottomRight.x),t=Math.max(this._mTopLeft.x,this._mBottomRight.x),n=Math.min(this._mTopLeft.y,this._mBottomRight.y),r=Math.max(this._mTopLeft.y,this._mBottomRight.y);this._mAABB.x=e,this._mAABB.y=n,this._mAABB.width=t-e,this._mAABB.height=r-n,this._boundingInfoDirty=!1},_setBoundingInfoDirty:function(){this._boundingInfoDirty=!0,this.parent!==null&&this.parent._setBoundingInfoDirty()},_checkVisibilityChange:function(){this.visible!==this._mPreviousVisibility&&(this._visibilityChanged=!0,this._mPreviousVisibility=this.visible,this._setBoundingInfoDirty())}},TGE.DisplayObjectContainer=function(){return TGE.DisplayObjectContainer.superclass.constructor.call(this),this._mChildren=[],this},TGE.DisplayObjectContainer.prototype={_mChildren:null,addChild:function(e){return e.parent!==null&&e.parent.removeChild(e),e.parent=this,e.stage=this.stage,this._mChildren.push(e),e},getChildAt:function(e){return this._mChildren[e]},getChildByName:function(e,t){t=typeof t=="undefined"?!1:t;var n=this._mChildren.length;for(var r=0;r<n;r++){if(this._mChildren[r].instanceName===e)return this._mChildren[r];if(t){var i=this._mChildren[r].getChildByName(e,!0);if(i!==null)return i}}return null},getChildIndex:function(e){var t=this._mChildren.length;for(var n=0;n<t;n++)if(this._mChildren[n]===e)return n;return-1},removeChild:function(e){var t=this.getChildIndex(e);return t!==-1&&(this._mChildren[t].parent=null,this._mChildren.splice(t,1)),e},clearChildren:function(){for(var e=this._mChildren.length-1;e>=0;e--)this._mChildren[e].markForRemoval(),this._mChildren[e].clearChildren(),this._mChildren[e].parent=null,this._mChildren.splice(e,1);this._mChildren=[]},numChildren:function(e){e=typeof e=="undefined"?!1:e;var t=this._mChildren.length;if(e){var n=0;for(var r=0;r<t;r++)n+=1+this._mChildren[r].numChildren(!0);return n}return t},_drawClass:function(e){TGE.DisplayObjectContainer.superclass._drawClass.call(this,e);var t=this._mChildren.length;for(var n=0;n<t;n++){var r=this._mChildren[n];r._checkVisibilityChange(),r.visible&&(e.save(),r._draw(e),e.restore())}},_updateAABB:function(){TGE.DisplayObjectContainer.superclass._updateAABB.call(this);var e=this._mChildren.length;for(var t=0;t<e;t++)this._mChildren[t].visible&&this._mAABB.union(this._mChildren[t].getBounds())}},extend(TGE.DisplayObjectContainer,TGE.DisplayObject),TGE.Stage=function(e,t,n){TGE.Stage.superclass.constructor.call(this),this.stage=this;var r=!1;e&&(e instanceof HTMLDivElement?r=!1:e instanceof HTMLCanvasElement?r=!0:e=document.body);var i;return r?i=e:(i=document.createElement("canvas"),e.appendChild(i)),this.width=e.clientWidth,this.height=e.clientHeight,this.registrationX=0,this.registrationY=0,i.width=this.width,i.height=this.height,this.width=this._mOriginalWidth=typeof t!="undefined"?t:e.clientWidth,this.height=this._mOriginalHeight=typeof n!="undefined"?n:e.clientHeight,this._mScale=1,this._mCanvas=i,this._mCanvasContext=i.getContext("2d"),this},TGE.Stage.prototype={_mCanvasContext:null,_mMouseTargets:[],draw:function(){this._mMouseTargets=[],this._mCanvasContext.globalAlpha=1,this._mCanvasContext.globalCompositeOperation="source-over",this._draw.call(this,this._mCanvasContext)},setScale:function(e){this._mScale=e,this._mCanvas.width=this._mOriginalWidth*e,this._mCanvas.height=this._mOriginalHeight*e,this.width=this._mOriginalWidth,this.height=this._mOriginalHeight},_notifyObjectsOfMouseEvent:function(e,t,n){for(var r=this._mMouseTargets.length-1;r>=0;r--){var i=this._mMouseTargets[r];if(i.hitTestPoint(t,n)){switch(e){case"up":i.MouseUp();break;case"down":i.MouseDown();break;case"click":i.Click()}return}}},_updateObjectMouseOverStates:function(e,t){for(var n=this._mMouseTargets.length-1;n>=0;n--){var r=this._mMouseTargets[n],i=r.hitTestPoint(e,t);i?r._mMouseOver=!0:r._mMouseOver&&(r._mMouseOver=!1)}}},extend(TGE.Stage,TGE.DisplayObjectContainer),TGE.Sprite=function(){return TGE.Sprite.superclass.constructor.call(this),this},TGE.Sprite.prototype={_mImage:null,_mCellWidth:0,_mCellHeight:0,_mSpriteIndex:0,_mCoordinateCache:null,setImage:function(e,t,n){t=typeof t=="undefined"?1:t,n=typeof n=="undefined"?1:n,typeof e=="string"&&(e=TGE.AssetManager.GetImage(e));if(!e||e instanceof Image||!e.spriteSheet)if(e instanceof Image){this._mImage=e,this._mCellWidth=Math.floor(e.width/n),this._mCellHeight=Math.floor(e.height/t),this._mCoordinateCache=[];var r,i;for(var s=0;s<t*n;s++)r=(s%n|0)*this._mCellWidth,i=(s/n|0)*this._mCellHeight,this._mCoordinateCache.push([r,i]);this.width=this._mCellWidth,this.height=this._mCellHeight}else this._mImage=null;else{this._mImage=e.spriteSheet,this._mCellWidth=Math.floor(e.width/n),this._mCellHeight=Math.floor(e.height/t),this._mCoordinateCache=[];var r,i;for(var s=0;s<t*n;s++)r=e.x+(s%n|0)*this._mCellWidth,i=e.y+(s/n|0)*this._mCellHeight,this._mCoordinateCache.push([r,i]);this.width=this._mCellWidth,this.height=this._mCellHeight}this._mSpriteIndex=0},setSpriteIndex:function(e){this._mSpriteIndex=e,this._mSpriteIndex>=this._mCoordinateCache.length&&(TGE.log("***** ERROR: Attempt to call TGE.Sprite.setSpriteIndex with an out of range index ("+e.toString()+")"),this._mSpriteIndex=0)},_drawClass:function(e){this._mImage!==null&&(this.width!==this._mCellWidth||this.height!==this._mCellHeight)&&(TGE.log("***** ERROR: You cannot change the width or height properties of a TGE.Sprite object - use scaleX or scaleY instead"),this.width=this._mCellWidth,this.height=this._mCellHeight),this._mImage!==null&&e.drawImage(this._mImage,this._mCoordinateCache[this._mSpriteIndex][0]>>0,this._mCoordinateCache[this._mSpriteIndex][1]>>0,this.width,this.height,0,0,this.width,this.height),TGE.Sprite.superclass._drawClass.call(this,e)}},extend(TGE.Sprite,TGE.DisplayObjectContainer),TGE.AudioLoader=function(e,t,n,r,i){var s=this;this.id=e,this.loader=null,this.forceHandler=null,this.audio=document.createElement("audio"),this.audio.setAttribute("preload","auto"),document.body.appendChild(this.audio);if(TGE.BrowserDetect.browser==="Safari"||TGE.BrowserDetect.platform==="Windows Phone")if(typeof t!="undefined"&&n.lastIndexOf("mp3")==n.length-"mp3".length){var o=t;t=n,n=o}var u=document.createElement("source");u.setAttribute("src",t),this.audio.appendChild(u);var a=document.createElement("source");a.setAttribute("src",n),this.audio.appendChild(a),this.url=t,this.tags=r,this.priority=i,this.complete=!1,this.pollCount=0,this.start=function(e){this.loader=e;if(this.isLimited()){var t=function(){this.audio.pause(),this.audio.removeEventListener("play",this.forceHandler,!1),this.complete=!0,this.loader.onLoad(s),this.audio.play()};this.forceHandler=t.bind(this),this.audio.addEventListener("play",this.forceHandler,!1),this.audio.play()}else{var n=function(){this.audio.removeEventListener("loadedmetadata",this.forceHandler,!1),this.complete=!0,this.loader.onLoad(s)};this.forceHandler=n.bind(this),this.audio.addEventListener("loadedmetadata",this.forceHandler,!1),this.audio.load()}},this.checkStatus=function(){if(this.audio.networkState===HTMLMediaElement.NETWORK_NO_SOURCE){this.loader.onError(s);return}if(this.pollCount>=3){this.loader.onTimeout(s);return}(this.complete===!0||TGE.BrowserDetect.platform==="Windows Phone")&&this.loader.onLoad(s);if(this.isLimited()){this.loader.onTimeout(s);return}this.pollCount++},this.onTimeout=function(){this.loader.onTimeout(s)},this.getName=function(){return t}},TGE.AudioLoader.prototype.isLimited=function(){return TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"},PxLoader.prototype.addAudio=function(e,t,n,r,i){var s=new TGE.AudioLoader(e,t,n,r,i);return this.add(s),s.audio},TGE.AudioManager=function(e){this.mAssetManager=e,this.mVolume=1,this.mMuted=!1,this.mplayerManagerList=new Array},TGE.AudioManager.prototype={Play:function(e){var t=null;if(e.id in this.mplayerManagerList)t=this.mplayerManagerList[e.id];else{t=new TGE.PlayerManager(this);if(t.init(e)===!1)return;this.mplayerManagerList[e.id]=t}if(this.isMobile()==1&&this.mMuted===!0)return;t.playAudio(e)},Pause:function(e){if(e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.pauseAudio()}},Mute:function(){if(this.mMuted===!0)return;this.mMuted=!0;for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];this.isMobile()===!0?t.nLoop==0?t.stopAudio():t.pauseAudio():t.muteAudio()}},Unmute:function(){if(this.mMuted===!1)return;this.mMuted=!1;for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];this.isMobile()===!0?t.nLoop!=0&&(t.mState===t.STATE.Stopped?t.playAudio({}):t.resumeAudio()):t.unmuteAudio()}},ToggleMute:function(){this.mMuted===!0?this.Unmute():this.Mute()},StopAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.stopAudio()}},PauseAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.pauseAudio()}},ResumeAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];if(this.isMobile()==1&&this.mMuted===!0)continue;t.resumeAudio()}},isLoadAudio:function(){return this.mAssetManager.mLoadAudio},isMobile:function(){return TGE.BrowserDetect.platform!=="Windows"&&TGE.BrowserDetect.platform!=="Mac"}},TGE.PlayerManager=function(e){this.mAudioManager=e,this.nStartTime=0,this.nEndTime=-1,this.nLoop=0,this.callback=null,this.audioElement=null,this.bPlaySegment=!1,this.STATE={NotLoaded:0,Playing:1,Stopped:2,Paused:3,AutoPaused:4},this.mState=this.STATE.NotLoaded,this.audioId=null,this.audioPlaybackInProgressHandler=null,this.audioPlaybackCompleteHandler=null},TGE.PlayerManager.prototype={init:function(e){this.mState=this.STATE.NotLoaded,this.audioId=e.id;var t=this;this.callback=e.callBackFunction!==undefined?e.callBackFunction:null,this.audioElement=this.mAudioManager.mAssetManager.getImage(e.id);if(undefined===this.audioElement)return TGE.log("Unknown audio id: "+e.id),!1;this.nStartTime=0,this.nEndTime=-1,"audio_sprite"===this.audioElement.assetType&&(this.bPlaySegment=!0,this.nStartTime=this.audioElement.startTime,this.nEndTime=this.audioElement.endTime,this.audioElement=this.mAudioManager.mAssetManager.getImage(this.audioElement.id));if(!this.audioElement.canPlayType)return TGE.log("No canPlayType attribute found in audio tag: "+e.id),!1;this.nLoop=0,e.loop!==undefined&&(this.nLoop=Number(e.loop)),this.nLoop===undefined&&(this.nLoop=0);var n=function(){this.bPlaySegment&&(this.audioElement.currentTime<this.nStartTime&&(this.audioElement.currentTime=this.nStartTime),this.audioElement.currentTime>=this.nEndTime&&(this.nLoop===0?this.stopAudio():this.restartAudio()))},r=function(){this.nLoop===0?this.stopAudio():this.restartAudio()};return this.audioElement.addEventListener("timeupdate",n.bind(this),!1),this.audioElement.addEventListener("ended",r.bind(this),!1),window.addEventListener("pagehide",function(){t.mState===t.STATE.Playing&&(t.pauseAudio(),t.mState=t.STATE.AutoPaused)}),window.addEventListener("pageshow",function(){t.mState===t.STATE.AutoPaused&&t.resumeAudio()}),this.mState=this.STATE.Stopped,!0},playAudio:function(e){if(this.mAudioManager.isLoadAudio()===!1)return;this.mAudioManager.mMuted===!0?this.audioElement.volume=0:this.audioElement.volume=this.mAudioManager.mVolume;try{this.audioElement.currentTime=this.nStartTime}catch(t){TGE.log("Error setting start time, continuing: "+t)}this.bPlaySegment===!1&&(this.nEndTime=this.audioElement.duration),this.mState=this.STATE.Playing,this.audioElement.play()},stopAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.mState=this.STATE.Stopped,this.audioElement.pause(),this.audioElement.currentTime=0,this.callback!==null&&this.callback()},restartAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.mState=this.STATE.Playing,this.audioElement.currentTime=this.nStartTime,this.audioElement.play()},pauseAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;if(this.mState!==this.STATE.Playing)return;this.mState=this.STATE.Paused,this.audioElement.pause()},resumeAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;if(this.mState!==this.STATE.Paused)return;this.mState=this.STATE.Playing,this.audioElement.play()},muteAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.audioElement.volume=0},unmuteAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.audioElement.volume=this.mAudioManager.mVolume}},TGE.Game=function(){if(TGE.Game._sInstance!==null)return TGE.log("***** ERROR: you can only create one instance of a TGE.Game object"),this;TGE.Game._sInstance=this,this.analytics=null,this.mCanvasDiv=null,this.mReorientationDiv=null,this.mCanvasPosition=null,this.mGameManager=new TGE.ObjectsManager,this.mLayers={},this.mCameraLocation=null,this.mLoadingStartTime=(new Date).getTime(),this.mLoadingScreen=null,this.stage=null,this.assetManager=new TGE.AssetManager,this.audioManager=new TGE.AudioManager(this.assetManager),this.mPlaying=!1,this.mPaused=!1,this.mCurrentLevel=null,this.mPauseButton=null,this.mUserPauseEnabled=!1,this.mGameTime=0,this.mFilterStrength=10,this.mFrameTime=0,this.mLastLoop=new Date,this.mLastDisplay=new Date,this.mThisLoop,this.mFPSText=null,this.mMaxTickTime=.1,this.mMinTickTime=Number.MIN_VALUE,this.mUIManager=new TGE.ObjectsManager,this.mScreenManager=new TGE.ScreenManager(this),this.mMouseX=0,this.mMouseY=0,this.mMouseDown=!1,this.mKeysDown={},this.mDefaultLinkTarget="_blank",this.canvasWidth=0,this.canvasHeight=0,this._mNativeScaling=null,this._mViewportScale=1,this._oniOS=TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad",this._onAndroid=TGE.BrowserDetect.platform==="Android"},TGE.Game._sInstance=null,TGE.Game.GetInstance=function(){return TGE.Game._sInstance},TGE.Game.prototype={_mViewportScale:0,_mResizeTimeout:null,_oniOS:!1,_onAndroid:!1,onMobile:function(){return TGE.BrowserDetect.isMobileDevice},oniOS:function(){return this._oniOS},onAndroid:function(){return this._onAndroid},onPhoneGap:function(){return TGE.BrowserDetect.usingPhoneGap},IsPlatformAcceptable:function(){var e=!!window.CanvasRenderingContext2D;if(!e)return this.AnalyticErrorEvent("no canvas"),!1;var t=!1;if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var n=TGE.BrowserDetect.OSversion.charCodeAt(0)-48;return n>=5}if(TGE.BrowserDetect.Platform==="Android")return!0;if(TGE.BrowserDetect.platform==="Windows"||TGE.BrowserDetect.platform==="Mac"){var r=TGE.BrowserDetect.browser.toLowerCase(),i=parseFloat(TGE.BrowserDetect.version);if(r=="firefox")return i>=8;if(r=="explorer")return i>=9;if(r=="chrome")return i>=14;if(r=="safari")return i>=5.1}return!0},_determineCanvasPosition:function(){TGE.debugLog("_determineCanvasPosition"),this.mCanvasPosition=getElementPosition(this.mCanvasDiv)},Launch:function(e,t){var n,r,i=-1,s=-1,o=-1,u=-1,a=!1;this.analytics===null&&this.mAnalytics!=null&&(this.analytics=this.mAnalytics),typeof e=="string"?(n=e,r=t):(n=typeof e.gameDiv=="undefined"?null:e.gameDiv,r=typeof e.reorientDiv=="undefined"?null:e.reorientDiv,i=typeof e.width=="undefined"?-1:e.width,s=typeof e.height=="undefined"?-1:e.height,o=typeof e.initialWidth=="undefined"?-1:parseInt(e.initialWidth),u=typeof e.initialHeight=="undefined"?-1:parseInt(e.initialHeight),a=typeof e.resizeForNative=="undefined"?!1:e.resizeForNative),this.mCanvasDiv=document.getElementById(n);if(this.mCanvasDiv==null)return TGE.log("***** ERROR: Could not find canvas div '"+n+"'"),!1;var f=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",f+" z-index: 1; overflow: hidden; -webkit-user-select: none; -ms-touch-action:none; -webkit-tap-highlight-color: transparent; -moz-tap-highlight-color: transparent; -webkit-transform: translateZ(0);");if(a){var l=document.getElementById("viewporter");l!==null&&(l.align="left");var c=1;TGE.BrowserDetect.platform==="iPad"?(c=.75,i=this.mCanvasDiv.clientWidth,s=Math.round(c*i)):TGE.BrowserDetect.platform==="iPhone"&&(c=320/480,i=this.mCanvasDiv.clientWidth,s=Math.round(c*i),l!==null&&(window.innerWidth>480||window.innerHeight>480)&&(l.align="center")),c!==1&&(this._mNativeScaling={x:i/this.mCanvasDiv.clientWidth,y:s/this.mCanvasDiv.clientHeight})}return i>0&&s>0&&(this.mCanvasDiv.style.width=i+"px",this.mCanvasDiv.style.height=s+"px"),this.canvasWidth=this.mCanvasDiv.clientWidth,this.canvasHeight=this.mCanvasDiv.clientHeight,TGE.debugLog("game launch calling _resizeViewport"),this._resizeViewport(),this.mReorientationDiv=document.getElementById(r),this._determineCanvasPosition(),window.addEventListener("resize",this._onResize.bind(this),!1),this.onMobile()&&(window.addEventListener("blur",this._onDeactivate.bind(this),!1),window.addEventListener("pagehide",this._onDeactivate.bind(this),!1),this.onPhoneGap()&&document.addEventListener("pause",this._onDeactivate.bind(this),!1)),"ontouchstart"in document.documentElement&&TGE.BrowserDetect.isMobileDevice?(this.mCanvasDiv.addEventListener("touchstart",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("touchmove",this._mouseMove.bind(this),!1),this.mCanvasDiv.addEventListener("touchend",this._mouseUp.bind(this),!1)):(this.mCanvasDiv.addEventListener("click",this._preventBehavior.bind(this),!1),this.mCanvasDiv.addEventListener("mousedown",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("mouseup",this._mouseUp.bind(this),!1),this.mCanvasDiv.addEventListener("mousemove",this._mouseMove.bind(this),!1)),document.addEventListener("keydown",this._keyDown.bind(this),!1),document.addEventListener("keyup",this._keyUp.bind(this),!1),o>0&&u>0?this.InitializeRenderer(o,u):this.InitializeRenderer(),window.addEventListener("orientationchange",this._onOrientationChanged),typeof viewporter!="undefined"&&typeof viewporter.preventPageScroll=="function"&&(viewporter.preventPageScroll=!0),this.BeginLoad(),!0},_onOrientationChanged:function(){TGE.debugLog("_onOrientationChanged called"),typeof viewporter!="undefined"&&typeof viewporter.refresh=="function"&&viewporter.refresh()},_onResize:function(){TGE.debugLog("_onResize::_mResizeTimeout: "+this._mResizeTimeout),this._mResizeTimeout!==null&&(clearTimeout(this._mResizeTimeout),this._mResizeTimeout=null),this.onAndroid()?this._mResizeTimeout=setTimeout(this._resizeViewport.bind(this),500):this._resizeViewport()},_scaleCanvasDiv:function(e){if(this.stage===null)return;var t=Math.round(this.stage.width*e*1e3)/1e3,n=Math.round(this.stage.height*e*1e3)/1e3;this.mCanvasDiv.style.width=t+"px",this.mCanvasDiv.style.height=n+"px",this._scaleStage(e)},_getBrowserWidth:function(){return window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth!=0?document.documentElement.clientWidth:document.body?document.body.clientWidth:0},_getBrowserHeight:function(){return window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight!=0?document.documentElement.clientHeight:document.body?document.body.clientHeight:0},_scaleStage:function(e){this._mViewportScale=e,this.stage!==null&&this.stage.setScale(this._mViewportScale),this._determineCanvasPosition()},_centerCanvasDiv:function(e,t,n,r){this.mCanvasDiv.style.position="absolute";if(e){this.mCanvasDiv.style.align="left",this.mCanvasDiv.style.left=this._getBrowserWidth()/2-n/2+"px";var i=document.getElementById("viewporter");i&&(i.style.align="left")}t&&(this.mCanvasDiv.style.top=this._getBrowserHeight()/2-r/2+"px")},_resizeViewport:function(){TGE.debugLog("_resizeViewport");if(typeof window.canvasScale!="undefined"){TGE.debugLog("_resizeViewport for JSEmbed using stage scaling"),this.scaleStage(window.canvasScale);return}var e=this.mCanvasDiv,t=e.getAttribute("style")||"",n=this.canvasWidth,r=this.canvasHeight,i=window.innerWidth,s=window.innerHeight;TGE.debugLog("_resizeViewport::game size: "+n+"x"+r+", \nscreen size: "+i+"x"+s);var o=n<=r,u=i<=s,a=u===o,f={x:1,y:1};f.x=i/n,f.y=s/r,f.x=Math.round(f.x*100)/100,f.y=Math.round(f.y*100)/100;var l=1,c;f.x<f.y?(l=f.x,c=!0):(l=f.y,c=!1),Math.abs(1-l)<=.01&&(l=1);var h=n*l,p=r*l;if(TGE.BrowserDetect.usingPhoneGap){TGE.debugLog("_resizeViewport for native using stage scaling"),this._scaleCanvasDiv(l),this._centerCanvasDiv(!0,!0,h,p);return}TGE.BrowserDetect.isMobileDevice?(TGE.BrowserDetect.platform==="Android"&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<4||TGE.BrowserDetect.oniOS&&TGE.BrowserDetect.OSversion.charAt(0)<6||TGE.BrowserDetect.platform==="Kindle Fire"?(TGE.debugLog("_resizeViewport for mobile web using stage scaling"),this._scaleCanvasDiv(l)):(TGE.debugLog("_resizeViewport for mobile web using css transform scaling"),this._mViewportScale=l,f=l+", "+l,e.setAttribute("style",t+" -ms-transform-origin: left top; -webkit-transform-origin: left top; -moz-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top; -ms-transform: scale("+f+"); -webkit-transform: scale3d("+f+", 1); -moz-transform: scale("+f+"); -o-transform: scale("+f+"); transform: scale("+f+");")),this._centerCanvasDiv(!0,!0,h,p)):this._centerCanvasDiv(!0,!1,n,r),this.mReorientationDiv!==null&&TGE.BrowserDetect.isMobileDevice&&(a?(this.mReorientationDiv.style.display="none",this.mCanvasDiv.style.display="block"):(this.mCanvasDiv.style.display="none",this.mReorientationDiv.style.display="block",this.PauseGame(!0))),this._determineCanvasPosition(),typeof viewporter!="undefined"&&typeof viewporter.refresh=="function"&&viewporter.refresh()},_onDeactivate:function(){this.mPlaying&&(this.PauseGame(!0),this.audioManager.Mute())},InitializeRenderer:function(e,t){this.stage=new TGE.Stage(this.mCanvasDiv,e,t)},BeginLoad:function(){this.assetManager.loadAssetList("loading",null,this.LoadRequiredAssets.bind(this))},LoadRequiredAssets:function(){this.mScreenManager.Initialize(this),this._resizeViewport();var e=null;typeof LoadingScreen!="undefined"&&(this.mLoadingScreen=this.ShowScreen(LoadingScreen),e=this.loadRequiredAssetsCallback.bind(this)),this.Update(),this.assetManager.loadAssetList("required",e,this.finishedLoadingRequiredAssets.bind(this))},loadRequiredAssetsCallback:function(e){this.mLoadingScreen!=null&&typeof this.mLoadingScreen.UpdateProgress=="function"&&this.mLoadingScreen.UpdateProgress(e)},finishedLoadingRequiredAssets:function(){var e=Math.round(((new Date).getTime()-this.mLoadingStartTime)/1e3);this.AnalyticGameEvent("load",e),TGE.debugLog("finishedLoadingRequiredAssets calling _resizeViewport"),this._resizeViewport(),this.GotoMainMenu()},LoadLevelAssets:function(e,t,n){this.assetManager.loadAssetList("level_"+e.toString(),t,n)},StartLevel:function(e){var t=e==this.mCurrentLevel;this.mCurrentLevel=e,this.subclassSetupLevel(this.mCurrentLevel),this.AnalyticLevelEvent(t?"replay":"start"),(!this.mPlaying||this.mPaused)&&this.StartPlaying()},FinishLevel:function(){this.AnalyticLevelEvent("complete"),this.subclassFinishLevel()},Replay:function(){this.StartLevel(this.mCurrentLevel)},StartPlaying:function(){this.mGameTime=0,this.mPaused=!1,this.mPlaying=!0,TGE.Achievements.EnableParterUI(!1),this.subclassStartPlaying()},ClearScene:function(){this.mGameManager.Purge(),this.mUIManager.Purge(),this.mCameraLocation=new TGE.Point,this.stage.clearChildren(),this.mFPSText=null,this.SetupLayers(),this.mScreenManager.Initialize(this),this.CreateLayer("FPS");var e=this.assetManager.getImage("pause_button",!1);if(e!=null&&e.width>0){var t=Math.max(e.width,e.height);this.mPauseButton=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.Width()-t/2,t/2,"pause_button","ScreenManager"),this.EnableUserPause()}},SetupLayers:function(){this.mLayers={},this.CreateLayer("TGE_default"),this.subclassSetupLayers()},ShowScreen:function(e){return this.mScreenManager.ShowScreen(e)},GotoMainMenu:function(){this.mPaused=!1,this.mPlaying=!1,this.ClearScene(),typeof MainMenu!="undefined"?this.ShowScreen(MainMenu):this.StartPlaying()},PauseGame:function(e){var t=typeof PauseScreen!="undefined";if(!this.mPlaying||e===this.mPaused||!t)return;this.mPaused=e,this.AnalyticGameEvent(this.mPaused?"pause":"resume",this.mCurrentLevel),this._determineCanvasPosition(),t&&(this.mPaused?(this.ShowScreen(PauseScreen,!1),this.DisableUserPause()):(this.mScreenManager.CloseScreen(PauseScreen),this.EnableUserPause())),TGE.Achievements.EnableParterUI(this.mPaused)},DisableUserPause:function(){this.mUserPauseEnabled=!1,this.mPauseButton!=null&&this.mPauseButton.Hide()},EnableUserPause:function(){this.mUserPauseEnabled=!0,this.mPauseButton!=null&&this.mPauseButton.Show()},Update:function(){var e=(this.mThisLoop=new Date)-this.mLastLoop;this.mFrameTime+=(e-this.mFrameTime)/this.mFilterStrength,this.mLastLoop=this.mThisLoop,this.updateFPSDisplay(),e/=1e3,e=Math.max(this.mMinTickTime,e),e=Math.min(this.mMaxTickTime,e),this.mPaused||(this.mGameTime+=e),this.mScreenManager.Update(e),this.stage._updateObjectMouseOverStates(this.mMouseX,this.mMouseY),this.mPaused||this.updateObjects(e),this.mPlaying&&!this.mPaused&&this.subclassUpdateGame(e),this._updateObjectsToScreen(),requestAnimFrame(this.Update.bind(this)),this.stage.draw()},SetConstantTickTime:function(e){this.mMinTickTime=this.mMaxTickTime=e},SetBackgroundColor:function(e){this.stage.backgroundColor=e},CreateLayer:function(e){var t=new TGE.DisplayObjectContainer;this.mLayers[e]=t,t.registrationX=0,t.registrationY=0,this.stage.addChild(t)},CreateWorldEntity:function(e){var t=new e;return e.prototype.constructor.apply(t,[this]),this.mGameManager.AddObject(t),t},CreateUIEntity:function(e){var t=new e;return e.prototype.constructor.apply(t,[this]),this.mUIManager.AddObject(t),t},getLayer:function(e){var t="TGE_default"in this.mLayers?this.mLayers.TGE_default:this.stage;return e!=null&&e in this.mLayers&&(t=this.mLayers[e]),t},ShowFramerateDisplay:function(e,t,n,r){this.mFPSText!=null&&this.mFPSText.markForRemoval(),this.mFPSText=this.CreateUIEntity(TGE.Text).Setup(e,t,"",n.toString()+"px Arial","center","middle",r,"FPS")},updateFPSDisplay:function(){var e=this.mThisLoop-this.mLastDisplay;if(e<1e3)return;this.mLastDisplay=this.mThisLoop,this.mFrameTime>0&&this.mFPSText!=null&&(this.mFPSText.Show(),this.mFPSText.text=Math.round(1e3/this.mFrameTime).toFixed(0)+"fps")},updateObjects:function(e){this.mGameManager.Update(e),this.mUIManager.Update(e)},_updateObjectsToScreen:function(){this.mGameManager._updateObjectsToScreen()},EndGame:function(){if(!this.mPlaying)return;this.mPlaying=!1,TGE.Achievements.EnableParterUI(!0);var e=Math.round(this.mGameTime);this.AnalyticGameEvent("end",e),this.DisableUserPause(),this.subclassEndGame(),typeof GameOver!="undefined"&&this.ShowScreen(GameOver)},CurrentLevel:function(){return this.mCurrentLevel},_processMousePosition:function(e){this.mCanvasPosition===null&&this._determineCanvasPosition(),this.mMouseX=e.pageX,this.mMouseY=e.pageY,e.touches&&(this.mMouseX=e.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.mMouseY=e.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop),this.mMouseX-=this.mCanvasPosition.x,this.mMouseY-=this.mCanvasPosition.y,this.mMouseX/=this._mViewportScale,this.mMouseY/=this._mViewportScale},_preventBehavior:function(e){e.stopPropagation(),e.preventDefault()},_mouseDown:function(e){window.focus(),this._processMousePosition(e),this.mMouseDown=!0;if(this.mUserPauseEnabled&&this.mPauseButton!=null&&this.mGameTime>.5){var t=Math.max(this.mPauseButton.Width(),this.mPauseButton.Height());if(this.mMouseX>this.Width()-t&&this.mMouseY<t){this.PauseGame(!0);return}}this.stage._notifyObjectsOfMouseEvent("down",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseDown(),e.stopPropagation(),e.preventDefault()},_mouseUp:function(e){this.mMouseDown=!1,this.stage._notifyObjectsOfMouseEvent("up",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseUp(),e.stopPropagation(),e.preventDefault()},_mouseMove:function(e){this._processMousePosition(e),this.mPaused||this.subclassMouseMove(),e.stopPropagation(),e.preventDefault()},MouseX:function(){return this.mMouseX},MouseY:function(){return this.mMouseY},IsMouseDown:function(){return this.mMouseDown},isMouseDown:function(){return this.mMouseDown},_keyDown:function(e){this.mKeysDown[e.keyCode]=!0,this.subclassKeyDown(e.keyCode)},_keyUp:function(e){this.mKeysDown[e.keyCode]=!1,this.subclassKeyUp(e.keyCode)},isKeyDown:function(e){return this.mKeysDown[e]===!0},Width:function(){return this.stage.width},Height:function(){return this.stage.height},GameTime:function(){return this.mGameTime},NumGameObjects:function(){return this.mGameManager.NumObjects()},NumUIObjects:function(){return this.mUIManager.NumObjects()},CameraLocation:function(){return this.mCameraLocation},ScreenX:function(e){return this.stage.width/2+(e-this.mCameraLocation.x)},ScreenY:function(e){return this.stage.height/2-(e-this.mCameraLocation.y)},GetImage:function(e){return this.assetManager.getImage(e)},OpenURL:function(e){this.AnalyticClickThruEvent(e),window.open(e,this.mDefaultLinkTarget)},PlayGame:function(){this.AnalyticGameEvent("begin"),this.subclassPlayGame()},CurrentScore:function(){return 0},subclassSetupLayers:function(){},subclassPlayGame:function(){this.StartLevel(-1)},subclassSetupLevel:function(e){},subclassStartPlaying:function(){},subclassStartLevel:function(){},subclassFinishLevel:function(){},subclassUpdateGame:function(e){},subclassEndGame:function(e){},subclassMouseMove:function(){},subclassMouseDown:function(){},subclassMouseUp:function(){},subclassKeyDown:function(e){},subclassKeyUp:function(e){},AnalyticGameEvent:function(e,t){this.analytics!==null&&this.analytics.logGameEvent(e,this.mCurrentLevel,t)},AnalyticShareEvent:function(e){this.analytics!==null&&this.analytics.logShareEvent(e,this.mCurrentLevel)},AnalyticLevelEvent:function(e){this.analytics!==null&&this.analytics.logLevelEvent(e,this.mCurrentLevel,Math.floor(this.mGameTime))},AnalyticAchievementEvent:function(e,t){this.analytics!==null&&this.analytics.logAchievementEvent(e,this.mCurrentLevel,t)},AnalyticErrorEvent:function(e){this.analytics!==null&&this.analytics.logErrorEvent(e)},AnalyticClickThruEvent:function(e){this.analytics!==null&&this.analytics.logClickThruEvent(e,this.mCurrentLevel)},AnalyticCustomEvent:function(e,t){this.analytics!==null&&this.analytics.logCustomEvent(e,this.mCurrentLevel,t)}},TGE.KEY_ARROW_LEFT=37,TGE.KEY_ARROW_RIGHT=39,TGE.KEY_ARROW_UP=38,TGE.KEY_ARROW_DOWN=40,TGE.KEY_SPACEBAR=32,TGE.ObjectsManager=function(){this.mObjectsArray=[]},TGE.ObjectsManager.prototype={AddObject:function(e){this.mObjectsArray.push(e)},Update:function(e){for(var t=this.mObjectsArray.length-1;t>=0;t--)this.mObjectsArray[t].Update(e),this.mObjectsArray[t].MarkedForRemoval()&&(this.mObjectsArray[t].Cleanup(),this.mObjectsArray.splice(t,1))},_updateObjectsToScreen:function(){for(var e=0;e<this.mObjectsArray.length;e++)this.mObjectsArray[e]._updateScreenPosition()},Purge:function(){for(var e=this.mObjectsArray.length-1;e>=0;e--)this.mObjectsArray[e].Cleanup(),this.mObjectsArray.splice(e,1)},NumObjects:function(){return this.mObjectsArray.length}},TGE.AssetLoader=function(){return this.mAssetList=null,this.mUpdateCallback=null,this.mCompleteCallback=null,this},TGE.AssetLoader.prototype={loadAssetList:function(e,t,n,r,s){n=typeof n=="string"?n:"",n.length>0&&n.charAt(n.length-1)!=="/"&&(n=n.concat("/")),this.mAssetList=t,this.mUpdateCallback=r,this.mCompleteCallback=s;var o=new PxLoader({statusInterval:3e3}),u=0;if(t!==null&&t.list.length>0&&t.loaded===!1){for(i=0;i<t.list.length;i++){var a=null;if(t.list[i].assetType==="audio")e.loadAudio&&(a=o.addAudio(t.list[i].id,n+t.list[i].url,n+t.list[i].backup_url,null,null),u++);else if(t.list[i].assetType==="audio_sprite")a={assetType:"audio_sprite",id:t.list[i].sprite,startTime:t.list[i].startTime,endTime:t.list[i].endTime};else if(t.list[i].sheet){var f=t.list[i].sheet,l=e._mSpriteSheets[f];l||(l=o.addImage(n+t.list[i].sheet),l!==null&&e.addImage(t.list[i].id,l),e._mSpriteSheets[t.list[i].sheet]=l);var c=TGE.AssetManager.SpriteSheets[this._trimmedFilename(f)];if(c){var h=c[this._trimmedFilename(t.list[i].url)];h&&(a={spriteSheet:l,x:h[0],y:h[1],width:h[2],height:h[3]})}}else a=o.addImage(n+t.list[i].url);a!==null&&e.addImage(t.list[i].id,a)}o.addProgressListener(TGE.AssetLoader.prototype._loaderCallback.bind(this)),o.addCompletionListener(TGE.AssetLoader.prototype._completeCallback.bind(this)),o.start()}else this.mUpdateCallback!==null&&this.mUpdateCallback(1),this.mCompleteCallback!==null&&this.mCompleteCallback.call()},_trimmedFilename:function(e){var t=e.lastIndexOf("/")+1;return e.substr(t,e.lastIndexOf(".")-t)},_loaderCallback:function(e){e.error&&TGE.log("***** ERROR: could not load image '"+e.resource.getName()+"'");if(this.mUpdateCallback!==null){var t=e.completedCount/e.totalCount;this.mUpdateCallback(t)}},_completeCallback:function(){this.mAssetList!==null&&(this.mAssetList.loaded=!0,this.mAssetList=null),this.mCompleteCallback!==null&&this.mCompleteCallback()}},TGE.AssetManager=function(e){return TGE.AssetManager.sAssetManagerInstance!==null?TGE.AssetManager.sAssetManagerInstance:(TGE.AssetManager.sAssetManagerInstance=this,e===undefined&&(e=!0),this.rootLocation="",this.useSpriteSheets=!1,this.loadAudio=e,this._mSpriteSheets={},this)},TGE.AssetManager.SpriteSheets={},TGE.AssetManager.sAssetManagerInstance=null,TGE.AssetManager.GetImage=function(e){return TGE.AssetManager.sAssetManagerInstance===null?null:TGE.AssetManager.sAssetManagerInstance.getImage(e)},TGE.AssetManager.prototype={_mImageAssetLists:[],_mImageCache:[],assignImageAssetList:function(e,t){this._mImageAssetLists[e]={loaded:!1,list:t}},loadAssetList:function(e,t,n){var r=new TGE.AssetLoader,i=this._mImageAssetLists[e];i?r.loadAssetList(this,i,this.rootLocation,t,n):(TGE.log("TGE.AssetManager could not locate asset list '"+e+"'"),n&&n.call())},addImage:function(e,t){this._mImageCache[e]=t},getImage:function(e,t){t=typeof t=="undefined"?!0:t;var n=this._mImageCache[e];return t&&e!=null&&!n&&TGE.log("***** ERROR: TGE.AssetManager.getImage could not find the asset '"+e+"'"),n}},TGE.SpriteAnimation=function(e,t,n,r,i,s,o){this.mFPS=s,this.mNumberOfFrames=i,this.mLooping=o,this.mAge=0,this.mPaused=!1,this.mFinishedCallback=null,this.mFrameOffset=0,this.mCurrentFrame=0,this.mSprite=new TGE.Sprite,this.mSprite.setImage(t,n,r),this.mSprite.visible=!1,e.addChild(this.mSprite),this.mSprite.registrationX=e.registrationX,this.mSprite.registrationY=e.registrationY},TGE.SpriteAnimation.prototype={Play:function(e){this.mAge=0,this.mFinishedCallback=e,this.mSprite.setSpriteIndex(0),this.mSprite.visible=!0},Pause:function(){this.mPaused=!0},Stop:function(){this.mSprite.visible=!1},Resume:function(){this.mPaused=!1},SetAnimationIndexOffset:function(e){this.mFrameOffset=e},Update:function(e){this.mPaused||(this.mAge+=e);var t=1/this.mFPS,n=Math.floor(this.mAge/t);this.mCurrentFrame=0,this.mLooping||n<this.mNumberOfFrames?this.mCurrentFrame=n%this.mNumberOfFrames:(this.mCurrentFrame=this.mNumberOfFrames-1,this.mFinishedCallback!=null&&(this.mFinishedCallback.call(),this.mFinishedCallback=null)),this.mCurrentFrame+=this.mFrameOffset,this.mSprite.setSpriteIndex(this.mCurrentFrame)}},TGE.KeyframedAnimation=function(e,t,n,r,i){return this.mAnimationPlayer=e,this.mAnimationID=t,this.mPartInstances=n,this.mLooping=r,this.mFinishedCallback=i,this.mSmoothTransitions=!1,this.mAge=0,this.mPaused=!1,this.mAnimationPlayer.AnimationExists(t)||(this.Cancel(),console.log("***** ERROR: keyframed animation not found: '"+t+"'")),this},TGE.KeyframedAnimation.prototype={Pause:function(){this.mPaused=!0},Resume:function(){this.mPaused=!1},Update:function(e){if(this.mPaused)return;this.mAge+=e,this.mAnimationPlayer.PosePartInstances(this.mPartInstances,this.mAnimationID,this.mAge,this.mLooping,this.mSmoothTransitions)},Cancel:function(){this.mFinishedCallback=null,this.Pause()}},TGE.KeyframedAnimationPlayer=function(e,t,n,r){var i,s=null;typeof t=="undefined"?(i=e.data,n=e.imagesFolder,t=e.assetsList,r=e.imageSet,s=typeof e.spriteSheet=="string"?e.spriteSheet:null):i=e,this.mData=null,this.mPartImages=null,this.mImageTag=typeof r=="undefined"?null:r;if(i.parts===undefined||i.part_instances===undefined||i.animations===undefined||i.max_children===undefined||i.framerate===undefined)return this;this.mData=i,this.mInverseGlobalScale=1/i.image_scale;if(t){typeof n=="undefined"&&(n="");for(var o in this.mData.parts)if(this.mData.parts.hasOwnProperty(o)){var u=this.mImageTag===null?o:this.mImageTag+"_"+o;s!==null?t.push({id:u,url:n+"/"+o+".png",sheet:s}):t.push({id:u,url:n+"/"+o+".png"})}}return this},TGE.KeyframedAnimationPlayer.prototype={Valid:function(){return this.mData!==null},GetAnimations:function(){return this.Valid()?this.mData.animations:null},NumRequiredPartInstances:function(){return this.Valid()?this.mData.max_children:0},AnimationExists:function(e){return this.Valid()?this.mData.animations[e]!==undefined:!1},InitializeImages:function(e){if(this.mPartImages!==null)return;this.mPartImages={};for(var t in this.mData.parts)if(this.mData.parts.hasOwnProperty(t)){var n=this.mImageTag===null?t:this.mImageTag+"_"+t;this.mPartImages[t]=e.GetImage(n)}},PosePartInstances:function(e,t,n,r,i){if(!this.Valid())return;var s=this.mData.animations[t],o=s.frames.length,u=o/this.mData.framerate,a=Math.floor(n/u),f=!r&&a>=1?o-1:(n-a*u)/u*o,l=Math.floor(f),c=s.frames[l],h=(l+1)%o,p=s.frames[h],d=e.length,v=c.instances.length;for(var m=0;m<d;m++){var g=e[m];if(m>=v)g.visible=!1;else{var y=c.instances[m],b=this.mData.part_instances[y.i],w=this.mData.parts[b];g.setImage(this.mPartImages[b]),g.registrationX=w.regx,g.registrationY=w.regy;var E=y.a,S=y.b,x=y.c,T=y.d,N=y.x,C=y.y;if(i){var k=p.instances[p.instances_map[y.i]];if(k!==undefined){var L=f-l;E=y.a+(k.a-y.a)*L,S=y.b+(k.b-y.b)*L,x=y.c+(k.c-y.c)*L,T=y.d+(k.d-y.d)*L,N=y.x+(k.x-y.x)*L,C=y.y+(k.y-y.y)*L}}E*=this.mInverseGlobalScale,S*=this.mInverseGlobalScale,x*=this.mInverseGlobalScale,T*=this.mInverseGlobalScale,g.setLocalTransform(E,S,x,T,N,C),g.visible=!0}}}},TGE.ScreenEntity=function(e){TGE.ScreenEntity.superclass.constructor.call(this),this.mGame=e,this.mAge=0,this.mMarkedForRemoval=!1,this.mAnimations=[],this.mCurrentAnimation=null,this.mKeyframedAnimationPlayer=null,this.mAnimationPartInstances=[],this.mCurrentKeyframedAnimation=null,this.mCurrentKeyframedAnimationID=null},TGE.ScreenEntity.prototype={_mCameraCulling:null,Setup:function(e,t,n,r){return this.mLayer=r,this.x=e,this.y=t,this.setImage(this.mGame.GetImage(n)),this.mGame.getLayer(this.mLayer).addChild(this),this},SetImage:function(e,t,n){var r=this.mGame.GetImage(e);if(r==null)return;t=typeof t!="undefined"?t:1,n=typeof n!="undefined"?n:1,this.setImage(r,t,n)},LoadAnimation:function(e,t,n,r,i,s,o){var u=new TGE.SpriteAnimation(this,this.mGame.GetImage(t),n,r,i,s,o);this.mAnimations[e]=u},PlayAnimation:function(e,t){if(this.mCurrentAnimation==this.mAnimations[e])return;this.PlayAnimationFromStart(e,t)},PlayAnimationFromStart:function(e,t){var n=this.mAnimations[e];n!=null&&(this.mCurrentAnimation!==null&&this.mCurrentAnimation.Stop(),this.setImage(null),this.mCurrentAnimation=n,this.mCurrentAnimation.Play(t),this.width=this.mCurrentAnimation.mSprite.width,this.height=this.mCurrentAnimation.mSprite.height)},removeCurrentAnimation:function(){this.mCurrentAnimation!==null&&this.mCurrentAnimation.Stop(),this.setImage(null),this.mCurrentAnimation=null,this.width=this.height=0,this._boundingInfoDirty=!0},InitializeKeyframedAnimations:function(e){this.mKeyframedAnimationPlayer=e,this.mKeyframedAnimationPlayer.InitializeImages(this.mGame),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Cancel();if(this.mAnimationPartInstances.length>0){var t=this.mAnimationPartInstances.length;for(var n=0;n<t;n++)this.mAnimationPartInstances[n].markForRemoval()}this.mAnimationPartInstances=[];var r=this.mKeyframedAnimationPlayer.NumRequiredPartInstances();for(var n=0;n<r;n++){var i=this.addChild(new TGE.Sprite);i.visible=!1,this.mAnimationPartInstances.push(i)}},PlayKeyframedAnimation:function(e,t,n){if(this.mCurrentKeyframedAnimationID===e)return;this.PlayKeyframedAnimationFromStart(e,t,n)},PlayKeyframedAnimationFromStart:function(e,t,n){typeof t=="undefined"&&(t=!0),typeof n=="undefined"&&(n=null),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Cancel(),this.mCurrentKeyframedAnimation=new TGE.KeyframedAnimation(this.mKeyframedAnimationPlayer,e,this.mAnimationPartInstances,t,n),this.mCurrentKeyframedAnimationID=e},Age:function(){return this.mAge},Update:function(e){this.mAge+=e,this.subclassUpdate(e),this.ShouldBeRemoved()&&this.markForRemoval(),this.mCurrentAnimation!=null&&this.mCurrentAnimation.Update(e),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Update(e)},Cleanup:function(){this.subclassCleanup(),this.clearChildren(),this.parent!==null&&this.parent.removeChild(this)},markForRemoval:function(){this.mMarkedForRemoval=!0;var e=this._mChildren.length;for(var t=0;t<e;t++)this._mChildren[t].markForRemoval()},MarkedForRemoval:function(){return this.mMarkedForRemoval},ShouldBeRemoved:function(){if(this._mCameraCulling!==null){var e=this.getBounds();if(this._mCameraCulling[0]&&e.y+e.height<0)return!0;if(this._mCameraCulling[1]&&e.x>this.mGame.Width())return!0;if(this._mCameraCulling[2]&&e.y>this.mGame.Height())return!0;if(this._mCameraCulling[3]&&e.x+e.width<0)return!0}return this.subclassShouldBeRemoved()},subclassUpdate:function(e){},subclassShouldBeRemoved:function(){return!1},subclassCleanup:function(){},_updateScreenPosition:function(){},SetRotation:function(e){this.rotation=e},SetScale:function(e,t){t=typeof t=="undefined"?e:t,this.scaleX=e,this.scaleY=t},SetAlpha:function(e){this.alpha=e},Width:function(){return this.width},Height:function(){return this.height},Show:function(){this.visible=!0},Hide:function(){this.visible=!1},Visible:function(){return this.visible}},extend(TGE.ScreenEntity,TGE.Sprite),TGE.Button=function(e){TGE.ScreenEntity.call(this,e),this.mouseEnabled=!0,this.mState="idle",this.mMouseDown=!1,this.mPressFunction},TGE.Button.prototype={Setup:function(e,t,n,r,i,s){return this.mNumStates=i,TGE.ScreenEntity.prototype.Setup.call(this,e,t,null,s),this.SetImage(n,1,i),this.mPressFunction=r,this.setButtonState("idle"),this},MouseDown:function(){this.mMouseDown=!0},MouseOver:function(){},MouseUp:function(){this.mPressFunction!=null&&this.mMouseDown&&this.mPressFunction.call(this,this),this.mMouseDown=!1},subclassUpdate:function(e){this.mMouseDown=this.mMouseDown&&this.mGame.IsMouseDown(),this._mMouseOver?this.setButtonState(this.mMouseDown?"down":"hover"):this.setButtonState("idle")},setButtonState:function(e){if(e==this.mState)return;this.mState=e;var t=0;switch(this.mState){case"disable":t=3;break;case"down":t=2;break;case"hover":t=1;break;case"idle":default:t=0}t<this.mNumStates&&this.setSpriteIndex(t)}},extend(TGE.Button,TGE.ScreenEntity),TGE.Text=function(e){return TGE.Text.superclass.constructor.call(this,e),this.text="",this.font="12px Arial",this.hAlign="center",this.vAlign="middle",this.textColor="#000",this},TGE.Text.prototype={_mPreviousText:null,_mPreviousFont:null,Setup:function(e,t,n,r,i,s,o,u){return TGE.ScreenEntity.prototype.Setup.call(this,e,t,null,u),this.text=n,this.font=r,this.hAlign=i,this.vAlign=s,this.textColor=o,this},_calculateDimensions:function(e){e.save(),e.font=this.font;var t=e.measureText(this.text);this.width=t.width;try{var n=this.font.indexOf("px"),r=this.font.substring(0,n);this.height=parseInt(r,10),this.height+=this.height/4>>0}catch(i){this.height=30}e.restore()},_drawClass:function(e){if(this.text===null)return;if(this._mPreviousText!==this.text||this._mPreviousFont!==this.font)this._mPreviousText=this.text,this._mPreviousFont=this.font,this._calculateDimensions(e);e.font=this.font!==null?this.font:"Arial",e.textAlign=this.hAlign!==null?this.hAlign:"center",e.textBaseline=this.vAlign!==null?this.vAlign:"middle",e.fillStyle=this.textColor!==null?this.textColor:"#000",e.fillText(this.text,0,0)}},extend(TGE.Text,TGE.ScreenEntity),TGE.GameWorldEntity=function(e){TGE.ScreenEntity.call(this,e),this.worldPosition=new TGE.Point},TGE.GameWorldEntity.prototype={_mLockXPosition:!1,Setup:function(e,t,n,r){return this.mLayer=r,this.SetWorldPosition(e,t),this.setImage(this.mGame.GetImage(n)),this.mGame.getLayer(this.mLayer).addChild(this),this},SetWorldPosition:function(e,t){this.worldPosition.x=e,this.worldPosition.y=t},CullToCamera:function(e,t,n,r){this._mCameraCulling=[e,t,n,r]},WorldPosition:function(){return this.mWorldPosition},LockXPosition:function(){this._mLockXPosition=!0},_updateScreenPosition:function(){var e=this._mLockXPosition?this.worldPosition.x:this.mGame.ScreenX(this.worldPosition.x),t=this.mGame.ScreenY(this.worldPosition.y);this.x=e,this.y=t}},extend(TGE.GameWorldEntity,TGE.ScreenEntity,null),TGE.Screen=function(e){this.mScreenManager=e,this.mBackground=null,this.mUIElements=new Array,this.mDestroyed=!1},TGE.Screen.prototype={Setup:function(){},Close:function(){this.mScreenManager.CloseScreen(this.constructor)},Game:function(){return this.mScreenManager.Game()},CreateUIEntity:function(e){var t=this.mScreenManager.CreateUIEntity(e);return this.mUIElements.push(t),t},DisplayNumber:function(e,t,n,r,s,o,u,a){var f=this.CreateUIEntity(TGE.ScreenEntity).Setup(t,n,null,a),l=e.toString(),c=24,h=2,p=l.length*s;if(u){var d=Math.floor((l.length-1)/3);p+=d*c,p-=d*h}var v=o=="center"?p/2+s/2:p;v-=s;var m=0,g=0;for(i=l.length-1;i>=0;i--){if(u&&g==3){v+=h;var y=new TGE.Sprite;y.setImage("big_digits_comma"),y.x=v,y.y=m,f.addChild(y),v-=c,g=0}var b=new TGE.Sprite;b.setImage(r,1,10),b.setSpriteIndex(l.charCodeAt(i)-48),b.x=v,b.y=m,f.addChild(b),v-=s,g++}return f},FillBackground:function(e){this.mBackground=this.mScreenManager.Game().CreateUIEntity(TGE.ScreenEntity),this.mBackground.Setup(0,0,null,this.mScreenManager.mLayerName),this.mBackground.registrationX=0,this.mBackground.registrationY=0,this.mBackground.width=this.mScreenManager.Game().Width(),this.mBackground.height=this.mScreenManager.Game().Height(),this.mBackground.backgroundColor=e},Finalize:function(){},ShowAll:function(){for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].Show()},HideAll:function(){for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].Hide()},Update:function(e){},Destroy:function(){this.mBackground!=null&&this.mBackground.markForRemoval();for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].markForRemoval();this.mDestroyed=!0}},TGE.ScreenManager=function(e){this.mGame=e,this.mLayerName="ScreenManager",this.mScreens=new Array,this.mFadeIn=null,this.mFadeInAlpha=1,this.mFadeInSpeed=1,this.mFadeInColor=null},TGE.ScreenManager.prototype={Initialize:function(e){for(var t in this.mScreens)this.mScreens[t]!=null&&(this.mScreens[t].Destroy(),this.mScreens[t]=null);e.CreateLayer(this.mLayerName),e.CreateLayer("FadeOverlay")},setupFadeIn:function(e,t){this.mFadeInSpeed=t,this.mFadeInColor=e},CreateUIEntity:function(e){return this.mGame.CreateUIEntity(e)},ShowScreen:function(e,t){var n=new e;e.prototype.constructor.apply(n,[this]);var r=e.className?e.className():e.name;return this.mScreens[r]=n,n.Setup(),n.Finalize(),t=typeof t=="undefined"?!0:t,t!=0&&this.ResetFade(),n},CloseScreen:function(e){var t=e.className?e.className():e.name,n=this.mScreens[t];if(n==null)return;n.Destroy(),this.mScreens[e]=null},ResetFade:function(){this.mFadeInColor!==null&&(this.mFadeIn===null&&(this.mFadeIn=new TGE.DisplayObject,this.mFadeIn.width=this.mGame.Width(),this.mFadeIn.height=this.mGame.Height(),this.mFadeIn.registrationX=0,this.mFadeIn.registrationY=0,this.mFadeIn.backgroundColor=this.mFadeInColor,this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn)),this.mGame.getLayer("FadeOverlay").getChildIndex(this.mFadeIn)===-1&&this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn),this.mFadeInAlpha=1,this.mFadeIn.alpha=1,this.mFadeIn.visible=!0)},Update:function(e){this.mFadeIn!==null&&this.mFadeInColor!==null&&(this.mFadeInAlpha-=e/this.mFadeInSpeed,this.mFadeInAlpha<=0&&(this.mFadeInAlpha=0,this.mFadeIn.visible=!1),this.mFadeIn.alpha=this.mFadeInAlpha);for(var t in this.mScreens)this.mScreens[t]!=null&&this.mScreens[t].Update(e)},Game:function(){return this.mGame},XFromPercentage:function(e){return this.mGame.Width()*e},YFromPercentage:function(e){return this.mGame.Height()*e},FixedDistanceFromTop:function(e){return e},FixedDistanceFromBottom:function(e){return this.mGame.Height()-e},FixedDistanceFromLeft:function(e){return e},FixedDistanceFromRight:function(e){return this.mGame.Width()-e}},TGE.Analytics=function(e){return this.gameName=e,this},TGE.Analytics.prototype={logGameEvent:function(e,t,n){var r=this.gameName;(e=="pause"||e=="resume")&&t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: game, "+e+", "+r;if(e=="load"||e=="end")i+=", "+n.toString();TGE.log(i)},logShareEvent:function(e,t){var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="ANALYTIC EVENT: share, "+e+", "+n;TGE.log(r)},logLevelEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: level, "+e+", "+r;(e=="complete"||e=="fail")&&n!=null&&(i+=", "+n.toString()),TGE.log(i)},logAchievementEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: achievement, "+e+", "+r;n!=null&&(i+=", "+n.toString()),TGE.log(i)},logErrorEvent:function(e){var t="ANALYTIC EVENT: error, "+e+", "+this.gameName;TGE.log(t)},logClickThruEvent:function(e,t){var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="ANALYTIC EVENT: clickthru, "+e+", "+n;TGE.log(r)},logCustomEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: custom, "+e+", "+r;n!=null&&(i+=", "+n.toString()),TGE.log(i)}},TGE.GoogleAnalytics=function(e,t){return TGE.GoogleAnalytics.superclass.constructor.call(this,e),TGE.BrowserDetect.usingPhoneGap&&(window.plugins&&window.plugins.gaPlugin?(this._gaPlugin=window.plugins.gaPlugin,this._gaPlugin.init(null,this._logError,t,10)):TGE.log("***** ERROR: PhoneGap GoogleAnalytics plugin was not found")),this},TGE.GoogleAnalytics.prototype={_gaPlugin:null,logGameEvent:function(e,t,n){try{var r=this.gameName;(e=="pause"||e=="resume")&&t!=null&&t>0&&(r+=" - level "+t.toString());var i="game",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logShareEvent:function(e,t){try{var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="share",i=e,s=n,o=null;this._trackEvent(r,i,s,o)}catch(u){this._logError(u.toString())}},logLevelEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="level",s=e,o=r,u;if(e=="complete"||e=="fail"&&n!=null)u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logAchievementEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="achievement",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logErrorEvent:function(e){try{var t="error",n=e,r=this.gameName,i=null;this._trackEvent(t,n,r,i)}catch(s){this._logError(s.toString())}},logClickThruEvent:function(e,t){try{var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="clickthru",i=e,s=n,o=null;this._trackEvent(r,i,s,o)}catch(u){this._logError(u.toString())}},logCustomEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="custom",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},_trackEvent:function(e,t,n,r){this._gaPlugin!==null&&(typeof r!="number"&&(r=-1),this._gaPlugin.trackEvent(this._logResult,this._logError,e,t,n,r))},_logError:function(e){TGE.log("***** ERROR: TGE.GoogleAnalytics - "+e)},_logResult:function(e){}},extend(TGE.GoogleAnalytics,TGE.Analytics),TGE.ParallaxPane=function(e){TGE.ParallaxPane.superclass.constructor.call(this,e),this.mTrackingSpeed=1,this.mPane1=null,this.mPane2=null,this.mHorizontalOffset=0,this.mWorldY=0},TGE.ParallaxPane.prototype={Setup:function(e,t,n,r){return TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,r),this.mWorldY=e,this.registrationX=0,this.registrationY=0,this.mTrackingSpeed=t,this.mPane1=new TGE.Sprite,this.mPane1.setImage(this.mGame.GetImage(n)),this.addChild(this.mPane1),this.mPane1.x=0,this.mPane1.y=0,this.mPane1.registrationX=0,this.mPane1.registrationY=0,this.mPane2=new TGE.Sprite,this.mPane2.setImage(this.mGame.GetImage(n)),this.addChild(this.mPane2),this.mPane2.x=this.mGame.Width(),this.mPane2.y=0,this.mPane2.registrationX=0,this.mPane2.registrationY=0,this},SetHorizontalOffset:function(e){this.mHorizontalOffset=e},_updateScreenPosition:function(){var e=this.mGame.CameraLocation().x,t=(-e+this.mHorizontalOffset)*this.mTrackingSpeed/this.scaleX,n=this.mGame.Width()/this.scaleX;this.mPane1.x=t%n,this.mPane1.y=this.mGame.ScreenY(this.mWorldY),this.mPane2.x=this.mPane1.x+n,this.mPane2.y=this.mGame.ScreenY(this.mWorldY)}},extend(TGE.ParallaxPane,TGE.ScreenEntity),TGE.VerticalParallaxPane=function(e){TGE.VerticalParallaxPane.superclass.constructor.call(this,e),this.mTrackingSpeed=1,this.mPane1=null,this.mPane2=null,this.mVerticalOffset=0},TGE.VerticalParallaxPane.prototype={Setup:function(e,t,n){return TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,n),this.registrationX=0,this.registrationY=0,this.mTrackingSpeed=e,this.mPane1=new TGE.Sprite,this.mPane1.setImage(this.mGame.GetImage(t)),this.addChild(this.mPane1),this.mPane1.x=0,this.mPane1.y=0,this.mPane1.registrationX=0,this.mPane1.registrationY=0,this.mPane2=new TGE.Sprite,this.mPane2.setImage(this.mGame.GetImage(t)),this.addChild(this.mPane2),this.mPane2.x=0,this.mPane2.y=this.mGame.Height(),this.mPane2.registrationX=0,this.mPane2.registrationY=0,this},_updateScreenPosition:function(){var e=this.mGame.CameraLocation().y,t=(e+this.mVerticalOffset)*this.mTrackingSpeed/this.scaleY,n=this.mGame.Height()/this.scaleY;this.mPane1.x=0,this.mPane1.y=t%n,this.mPane2.x=0,this.mPane2.y=this.mPane1.y-n}},extend(TGE.VerticalParallaxPane,TGE.ScreenEntity),TGE.Advertisement=function(e){this.element=e.element==="undefined"?null:e.element,this.closeCallback=e.closeCallback==="undefined"?null:e.closeCallback},TGE.Advertisement.prototype={close:function(){this.element!==null&&this.element.parentNode!==null&&this.element.parentNode.removeChild(this.element),this.closeCallback!==null&&this.closeCallback.call()}},TGE.Advertisement.DisplayAd=function(e){var t=e.parentDiv,n=e.adWidth,r=e.adHeight,i=typeof e.x=="undefined"?(t.clientWidth-n)/2:e.x,s=typeof e.y=="undefined"?(t.clientHeight-r)/2:e.y,o=typeof e.closeCallback=="undefined"?null:e.closeCallback,u=null;return TGE.BrowserDetect.platform==="Android"&&TGE.BrowserDetect.browser==="Mozilla"&&TGE.BrowserDetect.OSversion==="4.0"?u=null:getDistributionPartner()==="A0009"?u=null:(u=document.createElement("div"),u.style.position="absolute",u.style.zIndex=3,u.style.left=i.toString()+"px",u.style.top=s.toString()+"px",u.style.width=n.toString()+"px",u.style.height=r.toString()+"px",u.style.overflow="hidden",u.style.border="none",t.insertBefore(u,t.firstChild),u.innerHTML="<object type='text/html' width='"+n+"px' height='"+(r+4).toString()+"px' data='"+e.adURL+"'></object>"),new TGE.Advertisement({element:u,closeCallback:o})},TGE.Advertisement.DisplayModalOverlayAd=function(e){var t=e.parentDiv,n=e.adWidth,r=e.adHeight,i=typeof e.skipDelay=="undefined"?0:e.skipDelay,s=typeof e.headerText=="undefined"?"This game sponsored by:":e.headerText,o=typeof e.overlayRed=="undefined"?1:e.overlayRed,u=typeof e.overlayGreen=="undefined"?1:e.overlayGreen,a=typeof e.overlayBlue=="undefined"?1:e.overlayBlue,f=typeof e.overlayOpacity=="undefined"?1:e.overlayOpacity,l=typeof e.closeCallback=="undefined"?null:e.closeCallback;if(TGE.BrowserDetect.platform==="Android"&&TGE.BrowserDetect.browser==="Mozilla"&&TGE.BrowserDetect.OSversion==="4.0"){l!==null&&l.call();return}if(getDistributionPartner()==="A0009"){l!==null&&l.call();return}var c=document.createElement("div");c.id="ad_overlay",c.style.zIndex=3,c.style.position="absolute",c.style.width=t.clientWidth+"px",c.style.height=t.clientHeight+"px",c.style.backgroundColor="rgba("+Math.round(o*255).toString()+","+Math.round(u*255).toString()+","+Math.round(a*255).toString()+","+f.toString()+")",t.insertBefore(c,t.firstChild);var h=null;if(typeof e.closeButton=="string"){var p=30;h=document.createElement("div"),h.id="tge_ad_close_button",h.style.position="absolute",h.style.display="none";var d=Math.round(t.clientWidth*.0156),v=t.clientWidth-d-p;h.style.top=d.toString()+"px",h.style.left=v.toString()+"px",h.innerHTML="<img src='"+e.closeButton+"'>",h.style.cursor="pointer",c.insertBefore(h,c.firstChild)}var p=30,m=document.createElement("div");m.id="tge_ad_resume_button",m.style.position="absolute",m.style.display="none";var d=Math.round(t.clientHeight*.904),v=(t.clientWidth-302)/2;m.style.top=d.toString()+"px",m.style.left=v.toString()+"px",m.style.width="300px",m.style.marginLeft="auto",m.style.marginRight="auto",m.style.textAlign="center",m.style.paddingTop="6px",m.style.paddingBottom="6px",m.style.backgroundColor="#f00",m.style.border="solid 1px #444",m.style.borderRadius="5px",m.style.color="#fff",m.style.fontSize="17px",m.style.fontWeight="bold",m.innerHTML="Resume Game Play",m.style.cursor="pointer",c.insertBefore(m,c.firstChild);var g=!TGE.BrowserDetect.isMobileDevice||TGE.BrowserDetect.platform==="Windows Phone"?"click":"touchstart";h!==null&&h.addEventListener(g,TGE.Advertisement._CloseAd.bind(this,c,l),!1),m.addEventListener(g,TGE.Advertisement._CloseAd.bind(this,c,l),!1),i>0?setTimeout(TGE.Advertisement._ShowOverlayCloseButtons.bind(this,c),i*1e3):TGE.Advertisement._ShowOverlayCloseButtons(c),c.addEventListener("click",TGE.Advertisement._BlockEvent,!1),c.addEventListener("mousedown",TGE.Advertisement._BlockEvent,!1),c.addEventListener("mouseup",TGE.Advertisement._BlockEvent,!1),c.addEventListener("mousemove",TGE.Advertisement._BlockEvent,!1);var y=document.createElement("div");y.id="ad_div",y.style.position="absolute";var d=(t.clientHeight-(r+70))/2;y.style.top=d.toString()+"px",y.style.marginLeft="auto",y.style.marginRight="auto",y.style.width="100%",y.style.overflow="hidden",y.style.color="#333",y.style.fontSize="20px",y.style.fontWeight="bold",y.style.textAlign="center",c.insertBefore(y,c.firstChild),y.innerHTML="<div style='padding-bottom: 15px;'>"+s+"</div><object type='text/html' width='"+n+"px' height='"+(r+4).toString()+"px' data='"+e.adURL+"'></object><div style='color: #666; font-size: 10px; font-weight: normal; padding-left: "+(n-72).toString()+"px;'>Advertisement</div>"},TGE.Advertisement.DisplayChildBrowserAd=function(e){window.plugins.childBrowser.onClose=e.closeCallback,window.plugins.childBrowser.showWebPage(e.adURL,{showLocationBar:!0,showAddress:!1,showNavigationBar:!0})},TGE.Advertisement._CloseAd=function(e,t,n){e.parentNode.removeChild(e),t!==null&&t.call()},TGE.Advertisement._ShowOverlayCloseButtons=function(e){var t=document.getElementById("tge_ad_close_button");t!=null&&(t.style.display="block");var n=document.getElementById("tge_ad_resume_button");n!=null&&(n.style.display="block")},TGE.Advertisement._BlockEvent=function(e){return e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation(),!1},TGE.Achievement=function(e,t,n,r){return this._id=e,this._earned=!1,this.name=t,this.description=n,this.imageID=r,this},TGE.Achievement.prototype={_id:null,earned:function(){this._earned=!0},hasBeenEarned:function(){return this._earned},id:function(){return this._id}},TGE.Achievements=function(){return this.lockedIconID=null,this.earnedAchievementCallback=null,this},TGE.Achievements.HigherScoresAreBetter=!0,TGE.Achievements.BestScore=null,TGE.Achievements._FRIENDSTER_API_URL="http://www.littlegrey.net/temp/tresensa/friendster",TGE.Achievements.SubmitScore=function(e){var t=new TGE.Achievements;t.submitScore(e)},TGE.Achievements.ShowAchievementsScreen=function(e){getDistributionPartner()==="A0014"&&typeof MNDirect!="undefined"?TGE.PlayPhoneWrapper.showAchievementsScreen():e.call()},TGE.Achievements.EnableParterUI=function(e){getDistributionPartner()==="A0014"&&(e?TGE.PlayPhoneWrapper.showDashboardButton():TGE.PlayPhoneWrapper.hideDashboardButton())},TGE.Achievements.prototype={_achievements:[],_achievementIDs:[],createAchievement:function(e,t,n,r){this._achievements[e]=new TGE.Achievement(e,t,n,r),this._achievementIDs.push(e)},saveCompletedAchievements:function(){var e="",t=this._achievementIDs.length;for(var n=0;n<t;n++){var r=this.getAchievementAt(n);r.hasBeenEarned()&&(e+=n,e+=" ")}var i="";t=e.length;for(c=0;c<t;c++)e.charAt(c)===" "?i+=Math.floor(Math.random()*10).toString():i+=String.fromCharCode(e.charCodeAt(c)+50);if(i.length>0){var s=new Date,o=999;s.setDate(s.getDate()+o);var u=i+(o==null?"":"; expires="+s.toUTCString());document.cookie="tgeachv1="+u}},loadCompletedAchievements:function(){var e=null,t,n,r,i=document.cookie.split(";");for(t=0;t<i.length;t++)n=i[t].substr(0,i[t].indexOf("=")),r=i[t].substr(i[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n=="tgeachv1"&&(e=r);if(e){var s="";len=e.length;for(c=0;c<len;c++){var o=e.charCodeAt(c);e.charCodeAt(c)<=57?s+=" ":s+=String.fromCharCode(e.charCodeAt(c)-50)}var u=s.split(" ");for(var a=0;a<u.length;a++)u[a].length>0&&this.earnedAchievementAt(parseInt(u[a]),!0)}},clearAchievements:function(){var e=new Date,t=999;e.setDate(e.getDate()+t);var n=""+(t==null?"":"; expires="+e.toUTCString());document.cookie="tgeachv1="+n},numberOfAchievements:function(){return this._achievementIDs.length},getAchievement:function(e){return this._achievements[e]},getAchievementAt:function(e){return this.getAchievement(this._achievementIDs[e])},earnedAchievementAt:function(e,t){this.earnedAchievement(this._achievementIDs[e],t)},earnedAchievement:function(e,t){t=typeof t=="undefined"?!1:t;var n=this._achievements[e];n&&(n.hasBeenEarned()||(n.earned(),!t&&this.earnedAchievementCallback&&this.earnedAchievementCallback.call(null,n),this.submitAchievementToPartner(n,t),this.saveCompletedAchievements()))},submitScore:function(e){var t=!1;TGE.Achievements.BestScore===null?(TGE.Achievements.BestScore=e,t=!1):TGE.Achievements.HigherScoresAreBetter&&e>TGE.Achievements.BestScore?(TGE.Achievements.BestScore=e,t=!0):!TGE.Achievements.HigherScoresAreBetter&&e<TGE.Achievements.BestScore&&(TGE.Achievements.BestScore=e,t=!0);if(getDistributionPartner()==="A0009"&&parent.kongregate)parent.kongregate.stats.submit("highscore",e);else if(getDistributionPartner()==="A0010"){var n=parseInt(getQueryString().user),r=parseInt(getQueryString().hid);if(!isNaN(n)&&!isNaN(r)&&n>0&&r>=0){var i=Sha1.hash(r.toString()+e.toString()+"troisdixchix"+n.toString()),s="http://www.digyourowngrave.com/high_scores/exclusive/auto_submit_score.php?user_id="+n+"&game_id="+r+"&score="+e+"&key="+i,o=document.createElement("img");o.src=s}}else if(getDistributionPartner()==="A0013"){var u=getQueryString().session_key,a=getQueryString().gameName;if(u&&a){var f=new FriendsterSocialLeaderBoard,l={id:getQueryString().user_id,score:e,sessionKey:u,gameName:a};f.AutoSubmitScore(l);if(t){var s=TGE.Achievements._FRIENDSTER_API_URL+"/richwallpost.php?gameName="+a+"&score="+e+"&session_key="+u,o=document.createElement("img");o.src=s}}}else getDistributionPartner()==="A0014"?TGE.PlayPhoneWrapper.submitScore(e):TGE.BrowserDetect.usingPhoneGap&&TGE.BrowserDetect.oniOS},submitAchievementToPartner:function(e,t){if(e)if(getDistributionPartner()==="A0009"&&parent.kongregate)parent.kongregate.stats.submit(e.id(),1);else if(getDistributionPartner()==="A0010"){var n=parseInt(getQueryString().aid),r=parseInt(getQueryString().user);if(!isNaN(n)&&!isNaN(r)&&n>=0&&r>0){var i=this._achievementIDs.indexOf(e.id());if(i>=0){var s=n+i,o=Sha1.hash(s.toString()+"troisdixchix"+r.toString()),u="http://www.digyourowngrave.com/high_scores/exclusive/auto_submit_achievement.php?user_id="+r+"&achievement="+s+"&key="+o,a=document.createElement("img");a.src=u}}}else if(!t&&getDistributionPartner()==="A0013"){var f=getQueryString().session_key,l=getQueryString().gameName;if(f&&l){var c=encodeURIComponent(e.name),u=TGE.Achievements._FRIENDSTER_API_URL+"/richwallpost.php?gameName="+l+"&achv="+c+"&session_key="+f,a=document.createElement("img");a.src=u}}else if(getDistributionPartner()==="A0014"){var i=this._achievementIDs.indexOf(e.id());TGE.PlayPhoneWrapper.achievementEarned(i)}else TGE.BrowserDetect.usingPhoneGap&&TGE.BrowserDetect.oniOS}},FriendsterSocialLeaderBoard.prototype={GetUserDetails:function(e){var t={id:"",sessionKey:0,score:0};e(t)},AutoSubmitScore:function(e){for(var t=0;t<this.loginDetails.length;t++){var n={};n.sParams="",n.sParams+="avatar_id="+e.id,n.sParams+="&session_key="+e.sessionKey,n.sParams+="&game_name="+e.gameName,n.sParams+="&score="+e.score,n.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard",n.requestType="POST",n.callback=function(){},this.sendMessage(n)}},SubmitScore:function(e){var t={};t.sParams="",t.sParams+="avatar_id="+e.id,t.sParams+="&session_key="+e.sessionKey,t.sParams+="&game_name="+this.userConfiguration.GameCode,t.sParams+="&score="+e.score,t.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard",t.requestType="POST",t.callback=e.callback,this.sendMessage(t)},GetLeaderboard:function(e){if(e.id!="undefined"&&e.id!=undefined){var t={};t.sParams="",t.sParams+="avatar_id="+e.id,t.sParams+="&session_key="+e.sessionKey,t.sParams+="&game_name="+this.userConfiguration.GameCode,t.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard?"+t.sParams,t.requestType="GET",t.callback=e.callback,this.sendMessage(t)}else this.userConfiguration.ErrorHandler("backend-error")},sendMessage:function(e,t){var n,r=this,i=e,s=t;if(window.XDomainRequest)this.xdr=new XDomainRequest,this.xdr?(this.xdr.onerror=this.err.bind(this),this.xdr.ontimeout=this.timeo.bind(this),this.xdr.onprogress=this.progres.bind(this),this.xdr.onload=function(){var e=r.xdr.responseText,t=JSON.parse(e);t.Error==undefined&&t.Error==null?(i.callback(t),s!=undefined&&r.updateLoginDetails(t)):r.userConfiguration.ErrorHandler("backend-error")},this.xdr.timeout="2000",this.xdr.open(i.requestType,i.sURL+"?"+i.sParams),this.xdr.send()):this.userConfiguration.ErrorHandler("backend-error");else{window.XMLHttpRequest?n=new XMLHttpRequest:n=new ActiveXObject("Microsoft.XMLHTTP");try{n.onreadystatechange=function(){if(n.readyState==4)if(n.status!=200)r.userConfiguration.ErrorHandler("backend-error");else if(e.callback!=null){var t=JSON.parse(n.responseText);t.Error==undefined&&t.Error==null?(e.callback(t),s!=undefined&&r.updateLoginDetails(t)):r.userConfiguration.ErrorHandler("backend-error")}}}catch(o){this.userConfiguration.ErrorHandler("backend-error")}try{n.open(e.requestType,e.sURL,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(e.sParams)}catch(o){this.userConfiguration.ErrorHandler("backend-error")}}},err:function(){this.userConfiguration.ErrorHandler("backend-error")},timeo:function(){this.userConfiguration.ErrorHandler("backend-error")},progres:function(){},stopdata:function(){this.abort()},UpdateConfig:function(e){this.userConfiguration.ErrorHandler=e.ErrorHandler,this.userConfiguration.SocialNetwork=String(e.SocialNetwork).toLowerCase()}},TGE.PlayPhoneWrapper={dashboardButton:null,pendingAchievements:[],initialize:function(){if(typeof MNDirect=="undefined"){TGE.log("***** ERROR: PlayPhone SDK was not loaded properly.");return}MNDirect.AppReloadClient.setAppReloadHandler(MNDirect.AppReloadClient.APP_RELOAD_ALLOWED),MNDirect.AppReloadClient.setAppAfterReloadHandler(MNDirect.AppReloadClient.APP_AFTER_RELOAD_AUTO),MNDirectPopup.init(MNDirectPopup.MNDIRECTPOPUP_WELCOME);var e=78100,t="08b10129-d2f5da4f-eb68767e-85df7a2d";MNDirect.init(e,t),MNDirectUIHelper.showDashboard(),MNDirectUIHelper.addEventHandler(MNDirectUIHelper.EventName.onHideDashboard,TGE.PlayPhoneWrapper.onHideDashboard),MNDirect.addEventHandler(MNDirect.EventName.onUserLogin,TGE.PlayPhoneWrapper.onUserLogin),MNDirect.addEventHandler(MNDirect.EventName.onUserLogout,TGE.PlayPhoneWrapper.onUserLogout)},onHideDashboard:function(e){var t=MNDirect.getSession().isUserLoggedIn();t||MNDirectUIHelper.showDashboard()},onUserLogin:function(e){var t=MNDirect.getSession().isUserLoggedIn();if(t){TGE.PlayPhoneWrapper.hideDashboard();if(TGE.PlayPhoneWrapper.pendingAchievements.length>0){for(var n=0;n<TGE.PlayPhoneWrapper.pendingAchievements.length;n++)TGE.PlayPhoneWrapper.achievementEarned(TGE.PlayPhoneWrapper.pendingAchievements[n]);TGE.PlayPhoneWrapper.pendingAchievements=[]}}},onUserLogout:function(e){MNDirectUIHelper.showDashboard()},dashboardButtonClicked:function(e){MNDirect.execAppCommand("jumpToLeaderboard",null),MNDirectUIHelper.showDashboard()},hideDashboard:function(){MNDirectUIHelper.hideDashboard();if(TGE.Game&&TGE.Game.GetInstance()){TGE.Game.GetInstance()._determineCanvasPosition();if(TGE.PlayPhoneWrapper.dashboardButton===null){var e=TGE.Game.GetInstance().mCanvasDiv;TGE.PlayPhoneWrapper.dashboardButton=document.createElement("div");var t=80,n=10,r=TGE.PlayPhoneWrapper.dashboardButton;r.id="playphone_dashboard_button",r.style.position="absolute";var i=n*(TGE.BrowserDetect.isMobileDevice?3:1),s=e.clientWidth-n-t;r.style.top=i.toString()+"px",r.style.left=s.toString()+"px",r.innerHTML="<img src='http://slb.tresensa.com/playphone/dashboard_button.png'>",r.style.cursor="pointer",r.style.zIndex=5,e.insertBefore(r,e.firstChild);var o=TGE.BrowserDetect.isMobileDevice?"touchstart":"click";r.addEventListener(o,TGE.PlayPhoneWrapper.dashboardButtonClicked,!1)}}},showDashboardButton:function(){TGE.PlayPhoneWrapper.dashboardButton!==null&&(TGE.PlayPhoneWrapper.dashboardButton.style.display="block")},hideDashboardButton:function(){TGE.PlayPhoneWrapper.dashboardButton!==null&&(TGE.PlayPhoneWrapper.dashboardButton.style.display="none")},showAchievementsScreen:function(){if(typeof MNDirect=="undefined")return;MNDirect.execAppCommand("jumpToAchievements",null),MNDirectUIHelper.showDashboard()},submitScore:function(e){if(typeof MNDirect=="undefined")return;MNDirect.postGameScore(e)},achievementEarned:function(e){if(typeof MNDirect=="undefined"||typeof MNDirect.getSession()=="undefined"||!MNDirect.getSession().isUserLoggedIn()){TGE.PlayPhoneWrapper.pendingAchievements.push(e);return}var t=e+1,n=function(e){e.hadError()&&TGE.log("***** ERROR: PlayPhone SDK could not unlock achievement id "+t+", "+e.getErrorMessage())};MNDirect.serviceProvider.Achievements.reqCurrUserUnlockAchievement(n,t)}},getDistributionPartner()==="A0014"&&loadScript("http://webui.social.playphone.com/web_mnsapi/MNDirectHost.js.php",TGE.PlayPhoneWrapper.initialize),TGE.PlatformCompatibility=function(){return this},TGE.PlatformCompatibility.prototype={isAudioSupported:function(){var e=document.createElement("audio"),t=!1;try{if(t=!!e.canPlayType)t=new Boolean(t),t.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),t.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),t.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),t.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(n){}return t},isAudioFormatSupported:function(e){var t=document.createElement("audio"),n=!1,r;try{if(n=!!t.canPlayType){n=new Boolean(n);switch(e){case"ogg":r=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");break;case"mp3":r=t.canPlayType("audio/mpeg;").replace(/^no$/,"");break;case"wav":r=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");break;case"m4a":r=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,"");break;default:}}}catch(i){}return r},isCanvasSupported:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},isVideoSupported:function(){var e=document.createElement("video"),t=!1;try{if(t=!!e.canPlayType)t=new Boolean(t),t.ogg=e.canPlayType('video/ogg; codecs="theora"'),t.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"'),t.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"')}catch(n){}return t},isDragAndDropSupported:function(){var e=document.createElement("div");return bool="draggable"in e||"ondragstart"in e&&"ondrop"in e,bool},isGeolocationSupported:function(){return!!navigator.geolocation},isWebGlSupported:function(){try{var e=document.createElement("canvas"),t;t=!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl")&&!e.getContext("webgl")),e=undefined}catch(n){t=!1}return t},isHistorySupported:function(){return!!window.history&&!!history.pushState},isVideoSupported:function(){var e=document.createElement("video"),t=!1},isLocalStorageSupported:function(){try{return localStorage.setItem(mod,mod),localStorage.removeItem(mod),!0}catch(e){return!1}},isSessionStorageSupported:function(){try{return sessionStorage.setItem(mod,mod),sessionStorage.removeItem(mod),!0}catch(e){return!1}},isSVGSupported:function(){return ns={svg:"http://www.w3.org/2000/svg"},!!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect}},TGE.DeviceOrientation=function(){return this},TGE.DeviceOrientation.prototype={orientationChangeCallBack:null,RegisterOrientationChange:function(e){TGE.DeviceOrientation.prototype.orientationChangeCallBack=e,window.addEventListener("orientationchange",TGE.DeviceOrientation.prototype.internalOrientationChanged),TGE.DeviceOrientation.prototype.internalOrientationChanged()},internalOrientationChanged:function(){window.orientation===90||window.orientation===-90?TGE.DeviceOrientation.prototype.orientationChangeCallBack("landscape"):TGE.DeviceOrientation.prototype.orientationChangeCallBack("portrait")}};var Sha1={};Sha1.hash=function(e,t){t=typeof t=="undefined"?!0:t,t&&(e=Utf8.encode(e));var n=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);var r=e.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(var o=0;o<i;o++){s[o]=new Array(16);for(var u=0;u<16;u++)s[o][u]=e.charCodeAt(o*64+u*4)<<24|e.charCodeAt(o*64+u*4+1)<<16|e.charCodeAt(o*64+u*4+2)<<8|e.charCodeAt(o*64+u*4+3)}s[i-1][14]=(e.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(e.length-1)*8&4294967295;var a=1732584193,f=4023233417,l=2562383102,c=271733878,h=3285377520,p=new Array(80),d,v,m,g,y;for(var o=0;o<i;o++){for(var b=0;b<16;b++)p[b]=s[o][b];for(var b=16;b<80;b++)p[b]=Sha1.ROTL(p[b-3]^p[b-8]^p[b-14]^p[b-16],1);d=a,v=f,m=l,g=c,y=h;for(var b=0;b<80;b++){var w=Math.floor(b/20),E=Sha1.ROTL(d,5)+Sha1.f(w,v,m,g)+y+n[w]+p[b]&4294967295;y=g,g=m,m=Sha1.ROTL(v,30),v=d,d=E}a=a+d&4294967295,f=f+v&4294967295,l=l+m&4294967295,c=c+g&4294967295,h=h+y&4294967295}return Sha1.toHexStr(a)+Sha1.toHexStr(f)+Sha1.toHexStr(l)+Sha1.toHexStr(c)+Sha1.toHexStr(h)},Sha1.f=function(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}},Sha1.ROTL=function(e,t){return e<<t|e>>>32-t},Sha1.toHexStr=function(e){var t="",n;for(var r=7;r>=0;r--)n=e>>>r*4&15,t+=n.toString(16);return t};var Utf8={};Utf8.encode=function(e){var t=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|t&63)});return t=t.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|t&63)}),t},Utf8.decode=function(e){var t=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&15)<<12|(e.charCodeAt(1)&63)<<6|e.charCodeAt(2)&63;return String.fromCharCode(t)});return t=t.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(t)}),t};function Blocks(e){return TGE.GameWorldEntity.call(this,e),this.mWidth=0,this.mBlocks=[],this.targetSlabGlow=.15,this.allowStacking=!1,this.checkpoint=!1,this.trackEnd=!1,this}function Player(e){TGE.GameWorldEntity.call(this,e),this.mStopped=!1,this.mDesiredSpeed=0,this.mHorizontalSpeed=0,this.mVerticalSpeed=0,this.invincible=!1,this.shieldEffectDuration=1,this.shieldTimer=0,this.mCurrentSlab=null,this.mJumpPower=400,this.mLastPosition=new TGE.Point,this.glowSprite=null,this.desiredRotation=0,this.rotationSpeed=10,this.damageTimer=0}function Powerup(e){return TGE.GameWorldEntity.call(this,e),this.color="green",this.pickedUp=!1,this.rotationSpeed=30,this.alphaFade=0,this.scaleSpeed=0,this.tutorial=null,this}function Obstacle(e){return TGE.GameWorldEntity.call(this,e),this.type="pyramid",this.glow=null,this.beenHit=!1,this}function GameOver(e){return TGE.Screen.call(this,e),this.mAd=null,this.mBackground,this}function LoadingScreen(e){return TGE.Screen.call(this,e),this.mLoadingText=null,this}function MainMenu(e){return TGE.Screen.call(this,e),this}var tutorial=[{event:"speed",value:500},{event:"block",length:14,height:0,gap:0,objects:" G P J   "},{event:"block",length:10,height:0,gap:100,objects:"D",stack:!0},{event:"block",length:6,height:-200,gap:500,objects:"WPPPP"},{event:"block",length:10,height:100,gap:200,objects:"GPGP",stack:!0},{event:"block",length:6,height:-200,gap:500,objects:"GGG "},{event:"block",length:3,height:-100,gap:200,objects:"G"},{event:"block",length:3,height:-50,gap:100,objects:"G"}],chubbies=[{event:"speed",value:1e3},{event:"block",length:16,height:0,gap:100,objects:""},{event:"block",length:10,height:0,gap:200,objects:"",stack:!0},{event:"block",length:10,height:100,gap:200,objects:"OOOPPP"},{event:"block",length:30,height:50,gap:200,objects:" M M MOR"}],diamond_easy=[{event:"speed",value:500},{event:"block",length:4,height:60,gap:150,stack:!0,objects:"GP"},{event:"block",length:4,height:-60,gap:0,objects:"PG"},{event:"block",length:3,height:120,gap:120,stack:!0,objects:"PP"},{event:"block",length:3,height:0,gap:0,stack:!0,objects:" "},{event:"block",length:3,height:-120,gap:0,objects:"GG"},{event:"block",length:3,height:50,gap:200,stack:!0,objects:"GP"},{event:"block",length:3,height:-50,gap:0,objects:"PG"}],med1=[{event:"speed",value:600},{event:"block",length:20,height:-50,gap:150,objects:"GRGRGRGT"},{event:"block",length:10,height:-100,gap:100,objects:"GGG  RR",stack:!0},{event:"block",length:10,height:0,gap:300,objects:"   GGG"},{event:"block",length:3,height:-50,gap:50,stack:!0},{event:"block",length:1,height:100,gap:200,objects:"P"},{event:"block",length:3,height:0,gap:200}],med2=[{event:"speed",value:650},{event:"block",length:19,height:-50,gap:150,objects:"GRGRGRGR"},{event:"block",length:10,height:-100,gap:100,objects:"GGGPRRR",stack:!0},{event:"block",length:10,height:0,gap:300,objects:"   GGG"},{event:"block",length:3,height:-50,gap:50,stack:!0},{event:"block",length:1,height:120,gap:400,objects:"PP"},{event:"block",length:3,height:0,gap:200}],tall_intro=[{event:"speed",value:600},{event:"block",length:16,height:0,gap:150,objects:"GOG"},{event:"block",length:17,height:0,gap:150,objects:" OPO"}],turbulence_intro=[{event:"speed",value:700},{event:"block",length:10,height:0,gap:100,objects:"GGGG"},{event:"turbulence",value:!0},{event:"block",length:3,height:0,gap:200,objects:"G"},{event:"block",length:3,height:0,gap:200,objects:"G"},{event:"block",length:3,height:0,gap:200,objects:"G"},{event:"block",length:15,height:0,gap:200,objects:"GRRG"},{event:"block",length:15,height:0,gap:250,objects:"GPOPG"},{event:"block",length:5,height:50,gap:200,objects:"GGG"},{event:"block",length:4,height:50,gap:100},{event:"block",length:4,height:90,gap:100},{event:"block",length:2,height:130,gap:100},{event:"block",length:10,height:-100,gap:100,stack:!0},{event:"block",length:5,height:50,gap:600,objects:"  PPPP"},{event:"block",length:2,height:-50,gap:100},{event:"turbulence",value:!1}],up_down=[{event:"speed",value:700},{event:"block",length:1,height:50,gap:100,objects:"G"},{event:"block",length:1,height:-50,gap:100,objects:"G"},{event:"block",length:1,height:50,gap:100,objects:"G"},{event:"block",length:1,height:-50,gap:100,objects:"G"},{event:"block",length:1,height:50,gap:100,objects:"G"},{event:"block",length:1,height:-50,gap:100,objects:"G"},{event:"block",length:1,height:50,gap:100,objects:"G"},{event:"block",length:1,height:-50,gap:100,objects:"G"},{event:"block",length:1,height:50,gap:100,objects:"G"},{event:"block",length:1,height:-50,gap:100,objects:"G"},{event:"block",length:1,height:50,gap:100,objects:"G"},{event:"block",length:1,height:-50,gap:100,objects:"G"}],bounce=[{event:"speed",value:800},{event:"block",length:68,height:0,gap:200,objects:" R R R R RGRGRPR R R R RPRPRB"}],diamond_med_1000=[{event:"speed",value:1e3},{event:"block",length:5,height:0,gap:200},{event:"block",length:3,height:100,gap:200,stack:!0,objects:"GG"},{event:"block",length:3,height:-100,gap:0,objects:"  "},{event:"block",length:3,height:0,gap:200,stack:!0,objects:"PP"},{event:"block",length:3,height:-200,gap:200,objects:"  "},{event:"block",length:3,height:100,gap:150,stack:!0,objects:"GG"},{event:"block",length:3,height:-150,gap:0},{event:"block",length:5,height:-90,gap:200,stack:!0,objects:"B"},{event:"block",length:3,height:50,gap:200},{event:"block",length:3,height:100,gap:200,stack:!0,objects:"R"},{event:"block",length:3,height:-100,gap:0,objects:"PP"},{event:"block",length:3,height:0,gap:100,stack:!0,objects:"PPPP"},{event:"block",length:3,height:-200,gap:100,objects:"GG"},{event:"block",length:3,height:60,gap:200,stack:!0,objects:"GG"},{event:"block",length:5,height:-150,gap:0},{event:"block",length:8,height:-80,gap:300,objects:"    GGGG"}],hard1=[{event:"speed",value:1e3},{event:"block",length:10,height:0,gap:100,objects:"PGGGG"},{event:"turbulence",value:!0},{event:"block",length:5,height:0,gap:100},{event:"block",length:3,height:-50,gap:100},{event:"block",length:3,height:-50,gap:100},{event:"block",length:10,height:-50,gap:100,objects:"O"},{event:"block",length:8,height:-50,gap:200,objects:" O"},{event:"block",length:3,height:0,gap:50,objects:"PBP"},{event:"turbulence",value:!1}],hard2=[{event:"speed",value:1e3},{event:"block",length:10,height:0,gap:100,objects:"GGG O"},{event:"block",length:8,height:0,gap:100,objects:"BPGGG  "},{event:"block",length:3,height:0,gap:100},{event:"block",length:3,height:0,gap:100},{event:"block",length:12,height:50,gap:100,objects:"RR RR"},{event:"block",length:3,height:0,gap:200},{event:"block",length:3,height:40,gap:100,objects:"O"},{event:"block",length:34,height:-100,gap:0,objects:"GMGMGMGMG"}],up_down_hard=[{event:"speed",value:1e3},{event:"block",length:1,height:50,gap:200,objects:"G"},{event:"block",length:1,height:-50,gap:200,objects:"G"},{event:"block",length:1,height:50,gap:200,objects:"G"},{event:"block",length:1,height:-50,gap:200,objects:"G"},{event:"block",length:1,height:50,gap:500,objects:"G"},{event:"block",length:1,height:-50,gap:200,objects:"G"},{event:"block",length:1,height:50,gap:700,objects:"G"},{event:"block",length:1,height:-50,gap:200,objects:"G"},{event:"block",length:1,height:50,gap:700,objects:"G"},{event:"block",length:1,height:-50,gap:150,objects:"G"},{event:"block",length:1,height:-50,gap:500,objects:""}],up_down_hard_turbulence=[{event:"turbulence",value:!0},{event:"speed",value:1200},{event:"block",length:1,height:50,gap:200,objects:"G"},{event:"block",length:1,height:-50,gap:200,objects:"G"},{event:"block",length:1,height:50,gap:200,objects:"G"},{event:"block",length:1,height:-50,gap:250,objects:"G"},{event:"block",length:1,height:50,gap:500,objects:"G"},{event:"block",length:1,height:-50,gap:250,objects:"G"},{event:"block",length:1,height:50,gap:700,objects:"G"},{event:"block",length:1,height:-50,gap:250,objects:"G"},{event:"block",length:1,height:50,gap:700,objects:"G"},{event:"block",length:1,height:-50,gap:200,objects:"G"},{event:"block",length:1,height:-50,gap:500,objects:"B"},{event:"turbulence",value:!1}],ending=[{event:"speed",value:1200},{event:"block",length:8,height:-150,gap:200,objects:" W "},{event:"block",length:6,height:-80,gap:200,objects:""},{event:"block",length:30,height:0,gap:1600,trackEnd:!0}],segments=[tutorial,diamond_easy,med1,tall_intro,med2,turbulence_intro,up_down,bounce,diamond_med_1000,chubbies,hard1,hard2,up_down_hard,up_down_hard_turbulence,ending];Blocks.prototype={Setup:function(e,t,n,r,i){TGE.GameWorldEntity.prototype.Setup.call(this,e,t,null,i);var s=this.mGame.GetImage(n+"_left"),o=s.width;this.mWidth=o*(2+r),this.mHeight=o,this.slabGlow=new TGE.DisplayObjectContainer,this.slabGlow.backgroundColor="#080";var u=16;this.slabGlow.x=this.slabGlow.y=u,this.slabGlow.width=this.mWidth-u*2,this.slabGlow.height=o/2-u*2,this.slabGlow.registrationX=this.slabGlow.registrationY=0,this.slabGlow.alpha=this.targetSlabGlow,this.addChild(this.slabGlow),e+=o/2,t-=s.height/2;var a=this.mGame.CreateWorldEntity(TGE.GameWorldEntity).Setup(e,t,n+"_left",i);a.CullToCamera(!1,!1,!1,!0),a.positionHacked=!1,this.mBlocks.push(a),e+=o;for(var f=0;f<r;f++)a=this.mGame.CreateWorldEntity(TGE.GameWorldEntity).Setup(e,t,n+"_center",i),a.CullToCamera(!1,!1,!1,!0),a.positionHacked=!1,this.mBlocks.push(a),e+=o;return a=this.mGame.CreateWorldEntity(TGE.GameWorldEntity).Setup(e,t,n+"_right",i),a.CullToCamera(!1,!1,!1,!0),a.positionHacked=!1,this.mBlocks.push(a),this},playerLandedOn:function(){this.slabGlow.alpha=.5,this.targetSlabGlow=.25,this.checkpoint&&this.mGame.saveCheckpoint(),this.trackEnd&&this.mGame.trackComplete()},subclassUpdate:function(e){var t=.5;this.slabGlow.alpha>this.targetSlabGlow?(this.slabGlow.alpha-=t*e,this.slabGlow.alpha<this.targetSlabGlow&&(this.slabGlow.alpha=this.targetSlabGlow)):this.slabGlow.alpha<this.targetSlabGlow&&(this.slabGlow.alpha+=t*e,this.slabGlow.alpha>this.targetSlabGlow&&(this.slabGlow.alpha=this.targetSlabGlow))},checkAgainstPlayer:function(e){var t=e.CurrentSlab();if(t!=null&&t!=this)return!1;var n=this.worldPosition.x,r=this.worldPosition.y,i=e.worldPosition.x,s=e.worldPosition.y,o=e.LastPosition().y,u=s;s-=e.Height()/2;if(t==this){i>n+this.mWidth&&e.SetCurrentSlab(null);return}if(u==o)return;e.mVerticalSpeed<=0&&o>r&&s<=r&&i>=n&&i<=n+this.mWidth&&e.SetCurrentSlab(this)},_updateScreenPosition:function(){Blocks.superclass._updateScreenPosition.call(this);if(this.x<0)for(var e=0;e<this.mBlocks.length;e++){var t=this.mBlocks[e];t.MarkedForRemoval()||!t.positionHacked&&t.x-t.width/2<0&&(t.worldPosition.x-=1,t.positionHacked=!0)}},subclassShouldBeRemoved:function(){return this.x+this.mWidth<0},subclassCleanup:function(){for(var e=0;e<this.mBlocks.length;e++)this.mBlocks[e].markForRemoval()}},extend(Blocks,TGE.GameWorldEntity,null),Player.prototype=new TGE.GameWorldEntity,Player.prototype.constructor=Player,Player.prototype.Setup=function(e){var t=0,n=600;return TGE.GameWorldEntity.prototype.Setup.call(this,t,n,"racer",e),this.mHorizontalSpeed=this.mGame.Width()*this.mDesiredSpeed,this.glowSprite=new TGE.Sprite,this.glowSprite.scaleX=this.glowSprite.scaleY=5,this.addChild(this.glowSprite),this.glowSprite.visible=!1,this.rawBounds=new TGE.Rectangle(0,0,this.width,this.height),this.shield1=new TGE.Sprite,this.shield1.setImage("shield"),this.shield1.x=-2,this.shield1.y=1,this.addChild(this.shield1),this.shield1.visible=!1,this.shield2=new TGE.Sprite,this.shield2.setImage("shield"),this.shield2.x=-2,this.shield2.y=1,this.rotation=45,this.addChild(this.shield2),this.shield2.visible=!1,this.desiredRotation=-15,this.rotationSpeed=25,this},Player.prototype.reset=function(){this.setImage("racer"),this.mStopped=!1,this.mDesiredSpeed=0,this.mHorizontalSpeed=0,this.mVerticalSpeed=0,this.invincible=!1,this.shieldTimer=0,this.mCurrentSlab=null,this.damageTimer=0,this.worldPosition.y=600,this.desiredRotation=-15,this.rotationSpeed=25},Player.prototype.LastPosition=function(){return this.mLastPosition},Player.prototype.CurrentSlab=function(){return this.mCurrentSlab},Player.prototype.SetCurrentSlab=function(e){this.mCurrentSlab=e,e!==null?(e.playerLandedOn(),this.doubleJumped=!1,this.desiredRotation=this.rotation=0,this.rotationSpeed=200):(this.desiredRotation=-25,this.rotationSpeed=25)},Player.prototype.Jump=function(){if(this.mCurrentSlab==null){this.doubleJumped||this.doubleJump();return}this.mCurrentSlab=null,this.mVerticalSpeed=this.mJumpPower,this.rotation=15,this.desiredRotation=-10,this.rotationSpeed=20},Player.prototype.doubleJump=function(){this.mVerticalSpeed=this.mJumpPower,this.doubleJumped=!0,this.desiredRotation=370,this.rotationSpeed=600,this.mGame.achievements.earnedAchievement("aerialist")},Player.prototype.Stopped=function(){return this.mStopped},Player.prototype.makeInvincible=function(){this.invincible=!0,this.shieldTimer=this.shieldEffectDuration,this.setImage("racer_shield")},Player.prototype.boost=function(){this.shieldTimer=this.shieldEffectDuration,this.setSpeed(1400)},Player.prototype.setSpeed=function(e){this.mDesiredSpeed=e},Player.prototype.changeSpeed=function(e){this.mDesiredSpeed+=e,this.mGame.playSound("accelerate")},Player.prototype.getCoreSpeed=function(){return this.mDesiredSpeed},Player.prototype.stop=function(){this.mDesiredSpeed=0,this.mStopped=!0},Player.prototype.getRawBounds=function(){return this.rawBounds},Player.prototype.gotPowerup=function(e){this.glowSprite.setImage("glow_"+e),this.glowSprite.visible=!0,this.glowTimer=1},Player.prototype.gotHit=function(){if(this.damageTimer>0)return;if(this.invincible){this.invincible=!1,this.setImage("racer");return}this.mGame.loseLife(),this.mGame.lives<=0?this.stop():this.damageTimer=2},Player.prototype.subclassUpdate=function(e){if(!this.mGame.mPlaying||this.mGame.gameplayFrozen)return;this.damageTimer>0?(this.damageTimer-=e,this.visible=Math.floor(this.mAge*10)%2===0):this.visible=!0;if(this.shieldTimer>0){var t=this.shieldTimer/this.shieldEffectDuration;this.shield1.visible=!0,this.shield2.visible=!0,this.shield1.alpha=this.shield2.alpha=t*.6,this.shield1.scaleX=this.shield2.scaleX=this.shield1.scaleY=this.shield2.scaleY=1+(1-t),this.shield1.rotation+=200*e,this.shield2.rotation-=200*e,this.shieldTimer-=e}else this.shield1.visible=!1,this.shield2.visible=!1;this.glowTimer>0&&(this.glowTimer-=e,this.glowTimer<=0?(this.glowSprite.alpha=0,this.glowSprite.visible=!1):this.glowSprite.alpha=this.glowTimer/1),this.rotation<this.desiredRotation?(this.rotation+=this.rotationSpeed*e,this.rotation>this.desiredRotation&&(this.rotation=this.desiredRotation)):this.rotation>this.desiredRotation&&(this.rotation-=this.rotationSpeed*e,this.rotation<this.desiredRotation&&(this.rotation=this.desiredRotation)),this.mHorizontalSpeed!==this.mDesiredSpeed&&(this.mHorizontalSpeed+=(this.mDesiredSpeed-this.mHorizontalSpeed)*e),this.mStopped&&this.mHorizontalSpeed>0&&(this.mHorizontalSpeed-=250*e,this.mHorizontalSpeed<0&&(this.mHorizontalSpeed=0));var n=this.rawBounds.height/2,r=this.worldPosition.x,i=this.worldPosition.y,s=r,o=i;this.mLastPosition.x=r,this.mLastPosition.y=o,s+=this.mHorizontalSpeed*e;if(this.mCurrentSlab!==null)this.mVerticalSpeed=0;else{var u=!1;if(this.ApplyThrust()){u=!0;var a=375.2;this.mVerticalSpeed+=2894.4*e,this.mVerticalSpeed>a&&(this.mVerticalSpeed=a)}else{var f=2,l=-428.8;this.mVerticalSpeed-=536*f*e,this.mVerticalSpeed<l&&(this.mVerticalSpeed=l)}}o+=this.mVerticalSpeed*e;var c=this.mGame.blocks.length;for(b=0;b<c;b++){var h=this.mGame.blocks[b],p=h.worldPosition.x,d=h.worldPosition.y-7;if(this.mCurrentSlab===h)s>p+h.mWidth&&this.SetCurrentSlab(null);else if(this.mVerticalSpeed<=0&&i>d&&o<=d&&s>=p&&s<=p+h.mWidth){this.SetCurrentSlab(h),o=d;break}}this.mTrotting=!1;var n=this.rawBounds.height/2;!this.mStopped&&o<n&&(this.stop(),this.mGame.loseLife()),this.mGame.incPlayerDistance(s-r),this.worldPosition.x=s,this.worldPosition.y=o,this.rawBounds.x=this.x-this.rawBounds.width/2,this.rawBounds.y=this.y-this.rawBounds.height/2},Player.prototype.ApplyThrust=function(){return!1},Powerup.prototype=new TGE.GameWorldEntity,Powerup.prototype.constructor=Powerup,Powerup.prototype.Setup=function(e,t,n,r){this.color="green";switch(n){case"G":this.color="green";break;case"P":this.color="purple";break;case"W":this.color="white";break;case"B":this.color="blue";break;case"J":this.tutorial="tutorial_jump";break;case"D":this.tutorial="tutorial_doublejump";break;case"T":this.tutorial="tutorial_jumpthrough"}if(this.tutorial!==null)TGE.GameWorldEntity.prototype.Setup.call(this,e,t,null,r);else{TGE.GameWorldEntity.prototype.Setup.call(this,e,t,"powerup_"+this.color,r),this.scaleX=this.scaleY=.75;var i=new TGE.Sprite;i.setImage("glow_"+this.color),i.scaleX=i.scaleY=2,this.addChild(i)}return this.CullToCamera(!1,!1,!1,!0),this},Powerup.prototype.subclassUpdate=function(e){this.rotation+=this.rotationSpeed*e;var t=this.scaleSpeed*e;this.scaleX+=t,this.scaleY+=t,this.alpha-=this.alphaFade*e,this.alpha=Math.max(0,this.alpha);var n=this.worldPosition.x,r=this.worldPosition.y,i=this.mGame.getPlayer().worldPosition.x,s=this.mGame.getPlayer().worldPosition.y,o=30,u=o;this.tutorial!==null&&(u=150);if(!this.pickedUp&&n>i-o&&n<i+o&&r>s-u&&r<s+o){this.pickedUp=!0;if(this.tutorial!==null){this.mGame.showTutorial(this.tutorial);return}this.rotationSpeed=800,this.alphaFade=2,this.scaleSpeed=2;var a=0,f=null,l=null;switch(this.color){case"green":a=50,f="plus_50",l="powerup";break;case"purple":a=100,f="plus_100",l="powerup2";break;case"white":f="boost_popup",this.mGame.getPlayer().boost(),this.mGame.achievements.earnedAchievement("nitro");break;case"blue":this.mGame.lives>=5?(a=500,f="plus_500"):(a=0,f="one_up",this.mGame.oneUp())}this.mGame.awardPoints(a),this.mGame.getPlayer().gotPowerup(this.color),f!==null&&this.mGame.CreateWorldEntity(LabelPopup).Setup(this.x,this.y,f,1,"UI"),l!==null&&this.mGame.playSound(l)}},Obstacle.prototype=new TGE.GameWorldEntity,Obstacle.prototype.constructor=Obstacle,Obstacle.prototype.Setup=function(e,t,n,r){switch(n){case"R":this.type="pyramid";break;case"O":this.type="pyramid_large";break;case"M":this.type="pyramid_fat";break;case"E":this.type="emp"}return TGE.GameWorldEntity.prototype.Setup.call(this,e,t,this.type,r),this.registrationY=1,this.CullToCamera(!1,!1,!1,!0),this},Obstacle.prototype.subclassUpdate=function(e){var t=this.getBounds(),n=this.mGame.getPlayer().getBounds();if(!this.beenHit&&this.getBounds().intersects(this.mGame.getPlayer().getRawBounds(),.8,.8)){this.beenHit=!0;if(!this.mGame.getPlayer().mStopped){switch(this.type){case"pyramid":case"pyramid_large":case"pyramid_fat":this.mGame.getPlayer().gotHit();break;case"emp":}this.mGame.playSound("impact")}}},LabelPopup=function(e){return LabelPopup.superclass.constructor.call(this,e),this.xDelta=0,this.yDelta=0,this.fade=!1,this.blink=!1,this.lifespan=1,this.host=null,this.hostOffsetX=0,this.hostOffsetY=0,this},LabelPopup.prototype={Setup:function(e,t,n,r,i){return LabelPopup.superclass.Setup.call(this,e,t,n,i),r===0?(this.fade=!0,this.lifespan=1):r===1?(this.yDelta=-80,this.xDelta=-40,this.fade=!0,this.lifespan=1):r===2&&(this.blink=!0,this.lifespan=4),this},linkTo:function(e,t,n){this.host=e,this.hostOffsetX=t,this.hostOffsetY=n,this.fade=!1,this.lifespan=-1},subclassUpdate:function(e){this.y+=this.yDelta*e,this.x+=this.xDelta*e,this.fade&&this.mAge>.5&&(this.alpha-=e*2,this.alpha<=0&&this.markForRemoval()),this.blink&&(this.visible=Math.floor(this.mAge*8)%2===0),this.mAge>this.lifespan&&this.markForRemoval(),this.host!==null&&(this.host.mMarkedForRemoval?this.markForRemoval():(this.x=this.host.x+this.hostOffsetX,this.y=this.host.y+this.hostOffsetY))}},extend(LabelPopup,TGE.ScreenEntity),VectorRunner=function(){VectorRunner.superclass.constructor.call(this),this.mScreenManager.setupFadeIn("#000",.3),this.analytics=new TGE.GoogleAnalytics("Vector Runner Remix","UA-29301358-10"),window.gServerSessionDuration!=undefined?this.adSessionDuration=gServerSessionDuration:this.adSessionDuration=120,this.gameAdSessionDuration=0,this.adGameOverURL="",this.adGameReplayURL="";if(this.onPhoneGap()&&this.oniOS()){this.gamecenter=window.plugins.gamecenter,this.gameCenterLeaderboardID="com.tresensa.vectorrunnerremix";var e="560911787258340";try{FB.init({appId:e,nativeInterface:CDV.FB,useCachedDialogs:!1})}catch(t){console.log("FB Init error:"+t)}}var n=[],r=TGE.BrowserDetect.isMobileDevice?"tap":"click",i=[{id:"racer",url:"images/racer.png"},{id:"racer_shield",url:"images/racer_shield.png"},{id:"shield",url:"images/shield.png"},{id:"glow_green",url:"images/glow_green.png"},{id:"glow_white",url:"images/glow_white.png"},{id:"glow_blue",url:"images/glow_blue.png"},{id:"glow_purple",url:"images/glow_purple.png"},{id:"powerup_green",url:"images/powerup_green.png"},{id:"powerup_white",url:"images/powerup_white.png"},{id:"powerup_blue",url:"images/powerup_blue.png"},{id:"powerup_purple",url:"images/powerup_purple.png"},{id:"pyramid",url:"images/pyramid.png"},{id:"pyramid_large",url:"images/pyramid_large.png"},{id:"pyramid_fat",url:"images/pyramid_fat.png"},{id:"plus_100",url:"images/plus_100.png"},{id:"plus_500",url:"images/plus_500.png"},{id:"plus_50",url:"images/plus_50.png"},{id:"one_up",url:"images/one_up.png"},{id:"boost_popup",url:"images/boost_popup.png"},{id:"digits",url:"images/digits.png"},{id:"big_digits",url:"images/big_digits.png"},{id:"big_digits_comma",url:"images/big_digits_comma.png"},{id:"pause_button",url:"images/pause_button.png"},{id:"shield_icon",url:"images/shield_icon.png"},{id:"checkpoint",url:"images/checkponiint.png"},{id:"turbulence_warning",url:"images/turbulence_warning.png"},{id:"parallax_space",url:"images/parallax_space.png"},{id:"parallax_dust",url:"images/parallax_dust.png"},{id:"block_left",url:"images/block_left.png"},{id:"block_right",url:"images/block_right.png"},{id:"block_center",url:"images/block_center.png"},{id:"achievement_popup",url:"images/achievement_popup.png"},{id:"track_complete",url:"images/track_complete.png"},{id:"start_beat_your_score",url:"images/start_beat_your_score.png"},{id:"sound_button_on",url:"images/audio-on.png"},{id:"sound_button_off",url:"images/audio-off.png"},{id:"tresensa_plug",url:"images/screens/loading/tresensa_plug.png"},{id:"dyog_plug",url:"images/screens/loading/dyog_plug.png"},{id:"logo",url:"images/screens/mainmenu/logo.png"},{id:"mainmenu_play_button",url:"images/screens/mainmenu/play_button.png"},{id:"achievements_menu_button",url:"images/screens/achievements/menu_button.png"},{id:"achievements_back_button",url:"images/screens/achievements/back_button.png"},{id:"achievement_locked",url:"images/screens/achievements/achievement_locked.png"},{id:"achievement_aerialist",url:"images/screens/achievements/aerialist.png"},{id:"achievement_bumpy",url:"images/screens/achievements/bumpy.png"},{id:"achievement_victory",url:"images/screens/achievements/victory.png"},{id:"achievement_nitro",url:"images/screens/achievements/nitro.png"},{id:"achievement_bremix",url:"images/screens/achievements/bremix.png"},{id:"pausescreen_resume_button",url:"images/screens/pausescreen/resume_button.png"},{id:"pausescreen_restart_button",url:"images/screens/pausescreen/restart_button.png"},{id:"pausescreen_mainmenu_button",url:"images/screens/pausescreen/mainmenu_button.png"},{id:"gameover_tryagain_button",url:"images/screens/gameover/tryagain_button.png"},{id:"gameover_twitter_button",url:"images/screens/loading/dyog_plug.png"},{id:"gameover_facebook_button",url:"images/screens/loading/dyog_plug.png"},{id:"gameover_gamecenter_button",url:"images/screens/loading/dyog_plug.png"},{id:"gameover_apple_appstore_button",url:"images/screens/loading/dyog_plug.png"},{id:"gameover_google_play_button",url:"images/screens/loading/dyog_plug.png"},{id:"gameover_kik_button",url:"images/screens/loading/dyog_plug.png"},{id:"tutorial_continue",url:"images/screens/tutorials/continue.png"},{id:"tutorial_notips",url:"images/screens/tutorials/notips.png"},{id:"tutorial_jump",url:"images/screens/tutorials/tutorial_jump.jpg"},{id:"tutorial_jump_caption",url:"images/screens/tutorials/"+r+".png"},{id:"tutorial_doublejump",url:"images/screens/tutorials/tutorial_doublejump.jpg"},{id:"tutorial_doublejump_caption",url:"images/screens/tutorials/"+r+"2.png"},{id:"tutorial_jumpthrough",url:"images/screens/tutorials/tutorial_jumpthrough.jpg"},{id:"music",url:"audio/music.ogg",backup_url:"audio/music.mp3",assetType:"audio"}],s=[];this.oniOS()||(i=i.concat(s)),this.assetManager.assignImageAssetList("loading",n),this.assetManager.assignImageAssetList("required",i),this.assetManager.rootLocation="./assets-1.1.4",this.mSoundToggleOn=null,this.mSoundToggleOff=null,this.showTips=!0,this.tutorialsViewed=[];var o=!1,u,a,f,l=document.cookie.split(";");for(u=0;u<l.length;u++)a=l[u].substr(0,l[u].indexOf("=")),f=l[u].substr(l[u].indexOf("=")+1),a=a.replace(/^\s+|\s+$/g,""),a=="muted"?o=parseInt(unescape(f))===1:a=="tips"&&(this.showTips=parseInt(unescape(f))===1);o&&this.toggleMute(),this.blueRemixScore=6e3,this.mAchievementPopup=null,this.mAchievementMessage=null,this.mAchievementPopupIcon=null,this.mAchievementPopupTimer=0,this.mStartMessage=null,this.mStartMessageDigits=null,this.mStartMessageTimer=0,this.mLevelEvents=null,this.mCards=segments,this.mCurrentCardIndex=-1,this.mCurrentLevelEventIndex=0,this.insertedCheckpoint=!0,this.checkPointEvent={event:"block",length:6,height:0,gap:100,objects:"",checkpoint:!0},this.gameplayFrozen=!1,this.trackEndTimer=-1,this.bestScore=0,this.score=this.noCollisionScore=0,this.lives=5,this.lifeIcons=[],this.redOverlay=null,this.turbulenceStrength=0,this.turbulenceDelta=0,this.justResetCard=!0,this.checkpointState,this.blocks=[],this.achievements=new TGE.Achievements,this.achievements.lockedIconID="achievement_locked",this.achievements.earnedAchievementCallback=this.achievementPopup.bind(this),this.achievements.createAchievement("aerialist","空中杂技","进行一次二级跳","achievement_aerialist"),this.achievements.createAchievement("bumpy","穿越颠簸","穿越一次狂风暴雨","achievement_bumpy"),this.achievements.createAchievement("nitro","加速器","获取白色方块加速器","achievement_nitro"),this.achievements.createAchievement("bremix","蓝色风暴","在一条命不死的情况下获取"+this.blueRemixScore+"分","achievement_bremix"),this.achievements.createAchievement("victory","胜利之门","完成整条赛道","achievement_victory"),this.achievements.loadCompletedAchievements()},VectorRunner.prototype={subclassSetupLayers:function(){this.CreateLayer("background"),this.CreateLayer("road"),this.CreateLayer("dust"),this.CreateLayer("objects"),this.CreateLayer("player"),this.CreateLayer("flashes"),this.CreateLayer("popups"),this.CreateLayer("UI")},subclassStartPlaying:function(){document.getElementById("game_canvas").onselectstart=function(){return!1},this.score=this.noCollisionScore=0,this.lives=5,this.turbulenceStrength=0,this.turbulenceDelta=0,this.mLastSlab=null,this.gameplayFrozen=!1,this.trackEndTimer=-1,this.redOverlay=new TGE.DisplayObjectContainer,this.redOverlay.registrationX=this.redOverlay.registrationY=0,this.redOverlay.width=this.Width(),this.redOverlay.height=this.Height(),this.redOverlay.backgroundColor="#f20",this.getLayer("flashes").addChild(this.redOverlay),this.redOverlay.visible=!1,this.mCameraLocation=new TGE.Point(this.Width()/2,0),this.mCurrentLevelEventIndex=0,this.insertedCheckpoint=!0,this.mCurrentCardIndex=-1,this.mLevelEvents=null,this.justResetCard=!0,this.checkpointState={},this.blocks=[],this.saveCheckpoint(0),this.playMusic()},subclassSetupLevel:function(e){this.ClearScene(),this.mDistanceDigitIcons=[],this.SetBackgroundColor("#000");var t=this._mNativeScaling==null?1:this._mNativeScaling.y,n,r=25/t+this.mCanvasDiv.clientHeight-(this.mCanvasDiv.clientHeight-536)/3;r=561,n=this.CreateWorldEntity(TGE.ParallaxPane).Setup(r,.8,"parallax_space","background"),n.scaleX=3,n.scaleY=3*t,this.dust=this.CreateWorldEntity(TGE.ParallaxPane).Setup(r,3,"parallax_dust","dust"),this.dust.visible=!1,this.dust.scaleX=3,this.dust.scaleY=3*t,this.mPlayer=this.CreateWorldEntity(Player).Setup("player"),iconX=20,iconY=28;for(i=0;i<6;i++){var s=this.CreateUIEntity(TGE.ScreenEntity).Setup(iconX,iconY,null,"UI");s.SetImage("digits",1,10),this.mDistanceDigitIcons[i]=s,iconX+=24}this.lifeIcons=[],iconX=23,iconY=66;for(i=0;i<5;i++){var o=new TGE.Sprite;o.setImage("shield_icon"),o.x=iconX,o.y=iconY,this.getLayer("UI").addChild(o),this.lifeIcons.push(o),iconX+=o.width}var u=830,a=45;this.mSoundToggleOn=this.CreateUIEntity(TGE.Button).Setup(u,a,"sound_button_on",this.toggleMute.bind(this),1,"UI"),this.mSoundToggleOff=this.CreateUIEntity(TGE.ScreenEntity).Setup(u,a,"sound_button_off","UI"),this.updateSoundButtons(),this.DisplayStartMessage(this.bestScore)},subclassUpdateGame:function(e){if(this.gameplayFrozen)return;var t=this.blocks.length;for(var n=0;n<t;n++){var r=this.blocks[n];r.mMarkedForRemoval&&this.blocks.slice(n,1)}this.trackEndTimer>=0&&(this.trackEndTimer-=e,this.trackEndTimer<=0&&this.EndGame()),this.processEvents(e);var s=3;if(this.mGameTime>s){var o=Math.max(.15,1-(this.mGameTime-s));this.mSoundToggleOn.alpha=o,this.mSoundToggleOff.alpha=o,this.mPauseButton.alpha=o}else this.mSoundToggleOn.alpha=1,this.mSoundToggleOff.alpha=1,this.mPauseButton.alpha=1;if(this.mPlayer!=null){var u=this._mNativeScaling==null?1:this._mNativeScaling.y,a=this.mPlayer.worldPosition.x+400,f=this.Height()*.5;this.mCameraLocation.x=a,this.mCameraLocation.y=f*(1/u),this.turbulenceStrength+=this.turbulenceDelta*e,this.turbulenceStrength=Math.min(1,this.turbulenceStrength),this.turbulenceStrength=Math.max(0,this.turbulenceStrength),this.turbulenceStrength>0?(this.mCameraLocation.y+=Math.sin(this.mGameTime*15)*25*this.turbulenceStrength,this.dust.visible=!0,this.dust.alpha=this.turbulenceStrength):this.dust.visible=!1}this.redOverlay.visible&&(this.redOverlay.alpha-=e*.7,this.redOverlay.alpha<=0&&(this.redOverlay.alpha=0,this.redOverlay.visible=!1,this.lives>0?this.mPlayer.Stopped()&&(this.mCards[this.mCurrentCardIndex]==null?this.EndGame():(this.mPlayer.reset(),this.getLayer("road").clearChildren(),this.getLayer("objects").clearChildren(),this.getLayer("popups").clearChildren(),this.mLastSlab=null,this.justResetCard=!0,this.loadCheckpoint())):this.EndGame()));if(this.mStartMessageTimer>0){this.mStartMessageTimer-=e;if(this.mStartMessageTimer<=0){this.mStartMessage.markForRemoval();for(var l=0;l<this.mStartMessageDigits.length;l++)this.mStartMessageDigits[l].markForRemoval()}else{var c=1,h=this.mStartMessageTimer>c?1:this.mStartMessageTimer/c;this.mStartMessage.alpha=h;for(var l=0;l<this.mStartMessageDigits.length;l++)this.mStartMessageDigits[l].alpha=h}}this.mAchievementPopupTimer>0&&(this.mAchievementPopupTimer-=e,this.mAchievementPopupTimer<=0&&(this.mAchievementPopup.markForRemoval(),this.mAchievementMessage.markForRemoval(),this.mAchievementPopup=null));if(!this.mPlaying)return;var p=this.getScore().toString();for(si=0;si<6;si++)p.length>si?(this.mDistanceDigitIcons[si].Show(),this.mDistanceDigitIcons[si].setSpriteIndex(p.charCodeAt(si)-48)):this.mDistanceDigitIcons[si].Hide();for(i=0;i<5;i++)this.lifeIcons[i].visible=this.lives-1>=i;if(this.mStartMessageTimer>0){this.mStartMessageTimer-=e;if(this.mStartMessageTimer<=0){this.mStartMessage.markForRemoval();for(var l=0;l<this.mStartMessageDigits.length;l++)this.mStartMessageDigits[l].markForRemoval()}else{var c=1,h=this.mStartMessageTimer>c?1:this.mStartMessageTimer/c;this.mStartMessage.alpha=h;for(var l=0;l<this.mStartMessageDigits.length;l++)this.mStartMessageDigits[l].alpha=h}}this.mAchievementPopupTimer>0&&(this.mAchievementPopupTimer-=e,this.mAchievementPopupTimer<=0&&(this.mAchievementPopup.markForRemoval(),this.mAchievementMessage.markForRemoval(),this.mAchievementPopup=null))},PauseGame:function(e){VectorRunner.superclass.PauseGame.call(this,e)},subclassMouseDown:function(){this.mPlaying&&this.mPlayer!=null&&!this.gameplayFrozen&&this.trackEndTimer<0&&this.mPlayer.Jump()},subclassEndGame:function(){this.getScore()>this.bestScore&&(this.bestScore=this.getScore())},showTutorial:function(e){if(this.showTips&&this.tutorialsViewed[e]==null){this.freezeGameplay(!0);var t=this.ShowScreen(TutorialScreen);t.setTutorial(e),this.tutorialsViewed[e]=!0}},freezeGameplay:function(e){this.gameplayFrozen=e},disableTips:function(){this.showTips=!1,this.saveSettings()},loadCard:function(e){this.mCurrentLevelEventIndex=0,this.insertedCheckpoint=!1,this.mLevelEvents=e},trackComplete:function(){this.mPlayer.stop(),this.trackEndTimer=4,this.CreateWorldEntity(LabelPopup).Setup(this.Width()*.5,this.Height()*.25,"track_complete",2,"popups"),this.achievements.earnedAchievement("victory")},saveCheckpoint:function(e){e=typeof e=="undefined"?this.mCurrentCardIndex:e,this.checkpointState.cardIndex=e,this.checkpointState.score=this.score,this.checkpointState.speed=this.mPlayer.getCoreSpeed(),this.justResetCard||this.CreateWorldEntity(LabelPopup).Setup(this.Width()*.5,this.Height()*.8,"checkpoint",0,"popups")},loadCheckpoint:function(){this.score=this.checkpointState.score,this.mPlayer.setSpeed(this.checkpointState.speed),this.turbulenceStrength=0,this.turbulenceDelta=0,this.blocks=[],this.mCurrentCardIndex=this.checkpointState.cardIndex,this.loadCard(this.mCards[this.mCurrentCardIndex])},processLevelEvent:function(e){switch(e.event){case"speed":this.mPlayer.setSpeed(e.value);break;case"speed_change":this.mPlayer.changeSpeed(e.value);break;case"turbulence":this.turbulenceDelta=e.value?.3:-0.3,e.value&&this.turbulenceStrength===0?this.CreateWorldEntity(LabelPopup).Setup(this.Width()*.5,this.Height()*.25,"turbulence_warning",2,"popups"):this.achievements.earnedAchievement("bumpy");break;case"block":var t;this.mLastSlab===null?t=this.mPlayer.worldPosition.x:(t=this.mLastSlab.worldPosition.x,t+=this.mLastSlab.allowStacking?0:this.mLastSlab.mWidth);var n=e.gap&&!this.justResetCard?e.gap:0;this.mLastSlab=this.CreateWorldEntity(Blocks).Setup(t+n,e.height+300,"block",e.length,"road"),e.stack===!0&&(this.mLastSlab.allowStacking=!0),e.checkpoint===!0&&(this.mLastSlab.checkpoint=!0),e.trackEnd===!0&&(this.mLastSlab.trackEnd=!0),this.blocks.push(this.mLastSlab),this.justResetCard=!1,e.objects&&this.generateObjects(e.objects,this.mLastSlab);break;default:}},processEvents:function(e){var t=!0;if(this.mLastSlab)if(this.mLastSlab.allowStacking)t=!0;else{var n=this.mLastSlab.worldPosition.x+this.mLastSlab.mWidth,r=this.ScreenX(n),i=(r-this.Width())/this.Width();t=i<.1}if(t){var s=this.mLevelEvents===null?null:this.mLevelEvents[this.mCurrentLevelEventIndex];s!=null?(this.processLevelEvent(s),this.mCurrentLevelEventIndex++):this.insertedCheckpoint?(this.mCurrentCardIndex++,this.mCurrentLevel=this.mCurrentCardIndex,this.mCurrentCardIndex<this.mCards.length&&this.loadCard(this.mCards[this.mCurrentCardIndex])):(this.processLevelEvent(this.checkPointEvent),this.insertedCheckpoint=!0)}},generateObjects:function(e,t){var n=t.mWidth/(e.length+1),r=t.worldPosition.x+n,i=t.worldPosition.y;for(var s=0;s<e.length;s++){var o=e.charAt(s);if(o==="G"||o==="P"||o==="W"||o==="B"||o==="J"||o==="D"||o==="T")i=t.worldPosition.y+0,this.CreateWorldEntity(Powerup).Setup(r,i,o,"objects");if(o==="R"||o==="O"||o==="M"||o==="E"){i=t.worldPosition.y-17;switch(o){case"R":break;case"O":break;case"M":break;case"E":}this.CreateWorldEntity(Obstacle).Setup(r,i,o,"objects")}r+=n}},incPlayerDistance:function(e){this.awardPoints(e/50)},awardPoints:function(e){if(this.lives<=0)return;var t=this.score,n=this.noCollisionScore;this.score+=e,this.noCollisionScore+=e,n<this.blueRemixScore&&this.noCollisionScore>=this.blueRemixScore&&this.achievements.earnedAchievement("bremix"),t<this.bestScore&&this.getScore()>=this.bestScore&&this.DisplayAchievementNotification("NEW HIGHSCORE!")},achievementPopup:function(e){var t=this.mPlayer.y>this.Height()*.6?this.Height()*.1:this.Height()*.9;this.mAchievementPopup===null?(this.mAchievementPopup=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.Width()/2,t,"achievement_popup","UI"),this.mAchievementMessage=this.CreateUIEntity(TGE.Text).Setup(this.Width()/2+20,t+12,e.name,"bold 26px Arial","center","middle","#333","UI"),this.mAchievementPopupIcon=new TGE.Sprite,this.mAchievementPopupIcon.setImage(e.imageID),this.mAchievementPopup.addChild(this.mAchievementPopupIcon),this.mAchievementPopupIcon.x=-98):(this.mAchievementMessage.text=e.name,this.mAchievementPopupIcon.setImage(e.imageID)),this.mAchievementPopupTimer=5},DisplayAchievementNotification:function(e){},DisplayStartMessage:function(e){var t=this.Width()/2,n,r;this.mStartMessageDigits=new Array;if(e>0){n="start_beat_your_score",r=this.Height()*.15;var s=!0,o=38,u=e.toString(),a=24,f=2,l=u.length*o;if(s){var c=Math.floor((u.length-1)/3);l+=c*a}var h=t+l/2+o/2;h-=o,h-=7;var p=r+60,d=0;for(i=u.length-1;i>=0;i--){if(s&&d==3){h+=f;var v=this.CreateUIEntity(TGE.ScreenEntity).Setup(h,p,null,"UI");v.setImage("big_digits_comma",1,1),v.setSpriteIndex(0),this.mStartMessageDigits.push(v),h-=a,d=0}var m=this.CreateUIEntity(TGE.ScreenEntity).Setup(h,p,null,"UI");m.setImage("big_digits",1,10),m.setSpriteIndex(u.charCodeAt(i)-48),this.mStartMessageDigits.push(m),h-=o,d++}}this.mStartMessage=this.CreateUIEntity(TGE.ScreenEntity).Setup(t,r,n,"UI"),this.mStartMessageTimer=4},loseLife:function(){this.lives--,this.redFlash(),this.noCollisionScore=0,this.AnalyticCustomEvent("crashed")},redFlash:function(){this.redOverlay.visible=!0,this.redOverlay.alpha=.6,this.onPhoneGap()&&navigator.notification.vibrate(2500)},oneUp:function(){this.lives<5&&this.lives++},getPlayer:function(){return this.mPlayer},getScore:function(){return Math.floor(this.score)},saveSettings:function(){var e=new Date,t=999;e.setDate(e.getDate()+t);var n=this.audioManager.mMuted?"1":"0",r=escape(n)+(t==null?"":"; expires="+e.toUTCString());document.cookie="muted="+r;var i=this.showTips?"1":"0";r=escape(i)+(t==null?"":"; expires="+e.toUTCString()),document.cookie="tips="+r},toggleMute:function(){this.audioManager.ToggleMute(),this.updateSoundButtons(),this.saveSettings()},updateSoundButtons:function(){this.mSoundToggleOff!==null&&(this.mSoundToggleOff.visible=this.audioManager.mMuted)},playSound:function(e){},playMusic:function(){this.audioManager.Play({id:"music",loop:!0})}},extend(VectorRunner,TGE.Game),GameOver.prototype=new TGE.Screen,GameOver.prototype.constructor=GameOver,GameOver.prototype.Setup=function(){var e=new TGE.DisplayObjectContainer;e.registrationX=e.registrationY=0,e.width=this.Game().Width(),e.height=this.Game().Height(),e.backgroundColor="#000",e.alpha=.8,this.Game().getLayer(this.mScreenManager.mLayerName).addChild(e),this.mBackground=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.51),"parallax_space",this.mScreenManager.mLayerName),this.mBackground.scaleX=this.mBackground.scaleY=3,this.mBackground.alpha=.7;var t=Math.round(this.Game().mGameTime),n=this.Game().getScore();this.Game().onPhoneGap()&&(navigator.connection.type==Connection.NONE?(this.Game().adGameOverURL="",this.Game().adGameReplayURL=""):(this.Game().adGameOverURL="",this.Game().adGameReplayURL="")),this.Game().gameAdSessionDuration+=t;var r=this.Game().gameAdSessionDuration>=this.Game().adSessionDuration&&(!this.Game().onPhoneGap()||this.Game().onPhoneGap()&&navigator.connection.type!=Connection.NONE);this.Game().onPhoneGap()||this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.05),"更多赛道即将开放!","bold 20px Arial","center","middle","#aaa",this.mScreenManager.mLayerName),this.DisplayNumber(n,this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.16),"big_digits",40,"center",!0,this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.48),"achievements_menu_button",MainMenu.prototype.showAchievements.bind(this),1,this.mScreenManager.mLayerName),this.Game().onPhoneGap()&&r?this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.33),"gameover_tryagain_button",GameOver.prototype.playAgainWithAd.bind(this),1,this.mScreenManager.mLayerName):this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.33),"gameover_tryagain_button",GameOver.prototype.playAgain.bind(this),1,this.mScreenManager.mLayerName);var i=this.mScreenManager.XFromPercentage(.14),s=this.mScreenManager.YFromPercentage(.7),o=this.mScreenManager.XFromPercentage(.17);if(!this.Game().onPhoneGap()||!this.Game().oniOS())o=this.mScreenManager.XFromPercentage(.12),i=this.mScreenManager.XFromPercentage(.1);var u=35,a=this.Game().Width()-20-300,f=this.Game().Height()-20-250;this.Game().AnalyticAchievementEvent("score",n),this.Game().AnalyticAchievementEvent("max card"),this.Game().achievements.submitScore(n),this.Game().onPhoneGap()&&this.Game().oniOS()&&this.Game().gamecenter.reportScore(this.Game().gameCenterLeaderboardID,n)},GameOver.prototype.playAgainWithAd=function(){this.Game().gameAdSessionDuration=0,this.mAd!==null&&this.mAd.close(),this.Game().onPhoneGap()&&TGE.Advertisement.DisplayChildBrowserAd({adURL:this.Game().adGameReplayURL,closeCallback:GameOver.prototype.playAgain.bind(this)})},GameOver.prototype.playAgain=function(){this.Game().playSound("button"),this.Close(),this.Game().Replay()},GameOver.prototype.lbGameCenter=function(){this.Game().gamecenter.showLeaderboard(this.Game().gameCenterLeaderboardID)},GameOver.prototype.appStoreLink_Apple=function(){this.Game().OpenURL("https://itunes.apple.com/us/app/vector-runner-remix/id582523218?mt=8&uo=4"),this.Game().AnalyticShareEvent("apple_app_store")},GameOver.prototype.appStoreLink_Google=function(){this.Game().OpenURL("https://play.google.com/store/apps/details?id=com.tresensa.vectorrunnerremix"),this.Game().AnalyticShareEvent("google_play_store")},GameOver.prototype.shareFacebook=function(){var e="http://bit.ly/QLRUtM",t="http://www.facebook.com/sharer.php?u="+encodeURIComponent(e),n=this.Game().getScore(),r="I just scored "+n+" playing the new free online html5 game Vector Runner Remix. Can you beat that?";this.Game().onPhoneGap()&&this.Game().oniOS()?(FB.login(function(e){e.session},{scope:"email"}),FB.ui({method:"feed",name:"Vector Runner Remix",caption:"Beat my score",description:r,link:e,picture:"./assets-1.1.4/images/web-image.jpg"},function(e){})):this.Game().OpenURL(t),this.Game().AnalyticShareEvent("facebook")},GameOver.prototype.shareTwitter=function(){var e="http://bit.ly/QLRUtM",t=this.Game().getScore(),n="I just scored "+t+" playing the free #html5 #mobilegame Vector Runner Remix, @VectorRemixGame. Can you beat that?";this.Game().onPhoneGap()&&this.Game().oniOS()?(n=decodeURIComponent(n),window.plugins.twitter.composeTweet(null,null,n,{urlAttach:e})):this.Game().OpenURL("http://twitter.com/home?status="+encodeURIComponent(n+" "+e)),this.Game().AnalyticShareEvent("twitter")},GameOver.prototype.shareKik=function(){cards.kik.send({title:"Vector Runner Remix",text:"I just scored "+this.Game().getScore()+" playing Vector Runner Remix. Can you beat that?"}),this.Game().AnalyticShareEvent("kik")},GameOver.prototype.showAchievements=function(){this.mAd!==null&&this.mAd.close(),this.Game().ShowScreen(AchievementsScreen)},GameOver.prototype.Destroy=function(){this.mAd!==null&&this.mAd.close(),this.Game().getLayer(this.mScreenManager.mLayerName).removeChild(this.mBackground),TGE.Screen.prototype.Destroy.call(this)},LoadingScreen.prototype=new TGE.Screen,LoadingScreen.prototype.constructor=LoadingScreen,LoadingScreen.prototype.Setup=function(){this.FillBackground("#000"),this.mLoadingText=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"已加载 0%","bold italic 40px Arial","center","middle","#fff",this.mScreenManager.mLayerName)},LoadingScreen.prototype.UpdateProgress=function(e){var t="已加载 "+Math.round(e*100).toString()+"%";this.mLoadingText.text=t},MainMenu.prototype=new TGE.Screen,MainMenu.prototype.constructor=MainMenu,MainMenu.className=function(){return"MainMenu"},MainMenu.prototype.Setup=function(){this.FillBackground("#000"),this.Game().mCameraLocation.x=0,this.Game().mCameraLocation.y=0;var e=this.Game()._mNativeScaling==null?1:this.Game()._mNativeScaling.y,t=this.Game().CreateWorldEntity(TGE.ParallaxPane).Setup(300*e,200,"parallax_space",this.mScreenManager.mLayerName);t.scaleX=3,t.scaleY=3*e,this.mBackground=new TGE.DisplayObjectContainer,this.mBackground.registrationX=this.mBackground.registrationY=0,this.mBackground.width=this.Game().Width(),this.mBackground.height=this.Game().Height(),this.mBackground.backgroundColor="#000",this.mBackground.alpha=.4,this.Game().getLayer(this.mScreenManager.mLayerName).addChild(this.mBackground),this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.28),"logo",this.mScreenManager.mLayerName);var n=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.6),"mainmenu_play_button",MainMenu.prototype.playGame.bind(this),1,this.mScreenManager.mLayerName);this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.78),"achievements_menu_button",MainMenu.prototype.showAchievements.bind(this),1,this.mScreenManager.mLayerName);var r=this.mScreenManager.FixedDistanceFromBottom(50),i=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.18),r,"dyog_plug",MainMenu.prototype.dyogPlug.bind(this),1,this.mScreenManager.mLayerName);i.alpha=.5,r=this.mScreenManager.FixedDistanceFromBottom(85),i=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.87),r,"tresensa_plug",MainMenu.prototype.tresensaPlug.bind(this),1,this.mScreenManager.mLayerName),i.alpha=.5},MainMenu.prototype.Update=function(e){TGE.Screen.prototype.Update.call(this,e);var t=this.Game(),n=t.CameraLocation().x;t.mCameraLocation.x=n+e},MainMenu.prototype.playGame=function(){this.Close(),this.Game().PlayGame()},MainMenu.prototype.showAchievements=function(){TGE.Achievements.ShowAchievementsScreen(TGE.Game.prototype.ShowScreen.bind(this.Game(),AchievementsScreen))},MainMenu.prototype.tresensaPlug=function(){this.Game().OpenURL("")},MainMenu.prototype.dyogPlug=function(){var e=TGE.BrowserDetect.platform==="iPad"||TGE.BrowserDetect.platform==="iPhone"?"http://www.digyourowngrave.com/category/html5/":"http://www.digyourowngrave.com";this.Game().OpenURL(e)},PauseScreen=function(e){return PauseScreen.superclass.constructor.call(this,e),this},PauseScreen.className=function(){return"PauseScreen"},PauseScreen.prototype={Setup:function(){this.mBackground=new TGE.DisplayObjectContainer,this.mBackground.registrationX=this.mBackground.registrationY=0,this.mBackground.width=this.Game().Width(),this.mBackground.height=this.Game().Height(),this.mBackground.backgroundColor="#000",this.mBackground.alpha=.85,this.Game().getLayer(this.mScreenManager.mLayerName).addChild(this.mBackground),this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.25),"pausescreen_resume_button",PauseScreen.prototype.resumeGame.bind(this),1,this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"pausescreen_restart_button",PauseScreen.prototype.restartGame.bind(this),1,this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.75),"pausescreen_mainmenu_button",PauseScreen.prototype.gotoMainMenu.bind(this),1,this.mScreenManager.mLayerName),this.wasMuted=this.Game().audioManager.mMuted,this.Game().audioManager.Mute()},resumeGame:function(){this.wasMuted||this.Game().audioManager.Unmute(),this.Game().PauseGame(!1)},restartGame:function(){this.wasMuted||this.Game().audioManager.Unmute(),this.Close(),this.Game().Replay()},gotoMainMenu:function(){this.wasMuted||this.Game().audioManager.Unmute(),this.Game().GotoMainMenu()},Destroy:function(){this.Game().getLayer(this.mScreenManager.mLayerName).removeChild(this.mBackground),PauseScreen.superclass.Destroy.call(this)}},extend(PauseScreen,TGE.Screen),TutorialScreen=function(e){return TutorialScreen.superclass.constructor.call(this,e),this.mBackground=null,this.mImageBackground=null,this},TutorialScreen.className=function(){return"TutorialScreen"},TutorialScreen.prototype={Setup:function(){this.mBackground=new TGE.DisplayObjectContainer,this.mBackground.registrationX=this.mBackground.registrationY=0,this.mBackground.width=this.Game().Width(),this.mBackground.height=this.Game().Height(),this.mBackground.backgroundColor="#000",this.mBackground.alpha=.85,this.Game().getLayer(this.mScreenManager.mLayerName).addChild(this.mBackground),this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.85),this.mScreenManager.YFromPercentage(.91),"tutorial_continue",TutorialScreen.prototype.resumeGame.bind(this),1,this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.16),this.mScreenManager.YFromPercentage(.91),"tutorial_notips",TutorialScreen.prototype.disableTips.bind(this),1,this.mScreenManager.mLayerName)},setTutorial:function(e){var t=this.mScreenManager.XFromPercentage(.5),n=this.mScreenManager.YFromPercentage(.38);this.mImageBackground=new TGE.DisplayObjectContainer,this.mImageBackground.width=this.mImageBackground.height=270,this.mImageBackground.backgroundColor="#fff",this.mImageBackground.alpha=.1,this.mImageBackground.x=t,this.mImageBackground.y=n,this.Game().getLayer(this.mScreenManager.mLayerName).addChild(this.mImageBackground),this.CreateUIEntity(TGE.ScreenEntity).Setup(t,n,e,this.mScreenManager.mLayerName),this.Game().assetManager.getImage(e+"_caption",false)!=null&&this.CreateUIEntity(TGE.ScreenEntity).Setup(t,n+170,e+"_caption",this.mScreenManager.mLayerName)},resumeGame:function(){this.Close(),this.Game().freezeGameplay(!1)},disableTips:function(){this.Game().disableTips(),this.resumeGame()},Destroy:function(){this.Game().getLayer(this.mScreenManager.mLayerName).removeChild(this.mBackground),this.Game().getLayer(this.mScreenManager.mLayerName).removeChild(this.mImageBackground),TutorialScreen.superclass.Destroy.call(this)}},extend(TutorialScreen,TGE.Screen),AchievementsScreen=function(e){return AchievementsScreen.superclass.constructor.call(this,e),this.mBackground=null,this},AchievementsScreen.className=function(){return"AchievementsScreen"},AchievementsScreen.prototype={Setup:function(){this.mBackground=new TGE.DisplayObjectContainer,this.mBackground.registrationX=this.mBackground.registrationY=0,this.mBackground.width=this.Game().Width(),this.mBackground.height=this.Game().Height(),this.mBackground.backgroundColor="#000",this.mBackground.mouseEnabled=!0,this.Game().getLayer(this.mScreenManager.mLayerName).addChild(this.mBackground),this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.85),"achievements_back_button",AchievementsScreen.prototype.Close.bind(this),1,this.mScreenManager.mLayerName);var e=this.Game().achievements.numberOfAchievements(),t=.15,n=.25,r=.5-e*t/2;for(var i=0;i<e;i++){var s=this.Game().achievements.getAchievementAt(i);if(s){var o=s.hasBeenEarned()?s.imageID:this.Game().achievements.lockedIconID;this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(n),this.mScreenManager.YFromPercentage(r),o,this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(n+.04),this.mScreenManager.YFromPercentage(r),s.name.toUpperCase()+"  -  "+s.description,"20px Arial","left","middle","#aaa",this.mScreenManager.mLayerName),r+=t}}},Destroy:function(){this.Game().getLayer(this.mScreenManager.mLayerName).removeChild(this.mBackground),AchievementsScreen.superclass.Destroy.call(this)}},extend(AchievementsScreen,TGE.Screen);